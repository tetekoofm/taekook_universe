;/*FB_PKG_DELIM*/

__d("EARInitType",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["EB_INIT","LS_INIT","MAW_INIT","MAW_RP_INIT","MAW_IN_UI_INIT"]);c=a;f["default"]=c}),66);
__d("EBDBConsistencyApi",["$InternalEnum","EBDB","FBLogger","I64","QPLUserFlow","ReQL","asyncToGeneratorRuntime","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=["encrypted_backups_virtual_devices","secure_encrypted_backups_recovery_code_status","device_metadata","secure_encrypted_backups_epochs","secure_encrypted_backups_client_state","encrypted_backups","experiences_shared_state","auto_restore_opt_out"],j=null;function a(){return j}function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{var e=(yield d("EBDB").getEBDB()),g=BigInt((h||(h=d("I64"))).to_string(b));yield e.runInTransaction(["device_state"],"readwrite",function(b){return b.stores.device_state.bulkPut([{deviceId:g,env:a}])},"EBDB - AddDevice",f.id+":53");j=g}catch(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("Error on EBDB - AddDevice")}});return l.apply(this,arguments)}function m(a){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state)).then(function(a){return a==null?void 0:a.deviceId})}function e(a,b,c){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,d){if(d!=null)return k(b,d);try{d=(yield m(a));if(d==null)return;return k(b,d)}catch(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("Error on fetching secure_encrypted_backups_client_state")}});return n.apply(this,arguments)}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){c("QPLUserFlow").addPoint(e,"track_overprompting_start");try{var g=(yield d("EBDB").getEBDB()),h=!1;yield g.runInTransaction(["device_state"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=(yield b.stores.device_state.get(a));(b==null?void 0:b.deviceId)!=null&&(h=!0)});return function(a){return c.apply(this,arguments)}}(),"EBDB - AddDevice",f.id+":106");c("QPLUserFlow").addAnnotations(e,{bool:{overprompting:h}});c("QPLUserFlow").addPoint(e,"track_overprompting_end")}catch(a){c("QPLUserFlow").addPoint(e,"track_overprompting_fail"),c("FBLogger")("labyrinth_web").catching(a).mustfix("Error on track overpropting")}});return p.apply(this,arguments)}var q=b("$InternalEnum")({Disabled:0,EbsmInconsistent:1,EbdbInconsistent:2,Enabled:3,Inconsistent:4});function r(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield m(a));a=a!=null?BigInt((h||(h=d("I64"))).to_string(a)):null;if(a==null&&j==null)return q.Disabled;else if(a==null&&j!=null)return q.EbsmInconsistent;else if(a!=null&&j==null)return q.EbdbInconsistent;else if(a===j)return q.Enabled;else return q.Inconsistent});return s.apply(this,arguments)}function t(a,b,c,d){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,d,e){var f=1/c("justknobx")._("3914");if(Math.random()>=f)return;f=c("qpl")._(521471316,"2831");try{c("QPLUserFlow").start(f);a=(yield r(a));e!=null&&c("QPLUserFlow").addAnnotations(f,e());c("QPLUserFlow").endSuccess(f,{annotations:{"int":{consistency:a,env:b,operation:d}}})}catch(a){c("QPLUserFlow").endFailure(f,"error"),c("FBLogger")("labyrinth_web").catching(a).mustfix("Error on trackConsistency in %s",b)}});return u.apply(this,arguments)}function v(){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("EBDB").clearDeviceState(),j=null});return w.apply(this,arguments)}var x;function y(a,b){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){x!=null&&x();yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.encrypted_backups)).then(function(a){a!=null&&((a==null?void 0:a.backupId)==null||(a==null?void 0:a.isUserOptedOut)===!0)&&void v()})["catch"](function(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("EBDBApi: EBLS error on fetching data from encrypted_backups")});x=a.tables.encrypted_backups.subscribe(function(a,b){b.operation!=="delete"&&((b.value.backupId==null||b.value.isUserOptedOut===!0)&&void v())});var e=(yield d("EBDB").getEBDB()),g=(yield e.runInTransaction(["device_state"],"readonly",function(a){return a.stores.device_state.get(b)},"EBDB - readDeviceState",f.id+":249")["catch"](function(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("EBDB error: fetching device_state")}));j=A(g==null?void 0:g.deviceId);if(j==null){g=(yield m(a));if(g==null)return;var i=BigInt((h||(h=d("I64"))).to_string(g));j=i;yield e.runInTransaction(["device_state"],"readwrite",function(a){return a.stores.device_state.bulkPut([{deviceId:i,env:b}])},"EBDB - writeDeviceState",f.id+":271")["catch"](function(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("EBDB error: write device_state")})}});return z.apply(this,arguments)}function A(a){if(a==null)return;if(typeof a==="bigint")return a;if(typeof a==="number")return BigInt(a);if(typeof a==="string")try{return BigInt(a)}catch(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("EBDBApi: Parsing string as BigInt");void v();return}if(Array.isArray(a))try{return BigInt((h||(h=d("I64"))).to_string(a))}catch(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("EBDBApi: Parsing I64 as BigInt");void v();return}c("FBLogger")("labyrinth_web").mustfix("EBDBApi: Parsing unknown as BigInt %s",String(a));void v()}g.EB_STORES=i;g.getDeviceId=a;g.addNewDevice=e;g.trackOverprompting=o;g.EBConsistencyResult=q;g.checkRegistrationConsistency=r;g.trackConsistency=t;g.clearDeviceState=v;g.startListeningDeviceRegistrations=y}),98);
__d("EBEpochChangeListener",["EBIsEbEnabled","EBIsEbEnabledSubscriber","Promise","ReQL","WAPubSub","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(){function a(a){this.$1=d("WAPubSub").simplePubSub(),this.$3=a}var c=a.prototype;c.initialize=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this;(yield d("EBIsEbEnabled").isEbEnabledLS(this.$3.tables))&&this.$4(this.$3);yield d("EBIsEbEnabledSubscriber").isEbEnabledSubscriber().then(function(b){b.subscribe(function(b){b?a.$4(a.$3):a.$2==null||a.$2()})})});function c(){return a.apply(this,arguments)}return c}();c.$4=function(a){var b=this;this.$2==null&&(this.$2=d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_epochs).subscribe(function(a,c){b.$1.publish(c)}));return this.$2};c.subscribe=function(a){return this.$1.subscribe(a)};return a}(),j;function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(j!=null)return(h||(h=b("Promise"))).resolve();j=new i(a);yield j.initialize()});return k.apply(this,arguments)}function e(a){if(j==null)throw c("err")("EBEpochChangeListener is not initialized");return j.subscribe(a)}g.initEBEpochChangeListener=a;g.subscribeToEpochChanges=e}),98);
__d("EBSMProperties",[],(function(a,b,c,d,e,f){"use strict";a=["encrypted_backups_virtual_devices","secure_encrypted_backups_recovery_code_status","device_metadata","secure_encrypted_backups_epochs","secure_encrypted_backups_client_state","encrypted_backups","experiences_shared_state","auto_restore_opt_out"];b=new Set(["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"]);c={dbVersion:5,mandatoryTables:b,persistedTables:new Set(a),persistedTablesArray:a};d=c;f["default"]=d}),66);
__d("MWEncryptedBackupsFirstRestoreUpsellTime",["EBAPIWorkerCheck","FBLogger","WebStorage","getMWEncryptedBackupsIsLocalStorageSupported"],(function(a,b,c,d,e,f,g){"use strict";var h,i="mw_encrypted_backups_restore_upsell_first_impression_time_key";function a(){var a=Date.now().toString();if(d("EBAPIWorkerCheck").runningInWorker())return k(a);if(!d("getMWEncryptedBackupsIsLocalStorageSupported").getMWEncryptedBackupsIsLocalStorageSupported())return a;try{var b;b=(b=(h||(h=c("WebStorage"))).getLocalStorage())==null?void 0:b.getItem(i);if(b==null){var e;(e=(h||(h=c("WebStorage"))).getLocalStorage())==null||e.setItem(i,a);return a}return b}catch(b){c("FBLogger")("labyrinth_web").warn("[labyrinth][web] Failed to set EB session identifier due to %s",b);return a}}var j=null;function k(a){j==null&&(j=a);return j}g.getFirstRestoreUpsellTime=a;g.getFirstRestoreUpsellTimeForEBLS=k}),98);
__d("QPLMemoryUtils",["MemoryUtils","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("MemoryUtils").getCurrentMemory();b=b.usedJSHeapSize;c("QPLUserFlow").addAnnotations(a,{"int":{usedJSHeapSizeStart:b}})}function b(a){var b=d("MemoryUtils").getCurrentMemory();b=b.usedJSHeapSize;c("QPLUserFlow").addAnnotations(a,{"int":{usedJSHeapSizeEnd:b}})}g.logMemoryForQPLStart=a;g.logMemoryForQPLEnd=b}),98);
__d("MWBroadcastChannelPolyfill",["FBLogger","LocalStorageWrapper","MessengerLogHistory","Random","recoverableViolation","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h=d("MessengerLogHistory").getInstance("client_init");function a(a){h.debug("[MWBroadcastChannelPolyfill] "+a)}function i(a){c("FBLogger")("messenger_web").mustfix(a)}var j={},k=d("LocalStorageWrapper").getStorage(a);function b(a){var b="$BroadcastChannel$"+a+"$",e=!1,f=function(a){if(a.storageArea!==k)return;var c=a.newValue;if(c==null||c==="")return;if(((a=a.key)==null?void 0:a.substring(0,b.length))!==b)return;var d=JSON.parse(c);(a=j[b])==null||a.forEach(function(a){a({data:d})})};window.addEventListener("storage",f);return{addEventListener:function(a,c){j[b]=j[b]||new Set(),j[b].add(c)},close:function(){if(e)return;e=!0;j={};window.removeEventListener("storage",f)},postMessage:function(a){if(e){c("recoverableViolation")("Broadcast channel is closed","ls_web_init");return}a=JSON.stringify(a);var f=b+String(Date.now())+"$"+String(c("Random").uint32());d("LocalStorageWrapper").setItemGuarded(k,f,a,i);c("setTimeout")(function(){d("LocalStorageWrapper").removeItemGuarded(k,f,i)},500)},removeEventListener:function(a,c){(a=j[b])==null||a["delete"](c)}}}g["default"]=b}),98);
__d("MWBroadcastChannel",["MWBroadcastChannelPolyfill"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return self.BroadcastChannel!=null?new self.BroadcastChannel(a):c("MWBroadcastChannelPolyfill")(a)}g.MWBroadcastChannel=a}),98);
__d("MWLSDatabaseNames",[],(function(a,b,c,d,e,f){"use strict";a="LightSpeed";b=a+"V3";f.name=a;f.lightspeedPrefix=b}),66);
__d("MWLSIndexedDBName",["MAWCurrentUser","MWLSDatabaseNames"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=d("MAWCurrentUser").getID();return d("MWLSDatabaseNames").lightspeedPrefix+a}g.dbName=a}),98);
__d("ReStoreTabNotifier",["CurrentMessengerUser","FBLogger","MWBroadcastChannel","MWLSIndexedDBName"],(function(a,b,c,d,e,f,g){"use strict";var h=d("CurrentMessengerUser").getIDorEIMU();function a(a){var b=d("MWBroadcastChannel").MWBroadcastChannel(a==="restore-table-"+h+"-"+d("MWLSIndexedDBName").dbName()?"mwChat-"+h:a);function e(a,d){try{b.postMessage([a,d])}catch(a){c("FBLogger")("messenger_web").catching(a).warn("Failed to broadcast changes")}}function f(a,c){b.addEventListener("message",function(b){b=b.data;var d=b[0];d===a&&c(b[1])})}return{onEventReceive:f,postMessage:e}}g["default"]=a}),98);
__d("createReStoreEBSMTablesPersistence",["CurrentMessengerUser","EBLogger","ExecutionEnvironment","MAWUnrecoverableDbErrors","MWEBODSCategory","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","MWEBUseLocalStorage","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsLocalStorageEntryEnum","ODS","Promise","QPLMemoryUtils","QPLUserFlow","Random","ReStorePersistence","ReStoreTabNotifier","WebSession","asyncToGeneratorRuntime","gkx","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l;e=d("CurrentMessengerUser").getIDorEIMU();var m=c("ReStoreTabNotifier")==null?void 0:c("ReStoreTabNotifier")("mwChat-"+e),n=null,o=!1,p=!1,q=d("EBLogger").EBLogger.tags(["EBSM","Pesistence","MainThread"]);function r(a,b,c){return(a.has(b)?a:a.set(b,c())).get(b)}function a(a){var e=(l||(l=b("Promise"))).resolve(),f="flushChangesV2",g=new Map();function s(a){return r(g,a,function(){return new Map()})}var t=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").start(c("qpl")._(521481876,"1407"),{annotations:{string:{ebSessionIdentifier:t,sessionTabId:d("WebSession").getId()}}});(k||(k=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,c("MWEBODSEntityKey.enum").START);d("QPLMemoryUtils").logMemoryForQPLStart(c("qpl")._(521481876,"1407"));function u(){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield a.rehydrateEBSMFromEBDB(s),d("QPLMemoryUtils").logMemoryForQPLEnd(c("qpl")._(521481876,"1407")),c("QPLUserFlow").endSuccess(c("qpl")._(521481876,"1407")),(k||(k=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,c("MWEBODSEntityKey.enum").SUCCESS)}catch(a){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_FAILED"),q.MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["An error occured in EBSM hydration when loading EB data: ",""])),a),c("QPLUserFlow").endFailure(c("qpl")._(521481876,"1407"),"Hydration failed."),(k||(k=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,c("MWEBODSEntityKey.enum").FAIL)}});return v.apply(this,arguments)}n=u();m==null||m.onEventReceive("flushChangesV2",function(b){b=b.changeSet;var e=new Map();b.forEach(function(a,b){e.set(b,{toAdd:[],toDelete:[]});var c=s(b);a.forEach(function(a,f){if(d("ReStorePersistence").isDeletedValue(a,d("ReStorePersistence").sentinelDeleted)){var g;(g=e.get(b))==null||g.toDelete.push(c.get(f))}else{(g=e.get(b))==null||g.toAdd.push(a)}})});if(a.updateEBSM==null){q.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["ebdbEbsmApi.updateEBSM is not defined"])));return}c("promiseDone")(a.updateEBSM(e,f))});return{flush:function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,e){var g;if(b.size===0)return;b.size>0&&b.forEach(function(a,c){a.size===0&&b["delete"](c)});if(b.size===0)return;e=((g=e.actionSource)==null?void 0:g.type)==="user_initiated"&&((g=e.actionSource)==null?void 0:g.source)===f;if(e){c("gkx")("6240")&&b.forEach(function(a,b){var c=s(b);a.forEach(function(a,b){d("ReStorePersistence").isDeletedValue(a,d("ReStorePersistence").sentinelDeleted)?c["delete"](b):c.set(b,a)})});return}var h=new Map();b.forEach(function(a,b){h.set(b,{toAdd:[],toDelete:[]});var c=s(b);a.forEach(function(a,e){if(d("ReStorePersistence").isDeletedValue(a,d("ReStorePersistence").sentinelDeleted)){var f;(f=h.get(b))==null||f.toDelete.push(c.get(e));c["delete"](e)}else{(f=h.get(b))==null||f.toAdd.push(a);c.set(e,a)}})});m==null||m.postMessage("flushChangesV2",{changeSet:b,fromVersion:"",sentinelDeleted:d("ReStorePersistence").sentinelDeleted,version:""});g=d("Random").uint32();e=Array.from(b.keys());c("QPLUserFlow").start(c("qpl")._(521485383,"2200"),{annotations:{bool:{ebsmv2:!0},string_array:{tables:e}},instanceKey:g});yield n;yield a.flushEBSMtoEBDB(h)["catch"](function(){})});function g(a,b){return e.apply(this,arguments)}return g}(),get:function(a,c,d){var e=s(c);if(o)return e.get(d);return n==null?(l||(l=b("Promise"))).reject("rehydration is not complete"):n.then(function(){o=!0;return e.get(d)})},logError:function(b,e,f,g){(k||(k=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_RESTORE_PERSISTENCE_ERROR,b);if(f==="dbCorruption"){(k||(k=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_CORRUPTION,b);f="Got unexpected undefined in ebsm, mode: "+e+", table: "+b+", id: "+((f=g==null?void 0:g.id)!=null?f:"")+", deletedInThisTxn: "+((e=g==null?void 0:g.deletedInThisTxn)!=null?e:"")+". Deleting EBSM db";q.mustfix(f);g=d("Random").uint32();d("MAWUnrecoverableDbErrors").setError(new(d("MAWUnrecoverableDbErrors").EbsmHydrationError)(f,!0,g,b),function(){c("promiseDone")(a.clearEbStores(),function(){(k||(k=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_CORRUPTION,"db_deleted.main_thread")})});p||(p=!0,d("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE,"full"))}},queueCommitWork:void 0,runExclusively:function(a){return new(l||(l=b("Promise")))(function(c,d){e=e.then(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield a()),e=b[0];b[1];try{c(yield e())}catch(a){d(a)}}))})},shouldApplySync:function(){return!1},shouldInline:function(a,b){return!1},shouldSync:function(a,b){return a==="notifyInMemoryTable"?!1:!0},tabTablesNotifier:function(){return c("gkx")("6240")?m:(j||(j=c("ExecutionEnvironment"))).isInBrowser?m:void 0},types:["ephemeral"],uniqueId:""}}g["default"]=a}),98);
__d("EBSMDBAPIDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("EBSMDBAPI").__setRef("EBSMDBAPIDeferred"),i=c("requireDeferred")("EBSMDBCleanupAPI").__setRef("EBSMDBAPIDeferred");function a(a){var b=a.force,c=a.getCache;return h.load().then(function(a){return a.makeEBIDBWorker({force:b,getCache:c})})}function b(a){var b=a.closeDb,c=b===void 0?!0:b,d=a.hasUserGivenAutoRestoreConsent;return h.load().then(function(a){return a.clearEBIDBNonPersistedRows({closeDb:c,hasUserGivenAutoRestoreConsent:d})})}function d(a){return i.load().then(function(b){return b.cleanupStateTables(a)})}g.makeEBIDBWorker=a;g.clearEBIDBNonPersistedRows=b;g.cleanupStateTables=d}),98);
__d("EBSMGating",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("24151")}g.isPersistedEBTableEnabled=a}),98);
__d("MAWIndexedDBDeletion",["CurrentMessengerUser","FBLogger","MAWIndexedDbMetadata","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,d){return indexedDB==null||a==null?(h||(h=b("Promise"))).resolve():new(h||(h=b("Promise")))(function(b,e){var f=indexedDB.deleteDatabase(a);f.onsuccess=function(){c("FBLogger")("maw_db").warn("%s db was deleted",d),b()};f.onblocked=function(){c("FBLogger")("maw_db").mustfix("Cannot delete %s db: blocked. Make sure DB is closed.",d)};f.onerror=function(){c("FBLogger")("maw_db").mustfix("Cannot delete %s db",d),e(f.error)}})}function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("CurrentMessengerUser").getID();yield (h||(h=b("Promise"))).all([i(d("MAWIndexedDbMetadata").dbName(a),"maw_v1"),i(d("MAWIndexedDbMetadata").restoreDbName2(a),"maw_v3"),i(d("MAWIndexedDbMetadata").jobsDbName(a),"signal"),i(d("MAWIndexedDbMetadata").logDbName(a),"logDb")])});return j.apply(this,arguments)}g.deleteDB=i;g.deleteMAWPersistence=a}),98);
__d("EBSMDBAPI",["EBDB","EBLogger","EBSMGating","EBSMProperties","LSMetadata","MAWCurrentUser","MAWIndexedDBDeletion","MAWIndexedDbMetadata","MWEBODSCategory","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","ODS","Promise","QPLUserFlow","asyncToGeneratorRuntime","err","gkx","justknobx","qpl","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o=null,p=d("EBLogger").EBLogger.tags([]),q=c("justknobx")._("2243");function a(){if(o==null)throw c("err")("EB state IndexedDB should've been initialized");return o}var r=(n||(n=b("Promise"))).resolve();function e(){return r}function f(a){var e=a.force,f=a.getCache;return!e&&!d("EBSMGating").isPersistedEBTableEnabled()?(n||(n=b("Promise"))).resolve():(n||(n=b("Promise"))).resolve().then(function(){if(o==null||!f){c("QPLUserFlow").start(c("qpl")._(521471732,"1454"),{annotations:{bool:{is_worker:!0}}});(m||(m=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_IDB+c("MWEBODSEntityName.enum").MW_EBSM_WORKER_SUFFIX,c("MWEBODSEntityKey.enum").START);p.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Initializing EB state DB"])));var a=indexedDB.open(d("MAWIndexedDbMetadata").ebWorkerLSDBName(d("MAWCurrentUser").getID()),c("EBSMProperties").dbVersion);return new(n||(n=b("Promise")))(function(e,g){a.onerror=function(a){c("QPLUserFlow").endFailure(c("qpl")._(521471732,"1454"),"EB state idb initialization failed"),c("QPLUserFlow").endFailure(c("qpl")._(521477507,"1406"),"Initialisation failed. Reached onerror."),p.catching(a).mustfix("EBSM idb init failed"),(m||(m=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_IDB+c("MWEBODSEntityName.enum").MW_EBSM_WORKER_SUFFIX,c("MWEBODSEntityKey.enum").FAIL),g(a)},a.onblocked=function(){p.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["EB state DB initialization: db blocked"]))),(m||(m=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_IDB+c("MWEBODSEntityName.enum").MW_EBSM_WORKER_SUFFIX,"blocked")},a.onsuccess=function(a){var b=a.target.result;p.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["EB state DB initialization successsful"])));b.onversionchange=function(){p.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["EB state DB onVersionChange: closing the db"]))),b.close()};f&&(o=b);return r.then(function(){c("QPLUserFlow").endSuccess(c("qpl")._(521471732,"1454")),(m||(m=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_IDB+c("MWEBODSEntityName.enum").MW_EBSM_WORKER_SUFFIX,c("MWEBODSEntityKey.enum").SUCCESS),e(b)})["catch"](function(a){p.catching(a).mustfix("EBSM upgrade failed. Falling back to ephemeral LSDB"),c("QPLUserFlow").endFailure(c("qpl")._(521471732,"1454"),"EB state idb upgrade failed"),(m||(m=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_IDB+c("MWEBODSEntityName.enum").MW_EBSM_WORKER_SUFFIX,"upgrade.fail"),m.bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_IDB+c("MWEBODSEntityName.enum").MW_EBSM_WORKER_SUFFIX,c("MWEBODSEntityKey.enum").FAIL),e(null)})},a.onupgradeneeded=function(a){var e=a.target.result;a=new(n||(n=b("Promise")))(function(a,b){setTimeout(function(){b(c("err")("EBSM upgrade timeout"))},q)});var f=new n(function(a){c("QPLUserFlow").addPoint(c("qpl")._(521471732,"1454"),"eb_state_idb_upgrade_start",{data:{bool:{eb_state_upgrade:!0}}});p.DEBUG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["EB state DB upgrade needed"])));for(var b of Object.keys(d("LSMetadata").schema.tableNames))c("EBSMProperties").persistedTables.has(b)&&!e.objectStoreNames.contains(b)&&e.createObjectStore(b,{autoIncrement:!0});c("QPLUserFlow").addPoint(c("qpl")._(521471732,"1454"),"eb_state_idb_upgrade_end",{data:{bool:{eb_state_upgrade:!0}}});a()});r=n.race([f,a])}})}else return o})}function s(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.hasUserGivenAutoRestoreConsent;var e=a?["secure_encrypted_backups_epochs","secure_encrypted_backups_client_state"]:[];c("gkx")("5229")&&e.push("auto_restore_opt_out");var f=Array.from(c("EBSMProperties").persistedTables).filter(function(a){return!e.includes(a)});try{var g=a?[]:["device_state"];g=g.concat(f);if(g.length>0){a=(yield d("EBDB").getEBDB());yield a.runInTransaction(g,"readwrite",function(a){return(n||(n=b("Promise"))).all(g.map(function(b){return a.stores[b].clear()}))},"EBDB - clear on logout")}}catch(a){c("recoverableViolation")(a,"labyrinth_web")}});return t.apply(this,arguments)}function u(){var a=d("MAWIndexedDbMetadata").ebWorkerLSDBName(d("MAWCurrentUser").getID());(m||(m=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_IDB+c("MWEBODSEntityName.enum").MW_EBSM_WORKER_SUFFIX,"deletion");return d("MAWIndexedDBDeletion").deleteDB(a,"ebsm")}g.getEBLSDBWorker=a;g.isDBBeingUpgradedWorker=e;g.makeEBIDBWorker=f;g.clearEBIDBNonPersistedRows=s;g.deleteEBIDBWorker=u}),98);
__d("MAWEARGenNewKeychainCryptoKey",["FBLogger","MAWCryptoConsts","MAWKeychainCrypto","MAWWebInitDataHelpers","MessengerWebInitData","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a,b=d("MAWWebInitDataHelpers").getLastAccountKeyFormatVersion(),e=(yield (a=d("MAWKeychainCrypto")).getAccountKeys(b))[0],f=a.genBrowserEncryptionKeyString(),g=a.genDatabaseEncryptionSeed();e=(yield a.encryptDataToStringBuffer(e,g));g=d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+d("MAWCryptoConsts").ENC_KEY_TTL);return{accountKeyString:yield a.generateHashString(d("MAWWebInitDataHelpers").getAccountKeysString(b)[0]),appIdOrigin:c("MessengerWebInitData").appId,expiration:g,formatVersion:b,key:f,seed:e,userKeyBaseString:yield a.generateHashString(c("MessengerWebInitData").userKeyBase)}}catch(a){throw c("FBLogger")("messenger_web").catching(a).mustfixThrow("Failed to generateNewKey")}});return h.apply(this,arguments)}g["default"]=a}),98);
__d("MAWEARKeychainDecryptionError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){function b(b){var c;c=a.call(this,b)||this;c.name="MAWEARKeychainDecryptionError";c.message=b;return c}babelHelpers.inheritsLoose(b,a);return b}(babelHelpers.wrapNativeSuper(Error));f["default"]=a}),66);
__d("MAWWorkerSetupArgs",[],(function(a,b,c,d,e,f){"use strict";var g=null;function a(a){g=a}function b(){return g}function c(){g=null}f.setWorkerSetupArgs=a;f.getWorkerSetupArgs=b;f.resetWorkerSetupArgs=c}),66);
__d("MAWGenKeychainCryptoKeyWithVersion",["ExecutionEnvironment","FBLogger","MAWCurrentUser","MAWEARKeychainDecryptionError","MAWKeychainCrypto","MAWWebInitDataHelpers","MAWWorkerSetupArgs","MessengerWebInitData","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c,d,e,f,g){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,j,k,l){g===void 0&&(g=1);try{var m=(yield d("MAWKeychainCrypto").getAccountKeys(g));a=(yield (i||(i=b("Promise"))).all([d("MAWKeychainCrypto").importBrowserEncryptionKey(a),i.all(m.map(function(a){return d("MAWKeychainCrypto").decryptDataToArrayBuffer(a,e)["catch"](function(){return null})}))]));var n=a[0];m=a[1];a=(yield i.all(m.filter(Boolean).map(function(a){return d("MAWKeychainCrypto").genDatabaseEncryptionKey(n,a)["catch"](function(){return null})})));m=a.filter(Boolean);if(m.length===0)throw new(c("MAWEARKeychainDecryptionError"))("Failed to generate keys from seed");return{keys:m,version:f}}catch(b){a=null;m=null;f=d("MAWWorkerSetupArgs").getWorkerSetupArgs();(h||(h=c("ExecutionEnvironment"))).isInWorker&&f!=null&&(a=f.userKeyBase===c("MessengerWebInitData").userKeyBase,m=f.fbId===d("MAWCurrentUser").getID());f=d("MAWWebInitDataHelpers").getAccountKeysString(g);var o=f&&f[0]!=null?yield d("MAWKeychainCrypto").generateHashString(f[0]):null;c("FBLogger")("messenger_web").catching(b).mustfix("Failed to genKeyWithVersion: accountKeyBackfilled = %s; accountKeyExists = %s; acccountKeyMatches = %s; userKeyBaseBackilled = %s; userKeyBaseExists = %s; userKeyBaseMatches = %s; appIdOrigin = %s; appIdInitData = %s; userIdMatches = %s; isInWorker = %s; userKeyBase_match_between_threads = %s; userId_match_between_threads = %s; formatVersion = %s;",j!=null,f!=null,j===o,k!=null,c("MessengerWebInitData").userKeyBase!=null,k===(yield d("MAWKeychainCrypto").generateHashString(c("MessengerWebInitData").userKeyBase)),l,c("MessengerWebInitData").appId,d("MAWCurrentUser").getID()===String(c("MessengerWebInitData").userId),(h||(h=c("ExecutionEnvironment"))).isInWorker,a,m,g);throw b}});return j.apply(this,arguments)}g["default"]=a}),98);
__d("MWEARKeychainV3Errors",[],(function(a,b,c,d,e,f){"use strict";a=function(a){function b(b){var c;c=a.call(this,b)||this;c.name="EARKeychainNotFoundError";c.message=b;return c}babelHelpers.inheritsLoose(b,a);return b}(babelHelpers.wrapNativeSuper(Error));f.EARKeychainNotFoundError=a}),66);
__d("MWTabCommunicationChannel",["MAWLocalStorage"],(function(a,b,c,d,e,f,g){"use strict";var h=typeof window!=="undefined"?window:self;function i(a){var b=d("MAWLocalStorage").getStorage(),c=function(c){d("MAWLocalStorage").setItemGuarded(b,a,JSON.stringify(c))},e=function(c){window.removeEventListener("storage",c),d("MAWLocalStorage").removeItemGuarded(b,a)},f=function(a){window.addEventListener("storage",a)},g=function(b){return b!=null&&b.key===a&&typeof b.newValue==="string"?JSON.parse(b.newValue):null};return{getMessage:g,onRequestReceived:function(a){var b=function(b){b=g(b);b!=null&&a(b)};f(b);return{release:function(){e(b)}}},sendMessage:c,stopWaitingForReply:e,waitForReply:f}}function j(a){var b=new h.BroadcastChannel(a),c=new Set();b.addEventListener("message",function(a){c.forEach(function(b){b(a)})});var d=function(a){c.add(a)},e=function(a){c["delete"](a)};a=function(a){b.postMessage(JSON.stringify(a))};var f=function(a){return a!=null&&typeof a.data==="string"?JSON.parse(a.data):null};return{getMessage:f,onRequestReceived:function(a){var b=function(b){b=f(b);b!=null&&a(b)};d(b);return{release:function(){e(b)}}},sendMessage:a,stopWaitingForReply:e,waitForReply:d}}function a(a){return h.BroadcastChannel!=null?j(a):i(a)}g.getChannel=a}),98);
__d("MWTabCommunication",["MWTabCommunicationChannel","Promise","clearTimeout","pageID","promiseDone","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(a,b){var c=this;this.$2=null;this.$5=function(a){a=c.$4.getMessage(a);a!=null&&a.a==="sb"&&a.t!==c.tabID()&&a.r===c.tabID()&&a.k!=null&&(c.$2&&c.$2(a.k),c.$4.stopWaitingForReply(c.$5),c.$2=null)};this.$1=a;this.$3=b!=null?b:500;this.$4=d("MWTabCommunicationChannel").getChannel(a)}var e=a.prototype;e.tabID=function(){return c("pageID")};e.$6=function(){var a={a:"r",t:this.tabID()};this.$4.sendMessage(a)};e.listenToRequest=function(a){return this.listenToRequestAsync(function(){return(h||(h=b("Promise"))).resolve(a())})};e.listenToRequestAsync=function(a){var b=this,d=function(d){d.a==="r"&&d.t!==b.tabID()&&c("promiseDone")(a().then(function(a){a={a:"sb",k:a,r:d.t,t:b.tabID()};b.$4.sendMessage(a)}))};return this.$4.onRequestReceived(d)};e.$7=function(){var a=this;return new(h||(h=b("Promise")))(function(b){a.$2=b,a.$4.waitForReply(a.$5),a.$6()})};e.request=function(a,d){var e=this,f,g=function(){f!=null&&c("clearTimeout")(f)};return(h||(h=b("Promise"))).race([this.$7().then(function(b){e.$4.stopWaitingForReply(e.$5);return a(b)}),new h(function(a){f=c("setTimeout")(function(){a(d()),e.$4.stopWaitingForReply(e.$5)},e.$3)})]).then(function(a){g();return a})};return a}();g.MWTabCommunication=a}),98);
__d("MWEARKeychainV3",["$InternalEnum","Deferred","ExecutionEnvironment","FBLogger","LSPlatformLsInitLog","MAWCryptoConsts","MAWCurrentUser","MAWEARGenNewKeychainCryptoKey","MAWGenKeychainCryptoKeyWithVersion","MAWQplProxy","MAWReliabilityMonitor","MWEARKeychainV3Errors","MWTabCommunication","Promise","QPLUserFlow","Random","ReStoreTabNotifier","WAArrayBufferUtils","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","getErrorSafe","gkx","memoizeOneWithArgs","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(){return{accountKey:null,databaseEncryptionKeys:new Map(),dbReady:new(c("Deferred"))(),latestVersion:d("MAWCryptoConsts").VERSION}},k={global_ear:j(),maw_ear:j()},l=null,m=function(){var a=Object.keys(k).reduce(function(a,b){a[b]="none";return a},{});return{get:function(b){return a[b]},is:function(b,c){return a[b]===c},set:function(b,c){a[b]=c;(b=l)==null||b.updateState()}}}();function a(a){k[a]=j(),m.set(a,"none")}function e(a,b){m.set(a,b)}function n(a){var b=d("Random").uint32();while(a.some(function(a){return a.randomisedVersion===b}))b=d("Random").uint32();return b}var o={global_ear:function(){return null},maw_ear:function(){return null}},p=function(a){return o[a]()},q=function(a,b){o[a]=function(){return b}},r=function(a,b){q(a,b),x(a).dbReady.resolve()},s={global_ear:"browserEncryptionMetaV2",maw_ear:"encryptionMetaV3"},t=c("memoizeOneWithArgs")(function(a,b){return new(d("MWTabCommunication").MWTabCommunication)("ear_keys_"+b+"_"+a)});function f(a,b,c){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f;e===void 0&&(e=N);c("gkx")("9396")&&c("FBLogger")("messenger_web").info("Initialise EAR keychain: %s",a);l=K(a);if(m.is(a,"success")&&x(a).databaseEncryptionKeys.size!==0)return d("WAResultOrError").makeResult(w(a));var g=d("MAWCurrentUser").getID(),h=c("ReStoreTabNotifier")("channel-ear-keychain-v3-"+g);h.onEventReceive("notifyEarKeychainV2",G);var j=(i||(i=c("ExecutionEnvironment"))).isInWorker?"Worker":"UI";e(a+"_ear_init_start",{string:(f={},f["initFlow_"+a+"_"+j]=b,f)});try{b=(yield L(h,a,void 0,e));e(a+"_ear_import_end");for(f of b)x(a).databaseEncryptionKeys.set(f.result.version,{dbEntry:f.entry,keys:f.result.keys});F(a);t(a,g).listenToRequest(function(){return JSON.stringify(Array.from(x(a).databaseEncryptionKeys.entries()).map(function(a){var b=a[0];a=a[1];var c=a.dbEntry;a=a.keys;return[b,{dbEntry:c,keys:a.map(function(a){return d("WAArrayBufferUtils").arrayBufferToString(a)})}]}))});e(a+"_ear_init_end",{string_array:(h={},h[a+"_randomisedVersionKeys"+j]=v(a).map(function(a){a[0];a=a[1].dbEntry;return String(a.randomisedVersion)}),h)});m.set(a,"success");return d("WAResultOrError").makeResult(w(a))}catch(b){m.set(a,"failure");e(a+"_ear_init_error");c("gkx")("9396")&&c("FBLogger")("messenger_web").catching(c("getErrorSafe")(b)).mustfix("Failed to setup EAR Keychain V3. Namespace: %s",a);return d("WAResultOrError").DEPRECATED_makeError("keychain-setup-failure",b)}});return u.apply(this,arguments)}function v(a){return Array.from(x(a).databaseEncryptionKeys.entries())}function w(a){return x(a).latestVersion}function x(a){return k[a]}function y(a,b){var e=b!=null?b:w(a);b=x(a).databaseEncryptionKeys.get(e);if(b==null){c("promiseDone")(C(a).then(function(a){var b=a.map(function(a){return a.version}).includes(e);c("FBLogger")("messenger_web").info("EAR Keychain DB match found: %s. Version = %s. NumberVersions = %s",b,e,a.length)}));var f=w(a),g=Array.from(x(a).databaseEncryptionKeys.keys());c("FBLogger")("messenger_web").mustfix("EAR Key v%s was null. Latest version: %s has key: %s, keychain length: %s, currentLatestVersion: %s, init status %s, in worker %s",e,f,x(a).databaseEncryptionKeys.get(f)==null,x(a).databaseEncryptionKeys.size,Math.max.apply(Math,g),m.get(a),(i||(i=c("ExecutionEnvironment"))).isInWorker);throw new(d("MWEARKeychainV3Errors").EARKeychainNotFoundError)("EAR Key "+e+" was null.")}return{dbEntry:b.dbEntry,keys:b.keys,randomisedVersion:b.dbEntry.randomisedVersion,version:e}}function z(a){return c("MAWGenKeychainCryptoKeyWithVersion")(a.key,a.seed,a.version,a.formatVersion,a.accountKeyString,a.userKeyBaseString,a.appIdOrigin)}var A=b("$InternalEnum")({UNKNOWN:-1,NO_KEY:0,EBSM_EARV2_UPGRADE:1,RANDOMISED_VERSION_UPGRADE:2,EXPIRED_KEY:3,FORCE_KEY_ROTATION:4});function B(a){if(a.length===0)return{reason:A.NO_KEY,result:!0};a=a[a.length-1];return!d("WATimeUtils").isInFuture(a.expiration)?{reason:A.EXPIRED_KEY,result:!0}:{result:!1}}function C(a){var c=E(a,"readonly");return new(h||(h=b("Promise")))(function(b,d){c.onabort=function(){return d(c.error)};c.onerror=function(){return d(c.error)};var e=c.objectStore(s[a]).getAll();e.onsuccess=function(){return b(e.result)};e.onerror=function(){return d(e.error)}}).then(D)}function D(a){var b=a.find(function(a){return a.version==null});b!=null&&c("FBLogger")("messenger_web").mustfix("EAR Keychain Rotation null version: fields nonnull: %s %s %s %s %s %s",b.id==null,b.key==null,b.seed==null,b.formatVersion==null,b.accountKeyString==null,b.userKeyBaseString==null);b=a.filter(function(a){return a.version!=null});return b.sort(function(a,b){return a.version-b.version})}function E(a,b){var d=p(a);if(d==null)throw c("FBLogger")("messenger_web").mustfixThrow("Encryption IndexDB should've been initialized. Namespace: %s",a);return d.transaction(s[a],b,{durability:"strict"})}var F=function(a){var b=Array.from(x(a).databaseEncryptionKeys.keys());b.length>0?x(a).latestVersion=Math.max.apply(Math,b):c("FBLogger")("messenger_web").mustfix("EAR latest version does not exist")},G=function(a){var d=a.namespace,e=a.version;c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{c("FBLogger")("messenger_web").info("Received key rotation notification. Namespace: %s",d);yield x(d).dbReady.getPromise();var a=(yield C(d)).find(function(a){return a.version===e});if(a==null)throw c("FBLogger")("messenger_web").mustfixThrow("Notified new Ear Key but missing in DB");var b=(yield z(a));x(d).databaseEncryptionKeys.set(b.version,{dbEntry:a,keys:b.keys});F(d);c("FBLogger")("messenger_web").info("Rotated key successfully. Namespace: %s",d)}catch(a){return c("FBLogger")("messenger_web").catching(a).mustfix("Failed to handleNewVersion. In worker %s. Namespace: %s.",(i||(i=c("ExecutionEnvironment"))).isInWorker,d)}})())};function H(a){return m.get(a)!=="none"}function I(a){return m.get(a)}function J(a){if(m.is(a,"success")){x(a).databaseEncryptionKeys.size===0&&c("FBLogger")("messenger_web").mustfix("Keychain initialised but no keys present");return!0}return!1}function K(a){return d("MAWReliabilityMonitor").MAWReliabilityMonitorSingleton.startMonitoring("EARv3",function(){return{extra:{isKeychainInitialised:J(a).toString(),latestVersion:w(a).toString()},reason:m.get(a),state:function(){switch(m.get(a)){case"none":return d("MAWReliabilityMonitor").HealthReportState.PENDING;case"success":return d("MAWReliabilityMonitor").HealthReportState.OK;case"failure":return d("MAWReliabilityMonitor").HealthReportState.ERROR;default:return d("MAWReliabilityMonitor").HealthReportState.UNKNOWN}}()}})}function L(a,b,c,d){return M.apply(this,arguments)}function M(){M=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,d,e,f){var g=(yield c("MAWEARGenNewKeychainCryptoKey")());f(d+"_ear_raw_key_generated");var j=(yield new(h||(h=b("Promise")))(function(b,h){var j=E(d,"readwrite");j.onerror=function(){return h(j.error)};j.onabort=function(){return h(j.error)};var k=j.objectStore(s[d]).getAll();k.onerror=function(){return h(k.error)};k.onsuccess=function(){var l;f(d+"_ear_keys_fetched");var m=D(k.result),o=B(m),p=o.reason;o=o.result;if((e==null?void 0:e.forceKeyRotation)!==!0&&!o)return b(m);o=(e==null?void 0:e.forceKeyRotation)===!0?A.FORCE_KEY_ROTATION:p!=null?p:A.UNKNOWN;p=m.map(function(a){return a.version});l=(l=p[p.length-1])!=null?l:0;c("FBLogger")("messenger_web").info("Key rotation. EAR versions: %s. Latest version: %s. Namespace: %s, Worker: %s",p.toString(),l,d,(i||(i=c("ExecutionEnvironment"))).isInWorker);var q=babelHelpers["extends"]({},g,{randomisedVersion:n(m),source:o,version:l+1});f(d+"_ear_adding_new_key");j.oncomplete=function(){m.push(babelHelpers["extends"]({},q,{id:q.version})),a.postMessage("notifyEarKeychainV2",{namespace:d,version:q.version}),f(d+"_ear_gen_key_end"),b(m)};var r=j.objectStore(s[d]).add(q);r.onerror=function(){return h(c("FBLogger")("messenger_web").catching(r.error).mustfixThrow("Failed to rotate EAR key"))}}}));f(d+"_ear_import_start");j=(yield h.allSettled(j.map(function(a){return z(a).then(function(b){return{entry:a,result:b}})})));var k=j[j.length-1];if(k.status==="rejected"){var l;l=(l=e==null?void 0:e.corruptedEARRetryCount)!=null?l:0;if(l>=1)throw k.reason;return L(a,d,{corruptedEARRetryCount:l+1,forceKeyRotation:!0},f)}return j.map(function(a){if(a.status==="fulfilled")return a.value}).filter(Boolean)});return M.apply(this,arguments)}var N=function(a,b){d("LSPlatformLsInitLog").addPoint(a,b),O(a,b)},O=function(a,b){var e=c("qpl")._(25310776,"6155");(i||(i=c("ExecutionEnvironment"))).isInWorker?d("MAWQplProxy").sendQplPointThroughBridge(e,"backend_"+a,{annotations:b}):(c("QPLUserFlow").addPoint(e,"ui_"+a),b!=null&&c("QPLUserFlow").addAnnotations(e,b))},P=function(a,b){return t(a,b).request(function(b){b=JSON.parse(b);b.forEach(function(b){var c=b[0];b=b[1];var e=b.keys.map(d("WAArrayBufferUtils").stringToArrayBuffer);x(a).databaseEncryptionKeys.set(c,{dbEntry:b.dbEntry,keys:e})});F(a);m.set(a,"success");return!0},function(){return!1})};g.InitStatus=m;g.resetKeychain__TEST_ONLY_DO_NOT_USE=a;g.setInitStatus__TEST_ONLY_DO_NOT_USE=e;g.generateNewRandomisedVersionNumber=n;g.setNamespaceSourceDbWithoutMarkingDbReady=q;g.setNamespaceSourceDbAndMarkAsReady=r;g.getEncryptionKeysTabCommunication=t;g.init=f;g.getLatestVersion=w;g.getKeychain=x;g.getDbEncryptionKey=y;g.isKeychainSettled=H;g.getKeychainInitStatus=I;g.isKeychainInitialised=J;g.logMawInitPoint=O;g.importKeysFromOtherTab=P}),98);
__d("MAWLSDBEncryption",["FBLogger","I64","LSPlatformErrorChannel","MAWCryptoConsts","MAWKeychainCrypto","MAWKeychainNaClCrypto","MAWKeychainUtil","MWEARKeychainV3","QPLUserFlow","nullthrows","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=typeof window!=="undefined"?window:self,j="EBSMDecryptionFailure",k=function(b){function a(a,c){var d;a=a+" - Encrypted Restore was unable to decrypt an entity for table "+c;d=b.call(this,a)||this;d.message=a;d.name=j;d.tableName=c;return d}babelHelpers.inheritsLoose(a,b);var c=a.prototype;c.getTableName=function(){return this.tableName};return a}(babelHelpers.wrapNativeSuper(Error));function l(a){a=atob(a);var b=a.length,c=new Uint8Array(b);for(var d=0;d<b;d++)c[d]=a.charCodeAt(d);return c.buffer}function m(a){var b="";a=new Uint8Array(a);var c=a.byteLength;for(var d=0;d<c;d++)b+=String.fromCharCode(a[d]);return i.btoa(b)}function n(a){return c("nullthrows")(JSON.stringify(a,function(a,b){if((h||(h=d("I64"))).isI64(b))return{type:"64",value:[b[0],b[1]]};else if(a===""||b===null||typeof b==="string"||typeof b==="number"||typeof b==="boolean"||Array.isArray(b))return b;else if(b===void 0)return{type:"u"};else if(b instanceof ArrayBuffer)return{type:"ab",value:m(b)};else if(b instanceof Uint8Array)return{l:b.byteLength,o:b.byteOffset,type:"ui8",value:m(b.buffer)};else if(b instanceof Map)return{e:n(Array.from(b.entries())),type:"m"};else if(b instanceof Set)return{type:"s",v:n(Array.from(b.values()))};else if(typeof b==="object")return{type:"o",value:n(b)};throw c("FBLogger")("maw_ear").mustfixThrow('Value not supported when stringifying "%s"',b.toString())}))}function o(a){return JSON.parse(a,function(a,b){if(a===""||b===null||typeof b==="string"||typeof b==="number"||typeof b==="boolean"||Array.isArray(b))return b;else if(typeof b==="object")if(b.type==="64")return(h||(h=d("I64"))).mk(b.value[1],b.value[0]);else if(b.type==="u")return void 0;else if(b.type==="ab")return l(b.value);else if(b.type==="ui8")return new Uint8Array(l(b.value),b.o,b.l);else if(b.type==="o")return o(b.value);else if(b.type==="m")return new Map(o(b.e));else if(b.type==="s")return new Set(o(b.v));throw c("FBLogger")("maw_ear").mustfixThrow('Value not supported when parsing "%s"',b.toString())})}function a(a,b){try{var e=d("MWEARKeychainV3").getDbEncryptionKey("global_ear"),f=e.keys;f=f[0];e=e.version;e=d("MAWKeychainUtil").makeAAD(e,d("MAWCryptoConsts").CIPHER_ID);return p(f,c("nullthrows")(n(a)),e)}catch(a){throw c("FBLogger")("messenger_web").mustfixThrow(a.message+" - Encrypted LSDB was unable to encrypt an entity for table "+b)}}function b(a,b){try{var e=d("MAWKeychainCrypto").getKeyVersionFromCipherData(a),f=e.aadLengthInBytes;e=e.keyVersion;var g=d("MWEARKeychainV3").getDbEncryptionKey("global_ear",e),h=g.dbEntry;g=g.keys;g=g[0];g=q(g,a,e,h.formatVersion,f);return c("nullthrows")(o(g))}catch(a){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_DECRYPTION_FAILURE_ON_"+b.toUpperCase());c("LSPlatformErrorChannel").emit(new k(a.message,b));throw new k(a.message,b)}}function p(a,b,c){b=new TextEncoder().encode(b).buffer;return d("MAWKeychainNaClCrypto").encryptTweetNaClArrayBuffer(a,new Uint8Array(b),c)}function q(a,b,c,e,f){a=d("MAWKeychainNaClCrypto").decryptTweetNaClArrayBuffer(a,b,c,e,f);return new TextDecoder().decode(a)}g.ERROR_NAME=j;g.EBSMDecryptionFailure=k;g.stringify=n;g.parse=o;g.encryptLSDBObj=a;g.decryptLSDBObj=b}),98);
__d("EBSMHydrationUtils",["EBAPIWorkerCheck","EBLogger","EBSMDBAPI","EBSMProperties","MAWLSDBEncryption","MWEBUseLocalStorage","MWEncryptedBackupsLocalStorageEntryEnum","Promise","QPLUserFlow","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o=d("EBLogger").EBLogger.tags(["EBSM"]);function p(a){var b=[];a=a;while(a!==0)b.push(a.hd),a=a.tl;return b}function q(a,e){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_GET_ROWS_OF_"+e.toUpperCase());return new(n||(n=b("Promise")))(function(b,f){var g=[],i,j;try{j=a.transaction(e,"readonly"),i=j.objectStore(e).openCursor()}catch(a){o.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["EBSM hydration failed due to IDB transaction error: ",""])),String(a));return f(null)}i.onsuccess=function(a){a=a.target.result;if(a){var b=a.key,c=a.value;c=d("MAWLSDBEncryption").decryptLSDBObj(c,e);c!=null&&c.isLeaf!==void 0&&(c.keys!==void 0&&Array.isArray(c.keys)&&c.keys.length>0&&!Array.isArray(c.keys[0])&&(c.keys=c.keys.filter(function(a){return a!=null&&typeof a==="object"&&!Array.isArray(a)}).map(function(a){return p(a)})));g.push({key:b,value:c});a["continue"]()}};i.onerror=function(a){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_CURSOR_ERROR_ON_"+e.toUpperCase());return f(a)};j.onerror=function(a){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_TRANSACTION_ERROR_"+e.toUpperCase());return f(a)};j.onabort=function(a){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_TRANSACTION_ABORT_ERROR_"+e.toUpperCase());return f(a)};j.oncomplete=function(){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_TRANSACTION_COMPLETE_"+e.toUpperCase()),b(g)}})}function a(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=new Map();yield d("EBSMDBAPI").isDBBeingUpgradedWorker();c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_LOAD_DATA_FROM_IDB");return(n||(n=b("Promise"))).all(Array.from(c("EBSMProperties").persistedTables).map(function(b){if(!a.objectStoreNames.contains(b)){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_TABLE_"+b.toUpperCase()+"_NOT_IN_IDB");o.WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Hydration not performed for "," because its not present in IDB"])),b);return!0}var f=q(a,b),g=new Map();return f.then(function(a){a.map(function(a,b){g.set(a,b)});e.set(b,g);if(b==="secure_encrypted_backups_client_state"&&g.size===0){a=d("EBAPIWorkerCheck").runningInWorker()?!1:d("MWEBUseLocalStorage").mwEBGetIsLocalStorageEntryValuePresent(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION);a&&c("QPLUserFlow").addAnnotations(c("qpl")._(521481876,"1407"),{string:{missing_eb_keys:"true"}})}c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_DONE_ON_"+b.toUpperCase());o.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Hydrated ",": "," rows"])),b,g.size);return!0},function(){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_FAILED_ON_"+b.toUpperCase());o.MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Error loading table "," from EB State db to in memory ReStore"])),b);return!1})})).then(function(a){var d=!0;a.forEach(function(a){a||(d=!1)});if(d){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_DONE_ON_ALL_TABLES_SUCCESSFULLY");o.DEBUG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Loaded data from EB State db to in memory ReStore"])));return(n||(n=b("Promise"))).resolve(e)}else{c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_FAILED_TO_LOAD_DATA_FROM_IDB");o.MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Error loading data from EB State db to in memory ReStore"])));return(n||(n=b("Promise"))).reject(e)}})});return r.apply(this,arguments)}g.getAllRowsByTableName=q;g.loadEBdataToEphemeralRestore=a}),98);
__d("promiseFromRequest",[],(function(a,b,c,d,e,f){"use strict";function a(a){return new self.Promise(function(b,c){a.onsuccess=function(a){b(a.target.result)},a.onerror=function(a){c(a)}})}f["default"]=a}),66);
__d("createReStoreEBSMWorkerTablesPersistance",["EBLogger","EBSMDBAPIDeferred","EBSMHydrationUtils","MAWIndexedDbMetadata","MAWLSDBEncryption","MAWUnrecoverableDbErrors","MWEBODSCategory","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","MWEBUseLocalStorage","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsLocalStorageEntryEnum","ODS","Promise","QPLUserFlow","Random","ReStorePersistence","WAExceededStorageQuota","WebSession","asyncToGeneratorRuntime","promiseDone","promiseFromRequest","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=null,l=!1,m=!1,n=d("EBLogger").EBLogger.tags(["EBSM","Pesistence","MainThread"]);function o(a,b,c){return(a.has(b)?a:a.set(b,c())).get(b)}function a(a,e){a===void 0&&(a=!1);var f=(j||(j=b("Promise"))).resolve(),g=new Map();function p(a){return o(g,a,function(){return new Map()})}var q=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").start(c("qpl")._(521481876,"1407"),{annotations:{bool:{is_worker:!0},string:{ebSessionIdentifier:q,sessionTabId:d("WebSession").getId()}}});(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION+c("MWEBODSEntityName.enum").MW_EBSM_WORKER_SUFFIX,c("MWEBODSEntityKey.enum").START);function r(){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield e);if(a==null)return;a=d("EBSMHydrationUtils").loadEBdataToEphemeralRestore(a);return a.then(function(a){a.forEach(function(a,b){var c=p(b);a.forEach(function(a,b){c.set(b.key,b.value)})}),c("QPLUserFlow").endSuccess(c("qpl")._(521481876,"1407")),(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION+c("MWEBODSEntityName.enum").MW_EBSM_WORKER_SUFFIX,c("MWEBODSEntityKey.enum").SUCCESS)},function(){c("QPLUserFlow").addPoint(c("qpl")._(521481876,"1407"),"EBSM_HYDRATION_FAILED"),n.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["An error occured in EBSM hydration when loading EB data"]))),c("QPLUserFlow").endFailure(c("qpl")._(521481876,"1407"),"Hydration failed."),(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_HYDRATION+c("MWEBODSEntityName.enum").MW_EBSM_WORKER_SUFFIX,c("MWEBODSEntityKey.enum").FAIL)})});return s.apply(this,arguments)}k=r();return{flush:function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(f){if(f.size===0)return;f.size>0&&f.forEach(function(a,b){a.size===0&&f["delete"](b)});if(f.size>0){f.forEach(function(a,b){var c=p(b);a.forEach(function(a,b){d("ReStorePersistence").isDeletedValue(a,d("ReStorePersistence").sentinelDeleted)?c["delete"](b):c.set(b,a)})});if(a)return;var g=d("Random").uint32(),h=Array.from(f.keys());c("QPLUserFlow").start(c("qpl")._(521485383,"2200"),{annotations:{bool:{ebsmv2:!0,is_worker:!0},string_array:{tables:h}},instanceKey:g});yield k;var i=(yield e);if(i==null)return;var l=i.transaction(i.objectStoreNames,"readwrite",{durability:"relaxed"});d("WAExceededStorageQuota").listenToQuotaExceededError(l);h=new window.Promise(function(a,d){l.oncomplete=function(b){c("QPLUserFlow").endSuccess(c("qpl")._(521485383,"2200"),{instanceKey:g}),a(b.target.result)},l.onerror=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,e,h=Array.from(f).map(function(a){a=a[0];return a}).join(", ");n.mustfix("[labyrinth_web] An error occured in flush. "+(a==null||(b=a.target)==null?void 0:b.error)+". Requested stores: "+h);c("QPLUserFlow").endFailure(c("qpl")._(521485383,"2200"),a==null||(e=a.target)==null?void 0:e.error,{instanceKey:g});d(a)});return function(b){return a.apply(this,arguments)}}()});yield (j||(j=b("Promise"))).all(Array.from(f).map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a[0];a=a[1];if(e!=null&&i.objectStoreNames.contains(e)){var f=l.objectStore(e);yield (j||(j=b("Promise"))).all(Array.from(a).map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a[0];a=a[1];if(d("ReStorePersistence").isDeletedValue(a))yield c("promiseFromRequest")(f["delete"](b));else{a=d("MAWLSDBEncryption").encryptLSDBObj(a,e);yield c("promiseFromRequest")(f.put(a,b))}});return function(b){return a.apply(this,arguments)}}()))}else n.mustfix("[labyrinth_web][EB SM] EB SM tableName is "+e+" is missing in "+Array.from(i.objectStoreNames).toString())});return function(b){return a.apply(this,arguments)}}()));yield h}});function g(a){return f.apply(this,arguments)}return g}(),get:function(a,c,d){var e=p(c);if(l)return e.get(d);return k==null?(j||(j=b("Promise"))).reject("rehydration is not complete"):k.then(function(){l=!0;return e.get(d)})},logError:function(a,b,e,f){(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_RESTORE_PERSISTENCE_ERROR+c("MWEBODSEntityName.enum").MW_EBSM_WORKER_SUFFIX,a);if(e==="dbCorruption"){(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_CORRUPTION+c("MWEBODSEntityName.enum").MW_EBSM_WORKER_SUFFIX,a);e="Got unexpected undefined in worker ebsm, mode: "+b+", table: "+a+", id: "+((e=f==null?void 0:f.id)!=null?e:"")+", deletedInThisTxn: "+((b=f==null?void 0:f.deletedInThisTxn)!=null?b:"")+". Deleting EBSM db";n.mustfix(e);f=d("Random").uint32();d("MAWUnrecoverableDbErrors").setError(new(d("MAWUnrecoverableDbErrors").EbsmHydrationError)(e,!0,f,a),function(){c("promiseDone")(d("EBSMDBAPIDeferred").cleanupStateTables(d("MAWIndexedDbMetadata").EBSM_WORKER_DB_PREFIX),function(){(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_CORRUPTION,"db_deleted.worker")})});m||(m=!0,d("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE,"full"))}},queueCommitWork:void 0,runExclusively:function(a){return new(j||(j=b("Promise")))(function(c,d){f=f.then(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield a()),e=b[0];b[1];try{c(yield e())}catch(a){d(a)}}))})},shouldApplySync:function(){return!1},shouldInline:function(a,b){return!1},shouldSync:function(a,b){return a==="notifyInMemoryTable"?!1:!0},types:["ephemeral"],uniqueId:""}}g["default"]=a}),98);
__d("createReStoreTableNameAllowListPersistence",["Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c,d){var e;return{clearCache:function(){a.clearCache==null||a.clearCache(),c.clearCache==null||c.clearCache()},close:function(){a.close==null||a.close(),c.close==null||c.close()},flush:function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e,f){var h=new Map(),i=new Map();e.forEach(function(a,b){d.has(b)?i.set(b,a):h.set(b,a)});yield (g||(g=b("Promise"))).all([a.flush(h,f),c.flush(i,f)])});function f(a,b){return e.apply(this,arguments)}return f}(),get:function(b,e,f,g){return d.has(e)?c.get(b,e,f,g):a.get(b,e,f,g)},isClosed:function(){return(a.isClosed==null?void 0:a.isClosed())||!1},isPersistenceSupported:a.isPersistenceSupported,logError:function(b,e,f,g){d.has(b)?c.logError==null||c.logError(b,e,f,g):a.logError==null||a.logError(b,e,f,g)},permitsSynchronousIO:function(b){if(d.has(b)){var e;return(e=c.permitsSynchronousIO==null?void 0:c.permitsSynchronousIO(b))!=null?e:!1}else{return(e=a.permitsSynchronousIO==null?void 0:a.permitsSynchronousIO(b))!=null?e:!1}},runExclusively:function(d,e){return a.runExclusively(function(){return new(g||(g=b("Promise")))(function(a,f){var h=c.runExclusively(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var c=(yield d()),e=c[0],f=c[1],i=new(g||(g=b("Promise")))(function(b){a([function(){b();return h},f])});return[b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield i;return e()}),f]}),e);h["catch"](f)})},e)},shouldApplySync:function(b,e){if(d.has(e))return c.shouldApplySync(b,e);else return a.shouldApplySync(b,e)},shouldInline:function(b,e){return d.has(b)?c.shouldInline(b,e):a.shouldInline(b,e)},shouldSync:function(b,e){if(d.has(e))return c.shouldSync(b,e);else return a.shouldSync(b,e)},tabTablesNotifier:(e=a.tabTablesNotifier)!=null?e:c.tabTablesNotifier,types:[].concat(a.types,c.types),uniqueId:c.uniqueId+a.uniqueId}}f["default"]=a}),66);
__d("LSJSEBInMemoryStorage",["EBSMProperties","createLSReStoreEphemeralPersistence","createReStoreEBSMTablesPersistence","createReStoreEBSMWorkerTablesPersistance","createReStoreTableNameAllowListPersistence"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=c("createReStoreTableNameAllowListPersistence")(d("createLSReStoreEphemeralPersistence").createLSReStoreEphemeralPersistence(),c("createReStoreEBSMTablesPersistence")(a),c("EBSMProperties").persistedTables);return a}function b(a,b){b===void 0&&(b=!1);b=c("createReStoreTableNameAllowListPersistence")(d("createLSReStoreEphemeralPersistence").createLSReStoreEphemeralPersistence(),c("createReStoreEBSMWorkerTablesPersistance")(b,a),c("EBSMProperties").persistedTables);return b}g.makeReStorePersistence=a;g.makeReStoreWorkerPersistence=b}),98);
__d("WADbSignal",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a,b,c){return a+"_"+b+"_"+c}c={abProps:"abProps",authKeyPair:"authKeyPair",cat:"cat",certificateChain:"certificateChain",clockSkew:"clockSkew",deviceId:"deviceId",deviceUUID:"deviceUUID",edgeInfo:"edgeInfo",fbid:"fbid",identityKeyPair:"identityKeyPair",lastPrekeyGenerationId:"lastPrekeyGenerationId",lastPrekeyId:"lastPrekeyId",lastSessionDeviceWasLinkedTo:"lastSessionDeviceWasLinkedTo",lastSignedPrekeyId:"lastSignedPrekeyId",regId:"regId",registrationVersion:"registrationVersion",deviceRegUnixTime:"deviceRegUnixTime"};({msgrDeviceId:"msgrDeviceId"});d={registrationHistory:"registrationHistory"};f.unsafeCoerceToSenderKeySessionId=a;f.buildSenderKeySessionId=b;f.MetaKeysEnum=c;f.PlainTextMetaKeysEnum=d}),66);
__d("WAHandleFailureUtils",["WABridge","WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";c={GENERIC_FAILURE:"400",NOT_AUTHORIZED:"401",TEMP_BANNED:"402",BANNED:"403",CAT_EXPIRED:"413",CAT_INVALID:"414",NOT_FOUND:"415",CAT_SESSION_INVALID:"418",INTERNAL_ERROR:"500",SERVER_UNAVAILABLE:"503"};function h(){return d("WAGlobals").getDependencies().clearSignalAndTempStores()}function a(){return h().then(function(){d("WABridge").getBridge().fireAndForget("event","logout",{})})}function b(){return h().then(function(){d("WABridge").getBridge().fireAndForget("event","reregisterDevice",{})})}g.FAILURE_CODES=c;g.clearRegistrationAndTempData=h;g.deregisterPhone=a;g.reregisterPhone=b}),98);
__d("WASignalDB",["BrowserLockManager","QPLFlow","WAHandleFailureUtils","WAHex","WAIDBTypes","WALogger","WAResolvable","Worm","WormEAR","WormIDbDriver","WormIDbUtils","asyncToGeneratorRuntime","err","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i={identity:{primaryKey:"deviceJid",indexes:{userJid:{fields:["userJid"],unique:!1}}},contacts:{primaryKey:"contactJid"},session:{primaryKey:"id"},senderKeySessions:{primaryKey:"id",indexes:{groupJid:{fields:["groupJid"],unique:!1},userJid:{fields:["userJid"],unique:!1}}},prekey:{primaryKey:"keyId"},prekeyGeneration:{primaryKey:"generationId"},signedPrekey:{primaryKey:"keyId"},meta:{primaryKey:"key"},plaintextMeta:{primaryKey:"key",secure:!1},icdcFails:{primaryKey:"contactJid"},personalSenderKeyStatuses:{primaryKey:"groupJid"}},j,k=new(d("WAResolvable").Resolvable)();function a(a,b,c,d,e,f){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,l,m){var o=m!=null?d("QPLFlow").startQPLFlow(m,{timeoutInMs:c("justknobx")._("3415"),annotations:{string:{operationType:"initDb"}}}):null;try{yield n(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=d("WAHex").parseHex(e),c="signalDb";b=new(d("WormEAR").WormEAR)(i,c,b);c=new(d("Worm").WormDatabase)(new(d("WormIDbDriver").WormIDbDriver)(a,c,i,b,l,{blockingErrorThreshold:f,onBlockingError:g,safeToDeleteStores:new Set(["stanzaQueue","danglingQueue","migration"]),onTransactionError:function(b){if(b instanceof d("WormEAR").DecryptionError){b=b;if(b.store==="icdcFails")return;void d("WormIDbUtils").promisifyIDbRequest(d("WAIDBTypes").idb().deleteDatabase(a)).then(function(){return d("WAHandleFailureUtils").reregisterPhone()})}}}),m);j=c;yield c.init({eventFlow:o});k.resolve(c);o==null||o.endSuccess()}))}catch(a){o==null||o.endFail("error");d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[WORM] Error performing initDb: ",""])),a);throw a}});return l.apply(this,arguments)}function e(){if(j==null)throw c("err")("Signal Db v3 is not initialized");return j}function f(){return k.promise}function m(a){return"Signal - "+a}function n(a){return c("BrowserLockManager")!=null?c("BrowserLockManager").request("wajs_make_signal_v3_db",a):a()}g.makeSignalDb=a;g.getDb=e;g.getDbPromise=f;g.signalOp=m}),98);
__d("WACryptoPrimitives",["tweetnacl"],(function(a,b,c,d,e,f,g){"use strict";b={scalarbase:(a=d("tweetnacl")).lowlevel.scalarbase,crypto_hash:a.lowlevel.crypto_hash,modL:a.lowlevel.modL,pack25519:a.lowlevel.pack25519,S:a.lowlevel.S,M:a.lowlevel.M,A:a.lowlevel.A,Z:a.lowlevel.Z,D:a.lowlevel.D,unpack25519:a.lowlevel.unpack25519,pow2523:a.lowlevel.pow2523,crypto_verify_32:a.lowlevel.crypto_verify_32,set25519:a.lowlevel.set25519,add:a.lowlevel.add,scalarmult:a.lowlevel.scalarmult};g.hash=a.hash;g.scalarMult=a.scalarMult;g.verify=a.verify;g.lowlevel=b;g.keypairFromSecretKey=a.box.keyPair.fromSecretKey;g.keyPair=a.box.keyPair;g.signDetachedVerify=a.sign.detached.verify}),98);
__d("WASignalLocalStorageProtocol.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={},k={},l={},m={},n={},o={},p={},q={};a.internalSpec={sessionVersion:[1,(d=d("WAProtoConst")).TYPES.UINT32],localIdentityPublic:[2,d.TYPES.BYTES],remoteIdentityPublic:[3,d.TYPES.BYTES],rootKey:[4,d.TYPES.BYTES],previousCounter:[5,d.TYPES.UINT32],senderChain:[6,d.TYPES.MESSAGE,e],receiverChains:[7,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e],pendingKeyExchange:[8,d.TYPES.MESSAGE,c],pendingPreKey:[9,d.TYPES.MESSAGE,b],remoteRegistrationId:[10,d.TYPES.UINT32],localRegistrationId:[11,d.TYPES.UINT32],needsRefresh:[12,d.TYPES.BOOL],aliceBaseKey:[13,d.TYPES.BYTES]};b.internalSpec={preKeyId:[1,d.TYPES.UINT32],signedPreKeyId:[3,d.TYPES.INT32],baseKey:[2,d.TYPES.BYTES]};c.internalSpec={sequence:[1,d.TYPES.UINT32],localBaseKey:[2,d.TYPES.BYTES],localBaseKeyPrivate:[3,d.TYPES.BYTES],localRatchetKey:[4,d.TYPES.BYTES],localRatchetKeyPrivate:[5,d.TYPES.BYTES],localIdentityKey:[7,d.TYPES.BYTES],localIdentityKeyPrivate:[8,d.TYPES.BYTES]};e.internalSpec={senderRatchetKey:[1,d.TYPES.BYTES],senderRatchetKeyPrivate:[2,d.TYPES.BYTES],chainKey:[3,d.TYPES.MESSAGE,h],messageKeys:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,f]};f.internalSpec={index:[1,d.TYPES.UINT32],cipherKey:[2,d.TYPES.BYTES],macKey:[3,d.TYPES.BYTES],iv:[4,d.TYPES.BYTES]};h.internalSpec={index:[1,d.TYPES.UINT32],key:[2,d.TYPES.BYTES]};i.internalSpec={currentSession:[1,d.TYPES.MESSAGE,a],previousSessions:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,a]};j.internalSpec={id:[1,d.TYPES.UINT32],publicKey:[2,d.TYPES.BYTES],privateKey:[3,d.TYPES.BYTES]};k.internalSpec={id:[1,d.TYPES.UINT32],publicKey:[2,d.TYPES.BYTES],privateKey:[3,d.TYPES.BYTES],signature:[4,d.TYPES.BYTES],timestamp:[5,d.TYPES.FIXED64]};l.internalSpec={publicKey:[1,d.TYPES.BYTES],privateKey:[2,d.TYPES.BYTES]};m.internalSpec={senderKeyId:[1,d.TYPES.UINT32],senderChainKey:[2,d.TYPES.MESSAGE,p],senderSigningKey:[3,d.TYPES.MESSAGE,n],senderMessageKeys:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,o]};n.internalSpec={"public":[1,d.TYPES.BYTES],"private":[2,d.TYPES.BYTES]};o.internalSpec={iteration:[1,d.TYPES.UINT32],seed:[2,d.TYPES.BYTES]};p.internalSpec={iteration:[1,d.TYPES.UINT32],seed:[2,d.TYPES.BYTES]};q.internalSpec={senderKeyStates:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,m]};g.SessionStructureSpec=a;g.SessionStructure$PendingPreKeySpec=b;g.SessionStructure$PendingKeyExchangeSpec=c;g.SessionStructure$ChainSpec=e;g.SessionStructure$Chain$MessageKeySpec=f;g.SessionStructure$Chain$ChainKeySpec=h;g.RecordStructureSpec=i;g.PreKeyRecordStructureSpec=j;g.SignedPreKeyRecordStructureSpec=k;g.IdentityKeyPairStructureSpec=l;g.SenderKeyStateStructureSpec=m;g.SenderKeyStateStructure$SenderSigningKeySpec=n;g.SenderKeyStateStructure$SenderMessageKeySpec=o;g.SenderKeyStateStructure$SenderChainKeySpec=p;g.SenderKeyRecordStructureSpec=q}),98);
__d("WATypedArraysCast",["WABase64"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b instanceof a)return b;return typeof b==="string"?new a(d("WABase64").decodeB64(b)):new a(b)}g.castTypedArrays=a}),98);
__d("WACryptoHmac",["WACryptoDependencies","WATypedArraysCast"],(function(a,b,c,d,e,f,g){"use strict";var h=32,i=new Uint8Array(h),j={name:"HMAC",hash:"SHA-256"},k={name:"HMAC",hash:"SHA-512"},l={name:"HMAC",hash:"SHA-1"};function m(a,b){b=d("WATypedArraysCast").castTypedArrays(Uint8Array,b);return d("WACryptoDependencies").getCrypto().subtle.importKey("raw",b,a,!1,["sign"]).then(function(b){return{key:b,algo:a}})}function a(a){return m(j,a)}function n(a,b,c){var e=a.key;a=a.algo;return d("WACryptoDependencies").getCrypto().subtle.sign(a,e,b).then(function(a){return c!=null&&c!==0?a.slice(0,c):a})}function b(a,b){return m(j,a!=null?a:i).then(function(a){return n(a,b)})}function c(a,b,c){return m(j,a).then(function(a){return n(a,b,c)})}function e(a,b,c){return m(k,a).then(function(a){return n(a,b,c)})}function f(a,b,c){return m(l,a).then(function(a){return n(a,b,c)})}g.SHA256_BYTE_LENGTH=h;g.DEFAULT_SALT=i;g.encodeKeySha256=a;g.sign=n;g.extractSha256=b;g.hmacSha256=c;g.hmacSha512=e;g.hmacSha1=f}),98);
__d("WACryptoHkdf",["Promise","WABinary","WACryptoHmac","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=255*d("WACryptoHmac").SHA256_BYTE_LENGTH;function j(a,e,f){if(f<0||f>i)return(h||(h=b("Promise"))).reject(c("err")("HKDF::expand given bad length "+f));var g,j=Math.ceil(f/d("WACryptoHmac").SHA256_BYTE_LENGTH),k=d("WABinary").Binary.build(e).readByteArrayView(),l=new(d("WABinary").Binary)(),m=d("WACryptoHmac").encodeKeySha256(a).then(function(a){g=a;return new Uint8Array(0)});e=function(a){m=m.then(function(b){return d("WACryptoHmac").sign(g,d("WABinary").Binary.build(b,k,a).readByteArrayView())}).then(function(a){a=new Uint8Array(a);l.writeByteArray(a);return a})};for(a=1;a<=j;a++)e(a);return m.then(function(){return l.readBuffer(f)})}function a(a,b,c){return d("WACryptoHmac").extractSha256(null,a).then(function(a){return j(new Uint8Array(a),b,c)})}function e(a,b,c,e){return d("WACryptoHmac").extractSha256(b,a).then(function(a){return j(new Uint8Array(a),c,e)})}g.expand=j;g.extractAndExpand=a;g.extractWithSaltAndExpand=e}),98);
__d("WACryptoUtils",["WACryptoDependencies","WACryptoPrimitives","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(new Uint8Array(a),new Uint8Array(b))}function b(a,b){var c=new TextDecoder();return c.decode(a).toLowerCase()===c.decode(b).toLowerCase()}function h(a,b){return a.length===0&&b.length===0||d("WACryptoPrimitives").verify(a,b)}function e(a,b){return a.length===0&&b.length===0||d("WACryptoPrimitives").verify(a,b)}function f(a,b){return a.length===0&&b.length===0||d("WACryptoPrimitives").verify(a,b)}function i(a){if(a!==(a|0))throw c("err")("bound must be int32");if(a<=0)throw c("err")("bound must not be positive");var b=new Int32Array(1),e=-1>>>1;e=a*Math.floor(e/a);var f=-1;while(f===-1){d("WACryptoDependencies").getCrypto().getRandomValues(b);var g=b[0]>>>1;g<e&&(f=g%a)}return f}g.arrayBuffersEqual=a;g.arrayBuffersEqualCaseInsensitive=b;g.uint8ArraysEqual=h;g.rawKeysEqual=e;g.serializedPubKeysEqual=f;g.randomNumberLessThan=i}),98);
__d("WAXmlParsingFailure",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b){this.parser=a,this.reason=b}var b=a.prototype;b.toString=function(){return"XmlParsingFailure: "+this.parser+": "+this.reason};return a}();f.XmlParsingFailure=a}),66);
__d("WAParsableXmlNode",["WAHasProperty","WAXmlParsingFailure","err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){var c=this;this.$1=a;this.$2=b;this.$3=Array.isArray(b.content)?b.content.map(function(b){return new c.constructor(a,b)}):null}var b=a.prototype;b.name=function(){return this.$1};b.node=function(){return this.$2};b.hasAttr=function(a){return c("WAHasProperty")(this.$2.attrs,a)};b.assertTag=function(a){this.$2.tag!==a&&this["throw"]("to be <"+a+">")};b.tag=function(){return this.$2.tag};b.maybeChild=function(a){var b=this.$3;if(!b)return null;for(var c=0;c<b.length;c++)if(b[c].tag()===a)return b[c];return null};b.hasChild=function(a){return!!this.maybeChild(a)};b.child=function(a){var b=this.maybeChild(a);return!b?this["throw"]("to have child <"+a+">"):b};b.assertAttr=function(a,b){var c=this.attrString(a);c!==b&&this["throw"]('to have "'+a+'"="'+b+'", but instead has "'+c+'"')};b.attrString=function(a){return!c("WAHasProperty")(this.$2.attrs,a)?this["throw"]('to have attribute "'+a+'"'):this.decodeAsString(this.$2.attrs[a])};b.forEachAttributeKey=function(a){var b=this.$2.attrs;Object.keys(b).forEach(function(b){return a(b)})};b.maybeAttrString=function(a){return this.hasAttr(a)?this.decodeAsString(this.$2.attrs[a]):null};b.maybeAttrInt=function(a,b,c){return this.hasAttr(a)?this.attrInt(a,b,c):null};b.attrEnumValues=function(a,b,c){b=new Set(b);var d=this.attrString(a);if(!b.has(d)){if(c!=null)return c;c=Array.from(b).join("|");return this["throw"]('to have "'+a+'"={'+c+'} but has value "'+d+'"')}return d};b.attrEnum=function(a,b){var d=this.attrString(a);if(!c("WAHasProperty")(b,d)){var e=Object.keys(b).join("|");return this["throw"]('to have "'+a+'"={'+e+'} but has value "'+d+'"')}return b[d]};b.attrEnumOrNullIfUnknown=function(a,b){a=this.attrString(a);return!c("WAHasProperty")(b,a)?null:b[a]};b.attrEnumOrDefault=function(a,b,c){return this.hasAttr(a)?this.attrEnum(a,b):c};b.attrInt=function(a,b,c){var d=this.attrString(a);return this.$4(d,a,b,c)};b.$4=function(a,b,c,d){var e=parseInt(a,10);if(Number.isNaN(e))return this["throw"]('to have "'+b+'"={integer} but has value "'+a+'"');else if(c!==void 0&&e<c)return this["throw"]('to have "'+b+'"={at least '+c+"} but has value "+e);else if(d!==void 0&&e>=d)return this["throw"]('to have "'+b+'"={below '+d+"} but has value "+e);return e};b.forEachChild=function(a){var b=this.$3;if(b)b.forEach(function(b){return a(b)});else if(this.$2.content!=null)return this["throw"]("to have children")};b.forEachChildWithTag=function(a,b){this.forEachChild(function(c){c.tag()===a&&b(c)})};b.mapChildren=function(a){var b=this.$3;return!b&&this.$2.content!=null?this["throw"]("to have children"):b?b.map(function(b){return a(b)}):[]};b.mapChildrenWithTag=function(a,b){var c=this.$3;return!c&&this.$2.content!=null?this["throw"]("to have children"):c?c.filter(function(b){return b.tag()===a}).map(function(a){return b(a)}):[]};b.mapFirstChild=function(a){var b=this.$3;return!b||b.length===0?this["throw"]("to have children"):a(b[0])};b.hasContent=function(){return!this.$3&&!!this.$2.content};b.hasChildren=function(){return this.$3!=null};b.getChildren=function(){return this.$3};b.mapAttrKeys=function(a){var b=this.getAttrKeys();return b&&b.length?b.map(a):[]};b.getAttrKeys=function(){return Object.keys(this.$2.attrs)};b.hasAttrs=function(){var a=this.$2.attrs?Object.keys(this.$2.attrs):[];return a.length>0};b.getNode=function(){return this.$2};b.unsafeSetChildren=function(a){this.$3=a};b.unsafeSetNodeContent=function(a){this.$2.content=a};b.contentUint=function(a){var b=this.contentBytes(a);return h(b,a)};b.contentBytes=function(a){a===void 0&&(a=-1);if(this.$3)return this["throw"]("to have binary content, but has children instead");else if(this.$2.content!=null){var b=this.$2.content;return a!==-1&&b.length!==a?this["throw"]("to be "+a+" bytes, but got "+b.length+" instead"):b}else return this["throw"]("to have content")};b.contentString=function(){if(this.$3)return this["throw"]("to have string content, but has children instead");else if(this.$2.content!=null)return this.$2.content;else return this["throw"]("to have content")};b.contentInt=function(a,b){var c=this.contentString();return this.$4(c,"content",a,b)};b.contentEnum=function(a){var b=this.contentString();if(!c("WAHasProperty")(a,b)){var d=Object.keys(a).join("|");return this["throw"]("to have content {"+d+'} but has value "'+b+'"')}return a[b]};b.decodeAsString=function(a){if(typeof a!=="string")throw c("err")("decodeAsString: attribute is "+typeof a+" not a string: "+a);return a};b["throw"]=function(a){throw new(d("WAXmlParsingFailure").XmlParsingFailure)(this.$1,"expected <"+this.$2.tag+"> "+a)};b.toString=function(){return this.$2.toString()};return a}();function h(a,b){var c=0;for(var d=0;d<b;d++)c=c*256+a[d];return c}g.ParsableXmlNode=a;g.convertBytesToUint=h}),98);
__d("WASignalOther",["WACryptoDependencies","WACryptoHkdf","WACryptoUtils","WAParsableXmlNode","decodeProtobuf","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h={name:"AES-CBC"},i={name:"HMAC",hash:"SHA-256"};function j(a,b){if(a.length!==b)throw c("err")("Signal expected "+b+" bytes, given "+a.length);return a}function a(a,b){return j(new Uint8Array(a),b)}function b(a){var b=a.buffer,c=a.byteOffset;a=a.length;return c===0&&a===b.byteLength?b:b.slice(c,c+a)}function e(a,b){return a.readByteArrayView(b)}function f(a){return new Uint8Array(a)}function k(a,b,d){if(a.length-b<d)throw c("err")("Can not split off "+d+" bytes from index "+b+" of "+a.length+" bytes");return a.slice(b,b+d)}function l(a){a=a==="extendedRange"?(-1>>>1)-1:16380;return d("WACryptoUtils").randomNumberLessThan(a)+1}function m(a){return q(a)}function n(a){return d("WAParsableXmlNode").convertBytesToUint(a,4)}function o(){var a=-1>>>1;return d("WACryptoUtils").randomNumberLessThan(a)+1}function p(a){return q(a)}function q(a,b,d){b===void 0&&(b=0);d===void 0&&(d=4294967296);if(typeof a==="number"&&b<=a&&a<d&&Math.floor(a)===a)return a;else throw c("err")("Expected integer in range ["+b+", "+d+"), given "+String(a))}function r(a,b){return d("encodeProtobuf").encodeProtobuf(a,b).readByteArrayView()}function s(a,b,c){return c(d("decodeProtobuf").decodeProtobuf(a,b))}function t(a,b,c,e){return d("WACryptoHkdf").extractWithSaltAndExpand(a,b,c,e).then(function(a){return new Uint8Array(a)})}function u(a,b){var c,e;b==="hmac-sha256"?(c=i,e=["sign"]):(b,c=h,e=["encrypt","decrypt"]);return d("WACryptoDependencies").getCrypto().subtle.importKey("raw",a,c,!1,e)}function v(a){return a}function w(a){return a}function x(a,b){return d("WACryptoUtils").arrayBuffersEqual(a,b)}g.AES_CBC=h;g.HMAC_SHA256=i;g.ensureSize=j;g.toBytes=a;g.toBuffer=b;g.readBytes=e;g.makeBytes=f;g.sliceBytes=k;g.makeRegistrationId=l;g.castRegistrationId=m;g.castRegistrationIdFromBytes=n;g.makeSenderKeyId=o;g.castSenderKeyId=p;g.ensureIntInRange=q;g.encodeSignalProto=r;g.decodeSignalProto=s;g.hkdf=t;g.makeCryptoKey=u;g.castToByteEncoded=v;g.castToSessionHash=w;g.areSessionHashesEqual=x}),98);
__d("WASignalKeys",["WACryptoDependencies","WACryptoPrimitives","WALogger","WASignalLocalStorageProtocol.pb","WASignalOther","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=5,j=16777215;function k(a,b){return{publicKey:a,privateKey:b}}function a(a){a=d("WACryptoPrimitives").keypairFromSecretKey(a);var b=a.publicKey;a=a.secretKey;return k(d("WASignalOther").ensureSize(b,32),d("WASignalOther").ensureSize(a,32))}function b(a,b){return{publicKey:d("WASignalOther").toBytes(a,32),privateKey:d("WASignalOther").toBytes(b,32)}}function l(){var a=d("WACryptoPrimitives").keyPair(),b=a.publicKey;a=a.secretKey;a[0]&=248;a[31]=64|a[31]&63;return k(d("WASignalOther").ensureSize(b,32),d("WASignalOther").ensureSize(a,32))}function m(a,b){return k(d("WASignalOther").sliceBytes(b,1,32),a)}function n(a,b){return{serializedPubKey:b,privateKey:a}}function e(){var a=l();return n(a.privateKey,o(a))}function o(a){var b=d("WASignalOther").makeBytes(33);b[0]=i;b.set(a.publicKey,1);return b}function f(a){var b=d("WASignalOther").makeBytes(33);b[0]=i;b.set(d("WASignalOther").ensureSize(a,32),1);return b}function p(a){return n(a.privateKey,o(a))}function q(a,b){a=(a-1)%j;a<=0&&(a+=j);var c=[];for(var e=0;e<b;e++){var f=a===j?1:a+1,g=l(),h=d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,{id:f,publicKey:o(g),privateKey:g.privateKey});c.push({plainObject:{id:f,keyPair:g},record:h});a=f}return c}function r(a){try{a=d("decodeProtobuf").decodeProtobuf(d("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,a);var b=a.id,c=a.publicKey;a=a.privateKey;return b==null||c==null||a==null?null:{id:s(b),keyPair:m(d("WASignalOther").toBytes(a,32),u(new Uint8Array(c)))}}catch(a){d("WALogger").DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["deserializePreKey error ",""])),a);return null}}function s(a){return d("WASignalOther").ensureIntInRange(a,1,j)}function t(a){return d("WASignalOther").ensureIntInRange(a,0,j)}function u(a){if(a.length===0||a[0]!==i)throw c("err")("Unrecognized public key type");return d("WASignalOther").ensureSize(a,33)}function v(){var a=d("WASignalOther").makeBytes(32);d("WACryptoDependencies").getCrypto().getRandomValues(a);return a}function w(a,b){return d("WACryptoPrimitives").scalarMult(a,b.subarray(1)).buffer}g.KEY_TYPE=i;g.makeKeyPairFrom=a;g.makeKeyPairFromArrayBuffers=b;g.makeKeyPair=l;g.makeKeyPairFromSerialized=m;g.makeSerializedKeyPairFrom=n;g.makeSerializedKeyPair=e;g.serializePubKey=o;g.serializeIdentity=f;g.toSerializedKeyPair=p;g.makePreKeys=q;g.deserializePreKey=r;g.castToPreKeyId=s;g.castToSignedPreKeyId=t;g.castToSerializedPubKey=u;g.makeRawSenderKey=v;g.ecdh=w}),98);
__d("WAGetLocalPublicPrivateIdentityKeyApi",["WADbSignal","WALogger","WASignalDB","WASignalKeys","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){return d("WASignalDB").getDb().runInTransaction(["meta"],"readonly",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;a=(yield a.stores.meta.get(d("WADbSignal").MetaKeysEnum.identityKeyPair));if((a==null||(b=a.value)==null?void 0:b.identityKeyPair)==null){var e="[Remote Presence Error] Identity key pair was null";d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["",""])),e);throw c("err")(e)}return d("WASignalKeys").toSerializedKeyPair(a.value.identityKeyPair)});return function(b){return a.apply(this,arguments)}}(),d("WASignalDB").signalOp("getLocalPublicPrivateIdentityKey"))};g.getLocalPublicPrivateIdentityKey=a}),98);
__d("EBWorkerAddDeviceUtils",["EBDB","EBDBEbsmApi","EBSMProperties","I64","LSAuthorityLevel","LSIntEnum","LSJSEBInMemoryStorage","LSMetadata","LSReStoreWrapper","MAWLSVaultingHooks","Promise","ReQL","WAGetLocalPublicPrivateIdentityKeyApi","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAGetLocalPublicPrivateIdentityKeyApi").getLocalPublicPrivateIdentityKey()),b=a.privateKey;a=a.serializedPubKey;return{identityPrivateKey:b,identityPublicKey:a}});return k.apply(this,arguments)}function e(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(e.tables.secure_encrypted_backups_client_state)));if(g!=null)return"dest_table_not_empty";g={clearEbStores:d("EBDB").clearEbStores,flushEBSMtoEBDB:d("EBDBEbsmApi").flushEBSMtoEBDB,rehydrateEBSMFromEBDB:d("EBDBEbsmApi").rehydrateEBSMFromEBDB,updateEBSM:function(){return(j||(j=b("Promise"))).resolve()}};g=(yield d("LSJSEBInMemoryStorage").makeReStorePersistence(g));if(g==null)throw c("err")("persistence is null");g=d("LSReStoreWrapper").createLSReStore(g,d("LSMetadata").schema,[c("MAWLSVaultingHooks")],void 0);var k=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(g.tables.secure_encrypted_backups_epochs)));return k.filter(function(a){return(h||(h=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}).length===0?"source_epoch_not_authoritative":g.runInTransaction(function(c){return e.runInTransaction(function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(d){var e=(yield (j||(j=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=c[a];b=b.entries(new WeakMap());var e=(yield b.next());if(e.done)return"source_table_empty";a=d[a];while(!e.done){var f=e.value,g=f[0];f=f[1];yield a.upsert(g,f);e=(yield b.next())}return"success"});return function(b){return a.apply(this,arguments)}}())));e=new Set(e);if(e.has("source_table_empty"))return"source_table_empty";else if(e.has("success")&&e.size===1)return"success";return"fail"});return function(a){return d.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":111")},"readonly",void 0,void 0,f.id+":109")});return l.apply(this,arguments)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield a.runInTransaction(function(a){return(j||(j=b("Promise"))).all(c("EBSMProperties").persistedTablesArray.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=a[b];var c=b.entries(new WeakMap()),d=(yield c.next());while(!d.done)yield b["delete"].apply(b,d.value[0]),d=(yield c.next())});return function(a){return c.apply(this,arguments)}}()))},"readwrite",void 0,void 0,f.id+":152")});return n.apply(this,arguments)}g.getIdentityKeysInWorker=a;g.copyEBStateTablesFromMainthreadToWorker=e;g.clearLSEBSMTables=m}),98);
__d("EBWorkerODSEntityName.enum",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({MW_EBSM_HYDRATION:"mw_ebsm_hydration",MW_EBSM_IDB:"mw_eb_ebsm_idb",MW_EBSM_CORRUPTION:"mw_ebsm_corruption",MW_EBSM_RESTORE_PERSISTENCE_ERROR:"mw_ebsm_restore_persistence",MW_EBSM_IDB_TABLE_DELETION:"mw_ebsm_idb_table_deletion",MW_EB_AUTO_RESTORE_MAIN_THREAD:"mw_eb_auto_restore_main_thread",MW_EB_AUTO_RESTORE_WORKER:"mw_eb_auto_restore_worker",MW_EB_DEVICE_MIGRATION_WORKER:"mw_eb_device_migration_worker",MW_EB_OTC_MAIN_THREAD:"mw_eb_otc_main_thread",EB_WORKER_ADD_DEVICE_WITH_KEYS:"eb_worker_add_device_with_keys",EB_WORKER_ADD_DEVICE_WITH_RC:"eb_worker_add_device_with_rc",EB_WORKER_OPT_OUT:"eb_worker_opt_out"});c=a;f["default"]=c}),66);
__d("LSDedicatedMqttChannel",["FBMqttChannel","cr:1232"],(function(a,b,c,d,e,f,g){"use strict";function a(){b("cr:1232")!=null&&b("cr:1232").shutdownAndClear()}function d(a,d,e,f,g,h){return function(i){if(b("cr:1232")!=null)return b("cr:1232").getInstance(i,a,d,e,f,g,h);else return c("FBMqttChannel")}}g.shutdownAndClear=a;g.getInstance=d}),98);
__d("MAWEBLSInWorkerSwitch",["MAWEBEnabledStateManager"],(function(a,b,c,d,e,f,g){"use strict";a=new(d("MAWEBEnabledStateManager").MAWEBEnabledStateManager)();b=a;g["default"]=b}),98);
__d("LSIssueNewEbTaskAndGetTaskIDV2",["LSIssueNewTaskAndGetTaskID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),a[0],a[1],a[2],void 0,void 0,c.i64.cast([0,0]),a[3],a[4],void 0,a[5],a[7]).then(function(a){return a=a,d[0]=a[0],a})},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueNewEbTaskAndGetTaskIDV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSFetchBackupIds",["LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFetchBackupIdsStoredProcedure] Beginning execution."),d[11]=c.i64.cast([0,0]),d[7]=d[11],d[8]=new c.Map(),d[8].set("backup_tenancy",a[0]),d[8].set("trace_id",void 0),d[9]=c.toJSON(d[8]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",c.i64.cast([0,50008]),d[9],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,d[7]).then(function(a){return a=a,d[10]=a[0],a})},function(a){return d[1]=c.i64.of_float(Date.now()),d[2]=c.i64.random(),d[4]="Finishing execution. Execution time: ",d[5]=c.i64.to_string(c.i64.sub(d[1],d[0])),d[6]=" ms",d[3]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFetchBackupIdsStoredProcedure] ",d[3],d[4],d[3],d[5],d[3],d[6]].join("")),c.i64.eq(c.i64.mod_(d[2],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[7]=",",d[8]=c.createArray(),void 0!==void 0?d[9]=(d[8].push(void 0),d[8]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFetchBackupIdsStoredProcedure",[d[4],d[7],d[5],d[7],d[6]].join(""),d[8],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsFetchBackupIdsStoredProcedure";a.__tables__=["encrypted_backups"];e.exports=a}),null);
__d("LSFetchBackupIdsStoredProcedure",["LSFetchBackupIds","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSFetchBackupIds"),e.backupTenancy,e.traceId,e.isUiBlocking);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSLoadThreadPkFromThreadId",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadThreadPkFromThreadId] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(173).fetch(),function(b){return c.i64.to_string(b.jid)===a[0]}).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,100])),d[13].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[13].set("error_message",""),e=[void 0,d[13]],d[2]=e[0],d[3]=e[1]):(b=a.item,e=[b.clientThreadPk,void 0],d[2]=e[0],d[3]=e[1])})},function(a){return c.i64.neq(d[2],void 0)?(a=[d[2],d[3]],d[5]=a[0],d[6]=a[1],a):(d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,7])),d[13].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[13].set("error_message",""),c.i64.neq(void 0,void 0)?(a=[void 0,d[13]],d[14]=a[0],d[15]=a[1],a):(d[16]=new c.Map(),d[16].set("error_code",c.i64.cast([0,100])),d[16].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[16].set("error_message",""),a=[void 0,d[16]],d[14]=a[0],d[15]=a[1]),a=[d[14],d[15]],d[5]=a[0],d[6]=a[1]),d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadThreadPkFromThreadId] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadThreadPkFromThreadId",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure";a.__tables__=["mi_act_mapping_table"];e.exports=a}),null);
__d("LSIssueMessageRangeQueryTask",["LSArrayGetObjectAt","LSBase64Encode.nop","LSIsEncryptionVersionSecure","LSIssueNewTask","LSLoadThreadPkFromThreadId","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] Beginning execution."),d[10]=c.i64.gt(a[1],c.i64.cast([0,0]))&&c.i64.gt(a[5],c.i64.cast([0,0])),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[14]=new c.Map(),d[14].set("error_msg","Expected a nonempty query result"),d[14].set("code",c.i64.cast([0,3])),d[14].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[15]=c.createArray(),d[16]=(d[15].push(d[14]),d[15]),e=[void 0,d[15]],d[1]=e[0],d[2]=e[1]):(b=a.item,d[14]=new c.Map(),d[14].set("backup_id",b.backupId),d[14].set("device_public_key_blob",b.devicePublicKeyBlob),d[14].set("device_private_key_blob",b.devicePrivateKeyBlob),d[14].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[14].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[14].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[14].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[14].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[14].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[14].set("orf_client_state_v2_blob",void 0),d[14].set("orf_v2_authority_level",void 0),d[14].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[14].set("device_id",b.deviceId),d[14].set("backup_tenancy",b.backupTenancy),d[14].set("encryption_version",b.encryptionVersion),d[14].set("revision_version",b.revisionVersion),d[14].set("initialize_restore_result",void 0),d[14].set("device_creation_timestamp_sec",void 0),d[14].set("authority_level",b.authorityLevel),e=[d[14],void 0],d[1]=e[0],d[2]=e[1])})},function(e){return d[4]=new c.Map(),d[4].set("value",d[1]),d[4].set("errors",d[2]),d[5]=d[4].get("value"),d[5]!==void 0?c.sequence([function(e){return d[14]=d[5].get("backup_id"),d[15]=d[5].get("device_public_key_blob"),d[16]=d[5].get("device_private_key_blob"),d[17]=d[5].get("epoch_storage_public_key_blob"),d[18]=d[5].get("epoch_storage_private_key_blob"),d[19]=d[5].get("epoch_auth_public_key_blob"),d[20]=d[5].get("epoch_auth_private_key_blob"),d[21]=d[5].get("mailbox_root_key_blob"),d[22]=d[5].get("ocmf_client_state_blob"),d[23]=d[5].get("orf_client_state_v2_blob"),d[24]=d[5].get("orf_v2_authority_level"),d[25]=d[5].get("oblivious_validation_token_blob"),d[26]=d[5].get("device_id"),d[27]=d[5].get("backup_tenancy"),d[28]=d[5].get("encryption_version"),d[29]=d[5].get("revision_version"),d[30]=d[5].get("initialize_restore_result"),d[31]=d[5].get("device_creation_timestamp_sec"),d[32]=d[5].get("authority_level"),c.i64.neq(d[26],void 0)?c.sequence([function(a){return d[34]=void 0,c.i64.neq(d[34],void 0)?c.resolve(d[35]=d[34]):c.sequence([function(a){return d[40]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[41]=a[0],a})},function(a){return d[41]?d[50]=(d[40].push(c.i64.cast([0,0])),d[40]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[42]?d[50]=(d[40].push(c.i64.cast([0,2])),d[40]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[43]?d[50]=(d[40].push(c.i64.cast([0,3])),d[40]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[44]?d[50]=(d[40].push(c.i64.cast([0,4])),d[40]):0,d[45]=c.createArray(),d[46]=c.i64.of_int32(d[40].length),c.i64.gt(d[46],c.i64.cast([0,0]))?c.loopAsync(d[46],function(a){return d[50]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[40],d[50]).then(function(a){return a=a,d[51]=a[0],d[52]=a[1],a})},function(a){return d[53]=(d[45].push(d[51]),d[45])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[50]=c.createArray(),d[51]=c.i64.of_int32(d[45].length),c.i64.gt(d[51],c.i64.cast([0,0]))?c.loopAsync(d[51],function(a){return d[53]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[45],d[53]).then(function(a){return a=a,d[54]=a[0],d[55]=a[1],a})},function(a){return d[56]=(d[50].push(c.i64.to_string(d[54])),d[50])}])}):c.resolve()},function(a){return d[52]=d[50].join(","),d[47]=d[52]}])},function(a){return d[45].some(function(a){return c.i64.eq(d[28],a)})?d[48]=d[28]:d[48]=void 0,c.i64.neq(d[48],void 0)?d[49]=d[48]:d[49]=void 0,d[35]=d[49]}])},function(e){return c.i64.neq(d[35],void 0)?d[36]=d[35]:d[36]=c.i64.cast([0,0]),c.i64.neq(d[27],void 0)?d[37]=d[27]:d[37]=c.i64.cast([0,1]),c.storedProcedure(b("LSLoadThreadPkFromThreadId"),a[0]).then(function(a){return a=a,d[38]=a[0],d[39]=a[1],a})},function(e){return c.i64.neq(d[38],void 0)?d[10]?c.sequence([function(e){return c.i64.eq(d[37],c.i64.cast([0,3]))?d[40]=c.i64.cast([0,4]):d[40]=c.i64.cast([0,0]),d[41]=new c.Map(),d[41].set("act_thread_id",a[0]),d[41].set("tam_thread_subtype",d[40]),d[41].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[22]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[21]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[44]=new c.Map(),d[44].set("ocmf_client_state_blob",d[42]==null?"":d[42]),d[44].set("mailbox_root_key",d[43]==null?"":d[43]),d[45]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[56]=(d[45].push(a.epochId),d[45])})},function(a){return d[54]="Queried locally available epochs. Count: ",d[46]=c.i64.of_int32(d[45].length),d[55]=c.i64.to_string(d[46]),d[47]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[47],d[54],d[47],d[55]].join("")),c.resolve()},function(e){return d[48]=new c.Map(),d[48].set("device_id",d[26]),d[48].set("raw_tokens",d[44]),d[48].set("locally_available_epochs",d[45]),d[49]=new c.Map(),d[49].set("reference_timestamp",a[2]),d[49].set("server_thread_key",void 0),d[49].set("device_context",d[48]),d[49].set("source",a[6]),d[50]=new c.Map(),d[50].set("restore_context",d[41]),d[50].set("success",d[49]),d[51]=d[50].get("restore_context"),d[52]=d[51].get("act_thread_id"),d[53]=c.toJSON(d[50]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[52]].join(""),c.i64.cast([0,50031]),d[53],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.i64.gt(a[1],c.i64.cast([0,0]))?c.sequence([function(e){return c.i64.eq(d[37],c.i64.cast([0,3]))?d[40]=c.i64.cast([0,4]):d[40]=c.i64.cast([0,0]),a[7]===!0?d[41]=!0:d[41]=!1,d[42]=new c.Map(),d[42].set("act_thread_id",a[0]),d[42].set("request_id",a[4]),d[42].set("tam_thread_subtype",d[40]),d[42].set("reference_id",void 0),d[42].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[22]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[21]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[45]=new c.Map(),d[45].set("ocmf_client_state_blob",d[43]==null?"":d[43]),d[45].set("mailbox_root_key",d[44]==null?"":d[44]),d[46]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[57]=(d[46].push(a.epochId),d[46])})},function(a){return d[55]="Queried locally available epochs. Count: ",d[47]=c.i64.of_int32(d[46].length),d[56]=c.i64.to_string(d[47]),d[48]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[48],d[55],d[48],d[56]].join("")),c.resolve()},function(e){return d[49]=new c.Map(),d[49].set("device_id",d[26]),d[49].set("raw_tokens",d[45]),d[49].set("locally_available_epochs",d[46]),d[50]=new c.Map(),d[50].set("reference_timestamp",a[2]),d[50].set("direction",c.i64.cast([0,1])),d[50].set("server_thread_key",void 0),d[50].set("device_context",d[49]),d[50].set("source",a[6]),d[50].set("include_offset",d[41]),d[51]=new c.Map(),d[51].set("restore_context",d[42]),d[51].set("success",d[50]),d[51].set("queue_name",void 0),d[52]=d[51].get("queue_name"),d[52]!==void 0?d[53]=d[52]:(d[57]=d[51].get("restore_context"),d[58]=d[57].get("act_thread_id"),d[53]=["encrypted_backups_restore",":",d[58]].join("")),d[54]=c.toJSON(d[51]),c.storedProcedure(b("LSIssueNewTask"),d[53],c.i64.cast([0,50030]),d[54],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.sequence([function(e){return c.i64.eq(d[37],c.i64.cast([0,3]))?d[40]=c.i64.cast([0,4]):d[40]=c.i64.cast([0,0]),a[7]===!0?d[41]=!0:d[41]=!1,d[42]=new c.Map(),d[42].set("act_thread_id",a[0]),d[42].set("request_id",a[4]),d[42].set("tam_thread_subtype",d[40]),d[42].set("reference_id",void 0),d[42].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[22]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[21]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[45]=new c.Map(),d[45].set("ocmf_client_state_blob",d[43]==null?"":d[43]),d[45].set("mailbox_root_key",d[44]==null?"":d[44]),d[46]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[57]=(d[46].push(a.epochId),d[46])})},function(a){return d[55]="Queried locally available epochs. Count: ",d[47]=c.i64.of_int32(d[46].length),d[56]=c.i64.to_string(d[47]),d[48]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[48],d[55],d[48],d[56]].join("")),c.resolve()},function(e){return d[49]=new c.Map(),d[49].set("device_id",d[26]),d[49].set("raw_tokens",d[45]),d[49].set("locally_available_epochs",d[46]),d[50]=new c.Map(),d[50].set("reference_timestamp",a[2]),d[50].set("direction",c.i64.cast([0,2])),d[50].set("server_thread_key",void 0),d[50].set("device_context",d[49]),d[50].set("source",a[6]),d[50].set("include_offset",d[41]),d[51]=new c.Map(),d[51].set("restore_context",d[42]),d[51].set("success",d[50]),d[51].set("queue_name",void 0),d[52]=d[51].get("queue_name"),d[52]!==void 0?d[53]=d[52]:(d[57]=d[51].get("restore_context"),d[58]=d[57].get("act_thread_id"),d[53]=["encrypted_backups_restore",":",d[58]].join("")),d[54]=c.toJSON(d[51]),c.storedProcedure(b("LSIssueNewTask"),d[53],c.i64.cast([0,50030]),d[54],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.sequence([function(e){return d[10]?(d[42]=new c.Map(),d[42].set("error_code",c.i64.cast([0,100])),d[42].set("error_message",""),d[42].set("stored_procedure","issueMessageRangeQueryTask"),d[43]=new c.Map(),d[43].set("act_thread_id",a[0]),d[44]=new c.Map(),d[44].set("restore_context",d[43]),d[44].set("failure",d[42]),d[45]=d[44].get("restore_context"),d[46]=d[45].get("act_thread_id"),d[47]=c.toJSON(d[44]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[46]].join(""),c.i64.cast([0,50031]),d[47],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[54]=new c.Map(),d[54].set("error_msg","Expected a nonempty query result"),d[54].set("code",c.i64.cast([0,3])),d[54].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[55]=c.createArray(),d[56]=(d[55].push(d[54]),d[55]),e=[void 0,d[55]],d[42]=e[0],d[43]=e[1]):(b=a.item,d[54]=new c.Map(),d[54].set("backup_id",b.backupId),d[54].set("device_public_key_blob",b.devicePublicKeyBlob),d[54].set("device_private_key_blob",b.devicePrivateKeyBlob),d[54].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[54].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[54].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[54].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[54].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[54].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[54].set("orf_client_state_v2_blob",void 0),d[54].set("orf_v2_authority_level",void 0),d[54].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[54].set("device_id",b.deviceId),d[54].set("backup_tenancy",b.backupTenancy),d[54].set("encryption_version",b.encryptionVersion),d[54].set("revision_version",b.revisionVersion),d[54].set("initialize_restore_result",void 0),d[54].set("device_creation_timestamp_sec",void 0),d[54].set("authority_level",b.authorityLevel),e=[d[54],void 0],d[42]=e[0],d[43]=e[1])})},function(a){return d[45]=new c.Map(),d[45].set("value",d[42]),d[45].set("errors",d[43]),d[46]=d[45].get("value"),d[46]!==void 0?c.sequence([function(a){return d[54]=d[46].get("backup_id"),d[55]=d[46].get("device_public_key_blob"),d[56]=d[46].get("device_private_key_blob"),d[57]=d[46].get("epoch_storage_public_key_blob"),d[58]=d[46].get("epoch_storage_private_key_blob"),d[59]=d[46].get("epoch_auth_public_key_blob"),d[60]=d[46].get("epoch_auth_private_key_blob"),d[61]=d[46].get("mailbox_root_key_blob"),d[62]=d[46].get("ocmf_client_state_blob"),d[63]=d[46].get("orf_client_state_v2_blob"),d[64]=d[46].get("orf_v2_authority_level"),d[65]=d[46].get("oblivious_validation_token_blob"),d[66]=d[46].get("device_id"),d[67]=d[46].get("backup_tenancy"),d[68]=d[46].get("encryption_version"),d[69]=d[46].get("revision_version"),d[70]=d[46].get("initialize_restore_result"),d[71]=d[46].get("device_creation_timestamp_sec"),d[72]=d[46].get("authority_level"),c.i64.neq(d[66],void 0)?c.sequence([function(a){return d[74]=void 0,c.i64.neq(d[74],void 0)?c.resolve(d[75]=d[74]):c.sequence([function(a){return d[78]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[79]=a[0],a})},function(a){return d[79]?d[88]=(d[78].push(c.i64.cast([0,0])),d[78]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[80]=a[0],a})},function(a){return d[80]?d[88]=(d[78].push(c.i64.cast([0,2])),d[78]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[81]?d[88]=(d[78].push(c.i64.cast([0,3])),d[78]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[82]=a[0],a})},function(a){return d[82]?d[88]=(d[78].push(c.i64.cast([0,4])),d[78]):0,d[83]=c.createArray(),d[84]=c.i64.of_int32(d[78].length),c.i64.gt(d[84],c.i64.cast([0,0]))?c.loopAsync(d[84],function(a){return d[88]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[78],d[88]).then(function(a){return a=a,d[89]=a[0],d[90]=a[1],a})},function(a){return d[91]=(d[83].push(d[89]),d[83])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[88]=c.createArray(),d[89]=c.i64.of_int32(d[83].length),c.i64.gt(d[89],c.i64.cast([0,0]))?c.loopAsync(d[89],function(a){return d[91]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[83],d[91]).then(function(a){return a=a,d[92]=a[0],d[93]=a[1],a})},function(a){return d[94]=(d[88].push(c.i64.to_string(d[92])),d[88])}])}):c.resolve()},function(a){return d[90]=d[88].join(","),d[85]=d[90]}])},function(a){return d[83].some(function(a){return c.i64.eq(d[68],a)})?d[86]=d[68]:d[86]=void 0,c.i64.neq(d[86],void 0)?d[87]=d[86]:d[87]=void 0,d[75]=d[87]}])},function(a){return c.i64.neq(d[75],void 0)?d[76]=d[75]:d[76]=c.i64.cast([0,0]),c.i64.neq(d[67],void 0)?d[77]=d[67]:d[77]=c.i64.cast([0,1]),d[73]=d[66]}]):c.resolve(d[73]=void 0)},function(a){return d[47]=d[73]}]):c.resolve((d[54]=d[45].get("errors"),d[55]=d[45].get("errors"),d[47]=void 0))},function(e){return d[48]=new c.Map(),d[48].set("error_code",c.i64.cast([0,100])),d[48].set("error_message",void 0==null?"":void 0),d[48].set("stored_procedure","issueMessageRangeQueryTask"),d[49]=new c.Map(),d[49].set("act_thread_id",a[0]),d[49].set("source",a[6]),d[49].set("restore_operation_type",c.i64.cast([0,2])),d[49].set("request_id",a[4]),d[49].set("device_id",d[47]),d[50]=new c.Map(),d[50].set("restore_context",d[49]),d[50].set("failure",d[48]),d[51]=d[50].get("queue_name"),d[51]!==void 0?d[52]=d[51]:(d[54]=d[50].get("restore_context"),d[55]=d[54].get("act_thread_id"),d[52]=["encrypted_backups_restore",":",d[55]].join("")),d[53]=c.toJSON(d[50]),c.storedProcedure(b("LSIssueNewTask"),d[52],c.i64.cast([0,50030]),d[53],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(e){return d[41]="threak pk not found for jid",d[41]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[41]].join("")),d[42]=c.createArray(),a[4]!==void 0?d[43]=(d[42].push(a[4]),d[42]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[41],d[42],c.i64.cast([0,3]))):c.resolve()},function(a){return d[10]?d[40]=c.i64.cast([0,5]):d[40]=c.i64.cast([0,2])}])},function(a){return d[33]=!0}]):c.sequence([function(e){return d[10]?(d[36]=new c.Map(),d[36].set("error_code",c.i64.cast([0,1])),d[36].set("error_message",""),d[36].set("stored_procedure","issueMessageRangeQueryTask"),d[37]=new c.Map(),d[37].set("act_thread_id",a[0]),d[38]=new c.Map(),d[38].set("restore_context",d[37]),d[38].set("failure",d[36]),d[39]=d[38].get("restore_context"),d[40]=d[39].get("act_thread_id"),d[41]=c.toJSON(d[38]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[40]].join(""),c.i64.cast([0,50031]),d[41],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[48]=new c.Map(),d[48].set("error_msg","Expected a nonempty query result"),d[48].set("code",c.i64.cast([0,3])),d[48].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[49]=c.createArray(),d[50]=(d[49].push(d[48]),d[49]),e=[void 0,d[49]],d[36]=e[0],d[37]=e[1]):(b=a.item,d[48]=new c.Map(),d[48].set("backup_id",b.backupId),d[48].set("device_public_key_blob",b.devicePublicKeyBlob),d[48].set("device_private_key_blob",b.devicePrivateKeyBlob),d[48].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[48].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[48].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[48].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[48].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[48].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[48].set("orf_client_state_v2_blob",void 0),d[48].set("orf_v2_authority_level",void 0),d[48].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[48].set("device_id",b.deviceId),d[48].set("backup_tenancy",b.backupTenancy),d[48].set("encryption_version",b.encryptionVersion),d[48].set("revision_version",b.revisionVersion),d[48].set("initialize_restore_result",void 0),d[48].set("device_creation_timestamp_sec",void 0),d[48].set("authority_level",b.authorityLevel),e=[d[48],void 0],d[36]=e[0],d[37]=e[1])})},function(a){return d[39]=new c.Map(),d[39].set("value",d[36]),d[39].set("errors",d[37]),d[40]=d[39].get("value"),d[40]!==void 0?c.sequence([function(a){return d[48]=d[40].get("backup_id"),d[49]=d[40].get("device_public_key_blob"),d[50]=d[40].get("device_private_key_blob"),d[51]=d[40].get("epoch_storage_public_key_blob"),d[52]=d[40].get("epoch_storage_private_key_blob"),d[53]=d[40].get("epoch_auth_public_key_blob"),d[54]=d[40].get("epoch_auth_private_key_blob"),d[55]=d[40].get("mailbox_root_key_blob"),d[56]=d[40].get("ocmf_client_state_blob"),d[57]=d[40].get("orf_client_state_v2_blob"),d[58]=d[40].get("orf_v2_authority_level"),d[59]=d[40].get("oblivious_validation_token_blob"),d[60]=d[40].get("device_id"),d[61]=d[40].get("backup_tenancy"),d[62]=d[40].get("encryption_version"),d[63]=d[40].get("revision_version"),d[64]=d[40].get("initialize_restore_result"),d[65]=d[40].get("device_creation_timestamp_sec"),d[66]=d[40].get("authority_level"),c.i64.neq(d[60],void 0)?c.sequence([function(a){return d[68]=void 0,c.i64.neq(d[68],void 0)?c.resolve(d[69]=d[68]):c.sequence([function(a){return d[72]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[73]=a[0],a})},function(a){return d[73]?d[82]=(d[72].push(c.i64.cast([0,0])),d[72]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[74]=a[0],a})},function(a){return d[74]?d[82]=(d[72].push(c.i64.cast([0,2])),d[72]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[75]=a[0],a})},function(a){return d[75]?d[82]=(d[72].push(c.i64.cast([0,3])),d[72]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[76]=a[0],a})},function(a){return d[76]?d[82]=(d[72].push(c.i64.cast([0,4])),d[72]):0,d[77]=c.createArray(),d[78]=c.i64.of_int32(d[72].length),c.i64.gt(d[78],c.i64.cast([0,0]))?c.loopAsync(d[78],function(a){return d[82]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[72],d[82]).then(function(a){return a=a,d[83]=a[0],d[84]=a[1],a})},function(a){return d[85]=(d[77].push(d[83]),d[77])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[82]=c.createArray(),d[83]=c.i64.of_int32(d[77].length),c.i64.gt(d[83],c.i64.cast([0,0]))?c.loopAsync(d[83],function(a){return d[85]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[77],d[85]).then(function(a){return a=a,d[86]=a[0],d[87]=a[1],a})},function(a){return d[88]=(d[82].push(c.i64.to_string(d[86])),d[82])}])}):c.resolve()},function(a){return d[84]=d[82].join(","),d[79]=d[84]}])},function(a){return d[77].some(function(a){return c.i64.eq(d[62],a)})?d[80]=d[62]:d[80]=void 0,c.i64.neq(d[80],void 0)?d[81]=d[80]:d[81]=void 0,d[69]=d[81]}])},function(a){return c.i64.neq(d[69],void 0)?d[70]=d[69]:d[70]=c.i64.cast([0,0]),c.i64.neq(d[61],void 0)?d[71]=d[61]:d[71]=c.i64.cast([0,1]),d[67]=d[60]}]):c.resolve(d[67]=void 0)},function(a){return d[41]=d[67]}]):c.resolve((d[48]=d[39].get("errors"),d[49]=d[39].get("errors"),d[41]=void 0))},function(e){return d[42]=new c.Map(),d[42].set("error_code",c.i64.cast([0,1])),d[42].set("error_message",void 0==null?"":void 0),d[42].set("stored_procedure","issueMessageRangeQueryTask"),d[43]=new c.Map(),d[43].set("act_thread_id",a[0]),d[43].set("source",a[6]),d[43].set("restore_operation_type",c.i64.cast([0,2])),d[43].set("request_id",a[4]),d[43].set("device_id",d[41]),d[44]=new c.Map(),d[44].set("restore_context",d[43]),d[44].set("failure",d[42]),d[45]=d[44].get("queue_name"),d[45]!==void 0?d[46]=d[45]:(d[48]=d[44].get("restore_context"),d[49]=d[48].get("act_thread_id"),d[46]=["encrypted_backups_restore",":",d[49]].join("")),d[47]=c.toJSON(d[44]),c.storedProcedure(b("LSIssueNewTask"),d[46],c.i64.cast([0,50030]),d[47],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(e){return d[35]="backup not found",d[35]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[35]].join("")),d[36]=c.createArray(),a[4]!==void 0?d[37]=(d[36].push(a[4]),d[36]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[35],d[36],c.i64.cast([0,3]))):c.resolve()},function(a){return d[10]?d[34]=c.i64.cast([0,5]):d[34]=c.i64.cast([0,2]),d[33]=!1}])},function(a){return d[6]=d[33]}]):c.sequence([function(e){return d[14]=d[4].get("errors"),d[15]=d[4].get("errors"),d[10]?(d[18]=new c.Map(),d[18].set("error_code",c.i64.cast([0,1])),d[18].set("error_message",""),d[18].set("stored_procedure","issueMessageRangeQueryTask"),d[19]=new c.Map(),d[19].set("act_thread_id",a[0]),d[20]=new c.Map(),d[20].set("restore_context",d[19]),d[20].set("failure",d[18]),d[21]=d[20].get("restore_context"),d[22]=d[21].get("act_thread_id"),d[23]=c.toJSON(d[20]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[22]].join(""),c.i64.cast([0,50031]),d[23],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[30]=new c.Map(),d[30].set("error_msg","Expected a nonempty query result"),d[30].set("code",c.i64.cast([0,3])),d[30].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[31]=c.createArray(),d[32]=(d[31].push(d[30]),d[31]),e=[void 0,d[31]],d[18]=e[0],d[19]=e[1]):(b=a.item,d[30]=new c.Map(),d[30].set("backup_id",b.backupId),d[30].set("device_public_key_blob",b.devicePublicKeyBlob),d[30].set("device_private_key_blob",b.devicePrivateKeyBlob),d[30].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[30].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[30].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[30].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[30].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[30].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[30].set("orf_client_state_v2_blob",void 0),d[30].set("orf_v2_authority_level",void 0),d[30].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[30].set("device_id",b.deviceId),d[30].set("backup_tenancy",b.backupTenancy),d[30].set("encryption_version",b.encryptionVersion),d[30].set("revision_version",b.revisionVersion),d[30].set("initialize_restore_result",void 0),d[30].set("device_creation_timestamp_sec",void 0),d[30].set("authority_level",b.authorityLevel),e=[d[30],void 0],d[18]=e[0],d[19]=e[1])})},function(a){return d[21]=new c.Map(),d[21].set("value",d[18]),d[21].set("errors",d[19]),d[22]=d[21].get("value"),d[22]!==void 0?c.sequence([function(a){return d[30]=d[22].get("backup_id"),d[31]=d[22].get("device_public_key_blob"),d[32]=d[22].get("device_private_key_blob"),d[33]=d[22].get("epoch_storage_public_key_blob"),d[34]=d[22].get("epoch_storage_private_key_blob"),d[35]=d[22].get("epoch_auth_public_key_blob"),d[36]=d[22].get("epoch_auth_private_key_blob"),d[37]=d[22].get("mailbox_root_key_blob"),d[38]=d[22].get("ocmf_client_state_blob"),d[39]=d[22].get("orf_client_state_v2_blob"),d[40]=d[22].get("orf_v2_authority_level"),d[41]=d[22].get("oblivious_validation_token_blob"),d[42]=d[22].get("device_id"),d[43]=d[22].get("backup_tenancy"),d[44]=d[22].get("encryption_version"),d[45]=d[22].get("revision_version"),d[46]=d[22].get("initialize_restore_result"),d[47]=d[22].get("device_creation_timestamp_sec"),d[48]=d[22].get("authority_level"),c.i64.neq(d[42],void 0)?c.sequence([function(a){return d[50]=void 0,c.i64.neq(d[50],void 0)?c.resolve(d[51]=d[50]):c.sequence([function(a){return d[54]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[55]=a[0],a})},function(a){return d[55]?d[64]=(d[54].push(c.i64.cast([0,0])),d[54]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[56]=a[0],a})},function(a){return d[56]?d[64]=(d[54].push(c.i64.cast([0,2])),d[54]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[57]?d[64]=(d[54].push(c.i64.cast([0,3])),d[54]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[58]=a[0],a})},function(a){return d[58]?d[64]=(d[54].push(c.i64.cast([0,4])),d[54]):0,d[59]=c.createArray(),d[60]=c.i64.of_int32(d[54].length),c.i64.gt(d[60],c.i64.cast([0,0]))?c.loopAsync(d[60],function(a){return d[64]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[54],d[64]).then(function(a){return a=a,d[65]=a[0],d[66]=a[1],a})},function(a){return d[67]=(d[59].push(d[65]),d[59])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[64]=c.createArray(),d[65]=c.i64.of_int32(d[59].length),c.i64.gt(d[65],c.i64.cast([0,0]))?c.loopAsync(d[65],function(a){return d[67]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[59],d[67]).then(function(a){return a=a,d[68]=a[0],d[69]=a[1],a})},function(a){return d[70]=(d[64].push(c.i64.to_string(d[68])),d[64])}])}):c.resolve()},function(a){return d[66]=d[64].join(","),d[61]=d[66]}])},function(a){return d[59].some(function(a){return c.i64.eq(d[44],a)})?d[62]=d[44]:d[62]=void 0,c.i64.neq(d[62],void 0)?d[63]=d[62]:d[63]=void 0,d[51]=d[63]}])},function(a){return c.i64.neq(d[51],void 0)?d[52]=d[51]:d[52]=c.i64.cast([0,0]),c.i64.neq(d[43],void 0)?d[53]=d[43]:d[53]=c.i64.cast([0,1]),d[49]=d[42]}]):c.resolve(d[49]=void 0)},function(a){return d[23]=d[49]}]):c.resolve((d[30]=d[21].get("errors"),d[31]=d[21].get("errors"),d[23]=void 0))},function(e){return d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,1])),d[24].set("error_message",void 0==null?"":void 0),d[24].set("stored_procedure","issueMessageRangeQueryTask"),d[25]=new c.Map(),d[25].set("act_thread_id",a[0]),d[25].set("source",a[6]),d[25].set("restore_operation_type",c.i64.cast([0,2])),d[25].set("request_id",a[4]),d[25].set("device_id",d[23]),d[26]=new c.Map(),d[26].set("restore_context",d[25]),d[26].set("failure",d[24]),d[27]=d[26].get("queue_name"),d[27]!==void 0?d[28]=d[27]:(d[30]=d[26].get("restore_context"),d[31]=d[30].get("act_thread_id"),d[28]=["encrypted_backups_restore",":",d[31]].join("")),d[29]=c.toJSON(d[26]),c.storedProcedure(b("LSIssueNewTask"),d[28],c.i64.cast([0,50030]),d[29],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(e){return d[17]="backup not found",d[17]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[17]].join("")),d[18]=c.createArray(),a[4]!==void 0?d[19]=(d[18].push(a[4]),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[17],d[18],c.i64.cast([0,3]))):c.resolve()},function(a){return d[10]?d[16]=c.i64.cast([0,5]):d[16]=c.i64.cast([0,2]),d[6]=!1}])},function(a){return d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[11]="Finishing execution. Execution time: ",d[12]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[13]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ",d[9],d[11],d[9],d[12],d[9],d[13]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[14]=",",d[15]=c.createArray(),void 0!==void 0?d[16]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",[d[11],d[14],d[12],d[14],d[13]].join(""),d[15],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSIssueMessageRangeQueryTaskStoredProcedure",["LSIssueMessageRangeQueryTask","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSIssueMessageRangeQueryTask"),e.threadId,e.numMessages,e.startSortKey,e.isPointQuery,e.traceId,e.newerNumMessages,e.source,e.includeOffset);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MWChatEncryptedBackupsLogging",["MWEBODSCategory","MWEBODSEntityKey.enum","ODS","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){var b=a.cancelEndPoint,d=a.event,e=a.instanceKey;a=a.source;a!=null&&c("QPLUserFlow").addAnnotations(d,{string:{source:a}},{instanceKey:e});c("QPLUserFlow").addPoint(d,"cancel",{instanceKey:e});c("QPLUserFlow").addAnnotations(d,{string:{cancel_end_point:b}},{instanceKey:e});c("QPLUserFlow").endCancel(d,{instanceKey:e})}function a(a){var b=a.event,d=a.instanceKey,e=a.onClose;a=a.source;a!=null&&c("QPLUserFlow").addAnnotations(b,{string:{source:a}},{instanceKey:d});i({cancelEndPoint:"dialog_x_button",event:b,instanceKey:d});e()}function b(a){var b=a.annotations,e=a.event,f=a.instanceKey;a=a.odsEntityName;c("QPLUserFlow").addPoint(e,"success",{instanceKey:f});c("QPLUserFlow").endSuccess(e,{annotations:b,instanceKey:f});a&&(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),a,c("MWEBODSEntityKey.enum").SUCCESS)}function e(a){var b=a.annotations,e=a.errorName,f=a.event,g=a.instanceKey,i=a.odsEntityKey;a=a.odsEntityName;c("QPLUserFlow").addPoint(f,"failure",{instanceKey:g});c("QPLUserFlow").endFailure(f,e,{annotations:b,instanceKey:g});a&&(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),a,i!=null?i:c("MWEBODSEntityKey.enum").FAIL)}g.cancelFlow=i;g.closeDialogCancelFlow=a;g.endSuccess=b;g.endFailure=e}),98);
__d("MWChatEncryptedBackupsQPLEvents",["qpl"],(function(a,b,c,d,e,f,g){"use strict";b=(a=c("qpl"))._(521476140,"378");d=a._(521472542,"295");e=a._(521482085,"409");f=a._(521485406,"272");c=a._(521482763,"296");var h=a._(521484295,"1460"),i=a._(521482969,"1519"),j=a._(521479124,"1939"),k=a._(521474385,"263"),l=a._(521476098,"504"),m=a._(521482858,"1290"),n=a._(521473194,"1331");a=a._(521471024,"2275");g.pinCodeChangeQplEvent=b;g.optOutQplEvent=d;g.backupSetupQplEvent=e;g.mobileOnboardingQplEvent=f;g.restoreQplEvent=c;g.restoreDeviceAuthQplEvent=h;g.messageRestoreQplEvent=i;g.restoreWithAutoRestoreConsentQplEvent=j;g.hsmFleetMigrationQplEvent=k;g.virtualDeviceRevocationQplEvent=l;g.onboardingAuthQplEvent=m;g.processBackupIdsQPLEvent=n;g.fetchBackupIdsQPLEvent=a}),98);
__d("LSProcessBackupIds",["LSAppendDataTraceAddon","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsProcessBackupIdsStoredProcedure] Beginning execution."),c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1487]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[12]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[12]].join("")),d[11]=c.createArray(),void 0!==void 0?d[13]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[12],d[11],c.i64.cast([0,3]))):c.resolve()}])},function(e){return c.db.table(172).fetch([[[c.i64.cast([0,1])]]]).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1488]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[12]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[12]].join("")),d[11]=c.createArray(),void 0!==void 0?d[13]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[12],d[11],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[1]=c.i64.cast([0,0])}]):(f=e.item,c.sequence([function(e){return d[11]=f.backupId,d[10]=f.authorityLevel,c.i64.eq(d[10],c.i64.cast([0,20]))?c.resolve(d[9]=c.i64.cast([0,1])):c.sequence([function(e){return c.i64.eq(d[10],c.i64.cast([0,80]))?c.sequence([function(e){return c.i64.eq(d[11],void 0)?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1492]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]?d[15]=!0:d[15]=!1,d[15]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[17]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[17]].join("")),d[16]=c.createArray(),void 0!==void 0?d[18]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[17],d[16],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[13]=c.i64.cast([0,2])}]):c.sequence([function(e){return c.i64.eq(d[11],c.i64.cast([-1,4294967295]))?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1489]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[15]?d[16]=!0:d[16]=!1,d[16]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[18]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[18]].join("")),d[17]=c.createArray(),void 0!==void 0?d[19]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[18],d[17],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[14]=c.i64.cast([-1,4294967295])}]):c.sequence([function(e){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.backupId,d[11])&&c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(e,f){f=e.done;e=e.value;return f?c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1490]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[18]=!0:d[18]=!1,d[18]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[20]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[20]].join("")),d[19]=c.createArray(),void 0!==void 0?d[21]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[20],d[19],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[15]=c.i64.cast([0,4])}]):(e.item,c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1491]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[18]=!0:d[18]=!1,d[18]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[20]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[20]].join("")),d[19]=c.createArray(),void 0!==void 0?d[21]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[20],d[19],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[15]=c.i64.cast([0,3])}]))})},function(a){return d[14]=d[15]}])},function(a){return d[13]=d[14]}])},function(a){return d[12]=d[13]}]):c.sequence([function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1489]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[16]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[16]].join("")),d[15]=c.createArray(),void 0!==void 0?d[17]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[16],d[15],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[12]=c.i64.cast([-1,4294967295])}])},function(a){return d[9]=d[12]}])},function(a){return d[1]=d[9]}]))})},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[6]="Finishing execution. Execution time: ",d[7]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsProcessBackupIdsStoredProcedure] ",d[5],d[6],d[5],d[7],d[5],d[8]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[9]=",",d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsProcessBackupIdsStoredProcedure",[d[6],d[9],d[7],d[9],d[8]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[1]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsProcessBackupIdsStoredProcedure";a.__tables__=["encrypted_backups","secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSProcessBackupIdsStoredProcedure",["LSProcessBackupIds","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e===void 0&&(e={});a=a.storedProcedure(c("LSProcessBackupIds"),e.traceId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MWEncryptedBackupsProcessBackupIdsDEPRECATED",["FBLogger","LSFactory","LSIntEnum","LSProcessBackupIdsStoredProcedure","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","Promise","QPLEvent","QPLUserFlow","ReQL","WebSession","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("gkx")("23914");function l(a){if(k){var e=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((i||(i=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:e,processBackupIdsVersion:"msys",sessionTabId:d("WebSession").getId()}}});return a.runInTransaction(function(a){return c("LSProcessBackupIdsStoredProcedure")(c("LSFactory")(a))},"readwrite",void 0,void 0,f.id+":53").then(function(a){a=(j||(j=d("LSIntEnum"))).unwrapIntEnum(a[0]);c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,"EB_STATE_"+a+".");d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent});return a})}else return(h||(h=b("Promise"))).resolve(0)}function a(a,b){return a.tables.encrypted_backups.subscribe(function(){c("promiseDone")(d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.encrypted_backups)),function(d){if(d!=null){c("promiseDone")(l(a),b,function(a){c("FBLogger")("labyrinth_web").catching(a).info("Error in db transaction")});return}})})}g.processBackupIdsStoredProcedure=l;g.subscribeToEncryptedBackupsRow=a}),98);
__d("MWEncryptedBackupsListenForChangesToBackupStateInitPath",["EBAPIWorkerCheck","I64","LSAuthorityLevel","LSDataTraceType","LSEncryptedBackupsBackupTenancy","LSFactory","LSFetchBackupIdsStoredProcedure","LSIntEnum","LSIssueMessageRangeQueryTaskStoredProcedure","LSMEBTaskCreationSource","MAWEBRestoreTrackingUtils","MAWMainTraceUtils","MAWOfflineQueueStatus","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsProcessBackupIdsDEPRECATED","Promise","QPLEvent","QPLUserFlow","ReQL","WAJids","WATagsLogger","WebSession","gkx","isInstamadilloEB","promiseDone","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=c("gkx")("23961"),n=c("qex")._("121")===!0;function a(a){function b(){var b=d("ReQL").fromTableAscending(a.tables.encrypted_backups),e=b.subscribe(function(a,b){if(b.operation==="delete"||!(j||(j=d("I64"))).equal(b.value.authorityLevel,(k||(k=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)))return;e();c("QPLUserFlow").getActiveFlowIDs().includes((l||(l=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))&&d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent})});b=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((l||(l=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:b,fetchBackupIdsVersion:"msys",sessionTabId:d("WebSession").getId()}}});c("promiseDone")(a.runInTransaction(function(a){return c("LSFetchBackupIdsStoredProcedure")(c("LSFactory")(a),{backupTenancy:(k||(k=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION),isUiBlocking:!1})},"readwrite",void 0,void 0,f.id+":93"),function(){return p(a)})}(n||c("isInstamadilloEB")())&&b();var e=d("ReQL").fromTableAscending(a.tables.encrypted_backups_status_trigger);return e.subscribe(b)}function o(a){return a.runInTransaction(function(a){var e=d("MAWOfflineQueueStatus").getAllThreadsWithOfflineQueueIncomplete();return(i||(i=b("Promise"))).all(e.map(function(b){var e=d("WAJids").threadIdForChatJid(b),f=d("MAWMainTraceUtils").createTraceId();c("promiseDone")(d("MAWMainTraceUtils").startTraceWithTxn(a,(j||(j=d("I64"))).of_float(Date.now()),f,(k||(k=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_RESTORE)));e={isPointQuery:!1,newerNumMessages:j.zero,numMessages:j.of_int32(20),source:k.ofNumber(c("LSMEBTaskCreationSource").UNKNOWN),threadId:e,traceId:f};d("WATagsLogger").TAGS(["labyrinth_web","eb_prefetch",f]).LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[EB Prefetch] Issuing message range query for thread "," with params ",""])),b,JSON.stringify(e));d("MAWEBRestoreTrackingUtils").markEBRestoreFrontloaded(c("LSMEBTaskCreationSource").UNKNOWN,f,!1);return c("LSIssueMessageRangeQueryTaskStoredProcedure")(c("LSFactory")(a),e)}))},"readonly",void 0,void 0,f.id+":122")}function p(a){var b=d("MAWOfflineQueueStatus").isOfflineQueueComplete();m&&!b&&c("promiseDone")(d("MWEncryptedBackupsProcessBackupIdsDEPRECATED").processBackupIdsStoredProcedure(a),function(b){if(d("EBAPIWorkerCheck").runningInWorker())return;b===3&&c("promiseDone")(o(a))})}e={listenForChangesToBackupState:a,preloadEBData:p};g["default"]=e}),98);
__d("WAWorkerGlobalScope",[],(function(a,b,c,d,e,f){"use strict";a=function(){if(typeof window!=="undefined")return window;return typeof globalThis!=="undefined"?globalThis:self}();f.workerGlobalScope=a}),66);
__d("MAWEncryptionIndexedDbV2",["BrowserLockManager","EARInitType","ExecutionEnvironment","FBLogger","IndexedDbPolyfills","MAWCurrentUser","MAWIndexedDBDeletion","MAWIndexedDbMetadata","MAWQplProxy","MWEARKeychainV3","Promise","QPLUserFlow","WALogger","WAWorkerGlobalScope","err","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b("IndexedDbPolyfills");var k="browserEncryptionMetaV2",l="version",m=1,n=6e4,o=null,p=null,q=null;function a(){return o}function e(){return o!=null}var r=function(b){function a(){return b.apply(this,arguments)||this}babelHelpers.inheritsLoose(a,b);return a}(babelHelpers.wrapNativeSuper(Error));function s(a,e){e===void 0&&(e=0);var f=d("MAWCurrentUser").getID();if(e>m){v(a,"ear_idb_retry_failed_max_reached");return(j||(j=b("Promise"))).reject(new r())}if(o!=null){v(a,"ear_db_exists");return(j||(j=b("Promise"))).resolve()}if(indexedDB==null){v(a,"ear_idb_unavailable");return(j||(j=b("Promise"))).reject(c("err")("IndexedDB API not available"))}v(a,"ear_db_open_start",{bool:{browserLockEnabled:c("BrowserLockManager")!=null}});return new(j||(j=b("Promise")))(function(b,g){var h=function(c){s(a,e+1).then(b)["catch"](function(a){if(a instanceof r)return g(c);g(a)})};try{q=d("MAWIndexedDbMetadata").encryptionDbName(f);var j=indexedDB.open(q),m=d("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){g(c("err")("IndexedDB initialisation timeout in %s flow, isInWorker: %s, openRequest: %s",String(a),(i||(i=c("ExecutionEnvironment"))).isInWorker?"true":"false",j.readyState))},n);j.onupgradeneeded=function(b){d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(m);v(a,"ear_db_upgrade_start");b=b.target.result;if(!b.objectStoreNames.contains(k)){b=b.createObjectStore(k,{autoIncrement:!0,keyPath:"id"});b.createIndex(l,l,{unique:!0})}v(a,"ear_db_upgrade_end")};j.onblocked=function(){v(a,"ear_db_open_blocked"),d("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){g(c("err")("EAR Open timed out while blocked"))},2e3)};j.onsuccess=function(e){d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(m);var f=e.target.result;if(!f.objectStoreNames.contains(k)){e=j.result.objectStoreNames.contains(k);c("FBLogger")("messenger_web").warn("Missing encryption meta table. Is store present: %s",e);d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(m);return t(f,"missing_encryption_meta_table").then(function(){h(c("err")("Malformed encryption DB"))})["catch"](function(b){v(a,"ear_idb_retry_failed_delete_failed");return g(c("err")("Failed to delete malformed encryption DB: "+b.message))})}f.onversionchange=function(){f.close(),c("FBLogger")("messenger_web").info("EAR onversionchange triggered"),d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(m),p==null||p()};v(a,"ear_db_open_end");o=f;d("MWEARKeychainV3").setNamespaceSourceDbAndMarkAsReady("global_ear",o);b()};j.onerror=function(){d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(m);if(j.error.name==="UnknownError"){v(a,"ear_db_open_error_unknown_error");return h(j.error)}v(a,"ear_db_open_error");g(j.error)}}catch(b){v(a,"ear_db_error"),g(b)}})}function f(a){p=p==null?a:p}function t(a,b){a===void 0&&(a=o);c("FBLogger")("messenger_web").warn("EAR DB deletion triggered: %s",b);a!=null&&a.close();return d("MAWIndexedDBDeletion").deleteDB(q,"ear")}function u(a){switch(a){case c("EARInitType").EB_INIT:return c("qpl")._(521477507,"1406");case c("EARInitType").MAW_INIT:return c("qpl")._(25310776,"6155");case c("EARInitType").MAW_RP_INIT:d("WALogger").DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[Armadillo Web Remote Presence] MAW RP Initialising EAR"])));return c("qpl")._(25310776,"6155");case c("EARInitType").LS_INIT:return c("qpl")._(25305590,"1127");case c("EARInitType").MAW_IN_UI_INIT:return null}}function v(a,b,e){a=u(a);if(a==null)return;(i||(i=c("ExecutionEnvironment"))).isInWorker?d("MAWQplProxy").sendQplPointThroughBridge(a,"worker_"+b,{annotations:e}):(c("QPLUserFlow").addPoint(a,b),e!=null&&c("QPLUserFlow").addAnnotations(a,e))}g.storeName=k;g.ENCRYPTION_MAW_STORES_INDEX=l;g.getEncryptionDB=a;g.isEncryptionDBInited=e;g.makeEncryptionDB=s;g.maybeSetEncryptionDbOnVersionChange=f;g.deleteEncryptionDB_UNSAFE=t}),98);
__d("MAWKeychain",["MWEARKeychainV3"],(function(a,b,c,d,e,f,g){"use strict";a={getDbEncryptionKey:d("MWEARKeychainV3").getDbEncryptionKey,getLatestVersion:d("MWEARKeychainV3").getLatestVersion,init:d("MWEARKeychainV3").init};g["default"]=a}),98);
__d("MWSetupDBEncryption",["BrowserLockManager","ExecutionEnvironment","FBLogger","MAWEncryptionIndexedDbV2","MAWKeychain","MWEARKeychainV3","Promise","WAResultOrError","asyncToGeneratorRuntime","getErrorSafe","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(a,b){return b()};function a(a){j=a}var k="mw_ear_db";function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{yield d("MAWEncryptionIndexedDbV2").makeEncryptionDB(a);return yield j("init_setup_keychain",function(){return c("MAWKeychain").init("global_ear",a)})}catch(e){var b=e instanceof Error?e:c("getErrorSafe")(e);c("FBLogger")("messenger_web").catching(b).mustfix("[%s] EAR setup error",String(a));return d("WAResultOrError").DEPRECATED_makeError("keychain-setup-failure",b)}});return m.apply(this,arguments)}function n(a){if(d("MAWEncryptionIndexedDbV2").getEncryptionDB()!=null&&d("MWEARKeychainV3").isKeychainInitialised("global_ear"))return(i||(i=b("Promise"))).resolve(d("WAResultOrError").makeResult(d("MWEARKeychainV3").getLatestVersion("global_ear")));if(c("BrowserLockManager")!=null)return new(i||(i=b("Promise")))(function(d,e){c("promiseDone")(c("BrowserLockManager").request(k,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var b=(yield l(a));d(b)}catch(a){e(a)}})),function(a){},function(a){e(a)})});else return l(a)}function e(a,c){c===void 0&&(c=function(a){return!0});var d=null;return function(e){d==null&&(d=a(e).then(function(a){d=c(a)?(i||(i=b("Promise"))).resolve(a):null;return a})["catch"](function(a){d=null;throw a}));return d}}f=e(function(a){return n(a)},function(a){return(a==null?void 0:a.success)===!0});e=c("justknobx")._("2804")||(h||(h=c("ExecutionEnvironment"))).isInWorker?f:n;g.setPerformanceMeasurementTool=a;g.init=e}),98);
__d("MWSetupEBStateDB",["EARInitType","EBGating","EBSMDBAPI","FBLogger","LSJSEBInMemoryStorage","MWEncryptedBackupsFirstRestoreUpsellTime","MWSetupDBEncryption","QPLUserFlow","WebSession","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").start(c("qpl")._(521477507,"1406"),{annotations:{bool:{is_worker:!0},string:{ebSessionIdentifier:e,sessionTabId:d("WebSession").getId()}}});var f;e=(yield d("MWSetupDBEncryption").init(c("EARInitType").EB_INIT));if(e.success){b=d("EBSMDBAPI").makeEBIDBWorker(b).then(function(a){a==null?c("QPLUserFlow").endFailure(c("qpl")._(521477507,"1406"),"Initialisation failed. Idb is null"):c("QPLUserFlow").endSuccess(c("qpl")._(521477507,"1406"));return a})["catch"](function(a){c("QPLUserFlow").endFailure(c("qpl")._(521477507,"1406"),"Initialisation failed. makeEBIDB threw an error");c("FBLogger")("labyrinth_web").catching(a).warn("[labyrinth_web] EB State IDB initialization failed. Falling back to In memory ReStore db");return null});f=d("EBGating").isEBSMv2Phase1Enabled()?d("LSJSEBInMemoryStorage").makeReStoreWorkerPersistence(b,!1):d("LSJSEBInMemoryStorage").makeReStorePersistence(a)}else{c("QPLUserFlow").endFailure(c("qpl")._(521477507,"1406"),e.error.toString(),{annotations:{string:{errorDescription:((b=e.payload)==null?void 0:b.message)||""}}});c("FBLogger")("labyrinth_web").warn("[labyrinth_web] Encryption DB init failed. Falling back to In memory ReStore db")}return f});return h.apply(this,arguments)}g.makeEBStateDBWorker=a}),98);
__d("WorkerSchedulerPriority",[],(function(a,b,c,d,e,f){"use strict";a=2;b=1;c=0;f.BACKGROUND_PRIORITY=a;f.REGULAR_PRIORITY=b;f.BLOCKING_PRIORITY=c}),66);
__d("WorkerScheduler",["$InternalEnum","Promise","QPLFlow","QuickPerformanceLogger","WAGetSafeQPLError","WAResolvable","WAShiftTimer","WATagsLogger","WATimeUtils","WorkerSchedulerPriority","err","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=d("WATagsLogger").TAGS(["WorkerScheduler"]),w=0,x=100,y=3e4,z=10,A=6e4,B=b("$InternalEnum")({CREATED:0,SCHEDULED:1,RUNNING:2,COMPLETED:3,CANCELLED:-3,FAILED:-2,STUCK:-1}),C=function(){function a(a,b){var c;this.$3=!1;this.$4=new Map();this.$5=new Map();this.$6=new Map();this.$7=[new Set(),new Set(),new Set()];this.$8=[new((c=d("WAResolvable")).Resolvable)(),new c.Resolvable(),new c.Resolvable()];this.$9=new c.Resolvable();this.$1=a;this.config=b;this.$2=v.TAGS([a])}var e=a.prototype;e.waitUntilEndReached=function(){return this.$9.promise};e.waitUntilBlockingEnded=function(){return this.$8[d("WorkerSchedulerPriority").BLOCKING_PRIORITY].promise};e.waitUntilRegularEnded=function(){return this.$8[d("WorkerSchedulerPriority").REGULAR_PRIORITY].promise};e.waitUntilBackgroundEnded=function(){return this.$8[d("WorkerSchedulerPriority").BACKGROUND_PRIORITY].promise};e.getDebugState=function(){var a=this,b=Date.now();return{activeTasks:Array.from(this.$6.entries()).map(function(c){var d=c[0];c=c[1];d=a.$5.get(d);return!d||d.startTime==null?null:{executionTimeMs:b-d.startTime,priority:c,task:d.name,waitTimeMs:b-d.scheduledTime}}).filter(Boolean),pendingTasksByPriority:this.$7.map(function(c){var d=[];c.forEach(function(c){c=a.$5.get(c);if(!c)return;d.push({task:c.name,waitTimeMs:b-c.scheduledTime})});return d})}};e.$10=function(){if(this.$6.size<this.config.maxConcurrency){var a=this.pendingTasksTick({increaseCounter:!1,lowestTier:this.$3?d("WorkerSchedulerPriority").BACKGROUND_PRIORITY:d("WorkerSchedulerPriority").BLOCKING_PRIORITY,tasksToPick:1,tickDelta:0});a=a.candidates;var b=E.getHighestActivePriority();a.length>0&&this.maybeStartTask(a[0].id,b)}};e.runTask=function(a){return this.task(a).run()};e.task=function(a){var b,c=this.$1+":"+a.name+":"+w++;b=(b=a.priority)!=null?b:d("WorkerSchedulerPriority").REGULAR_PRIORITY;a=this.$11(c,{annotations:a.annotations,customFlags:a.customFlags,eventSamplingRate:a.eventSamplingRate,fn:a.fn,name:a.name,priority:b});this.$4.set(c,a);return a.publicApi};e.$12=function(a){var d=this.$4.get(a);if(d==null)return(u||(u=b("Promise"))).reject(c("err")("Cannot run task from Scheduler:"+this.$1+" Task was already cancelled"));d.publicApi.status=B.SCHEDULED;this.$5.set(a,d);this.$7[d.priority].add(a);this.$13(d.priority);d.metric.addPoint("schedule_start");E.scheduleTimerIfNeeded();this.$10();return d.resolvable.promise};e.$11=function(a,b){var c,e=this,f=new(d("WAResolvable").Resolvable)();c=d("QPLFlow").startQplFlowWithCoinflip(F,b.eventSamplingRate!=null?b.eventSamplingRate:this.config.defaultSamplingRate,{annotations:{bool:babelHelpers["extends"]({},(c=b.annotations)==null?void 0:c.bool,b.customFlags),"int":babelHelpers["extends"]({},(c=b.annotations)==null?void 0:c["int"],{originalPriority:b.priority}),string:babelHelpers["extends"]({},(c=b.annotations)==null?void 0:c.string,{name:b.name,scheduler:this.$1,workerID:self!=null&&"worker_id"in self?self.worker_id:void 0})}});var g={fn:b.fn,id:a,loggingParams:{},maxTickDelta:0,metric:c,name:b.name,priority:b.priority,publicApi:{cancel:function(){if(g.publicApi.status!==B.CREATED&&g.publicApi.status!==B.SCHEDULED)return!1;e.$14(a,B.CANCELLED);return e.$4["delete"](a)},id:a,name:b.name,promise:f.promise,promote:function(a){e.$2.DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Promoting "," from "," to ",""])),g.id,g.priority,a);if((g.publicApi.status===B.CREATED||g.publicApi.status===B.SCHEDULED)&&g.priority>a){e.$15(g,a);return!0}return!1},run:function(){return e.$12(a)},status:B.CREATED},resolvable:f,scheduledTime:Date.now(),startTime:null,tickCounter:0,waitCounter:0};return g};e.$14=function(a,b){var c=this.$5.get(a),e=c==null?void 0:c.publicApi.status;if(c==null||e===B.COMPLETED||e===B.FAILED||e===B.STUCK)return;this.$5["delete"](a);this.$6["delete"](a);c.publicApi.status=b;var f=[this.$7[d("WorkerSchedulerPriority").BLOCKING_PRIORITY].size===0,this.$7[d("WorkerSchedulerPriority").REGULAR_PRIORITY].size===0,this.$7[d("WorkerSchedulerPriority").BACKGROUND_PRIORITY].size===0];this.$6.forEach(function(a){f[a]=!1});f[d("WorkerSchedulerPriority").BLOCKING_PRIORITY]&&f[d("WorkerSchedulerPriority").REGULAR_PRIORITY]&&f[d("WorkerSchedulerPriority").BACKGROUND_PRIORITY]&&this.$9.resolve();for(e=d("WorkerSchedulerPriority").BLOCKING_PRIORITY;e<=d("WorkerSchedulerPriority").BACKGROUND_PRIORITY;e++)f[e]&&this.$8[e].resolve()};e.maybeStartTask=function(a,b){var c=this.$5.get(a);if(c==null){this.$2.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Safeguard: Task without corresponding record: Task: ",", Scheduler: ",""])),a,this.$1);return}if(b==null||this.$3===!0)return this.$16(c);if(b<c.priority)return;return this.$16(c)};e.$16=function(a){var c=this;this.$7[a.priority]["delete"](a.id);this.$6.set(a.id,a.priority);this.$2.TAGS([a.name]).LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Started: ",""])),a.id);a.startTime=Date.now();a.publicApi.status=B.RUNNING;a.metric.addPoint("schedule_end",{"int":{priorityTier:a.priority,waitTicks:a.waitCounter}});a.metric.addPoint("run_start",{"int":{startPriority:a.priority}});var e;try{e=a.fn({metric:a.metric})}catch(a){e=(u||(u=b("Promise"))).reject(a)}e.then(function(b){a.resolvable.resolve(b),c.$2.TAGS([a.name]).LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Completed: ",""])),a.id),a.metric.addPoint("run_end",{"int":{executionTicks:a.tickCounter}}),c.$14(a.id,B.COMPLETED),a.metric.endSuccess({"int":{maxTickDeltaMs:a.maxTickDelta}}),c.$10()})["catch"](function(b){a.resolvable.reject(b),c.$2.TAGS([a.name]).WARN(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Failed: ",""])),a.id),a.metric.addPoint("run_fail"),c.$2.TAGS([a.name]).ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Debug params: "," failed: ",""])),a.loggingParams,b),c.$14(a.id,B.FAILED),a.metric.endFail("runtime",{"int":{maxTickDeltaMs:a.maxTickDelta},string:{jsError:d("WAGetSafeQPLError").getSafeQPLErrorMessage(b)}}),c.$10()})};e.$13=function(a){for(var b=d("WorkerSchedulerPriority").BLOCKING_PRIORITY;b<=a;b++)this.$8[b].resolveWasCalled()&&(this.$8[b]=new(d("WAResolvable").Resolvable)());this.$9.resolveWasCalled()&&(this.$9=new(d("WAResolvable").Resolvable)())};e.getHighestActivePriority=function(){var a=this,b=null;this.$6.forEach(function(c,d){c=a.$5.get(d);if(c==null){v.ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Safeguard: Active task without corresponding record: Task: ",", Scheduler: ",""])),d,a.$1);a.$6["delete"](d);return}(b==null||b>c.priority)&&(b=c.priority)});return b};e.activeTasksTick=function(a){var b=this,d=null;this.$6.forEach(function(e,f){e=b.$5.get(f);if(e==null){v.ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Safeguard: Active task without corresponding record: Task: ",", Scheduler: ",""])),f,b.$1);b.$6["delete"](f);return}e.tickCounter++;e.maxTickDelta=Math.max(a,e.maxTickDelta);(d==null||d>e.priority)&&(d=e.priority);e.tickCounter>b.config.ticksToStuck&&e.publicApi.status===B.RUNNING&&(v.WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Possibly stuck: ",""])),e.name),b.$14(e.id,B.STUCK),e.resolvable.reject(c("err")("Stuck")),e.metric.endFail("stuck",{"int":{maxTickDeltaMs:e.maxTickDelta}}))});return d};e.$15=function(a,b){function c(){switch(e){case d("WorkerSchedulerPriority").BACKGROUND_PRIORITY:return d("WorkerSchedulerPriority").REGULAR_PRIORITY;case d("WorkerSchedulerPriority").REGULAR_PRIORITY:return d("WorkerSchedulerPriority").BLOCKING_PRIORITY;default:return d("WorkerSchedulerPriority").BLOCKING_PRIORITY}}var e=a.priority;b=b!=null?b:c();if(b===e)return;a.metric.addPoint("promote_to_"+b);this.$7[e]["delete"](a.id);a.priority=b;this.$7[b].add(a.id)};e.pendingTasksTick=function(a){var b=this,c=a.increaseCounter,e=a.lowestTier,f=a.tasksToPick,g=a.tickDelta,h=[],i=!0;a=function(a){i&&(i=b.$7[a].size===0),b.$7[a].forEach(function(e){var i=b.$5.get(e);if(i==null){v.ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Safeguard: Pending task without corresponding record: Task: ",", Scheduler: ",""])),e,b.$1);b.$7[a]["delete"](e);return}c&&(i.waitCounter++,i.maxTickDelta=Math.max(g,i.maxTickDelta),i.priority>d("WorkerSchedulerPriority").REGULAR_PRIORITY&&i.waitCounter>=b.config.throttleTicks&&b.$15(i),i.priority===d("WorkerSchedulerPriority").REGULAR_PRIORITY&&i.waitCounter>=E.maxWaitTicksMultiplierForFinalPromotion*b.config.throttleTicks&&(v.LOG(r||(r=babelHelpers.taggedTemplateLiteralLoose(["Promoting task ",":"," to blocking priority"])),b.$1,i.name),b.$15(i)));if(h.length>=f)return;if(b.$6.size+h.length>=b.config.maxConcurrency)return;h.push(i)})};for(var j=d("WorkerSchedulerPriority").BLOCKING_PRIORITY;j<=e;j++)a(j);return{candidates:h.map(function(a){return{id:a.id,priority:a.priority}}),isEmpty:i}};e.TEST_ONLY_ignore_delays=function(){this.$3=!0};return a}(),D=function(){function a(){var a=this;this.$1=new Map();this.tickFrequencyMs=x;this.maxThrottleMs=A;this.maxWaitTicksMultiplierForFinalPromotion=z;this.$2=null;this.$3=new(d("WAShiftTimer").ShiftTimer)(function(){var b=!1;try{var c,e=d("WATimeUtils").performanceAbsoluteNow();b=a.$4(e-((c=a.$2)!=null?c:e))}catch(a){v.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Scheduler fatal: ",""])),a)}finally{b===!1?(a.$2=d("WATimeUtils").performanceAbsoluteNow(),a.$3.onOrBefore(a.tickFrequencyMs)):a.$2=null}});this.$5=new Map()}var b=a.prototype;b.getHighestActivePriority=function(){var a=null;this.$5.forEach(function(b){b=b.getHighestActivePriority();a!=null&&b!=null&&a<b&&(a=b);a==null&&b!=null&&(a=b)});return a};b.$4=function(a){var b,c=!0,e=null;this.$5.forEach(function(b){b=b.activeTasksTick(a);e!=null&&b!=null&&e<b&&(e=b);e==null&&b!=null&&(e=b)});var f=[[],[],[]];this.$5.forEach(function(b){var e=b.pendingTasksTick({increaseCounter:!0,lowestTier:d("WorkerSchedulerPriority").BACKGROUND_PRIORITY,tasksToPick:b.config.concurrency,tickDelta:a}),g=e.candidates;e=e.isEmpty;c&&(c=e);g.forEach(function(a){f[a.priority].push({id:a.id,scheduler:b})})});b=(b=f.find(function(a){return a.length>0}))!=null?b:[];for(b of b){var g=b.id,h=b.scheduler;h.maybeStartTask(g,e)}return c};b.scheduleTimerIfNeeded=function(){this.$3.onOrBefore(this.tickFrequencyMs)};b.newScheduler=function(a,b){var c=this.$5.get(a);if(c)return c;c=new C(a,b);this.$5.set(a,c);return c};b.TEST_ONLY_reset=function(){this.$5=new Map(),this.$1=new Map()};return a}(),E=new D(),F=c("qpl")._(1056838280,"1566");function a(a,b){return E.newScheduler(a,{concurrency:(a=b.concurrency)!=null?a:1,defaultSamplingRate:(a=b.defaultSamplingRate)!=null?a:1e4,maxConcurrency:b.maxConcurrency,throttleTicks:Math.round(((a=b.maxThrottleMs)!=null?a:E.maxThrottleMs)/E.tickFrequencyMs),ticksToStuck:Math.round(((a=b.timeToStuckMs)!=null?a:y)/E.tickFrequencyMs)})}function e(a){a.tickFrequencyMs!=null&&(E.tickFrequencyMs=a.tickFrequencyMs),a.maxThrottleMs!=null&&(E.maxThrottleMs=a.maxThrottleMs),a.maxWaitTicksMultiplierForFinalPromotion!=null&&(E.maxWaitTicksMultiplierForFinalPromotion=a.maxWaitTicksMultiplierForFinalPromotion),a.qplEventType!=null&&(F=a.qplEventType),(t||(t=c("QuickPerformanceLogger"))).setAlwaysOnSampleRate(F,1)}function f(){E.TEST_ONLY_reset()}g.BACKGROUND_PRIORITY=d("WorkerSchedulerPriority").BACKGROUND_PRIORITY;g.BLOCKING_PRIORITY=d("WorkerSchedulerPriority").BLOCKING_PRIORITY;g.REGULAR_PRIORITY=d("WorkerSchedulerPriority").REGULAR_PRIORITY;g.SchedulerExecutionState=B;g.makeScheduler=a;g.configWorkerScheduler=e;g.TEST_ONLY_reset=f}),98);
__d("WAWaitForUserUnblocked",["WAResolvable","WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";f=2*60*1e3;var h=new(d("WAResolvable").Resolvable)(),i=d("WorkerScheduler").makeScheduler("offline-queue",{concurrency:1,maxConcurrency:1,defaultSamplingRate:1e3,timeToStuckMs:f});function a(){h.resolveWasCalled()&&(h=new(d("WAResolvable").Resolvable)(),j())}function j(){void i.runTask({name:"offline-queue",fn:function(){return h.promise},priority:d("WorkerScheduler").BLOCKING_PRIORITY})}function b(){return h.promise}function c(){h.resolve()}function e(){return!h.resolveWasCalled()}g.maybeResetWaitForUserUnblocked=a;g.markOfflineQueueAsStarted=j;g.waitForUserUnblocked=b;g.unblockUser=c;g.isStillWaitingForUserUnblocked=e}),98);
__d("EBLS",["EBDB","EBDBEbsmApi","EBEpochChangeListener","EBIsEbEnabledSubscriber","EBLogger","EBReadyNotifier","EBReenrollmentTriggerListener","EBWorkerAddDeviceUtils","EBWorkerODSEntityName.enum","I64","LSAuthorityLevel","LSDataTraceFlushDeferred","LSDatascriptEvaluatorMaybeDeferred","LSDedicatedMqttChannel","LSDefaultSyncGroups","LSDeleteAllAndInsertConnectivityStatusStoredProcedure","LSEncryptedBackupsBackupTenancy","LSFactory","LSIntEnum","LSInternetConnectionState","LSJSEBInMemoryStorage","LSMetadata","LSPlatformDeviceId","LSPlatformMessengerSyncParams","LSPlatformMqttRealtimeTransport","LSPlatformRealtimeTransport","LSPlatformTaskSystemTransport","LSReStoreWrapper","LSVersion","MAWBridge","MAWEBLSInWorkerSwitch","MAWEncryptedBackupsStateManager","MAWLSVaultingHooks","MAWVaultMaterialsStorage","MWEncryptedBackupsListenForChangesToBackupStateInitPath","MWEncryptedBackupsProcessBackupIdsDEPRECATED","MWPlatformTaskSystem","MWSetupEBStateDB","MqttEnv","Promise","QPLUserFlow","ReQL","ServerAppID","WAAssertUnreachable","WAResolvable","WAWaitForUserUnblocked","asyncToGeneratorRuntime","cr:21221","cr:7533","emptyFunction","err","getMWLSRegion","gkx","nullthrows","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=d("EBLogger").EBLogger.tags(["EBLS"]),D=c("qpl")._(521478817,"2806");function a(){return H()}var E,F,G;function H(){return E?E.promise:I({copyKeys:!0,getNewDB:!1}).promise}function I(a){E!=null&&!E.isSettled&&E.reject(c("err")("LSClient is not settled"));F!=null&&!F.isSettled&&F.reject(c("err")("LSDBStorage is not settled"));var b=new(d("WAResolvable").Resolvable)();E=b;F=null;void L(a).then(function(a){b.resolve(a)},function(a){b.reject(a)});return b}function J(){return K.apply(this,arguments)}function K(){K=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){c("QPLUserFlow").addPoint(D,"offline_queue_wait_start"),yield d("WAWaitForUserUnblocked").waitForUserUnblocked(),c("QPLUserFlow").addPoint(D,"offline_queue_wait_end")});return K.apply(this,arguments)}function L(a){return M.apply(this,arguments)}function M(){M=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.copyKeys;a=a.getNewDB;d("EBReadyNotifier").resetEBReady();c("QPLUserFlow").start(D,{timeoutInMs:6e4});c("QPLUserFlow").addPoint(D,"ls_storage_creation_start");a=(yield N(a));c("QPLUserFlow").addPoint(D,"ls_storage_creation_end");!c("gkx")("6240")&&b("cr:21221")!=null&&e?(c("QPLUserFlow").addPoint(D,"eb_worker_add_device_start"),c("promiseDone")(b("cr:21221").addDeviceWithKeysInWorker(c("EBWorkerODSEntityName.enum").MW_EB_DEVICE_MIGRATION_WORKER),function(){c("QPLUserFlow").addPoint(D,"eb_worker_add_device_success"),c("QPLUserFlow").endSuccess(D),d("EBReadyNotifier").markEBReady()},function(){c("QPLUserFlow").addPoint(D,"eb_worker_add_device_failure"),c("QPLUserFlow").endSuccess(D),d("EBReadyNotifier").markEBReady()})):(c("QPLUserFlow").addPoint(D,"eb_worker_add_device_skipped"),c("QPLUserFlow").endSuccess(D),d("EBReadyNotifier").markEBReady());C.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Initialised db"])));e={appId:c("nullthrows")(c("ServerAppID").app_id),executeGraphQLLightSpeedRequest:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];var e=(yield d("MAWBridge").getBridge().sendAndReceive("event","executeGraphQLLightSpeedRequest",{args:b}));return e});function c(){return a.apply(this,arguments)}return c}(),getDb:N,getEval:function(){return c("LSDatascriptEvaluatorMaybeDeferred")()},platformName:"Messenger",realtimeUnderylingTransport:function(){return(B||(B=b("Promise"))).resolve(function(b,a){return c("LSPlatformMqttRealtimeTransport")(c("LSVersion"),a,{getInstance:d("LSDedicatedMqttChannel").getInstance(function(){return!0},(b={},b[d("MqttEnv").MqttGkNames.mqttweb_global_connection_counter]=!1,b),function(a,b){return b},c("emptyFunction")),shutdownAndClear:d("LSDedicatedMqttChannel").shutdownAndClear})})},region:c("getMWLSRegion")(),schemaVersion:c("LSVersion"),sendHardcodedInitSync:!1,syncParams:c("LSPlatformMessengerSyncParams")};C.DEBUG(n||(n=babelHelpers.taggedTemplateLiteralLoose(["created config"])));c("QPLUserFlow").addAnnotations(D,{string:{appId:e.appId}});var f=d("LSPlatformDeviceId").getDeviceIdForProviderType("ephemeral");c("QPLUserFlow").addPoint(D,"platform_client_init_start");e=(yield S(a,e,f));c("QPLUserFlow").addPoint(D,"platform_client_init_end");G=U(a);yield d("EBIsEbEnabledSubscriber").initIsEbEnabledPubSub(a);yield d("EBEpochChangeListener").initEBEpochChangeListener(a);yield d("EBReenrollmentTriggerListener").initEBReenrollmentTriggerListener(a);C.DEBUG(o||(o=babelHelpers.taggedTemplateLiteralLoose(["finished init successfully"])));return e});return M.apply(this,arguments)}function N(a){return O.apply(this,arguments)}function O(){O=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=!1);if(!a&&F!=null)return F.promise;a=new(d("WAResolvable").Resolvable)();F=a;yield d("MAWVaultMaterialsStorage").setupVaultMaterials();var e={clearEbStores:d("EBDB").clearEbStores,flushEBSMtoEBDB:d("EBDBEbsmApi").flushEBSMtoEBDB,rehydrateEBSMFromEBDB:d("EBDBEbsmApi").rehydrateEBSMFromEBDB},g;c("gkx")("6240")?g=(yield d("LSJSEBInMemoryStorage").makeReStorePersistence(e)):g=(yield d("MWSetupEBStateDB").makeEBStateDBWorker({clearEbStores:function(){return(B||(B=b("Promise"))).resolve()},flushEBSMtoEBDB:function(){return(B||(B=b("Promise"))).resolve()},rehydrateEBSMFromEBDB:function(){return(B||(B=b("Promise"))).resolve(d("EBDBEbsmApi").RehydrationResult.EmptyDb)},updateEBSM:function(){return(B||(B=b("Promise"))).resolve()}},{force:!1,getCache:!0}));if(g==null)throw C.mustfixThrow("persistence is null");g=d("LSReStoreWrapper").createLSReStore(g,d("LSMetadata").schema,[c("MAWLSVaultingHooks")],void 0);c("gkx")("6240")&&(e.updateEBSM=d("EBDBEbsmApi").updateEBSM(g));yield g.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("LSDefaultSyncGroups").seedDb(a,void 0)});return function(b){return a.apply(this,arguments)}}(),"readwrite","ui",void 0,f.id+":289");a.resolve(g);return g});return O.apply(this,arguments)}function e(){return P.apply(this,arguments)}function P(){P=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(b("cr:7533")!=null||E==null)return;yield d("EBWorkerAddDeviceUtils").clearLSEBSMTables(yield N())});return P.apply(this,arguments)}function Q(a){var b=c("MWEncryptedBackupsListenForChangesToBackupStateInitPath").listenForChangesToBackupState(a);return function(){b&&b()}}function R(a,b){var e=b==="Connected"?(z||(z=d("LSIntEnum"))).ofNumber(c("LSInternetConnectionState").CONNECTED):(z||(z=d("LSIntEnum"))).ofNumber(c("LSInternetConnectionState").NOT_CONNECTED);C.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync connection status: ",""])),b);c("promiseDone")(a.runInTransaction(function(a){return c("LSDeleteAllAndInsertConnectivityStatusStoredProcedure")(c("LSFactory")(a),{internetConnectionState:e})},"readwrite",void 0,void 0,f.id+":327"),function(){C.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync connection status set successfully"])))},function(a){C.MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync connection status set failed: ",""])),a==null?void 0:a.message);throw a})}function S(a,b,c){return T.apply(this,arguments)}function T(){T=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){C.DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync starting..."])));var g=(yield e.getEval());C.DEBUG(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Getting datascript evaluator success"])));var h=g()(a);C.DEBUG(r||(r=babelHelpers.taggedTemplateLiteralLoose(["Clearing epoch before resume sync..."])));C.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Starting realtime transport"])));g=(yield e.realtimeUnderylingTransport());var i=d("LSPlatformRealtimeTransport").LSPlatformRealtimeTransport(g,e.appId,f);C.DEBUG(t||(t=babelHelpers.taggedTemplateLiteralLoose(["Starting task system"])));var j=new(c("MWPlatformTaskSystem"))(a,new(c("LSPlatformTaskSystemTransport"))(a,i,h,e.schemaVersion));C.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Starting backup state listeners"])));var k=null;b("cr:7533")!=null?c("promiseDone")(J().then(function(a){return b("cr:7533")()}),function(b){c("QPLUserFlow").addPoint(D,"sync_system_creation_start"),k=b(a,i,h,e.schemaVersion,f,e.executeGraphQLLightSpeedRequest),c("QPLUserFlow").addPoint(D,"sync_system_creation_end")}):c("QPLUserFlow").addPoint(D,"sync_system_creation_skipped");var l=Q(a);C.DEBUG(v||(v=babelHelpers.taggedTemplateLiteralLoose(["Watching for expired traces"])));var m;c("promiseDone")(d("LSDataTraceFlushDeferred").watchForExpiredTraces(a).then(function(a){m=a}));C.DEBUG(w||(w=babelHelpers.taggedTemplateLiteralLoose(["Subscribing to mqtt sync status change events"])));i.onConnectionStatusChange(function(b){R(a,b)});C.DEBUG(x||(x=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync starting sucess"])));return{cleanup:function(){var a;C.DEBUG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync cleaning up"])));j==null||j.cleanup();i.cleanup();(a=k)==null||a.cleanup();l();m==null||m();G.forEach(function(a){return a()})},db:a}});return T.apply(this,arguments)}function U(a){var b=[];if(c("gkx")("12414")){var e=function(a){d("MAWEncryptedBackupsStateManager").setEncryptedBackupsState(a),d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"UpdateEBState",value:{newState:a}}]})},f=a.tables.encrypted_backups.subscribe(function(){c("promiseDone")(d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.encrypted_backups)),function(b){if(b!=null){c("promiseDone")(d("MWEncryptedBackupsProcessBackupIdsDEPRECATED").processBackupIdsStoredProcedure(a),e,function(a){C.catching(a).mustfix("Process backup ids failed")});return}})});b.push(f)}else{f=V(a);b.push(f)}return b}function V(a){d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state)).then(function(a){a!=null&&c("MAWEBLSInWorkerSwitch").set(W(a))})["catch"](function(a){C.catching(a).MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Failed to get initial state for EBLS Switch"])))});return a.tables.secure_encrypted_backups_client_state.subscribe(function(a,b){C.DEBUG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["EBLS Switch state changed. operation: ",""])),b.operation);switch(b.operation){case"delete":c("MAWEBLSInWorkerSwitch").set(!1);break;case"add":case"put":c("MAWEBLSInWorkerSwitch").set(W(b.value));break;default:b.operation;throw c("WAAssertUnreachable")(b.operation)}})}function W(a){var b=a.authorityLevel;a=a.backupTenancy;if(b==null)return!1;a=a!=null?a:(z||(z=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION);return(A||(A=d("I64"))).equal(a,(z||(z=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION))&&(A||(A=d("I64"))).equal(b,(z||(z=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}g.init=a;g.genLSClient=H;g.getLSStorage=N;g.clearEBSMStorage=e;g.platformClientInit=S}),98);
__d("EBSMAPI",["Promise","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(a=c("requireDeferred"))("EBAddDeviceWithKeys").__setRef("EBSMAPI"),j=a("EBAddDeviceWithRecoveryCode").__setRef("EBSMAPI"),k=a("EBDeleteMailbox").__setRef("EBSMAPI"),l=a("EBFetchBackupIds").__setRef("EBSMAPI"),m=a("EBGetEBState").__setRef("EBSMAPI"),n=a("EBGetLSVirtualDevices").__setRef("EBSMAPI"),o=a("EBInitializeBackup").__setRef("EBSMAPI"),p=a("EBIsEbEnabled").__setRef("EBSMAPI");d={addDeviceWithEBKeys:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return i.load().then(function(a){return a.addDeviceWithEBKeys.apply(a,b)})},addDeviceWithRecoveryCode:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return j.load().then(function(a){return a.addDeviceWithRecoveryCode.apply(a,b)})},deleteMailbox:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return k.load().then(function(a){return a.deleteMailbox.apply(a,b)})},fetchBackupIds:function(a,b){return l.load().then(function(c){return c.fetchBackupIds(a,b)})},getEBState:function(){return m.load().then(function(a){return a.GetEbState()})},getLSVirtualDevices:function(a){return n.load().then(function(b){return b.getLSVirtualDevices(a)})},initializeBackup:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return o.load().then(function(a){return a.initializeBackup.apply(a,b)})},isEbEnabled:function(){return p.load().then(function(a){return a.isEbEnabledEbSwitch()})},optOutOfBackup:function(){return(h||(h=b("Promise"))).resolve()}};e=d;g["default"]=e}),98);
__d("EBWorkerEBDBApi",["EBDB","EBDBConsistencyApi","EBLS","WALogger","WAResolvable","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new(d("WAResolvable").Resolvable)();function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("EBLS").genLSClient());try{yield d("EBDBConsistencyApi").startListeningDeviceRegistrations(a.db,d("EBDB").EBDBEnvironment.Worker)}catch(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Error on EBDB init in Worker: ",""])),a)}finally{i.resolve(a.db)}});return j.apply(this,arguments)}function c(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield i.promise);yield d("EBDBConsistencyApi").addNewDevice(b,d("EBDB").EBDBEnvironment.Worker,a)});return k.apply(this,arguments)}function e(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield i.promise);void d("EBDBConsistencyApi").trackConsistency(b,d("EBDB").EBDBEnvironment.Worker,a);return d("EBDBConsistencyApi").getDeviceId()});return l.apply(this,arguments)}function f(){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("EBDB").getEBDB());a=(yield a.store("secure_encrypted_backups_client_state").readAll());return a[0]});return m.apply(this,arguments)}g.startListeningEBDeviceRegistrations=a;g.addNewDevice=c;g.trackConsistency=e;g.getSecureEBClientState=f}),98);
__d("LSEncryptedBackupsOpStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({SUCCESS:0,FAILURE:1,UNKNOWN:2});f["default"]=a}),66);
__d("MAWAdminMsgTypesGrouped",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";b=[(a=d("MAWLocalizationType")).LOCALIZATION_TYPE.CUTOVER_IGD_THREAD_ADMIN_MESSAGE,a.LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE,a.LOCALIZATION_TYPE.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE];c=[a.LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE,a.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE,a.LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE,a.LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE];e=[a.LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS,a.LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT,a.LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS,a.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS,a.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT,a.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_MORE_THAN_TWO_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_TWO_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_MORE_THAN_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_ONE_USER];f=[a.LOCALIZATION_TYPE.CURRENT_USER_DEMOTED_PARTICIPANT,a.LOCALIZATION_TYPE.CURRENT_USER_PROMOTED_PARTICIPANT,a.LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_PARTICIPANT,a.LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_PARTICIPANT,a.LOCALIZATION_TYPE.CURRENT_USER_GOT_DEMOTED,a.LOCALIZATION_TYPE.CURRENT_USER_GOT_PROMOTED,a.LOCALIZATION_TYPE.CURRENT_USER_SELF_DEMOTED,a.LOCALIZATION_TYPE.PARTICIPANT_GOT_DEMOTED,a.LOCALIZATION_TYPE.PARTICIPANT_GOT_PROMOTED,a.LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_YOU,a.LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_YOU,a.LOCALIZATION_TYPE.PARTICIPANT_SELF_DEMOTED,a.LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ADMIN_ONLY,a.LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ALL_MEMBERS,a.LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY,a.LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS,a.LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ADMIN_ONLY,a.LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ALL_MEMBERS];d=[a.LOCALIZATION_TYPE.CURRENT_USER_LEFT_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP];var h=[a.LOCALIZATION_TYPE.CURRENT_USER_NAMED_GROUP,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_HOTLIKE,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_NICKNAME,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_PHOTO,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_THEME,a.LOCALIZATION_TYPE.CURRENT_USER_CLEAR_OWN_NICKNAME,a.LOCALIZATION_TYPE.CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME,a.LOCALIZATION_TYPE.CURRENT_USER_SET_OWN_NICKNAME,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_AI_THEME],i=[a.LOCALIZATION_TYPE.PARTICIPANT_NAMED_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_HOTLIKE,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PHOTO,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_THEME,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_AI_THEME,a.LOCALIZATION_TYPE.UNKNOWN_USER_NAMED_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_CLEAR_OWN_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_SET_OWN_NICKNAME],j=[a.LOCALIZATION_TYPE.CURRENT_USER_PINNED_MESSAGE,a.LOCALIZATION_TYPE.CURRENT_USER_UNPINNED_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_PINNED_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_UNPINNED_MESSAGE],k=[a.LOCALIZATION_TYPE.CURRENT_USER_LIMIT_SHARING_ENABLED,a.LOCALIZATION_TYPE.CURRENT_USER_LIMIT_SHARING_DISABLED,a.LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_ENABLED,a.LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_DISABLED],l=[a.LOCALIZATION_TYPE.TWO_USERS_CONNECTED,a.LOCALIZATION_TYPE.TWO_USERS_CONNECTED_ONE_MSPLIT],m=[a.LOCALIZATION_TYPE.CURRENT_USER_SEND_UNRENDERABLE_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_LIVE_LOCATION_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_LOCATION_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_POLL_CREATION_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_CONTACT_SHARE_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_STORY_MENTION_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_BUMP_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK],n=[a.LOCALIZATION_TYPE.PARTICIPANT_SEND_UNRENDERABLE_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_LIVE_LOCATION_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_LOCATION_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_POLL_CREATION_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_CONTACT_SHARE_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_STORY_MENTION_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_BUMP_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.META_AI_SEND_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.USER_SEND_UNAVAILABLE_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.USER_SEND_ENCRYPTED_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_BUMP_MESSAGE_ORIGINAL_UNAVAILABLE_FALLBACK,a.LOCALIZATION_TYPE.RTC_XMA_FALLBACK],o=[a.LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE,a.LOCALIZATION_TYPE.CURRENT_USER_BUMPED_OWN_MESSAGE],p=[a.LOCALIZATION_TYPE.PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_BUMPED_OWN_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE],q=[a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_DAYS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_HOURS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_MINUTES,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_SECONDS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_OFF,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_DAYS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_HOURS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_MINUTES,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_DAYS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_HOURS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_MINUTES,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_SECONDS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_OFF,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_DAYS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_HOURS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_MINUTES,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_SECONDS,a.LOCALIZATION_TYPE.EPHEMERAL_SETTINGS_AUTO_RESET],r=[a.LOCALIZATION_TYPE.YOUR_DEVICE_ICDC_ALERT_ADMIN_MESSAGE,a.LOCALIZATION_TYPE.ICDC_ALERT_ADMIN_MESSAGE],s=[a.LOCALIZATION_TYPE.CURRENT_USER_MISSED_AUDIO_CALL,a.LOCALIZATION_TYPE.CURRENT_USER_MISSED_VIDEO_CALL,a.LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_AUDIO_CALL,a.LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_VIDEO_CALL],t=[a.LOCALIZATION_TYPE.CURRENT_USER_AUDIO_CALLED,a.LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_AUDIO_CALL,a.LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_VIDEO_CALL,a.LOCALIZATION_TYPE.CURRENT_USER_VIDEO_CALLED,a.LOCALIZATION_TYPE.PARTICIPANT_MISSED_AUDIO_CALL,a.LOCALIZATION_TYPE.PARTICIPANT_MISSED_VIDEO_CALL,a.LOCALIZATION_TYPE.PARTICIPANT_AUDIO_CALLED,a.LOCALIZATION_TYPE.PARTICIPANT_VIDEO_CALLED],u=[a.LOCALIZATION_TYPE.CURRENT_USER_CREATED_GROUP,a.LOCALIZATION_TYPE.CURRENT_USER_MENTIONED_STORY_IG,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_EVENT,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_POST,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_REEL,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY_HIGHLIGHT,a.LOCALIZATION_TYPE.CURRENT_USER_RECEIVED_STORY_MENTION_IG,a.LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_RECORD_SCREEN,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_TAKE_SCREENSHOT,a.LOCALIZATION_TYPE.CURRENT_USER_UNSENT_MESSAGE],v=[a.LOCALIZATION_TYPE.PARTICIPANT_CREATED_GROUP,a.LOCALIZATION_TYPE.UNKNOWN_USER_CREATED_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_AUDIO,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_GIF,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT_IN_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_EVENT,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_POST,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_REEL,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY_HIGHLIGHT,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT,a.LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE_IN_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_UNSENT_MESSAGE,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_RECORD_SCREEN,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_TAKE_SCREENSHOT];a=[a.LOCALIZATION_TYPE.EMPTY_SNIPPET];g.cutoverAdminMsgs=b;g.deviceChanges=c;g.participantsAddedRemoved=e;g.groupPermissionsChanged=f;g.participantLeftGroup=d;g.chatCustomizedByCurrentUser=h;g.chatCustomizedByOtherUser=i;g.pinnedMessageUpdate=j;g.limitSharingUpdate=k;g.twoUsersConnected=l;g.fallbackMsgFromCurrentUser=m;g.fallbackMsgFromOtherUser=n;g.currentUserBumpsMessage=o;g.otherUserBumpsMessage=p;g.ephemeralSettingChanges=q;g.icdcAlerts=r;g.callActionToNotifyAbout=s;g.callActionNotToNotifyAbout=t;g.otherNonAdminMsgToBeBumped=u;g.otherNonAdminMsgToBeMarkedAsUnread=v;g.otherNonAdminMsgToNotTriggerUpdate=a}),98);
__d("MAWArmadilloAppDataTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={},k={},l={},m={},n={},o={},p={},q={},r={},s={};a.name="ProtocolMsgId";a.internalSpec={externalId:[1,(d=d("WAProtoConst")).TYPES.STRING],author:[2,d.TYPES.STRING],chat:[3,d.TYPES.STRING]};b.name="MetaSyncMessageKeyProto";b.internalSpec={fromMe:[1,d.TYPES.BOOL],id:[2,d.TYPES.STRING]};c.name="MetaSyncMessageProto";c.internalSpec={key:[1,d.TYPES.MESSAGE,b],ts:[2,d.TYPES.INT64]};e.name="MetaSyncMessageRangeProto";e.internalSpec={lastMessageTimestamp:[1,d.TYPES.INT64],lastSystemMessageTimestamp:[2,d.TYPES.INT64],messages:[3,d.FLAGS.REPEATED|d.TYPES.MESSAGE,c]};f.name="MetaSyncChatActionProto";f.internalSpec={type:[1,d.TYPES.STRING],chatJid:[2,d.TYPES.STRING],archived:[3,d.TYPES.BOOL],ts:[4,d.TYPES.INT64],messageRange:[5,d.TYPES.MESSAGE,e],read:[6,d.TYPES.BOOL]};h.name="MetaSyncMessageActionProto";h.internalSpec={type:[1,d.TYPES.STRING],protocolMsgId:[2,d.TYPES.MESSAGE,a]};i.name="MetaSyncActionProto";i.internalSpec={chatAction:[1,d.TYPES.MESSAGE,f],messageAction:[2,d.TYPES.MESSAGE,h],__oneofs__:{action:["chatAction","messageAction"]}};j.name="MetaSyncAppDataProto";j.internalSpec={actions:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i]};k.name="EncryptedBackupsSecretsEpochProto";k.internalSpec={id:[1,d.TYPES.UINT64],anonId:[2,d.TYPES.BYTES],rootKey:[3,d.TYPES.BYTES],status:[4,d.TYPES.INT32]};l.name="EncryptedBackupsSecretsProto";l.internalSpec={backupId:[1,d.TYPES.UINT64],serverDataId:[2,d.TYPES.UINT64],epoch:[3,d.FLAGS.REPEATED|d.TYPES.MESSAGE,k],tempOcmfClientState:[4,d.TYPES.BYTES],mailboxRootKey:[5,d.TYPES.BYTES],obliviousValidationToken:[6,d.TYPES.BYTES]};m.name="FingerprintProto";m.internalSpec={currentIndex:[1,d.TYPES.UINT32],deviceIndexes:[2,d.FLAGS.REPEATED|d.TYPES.UINT32],rawId:[3,d.TYPES.UINT32]};n.name="SyncKeyDataProto";n.internalSpec={keyId:[1,d.TYPES.BYTES],keyData:[2,d.TYPES.BYTES],keyEpoch:[3,d.TYPES.UINT32],timestamp:[4,d.TYPES.INT64],fingerprint:[5,d.TYPES.MESSAGE,m]};o.name="SyncKeyShareProto";o.internalSpec={keys:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,n],orphanKeys:[2,d.FLAGS.REPEATED|d.TYPES.BYTES]};p.name="SyncKeyRequestProto";p.internalSpec={keyIds:[1,d.FLAGS.REPEATED|d.TYPES.BYTES]};q.name="AppDataProto";q.internalSpec={type:[1,d.TYPES.STRING],actions:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i],encryptedBackupsSecrets:[3,d.TYPES.MESSAGE,l],syncKeyShare:[4,d.TYPES.MESSAGE,o],syncKeyRequest:[5,d.TYPES.MESSAGE,p]};r.name="IdentitiesPerDeviceProto";r.internalSpec={deviceJid:[1,d.TYPES.STRING],serializedPubKey:[2,d.TYPES.BYTES],baseKey:[3,d.TYPES.BYTES]};s.name="AppDataTableSchemaProto";s.internalSpec={externalId:[1,d.TYPES.STRING],ts:[2,d.TYPES.INT64],contents:[3,d.TYPES.MESSAGE,q],permittedIdentitiesPerDevice:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,r],ack:[5,d.TYPES.INT32],appDataId:[6,d.TYPES.INT32],recipientDevices:[7,d.FLAGS.REPEATED|d.TYPES.STRING],sendPartial:[8,d.TYPES.BOOL]};g.ProtocolMsgIdSpec=a;g.MetaSyncMessageKeyProtoSpec=b;g.MetaSyncMessageProtoSpec=c;g.MetaSyncMessageRangeProtoSpec=e;g.MetaSyncChatActionProtoSpec=f;g.MetaSyncMessageActionProtoSpec=h;g.MetaSyncActionProtoSpec=i;g.MetaSyncAppDataProtoSpec=j;g.EncryptedBackupsSecretsEpochProtoSpec=k;g.EncryptedBackupsSecretsProtoSpec=l;g.FingerprintProtoSpec=m;g.SyncKeyDataProtoSpec=n;g.SyncKeyShareProtoSpec=o;g.SyncKeyRequestProtoSpec=p;g.AppDataProtoSpec=q;g.IdentitiesPerDeviceProtoSpec=r;g.AppDataTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloAppMetaTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="DbAppMetaValuesProto";a.internalSpec={msgTypeVersion:[1,(c=d("WAProtoConst")).TYPES.INT32],hmacKey:[2,c.TYPES.BYTES],allowSecurityAlert:[3,c.TYPES.BOOL],hotlikeSticker:[4,c.TYPES.BYTES],isBackfilledForOccamadillo:[5,c.TYPES.BOOL],allowSecurityAlertForSelf:[11,c.TYPES.BOOL],hasMigratedFromDexie:[12,c.TYPES.BOOL],restoreMigrationAttempts:[13,c.TYPES.INT32],deviceJid:[14,c.TYPES.STRING],restoreToDexieMigrationComplete:[15,c.TYPES.BOOL],dbMigrationVersion:[16,c.TYPES.INT32]};b.name="AppMetaTableSchemaProto";b.internalSpec={key:[1,c.TYPES.STRING],value:[2,c.TYPES.MESSAGE,a]};g.DbAppMetaValuesProtoSpec=a;g.AppMetaTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloCollectionVersionsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="CollectionVersionsTableSchemaProto";a.internalSpec={collection:[1,(b=d("WAProtoConst")).TYPES.STRING],version:[2,b.TYPES.INT32],state:[3,b.TYPES.STRING],finiteFailureStartTime:[4,b.TYPES.INT64],ltHash:[5,b.TYPES.BYTES],isCollectionInMacMismatchFatal:[6,b.TYPES.BOOL],isCollectionLthashInconsistent:[7,b.TYPES.BOOL]};g.CollectionVersionsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloContactsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="EphemeralSettingProto";a.internalSpec={ephemeralExpirationInSec:[1,(c=d("WAProtoConst")).TYPES.UINT32],ephemeralLastUpdatedOrSetTimestamp:[2,c.TYPES.INT64]};b.name="EphemeralSyncResponseBackoffInfo";b.internalSpec={syncResponseRetries:[1,c.TYPES.INT32],syncResponseSentTs:[2,c.TYPES.INT64]};g.EphemeralSettingProtoSpec=a;g.EphemeralSyncResponseBackoffInfoSpec=b}),98);
__d("MAWArmadilloDeletedMessagesTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="DeletedMessagesTableSchemaProto";a.internalSpec={author:[1,(b=d("WAProtoConst")).TYPES.STRING],chat:[2,b.TYPES.STRING],externalId:[3,b.TYPES.STRING],reason:[4,b.TYPES.STRING]};g.DeletedMessagesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloDeviceChangeAlertsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="DeviceChangeAlertsTableSchemaProto";a.internalSpec={action:[1,(b=d("WAProtoConst")).TYPES.STRING],isArchived:[2,b.TYPES.BOOL],deviceChangeAlertsId:[3,b.TYPES.INT64],location:[4,b.TYPES.STRING],model:[5,b.TYPES.STRING],ts:[6,b.TYPES.INT64],loggedOut:[7,b.TYPES.BOOL],deviceJid:[8,b.TYPES.STRING],identity:[9,b.TYPES.BYTES],platform:[10,b.TYPES.STRING],latitude:[11,b.TYPES.STRING],longitude:[12,b.TYPES.STRING],isConfirmed:[13,b.TYPES.BOOL],isNotified:[14,b.TYPES.BOOL]};g.DeviceChangeAlertsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloDyiBatchTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={BACKUP_RESTORE:0,E2E_DYI:1};b={};b.name="DyiBatchTableSchemaProto";b.internalSpec={batchId:[1,(c=d("WAProtoConst")).TYPES.INT32],numMessages:[2,c.TYPES.INT32],oldestTs:[3,c.TYPES.INT64],threadId:[4,c.TYPES.STRING],isThread:[5,c.TYPES.BOOL],numMessagesRestored:[6,c.TYPES.INT32],qplInstanceKeyForThread:[7,c.TYPES.INT64],qplFlowDescriptor:[8,c.TYPES.ENUM,a],qplInstanceKeyE2E:[9,c.TYPES.INT64],numThreadsRestored:[10,c.TYPES.INT64]};g.DYI_BATCH_TABLE_SCHEMA_PROTO_QPL_FLOW_DESCRIPTOR=a;g.DyiBatchTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloEBMsgRangesTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="EBMsgRangesTableSchemaProto";a.internalSpec={rangeId:[1,(b=d("WAProtoConst")).TYPES.UINT32],threadJid:[2,b.TYPES.STRING],minMsgExternalId:[3,b.TYPES.STRING],maxMsgExternalId:[4,b.TYPES.STRING],minMsgSortOrderMs:[5,b.TYPES.UINT64],maxMsgSortOrderMs:[6,b.TYPES.UINT64],creationTime:[7,b.TYPES.INT64]};g.EBMsgRangesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloMessagesTableSchema.pb",["MAWArmadilloContactsTableSchema.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={};b={};c={};e={};f={};var i={},j={},k={},l={},m={},n={};a.name="MsgContentProto";a.internalSpec={content:[1,(h=d("WAProtoConst")).TYPES.STRING],adminMsgContent:[2,h.FLAGS.REPEATED|h.TYPES.STRING],adminType:[3,h.TYPES.STRING],obsoleteExpiration:[4,h.TYPES.INT32],obsoleteTs:[5,h.TYPES.INT64],subtype:[6,h.TYPES.STRING],protobuf:[7,h.TYPES.BYTES],screenshotActionType:[8,h.TYPES.INT32],authorName:[9,h.TYPES.STRING],version:[10,h.TYPES.INT32],mentionedJids:[11,h.FLAGS.REPEATED|h.TYPES.STRING],commands:[12,h.FLAGS.REPEATED|h.TYPES.MESSAGE,b]};b.name="MsgContentCommandProto";b.internalSpec={commandType:[1,h.TYPES.INT32],offset:[2,h.TYPES.INT32],length:[3,h.TYPES.INT32],validationToken:[4,h.TYPES.STRING]};c.name="ReportingMetaProto";c.internalSpec={frankingTag:[1,h.TYPES.BYTES],frankingVersion:[2,h.TYPES.INT32],reportingContent:[3,h.TYPES.BYTES],reportingTag:[4,h.TYPES.BYTES],frankingKey:[5,h.TYPES.BYTES]};e.name="DbQuotedMsgProto";e.internalSpec={remoteJid:[1,h.TYPES.STRING],content:[2,h.TYPES.MESSAGE,m]};f.name="VideoMsgContentProto";f.internalSpec={duration:[1,h.TYPES.INT32],width:[2,h.TYPES.INT32],height:[3,h.TYPES.INT32],mimetype:[4,h.TYPES.STRING],jpegThumbnail:[5,h.TYPES.BYTES],jpegThumbnailHeight:[6,h.TYPES.INT32],jpegThumbnailWidth:[7,h.TYPES.INT32]};i.name="ImageMsgContentProto";i.internalSpec={width:[1,h.TYPES.UINT32],height:[2,h.TYPES.UINT32],jpegThumbnail:[3,h.TYPES.BYTES],jpegThumbnailHeight:[4,h.TYPES.INT32],jpegThumbnailWidth:[5,h.TYPES.INT32]};j.name="AudioMsgContentProto";j.internalSpec={duration:[1,h.TYPES.INT32],mimetype:[2,h.TYPES.STRING],played:[3,h.TYPES.BOOL]};k.name="DocumentFileMsgContentProto";k.internalSpec={filename:[1,h.TYPES.STRING],mimetype:[2,h.TYPES.STRING]};l.name="QuotedDbMediaProto";l.internalSpec={mediaType:[1,h.TYPES.STRING],plaintextHash:[2,h.TYPES.STRING],size:[3,h.TYPES.INT32],ts:[4,h.TYPES.INT64],mediaEntry:[5,h.TYPES.BYTES],validatedVideoInfo:[6,h.TYPES.MESSAGE,f],validatedImageInfo:[7,h.TYPES.MESSAGE,i],validatedAudioInfo:[8,h.TYPES.MESSAGE,j],validatedDocumentFileInfo:[9,h.TYPES.MESSAGE,k]};m.name="DbQuotedMsgContentProto";m.internalSpec={type:[1,h.TYPES.STRING],ts:[2,h.TYPES.INT64],externalId:[3,h.TYPES.STRING],author:[4,h.TYPES.STRING],msgContent:[5,h.TYPES.MESSAGE,a],obsoleteMedia:[6,h.TYPES.MESSAGE,l],msgId:[7,h.TYPES.STRING],mediaId:[8,h.TYPES.INT32],sourceId:[9,h.TYPES.STRING],xmaMessageType:[10,h.TYPES.INT32],specialTextSize:[11,h.TYPES.INT32],plaintextHash:[12,h.TYPES.STRING],expirationTs:[13,h.TYPES.INT64]};n.name="MessagesTableSchemaProto";n.internalSpec={type:[1,h.TYPES.STRING],ts:[2,h.TYPES.INT64],externalId:[3,h.TYPES.STRING],msgId:[4,h.TYPES.STRING],author:[5,h.TYPES.STRING],ack:[6,h.TYPES.INT32],resendCount:[7,h.TYPES.INT32],msgContent:[8,h.TYPES.MESSAGE,a],altIndex:[9,h.TYPES.STRING],forwardingScore:[10,h.TYPES.INT32],quote:[11,h.TYPES.MESSAGE,e],messageExpirationTs:[12,h.TYPES.INT64],ephemeralSetting:[13,h.TYPES.MESSAGE,d("MAWArmadilloContactsTableSchema.pb").EphemeralSettingProtoSpec],revokedExternalId:[14,h.TYPES.STRING],isForwarded:[15,h.TYPES.BOOL],originalTs:[17,h.TYPES.INT64],sortOrderMs:[18,h.TYPES.INT64],reportingMeta:[19,h.TYPES.MESSAGE,c],messageDeleteTs:[20,h.TYPES.INT64],ephemeralCounterStarted:[21,h.TYPES.BOOL],quoteExternalId:[22,h.TYPES.STRING],unsendMsgContentDeleteTs:[23,h.TYPES.INT64],rowId:[24,h.TYPES.INT32],thread:[25,h.TYPES.INT32],mediaId:[26,h.TYPES.INT32],ephemeralMsgDisappeared:[27,h.TYPES.BOOL],threadJid:[28,h.TYPES.STRING],xmaId:[29,h.TYPES.INT32],specialTextSize:[30,h.TYPES.INT32],xmaMessageType:[31,h.TYPES.INT32],isExpiredXmaMsg:[32,h.TYPES.BOOL],ravenEphemeralType:[33,h.TYPES.INT32],ravenEphemeralMediaState:[34,h.TYPES.INT32],editCount:[35,h.TYPES.INT32],groupId:[36,h.TYPES.STRING],groupIndex:[37,h.TYPES.INT64],groupSize:[38,h.TYPES.INT64],receiverFetchId:[39,h.TYPES.STRING],source:[40,h.TYPES.STRING],quoteExpirationTs:[41,h.TYPES.INT64],applicationErrorCode:[42,h.TYPES.INT32],hdType:[43,h.TYPES.INT32],pollStanzaId:[44,h.TYPES.STRING],collapsibleId:[45,h.TYPES.STRING],isCollapsed:[46,h.TYPES.BOOL]};g.MsgContentProtoSpec=a;g.MsgContentCommandProtoSpec=b;g.ReportingMetaProtoSpec=c;g.DbQuotedMsgProtoSpec=e;g.VideoMsgContentProtoSpec=f;g.ImageMsgContentProtoSpec=i;g.AudioMsgContentProtoSpec=j;g.DocumentFileMsgContentProtoSpec=k;g.QuotedDbMediaProtoSpec=l;g.DbQuotedMsgContentProtoSpec=m;g.MessagesTableSchemaProtoSpec=n}),98);
__d("MAWArmadilloEditMsgHistoryTableSchema.pb",["MAWArmadilloMessagesTableSchema.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="EditMsgHistoryTableSchemaProto";a.internalSpec={author:[1,(b=d("WAProtoConst")).TYPES.STRING],editMsgHistoryId:[2,b.TYPES.INT32],editTs:[3,b.TYPES.INT64],msgContent:[4,b.TYPES.MESSAGE,d("MAWArmadilloMessagesTableSchema.pb").MsgContentProtoSpec],originalMsgExternalId:[5,b.TYPES.STRING],specialTextSize:[6,b.TYPES.INT32],threadJid:[7,b.TYPES.STRING],editExternalId:[8,b.TYPES.STRING],sendStatus:[9,b.TYPES.INT32]};g.EditMsgHistoryTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloGroupInfoTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="GroupInfoSchemaProto";a.internalSpec={groupJid:[1,(b=d("WAProtoConst")).TYPES.STRING],threadId:[2,b.TYPES.INT32],creator:[3,b.TYPES.STRING],creationTs:[4,b.TYPES.INT64],name:[5,b.TYPES.STRING],nameOwner:[6,b.TYPES.STRING],nameTs:[7,b.TYPES.INT64],msgExpiration:[8,b.TYPES.INT32],participantVersion:[9,b.TYPES.STRING],inviter:[10,b.TYPES.STRING],memberAddMode:[11,b.TYPES.STRING]};g.GroupInfoSchemaProtoSpec=a}),98);
__d("MAWArmadilloGroupInvitesTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="GroupInvitesTableSchemaProto";a.internalSpec={inviterJid:[1,(b=d("WAProtoConst")).TYPES.STRING],invitedParticipantId:[2,b.TYPES.STRING],inviteCode:[3,b.TYPES.STRING],inviteExpirationTs:[4,b.TYPES.INT64],caption:[5,b.TYPES.STRING]};g.GroupInvitesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloMediaTablesSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={NONE:0,LQ_4K:1,HQ_4K:2};b={};c={};e={};f={};var h={},i={},j={},k={},l={};b.name="ChunkTableSchemaProto";b.internalSpec={plaintextHash:[1,(d=d("WAProtoConst")).TYPES.STRING],blobData:[2,d.TYPES.BYTES],mimetype:[3,d.TYPES.STRING],hashedPlaintextHash:[4,d.TYPES.STRING],chunkId:[5,d.TYPES.INT32]};c.name="MediaBackupSchemaProto";c.internalSpec={mediaBackupId:[1,d.TYPES.INT32],mediaId:[2,d.TYPES.INT32],objectId:[3,d.TYPES.STRING],msgId:[4,d.TYPES.STRING],fbid:[5,d.TYPES.STRING]};e.name="MediaEntriesProto";e.internalSpec={msgId:[1,d.TYPES.STRING],mediaEntryData:[2,d.TYPES.BYTES]};f.name="VideoMsgContentProto";f.internalSpec={duration:[1,d.TYPES.UINT32],width:[2,d.TYPES.UINT32],height:[3,d.TYPES.UINT32],mimetype:[4,d.TYPES.STRING],jpegThumbnail:[5,d.TYPES.BYTES],jpegThumbnailHeight:[6,d.TYPES.UINT32],jpegThumbnailWidth:[7,d.TYPES.UINT32],thumbnailPlaintextHash:[8,d.TYPES.STRING]};h.name="ImageMsgContentProto";h.internalSpec={width:[1,d.TYPES.UINT32],height:[2,d.TYPES.UINT32],jpegThumbnail:[3,d.TYPES.BYTES],jpegThumbnailHeight:[4,d.TYPES.UINT32],jpegThumbnailWidth:[5,d.TYPES.UINT32],thumbnailPlaintextHash:[6,d.TYPES.STRING],hdType:[7,d.TYPES.ENUM,a]};i.name="AudioMsgContentProto";i.internalSpec={duration:[1,d.TYPES.UINT32],mimetype:[2,d.TYPES.STRING],played:[3,d.TYPES.BOOL]};j.name="DocumentFileMsgContentProto";j.internalSpec={filename:[1,d.TYPES.STRING],mimetype:[2,d.TYPES.STRING]};k.name="ValidatedResult";k.internalSpec={validatedMimeType:[1,d.TYPES.STRING],videoStreamType:[2,d.TYPES.STRING],videoCalculatedFps:[3,d.TYPES.UINT32],videoNominalFps:[4,d.TYPES.UINT32],videoWidth:[5,d.TYPES.UINT32],videoHeight:[6,d.TYPES.UINT32],videoDuration:[7,d.TYPES.UINT32],videoAvgBitsPerSecond:[8,d.TYPES.UINT32],audioStreamType:[9,d.TYPES.STRING],audioSamplingRate:[10,d.TYPES.UINT32],audioNumberOfChannels:[11,d.TYPES.UINT32],audioAvgBitsPerSecond:[12,d.TYPES.UINT32]};l.name="MediaTableSchemaProto";l.internalSpec={mediaType:[1,d.TYPES.STRING],plaintextHash:[2,d.TYPES.STRING],size:[3,d.TYPES.UINT64],mediaEntries:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e],ts:[5,d.TYPES.INT64],validatedVideoInfo:[6,d.TYPES.MESSAGE,f],validatedImageInfo:[7,d.TYPES.MESSAGE,h],validatedAudioInfo:[8,d.TYPES.MESSAGE,i],hashedPlaintextHash:[9,d.TYPES.STRING],mediaId:[10,d.TYPES.INT32],msgIds:[11,d.FLAGS.REPEATED|d.TYPES.STRING],objectId:[12,d.TYPES.STRING],fbid:[13,d.TYPES.STRING],validatedDocumentFileInfo:[14,d.TYPES.MESSAGE,j],validatedResult:[15,d.TYPES.MESSAGE,k],accessibilitySummaryText:[16,d.TYPES.STRING]};g.HD_TYPE=a;g.ChunkTableSchemaProtoSpec=b;g.MediaBackupSchemaProtoSpec=c;g.MediaEntriesProtoSpec=e;g.VideoMsgContentProtoSpec=f;g.ImageMsgContentProtoSpec=h;g.AudioMsgContentProtoSpec=i;g.DocumentFileMsgContentProtoSpec=j;g.ValidatedResultSpec=k;g.MediaTableSchemaProtoSpec=l}),98);
__d("MAWArmadilloMissingKeysTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="DeviceResponse";a.internalSpec={deviceId:[1,(c=d("WAProtoConst")).TYPES.INT32],deviceResponse:[2,c.TYPES.BOOL]};b.name="MissingKeysTableSchemaProto";b.internalSpec={keyHex:[1,c.TYPES.STRING],keyId:[2,c.TYPES.BYTES],timestamp:[3,c.TYPES.INT64],deviceResponses:[4,c.FLAGS.REPEATED|c.TYPES.MESSAGE,a]};g.DeviceResponseSpec=a;g.MissingKeysTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloParticipantsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="ParticipantsTableSchemaProto";a.internalSpec={id:[1,(b=d("WAProtoConst")).TYPES.STRING],userJid:[2,b.TYPES.STRING],deliveredWatermarkTs:[3,b.TYPES.INT64],lastReadWatermarkTs:[4,b.TYPES.INT64],type:[5,b.TYPES.STRING],addressable:[6,b.TYPES.BOOL],lastReadActionTs:[7,b.TYPES.INT64],threadId:[9,b.TYPES.INT32],threadJid:[10,b.TYPES.STRING]};g.ParticipantsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloPendingMutationsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={SET:0,REMOVE:1};b={};b.name="PendingMutationsTableSchemaProto";b.internalSpec={id:[1,(c=d("WAProtoConst")).TYPES.INT32],collection:[2,c.TYPES.STRING],index:[3,c.TYPES.STRING],binarySyncAction:[4,c.TYPES.BYTES],version:[5,c.TYPES.INT32],operation:[6,c.TYPES.ENUM,a],timestamp:[7,c.TYPES.INT64],action:[8,c.TYPES.STRING]};g.SYNCD_MUTATION_SYNCD_OPERATION=a;g.PendingMutationsTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="PersonalSenderKeyStatusTableSchemaProto";a.internalSpec={groupJid:[1,(b=d("WAProtoConst")).TYPES.STRING],senderKeyId:[2,b.TYPES.INT32],rotateSenderKey:[4,b.TYPES.BOOL],senderKeyTs:[5,b.TYPES.INT64],hasSenderKey:[6,b.FLAGS.REPEATED|b.TYPES.STRING]};g.PersonalSenderKeyStatusTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloPollTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={OPEN:0,FROZEN:1};b={};c={};e={};f={};b.name="PollOptionProto";b.internalSpec={optionText:[1,(d=d("WAProtoConst")).TYPES.STRING],voteAuthors:[2,d.FLAGS.REPEATED|d.TYPES.STRING]};c.name="PollOptionsProto";c.internalSpec={pollOptionHash:[1,d.TYPES.STRING],pollOption:[2,d.TYPES.MESSAGE,b]};e.name="LatestSenderTimestampsMsProto";e.internalSpec={author:[1,d.TYPES.STRING],latestSenderTimestampMs:[2,d.TYPES.INT64]};f.name="PollTableSchemaProto";f.internalSpec={chatJid:[1,d.TYPES.STRING],encKey:[2,d.TYPES.BYTES],pollAuthor:[3,d.TYPES.STRING],pollStanzaId:[4,d.TYPES.STRING],pollOptions:[5,d.FLAGS.REPEATED|d.TYPES.MESSAGE,c],pollParticipantCount:[6,d.TYPES.UINT32],pollState:[7,d.TYPES.ENUM,a],selectableOptionsCount:[8,d.TYPES.UINT32],title:[9,d.TYPES.STRING],latestSenderTimestampsMs:[10,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e]};g.POLL_STATE=a;g.PollOptionProtoSpec=b;g.PollOptionsProtoSpec=c;g.LatestSenderTimestampsMsProtoSpec=e;g.PollTableSchemaProtoSpec=f}),98);
__d("MAWArmadilloReactionsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="ReactionsTableSchemaProto";a.internalSpec={ack:[1,(b=d("WAProtoConst")).TYPES.INT32],author:[2,b.TYPES.STRING],externalId:[3,b.TYPES.STRING],reactionId:[4,b.TYPES.STRING],reactToExternalId:[5,b.TYPES.STRING],reactToAuthor:[6,b.TYPES.STRING],reactToMsgId:[7,b.TYPES.STRING],threadJid:[8,b.TYPES.STRING],reaction:[9,b.TYPES.STRING],groupingKey:[10,b.TYPES.STRING],ts:[11,b.TYPES.INT64],rowId:[12,b.TYPES.INT32],senderTimestampMs:[13,b.TYPES.INT64]};g.ReactionsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloReceiptTablesSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={};a.name="DbUserStatusTsProto";a.internalSpec={deliveredTs:[1,(d=d("WAProtoConst")).TYPES.INT64],readTs:[2,d.TYPES.INT64]};b.name="StatusTsPerUserProto";b.internalSpec={userJid:[1,d.TYPES.STRING],dbUserStatusTs:[2,d.TYPES.MESSAGE,a]};c.name="IdentitiesPerDeviceProto";c.internalSpec={deviceJid:[1,d.TYPES.STRING],serializedPubKey:[2,d.TYPES.BYTES],baseKey:[3,d.TYPES.BYTES]};e.name="RetryCountPerDeviceProto";e.internalSpec={deviceJid:[1,d.TYPES.STRING],count:[2,d.TYPES.INT32]};f.name="ReceiptsTableSchemaProto";f.internalSpec={msgId:[1,d.TYPES.STRING],statusTsPerUser:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,b],permittedIdentitiesPerDevice:[3,d.FLAGS.REPEATED|d.TYPES.MESSAGE,c],recipientDevices:[4,d.FLAGS.REPEATED|d.TYPES.STRING],retryCountsPerDevice:[5,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e],waMsgId:[6,d.TYPES.STRING]};h.name="Receipts";h.internalSpec={device:[1,d.TYPES.STRING],ts:[2,d.TYPES.INT64]};i.name="PendingReceiptsTableSchemaProto";i.internalSpec={pendingReceiptId:[1,d.TYPES.STRING],thread:[2,d.TYPES.STRING],externalId:[3,d.TYPES.STRING],author:[4,d.TYPES.STRING],deliveryReceipts:[5,d.FLAGS.REPEATED|d.TYPES.MESSAGE,h],readReceipts:[6,d.FLAGS.REPEATED|d.TYPES.MESSAGE,h]};g.DbUserStatusTsProtoSpec=a;g.StatusTsPerUserProtoSpec=b;g.IdentitiesPerDeviceProtoSpec=c;g.RetryCountPerDeviceProtoSpec=e;g.ReceiptsTableSchemaProtoSpec=f;g.ReceiptsSpec=h;g.PendingReceiptsTableSchemaProtoSpec=i}),98);
__d("MAWArmadilloReceiverFetchInfoTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="ReceiverFetchInfoTableSchemaProto";a.internalSpec={mimetype:[1,(b=d("WAProtoConst")).TYPES.STRING],previewHeight:[2,b.TYPES.UINT32],previewWidth:[3,b.TYPES.UINT32],receiverFetchId:[4,b.TYPES.STRING],type:[5,b.TYPES.STRING],previewUrl:[6,b.TYPES.STRING],previewUrlExpirationTimestampMs:[7,b.TYPES.UINT64],accessibilitySummaryText:[8,b.TYPES.STRING]};g.ReceiverFetchInfoTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloSyncActionsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="SyncActionsTableSchemaProto";a.internalSpec={index:[1,(b=d("WAProtoConst")).TYPES.STRING],binarySyncData:[2,b.TYPES.BYTES],actionState:[3,b.TYPES.STRING],version:[4,b.TYPES.INT32],keyId:[5,b.TYPES.BYTES],modelId:[6,b.TYPES.STRING],modelType:[7,b.TYPES.STRING],indexMac:[8,b.TYPES.BYTES],valueMac:[9,b.TYPES.BYTES],collection:[10,b.TYPES.STRING],timestamp:[11,b.TYPES.INT64],action:[12,b.TYPES.STRING]};g.SyncActionsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloSyncKeysTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="SyncKeyFingerprint";a.internalSpec={currentIndex:[1,(c=d("WAProtoConst")).TYPES.INT32],deviceIndexes:[2,c.FLAGS.REPEATED|c.TYPES.INT32],rawId:[3,c.TYPES.INT64]};b.name="SyncKeysTableSchemaProto";b.internalSpec={id:[1,c.TYPES.BYTES],keyId:[2,c.TYPES.BYTES],keyData:[3,c.TYPES.BYTES],keyEpoch:[4,c.TYPES.INT64],timestamp:[5,c.TYPES.INT64],fingerprint:[6,c.TYPES.MESSAGE,a]};g.SyncKeyFingerprintSpec=a;g.SyncKeysTableSchemaProtoSpec=b}),98);
__d("MAWArmadilloTasksTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="TasksTableSchemaProto";a.internalSpec={taskName:[1,d("WAProtoConst").TYPES.STRING],scheduledTime:[2,d("WAProtoConst").TYPES.INT64]};g.TasksTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloThreadsTableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="ThreadsTableSchemaProto";a.internalSpec={jid:[1,(b=d("WAProtoConst")).TYPES.STRING],threadOrder:[2,b.TYPES.STRING],folder:[4,b.TYPES.INT32],newestMsg:[5,b.TYPES.STRING],oldestMsg:[6,b.TYPES.STRING],lastReadMsg:[7,b.TYPES.STRING],lastReadMsgReceiptSent:[8,b.TYPES.STRING],lastReadMsgTs:[9,b.TYPES.INT64],newestMsgTs:[10,b.TYPES.INT64],muteExpireTimeMs:[11,b.TYPES.INT64],muteCallsExpireTimeMs:[12,b.TYPES.INT64],archived:[13,b.TYPES.BOOL],cannotReplyReason:[14,b.TYPES.STRING],chatId:[15,b.TYPES.INT32],optimisticThreadKey:[16,b.TYPES.STRING],isMigratedLocally:[17,b.TYPES.BOOL],snippetMsg:[18,b.TYPES.STRING],deduplicationKey:[19,b.TYPES.STRING],authoritativeThreadKey:[20,b.TYPES.STRING],snippetMsgTs:[21,b.TYPES.INT64],didInsertDualThreadCutoverAdminMsg:[22,b.TYPES.BOOL],unbumpFromTs:[23,b.TYPES.INT64],unbumpToTs:[24,b.TYPES.INT64]};g.ThreadsTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloUnrenderedMessagesTableSchema.pb",["MAWArmadilloContactsTableSchema.pb","MAWArmadilloMessagesTableSchema.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="UnrenderedMessagesTableSchemaProto";a.internalSpec={type:[1,(b=d("WAProtoConst")).TYPES.STRING],ts:[2,b.TYPES.INT64],externalId:[3,b.TYPES.STRING],msgId:[4,b.TYPES.STRING],author:[5,b.TYPES.STRING],ack:[6,b.TYPES.INT32],resendCount:[7,b.TYPES.INT32],ephemeralSetting:[8,b.TYPES.MESSAGE,d("MAWArmadilloContactsTableSchema.pb").EphemeralSettingProtoSpec],messageDeleteForMeTs:[9,b.TYPES.INT64],rowId:[10,b.TYPES.INT32],thread:[11,b.TYPES.INT32],mediaId:[12,b.TYPES.INT32],msgContent:[13,b.TYPES.STRING],threadJid:[14,b.TYPES.STRING],reportingMeta:[15,b.TYPES.MESSAGE,d("MAWArmadilloMessagesTableSchema.pb").ReportingMetaProtoSpec],invitedParticipantUserJid:[16,b.TYPES.STRING],groupName:[17,b.TYPES.STRING],quote:[18,b.TYPES.MESSAGE,d("MAWArmadilloMessagesTableSchema.pb").DbQuotedMsgProtoSpec],xmaMessageType:[19,b.TYPES.INT32],sortOrderMs:[20,b.TYPES.INT64]};g.UnrenderedMessagesTableSchemaProtoSpec=a}),98);
__d("MAWArmadilloXMATableSchema.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="XMATableSchemaProto";a.internalSpec={associatedMessageId:[1,(c=d("WAProtoConst")).TYPES.STRING],author:[2,c.TYPES.STRING],ctas:[3,c.FLAGS.REPEATED|c.TYPES.MESSAGE,b],defaultCTA:[4,c.TYPES.MESSAGE,b],defaultPreviewMediaId:[5,c.TYPES.INT32],externalId:[6,c.TYPES.STRING],faviconMediaId:[7,c.TYPES.INT32],headerMediaId:[8,c.TYPES.INT32],headerTitle:[9,c.TYPES.STRING],isTombstoned:[10,c.TYPES.BOOL],maxSubtitleNumOfLines:[11,c.TYPES.INT32],maxTitleNumOfLines:[12,c.TYPES.INT32],msgId:[13,c.TYPES.STRING],overlayDescription:[14,c.TYPES.STRING],overlayIconGlyph:[15,c.TYPES.INT32],overlayTitle:[16,c.TYPES.STRING],previewMediaIds:[17,c.FLAGS.REPEATED|c.TYPES.INT32],subtitleText:[18,c.TYPES.STRING],targetExpiringAtSec:[19,c.TYPES.INT64],targetId:[20,c.TYPES.STRING],targetType:[21,c.TYPES.INT32],targetUsername:[22,c.TYPES.STRING],threadJid:[23,c.TYPES.STRING],titleText:[24,c.TYPES.STRING],xmaId:[25,c.TYPES.INT32],xmaLayoutType:[26,c.TYPES.INT32],defaultPreviewMediaPlaintextHash:[27,c.TYPES.STRING],faviconPlaintextHash:[28,c.TYPES.STRING],headerMediaPlaintextHash:[29,c.TYPES.STRING]};b.name="CTAProto";b.internalSpec={buttonType:[1,c.TYPES.INT32],title:[2,c.TYPES.STRING],actionUrl:[3,c.TYPES.STRING],nativeUrl:[4,c.TYPES.STRING],ctaType:[5,c.TYPES.STRING]};g.XMATableSchemaProtoSpec=a;g.CTAProtoSpec=b}),98);
__d("MAWAuthoritativeThreadsCache",[],(function(a,b,c,d,e,f){"use strict";a=new Set();f.AuthoritativeThreadsCache=a}),66);
__d("MAWBridgeReceiverFetchInfo",["WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,d,e){var f=e.accessibilitySummaryText,g=e.mimetype,h=e.previewHeight,k=e.previewUrl,l=e.previewUrlExpirationTimestampMs,m=e.previewWidth,n=e.receiverFetchId;e=e.type;return{accessibilitySummaryText:f,mimetype:g,msgId:b,previewHeight:h,previewUrl:k,previewUrlExpirationTimestampMs:j(l),previewWidth:m,receiverFetchId:n,sortOrderMs:i(c,d),threadJid:a,type:e}}function b(a,b,c,d,e){var f=e.mimetype,g=e.previewHeight,h=e.previewWidth,j=e.receiverFetchId;e=e.type;return{mimetype:f,msgId:b,previewHeight:g,previewWidth:h,receiverFetchId:j,sortOrderMs:i(c,d),threadJid:a,type:e}}function i(a,b){return d("WATimeUtils").castToMillisTime(a!=null?a:b*1e3)}function j(a){if(a==null)return void 0;try{return d("WATimeUtils").castLongIntToMillisTime(a)}catch(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to cast previewUrlExpirationTimestampMs to millis time: ",""])),a);return void 0}}g.createBridgeReceiverFetchInfoPayloadFromDbInfo=a;g.createBridgeReceiverFetchInfoPayloadFromUnstoredInfo=b}),98);
__d("MAWBridgeTypesCreators",["FBLogger","MAWDbMsg","MAWImageUtils","MAWMsgType","MAWUserJidWrapper","WAJids","WAMediaUtils","WATimeUtils","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{threadJid:a}}function h(a){var b,c=a.ts;switch(a.type){case d("MAWMsgType").MSG_TYPE.REVOKED:c=(b=a.originalTs)!=null?b:a.ts;break;default:c=d("MAWDbMsg").getCanonicalTsFromMsg(a)}return{msgId:a.msgId,ts:c}}function b(a,b){b=b.map(h);return{messages:b,threadJid:a}}function e(a){return{ravenMsgId:a.msgId,threadJid:a.threadJid}}function f(a,b){return a.filter(function(a){return b===a.threadJid}).map(function(a){return a.msgId})}function i(a){var b,e=a.chatJid,f=a.filteredMsgIds,g=a.hasMediaForUI,h=a.hdTypes,i=a.media,j=a.offlineAttachmentId,k=a.ravenSettings,l=a.sortOrderMs;a=a.transportKey;switch(i.mediaType){case"Image":return{duration:null,ephemeralMediaState:k==null?void 0:k.ephemeralMediaState,ephemeralMediaViewMode:k==null?void 0:k.ephemeralMediaViewMode,filesize:i.size,hasMedia:g,hasPreviewMedia:((b=i.validatedImageInfo)==null?void 0:b.jpegThumbnail)!=null,hdTypes:h,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:f,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:(b=i.validatedImageInfo)==null?void 0:b.jpegThumbnailHeight,previewHeightLarge:(h=i.validatedImageInfo)==null?void 0:h.height,previewWidth:(b=i.validatedImageInfo)==null?void 0:b.jpegThumbnailWidth,previewWidthLarge:(h=i.validatedImageInfo)==null?void 0:h.width,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"Video":return{duration:((b=i.validatedVideoInfo)==null?void 0:b.duration)!=null?((h=i.validatedVideoInfo)==null?void 0:h.duration)*1e3:0,ephemeralMediaState:k==null?void 0:k.ephemeralMediaState,ephemeralMediaViewMode:k==null?void 0:k.ephemeralMediaViewMode,filesize:i.size,hasMedia:g,hasPreviewMedia:((b=i.validatedVideoInfo)==null?void 0:b.jpegThumbnail)!=null,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:f,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:(h=i.validatedVideoInfo)==null?void 0:h.jpegThumbnailHeight,previewHeightLarge:(k=i.validatedVideoInfo)==null?void 0:k.height,previewWidth:(b=i.validatedVideoInfo)==null?void 0:b.jpegThumbnailWidth,previewWidthLarge:(h=i.validatedVideoInfo)==null?void 0:h.width,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"Ptt":return{duration:(k=i.validatedAudioInfo)!=null&&k.duration?i.validatedAudioInfo.duration*1e3:null,filesize:i.size,hasMedia:g,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:f,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:null,previewHeightLarge:null,previewWidth:null,previewWidthLarge:null,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"Gif":return{accessibilitySummaryText:(b=i.accessibilitySummaryText)!=null?b:void 0,duration:null,filesize:i.size,hasMedia:g,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:i.msgIds,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:(h=i.validatedImageInfo)==null?void 0:h.jpegThumbnailHeight,previewHeightLarge:(k=i.validatedImageInfo)==null?void 0:k.height,previewWidth:(b=i.validatedImageInfo)==null?void 0:b.jpegThumbnailWidth,previewWidthLarge:(h=i.validatedImageInfo)==null?void 0:h.width,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"Sticker":h=d("MAWImageUtils").boundHeightWidth((k=i.validatedImageInfo)==null?void 0:k.jpegThumbnailHeight,(b=i.validatedImageInfo)==null?void 0:b.jpegThumbnailWidth,d("MAWImageUtils").STICKER_THUMBNAIL_MAX_SIZE);k=h.height;b=h.width;return{accessibilitySummaryText:(h=i.accessibilitySummaryText)!=null?h:void 0,duration:null,filesize:i.size,hasMedia:g,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:i.msgIds,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:k,previewHeightLarge:k,previewWidth:b,previewWidthLarge:b,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"DocumentFile":h={};for(k of i.mediaEntries){b=k[0];var m=k[1];m=d("WAMediaUtils").mediaEntryDataToRawData(i.plaintextHash,m);m=m.filename;m!=null&&(h[b]=m)}return{defaultFilename:(b=i.validatedDocumentFileInfo)==null?void 0:b.filename,duration:null,filenames:h,filesize:i.size,hasMedia:g,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:f,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:null,previewHeightLarge:null,previewWidth:null,previewWidthLarge:null,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};default:i.mediaType;throw c("FBLogger")("messenger_web").mustfixThrow("[createBridgeMedia] Unsupported media type: "+i.mediaType)}}function j(a,b,e,f,g){var h=c("qex")._("3109")===!0;return{chatJid:a,deliveredWatermarkTs:e!=null?e:d("WATimeUtils").castToUnixTime(0),fbid:b,lastReadActionTs:h&&g!=null?g:d("WATimeUtils").castToUnixTime(0),lastReadWatermarkTs:h&&f!=null?f:d("WATimeUtils").castToUnixTime(0)}}function k(a){var b=a.cannotReplyReason,c=a.folder,d=a.snippetParams,e=a.snippetSenderContactId,f=a.snippetType;a=a.threadJid;return{cannotReplyReason:b,folder:c,snippetContactIDs:d==null?void 0:d.contactIDs,snippetMentionJIDs:d==null?void 0:d.mentionJIDs,snippetParams:d==null?void 0:d.strings,snippetSenderContactId:e,snippetType:f,threadJid:a}}function l(a){return{chatJid:a.groupJid,memberAddMode:a.memberAddMode,threadName:a.name}}var m={snippetContactIDs:[],snippetMentionJIDs:[],snippetParams:[],snippetSenderContactId:null,snippetType:null};function n(a){var b,c=a.bumpTimestampMs,d=a.description,e=a.isMessageAuthorMe,f=a.isUnbump,g=a.skipBumpTimestampValidation,h=a.skipServerThreadBump,i=a.snippetData;a=a.threadJid;b=i==null?m:{snippetContactIDs:i.params.contactIDs,snippetMentionJIDs:(b=i.params.mentionJIDs)!=null?b:[],snippetParams:i.params.strings,snippetSenderContactId:i.senderContactId,snippetType:i.type};return babelHelpers["extends"]({},b,{bumpTimestampMs:c,description:d,isMessageAuthorMe:e,isUnbump:f,skipBumpTimestampValidation:g!=null?g:!1,skipServerThreadBump:h!=null?h:!1,threadJid:a})}function o(a){var b=a.author,c=a.chatJid,e=a.reaction,f=a.reactToMsgId;a=a.ts;return{actorId:d("WAJids").authorToUserId(b,d("WAJids").extractUserId(d("MAWUserJidWrapper").getMyUserJid())),chatJid:c,messageId:f,reaction:e,ts:a}}function p(a){var b=d("WAJids").extractUserId(d("MAWUserJidWrapper").getMyUserJid()),c=a.author,e=a.chatJid;a=a.reactToMsgId;return{actorId:d("WAJids").authorToUserId(c,b),chatJid:e,messageId:a}}function q(a){return{creationTs:a.creationTs,creator:a.creator,groupJid:a.groupJid,msgExpiration:a.msgExpiration,name:a.name,nameOwner:a.nameOwner,nameTs:a.nameTs,participantVersion:a.participantVersion}}function r(a){var b=a.threadJid,c=a.inviteeJid;return{caption:a.caption,inviteCode:a.inviteCode,inviteeId:c,inviteExpireTs:a.inviteExpirationTs,inviterId:d("WAJids").extractUserId(a.inviterJid),threadJid:b}}function s(a){return{threadJid:a}}function t(a,b,c){return{senderId:d("WAJids").extractUserId(b),state:c,threadJid:a}}g.createBridgeUpdateE2EEMetadataParticipants=a;g.createBridgeDeletedMessage=h;g.createBridgeDeleteMessages=b;g.createBridgeRavenAction=e;g.getMsgIdsFilteredByJid=f;g.createBridgeMedia=i;g.createBridgeReceivedReceipt=j;g.createBridgeUpdatedThread=k;g.createBridgeUpdatedGroupInfo=l;g.createBridgeBumpedThreadV2=n;g.createBridgeUpsertReaction=o;g.createBridgeDeleteReaction=p;g.createBridgeGroupInfo=q;g.createBridgeGroupInvite=r;g.createBridgeDeleteGroupInvite=s;g.createBridgeReceivedChatState=t}),98);
__d("MAWCacheServiceBase",["MAWCacheServiceDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=["id"];a=function(){function a(a){this.$1=new Map(),this.namespace=a}var c=a.prototype;c.$2=function(a){return(a=this.$1.get(a))!=null?a:null};c.updateInMemoryCache=function(a,b){this.$1.set(a,b)};c.updateInMemoryCacheBulk=function(a){var b=this;a.forEach(function(a){var c=a[0];a=a[1];b.updateInMemoryCache(c,a)})};c.getValueFromCache=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this,c=this.$2(a);if(c!=null)return c;c=(yield d("MAWCacheServiceDB").getOrSetupMAWCacheDB());c=(yield c.runInTransaction([this.namespace],"readonly",function(c){return c.stores[b.namespace].getByIndex("key",[a])},"read_from_persisted_"+this.namespace));if(c==null)return null;c.id;c=babelHelpers.objectWithoutPropertiesLoose(c,h);this.updateInMemoryCache(a,c);return c});function c(b){return a.apply(this,arguments)}return c}();return a}();g["default"]=a}),98);
__d("MAWDbParticipant",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a+"_"+b}f.craftParticipantId=a}),66);
__d("MAWDbThread",["MAWHexUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWHexUtils").orderPreservingHex(a)+"_"+b}g.craftThreadOrder=a}),98);
__d("MAWDexie",["cr:10766"],(function(a,b,c,d,e,f,g){"use strict";f.exports=b("cr:10766")}),34);
__d("MAWDexieTable",["MAWDexie","Promise","asyncToGeneratorRuntime","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return(h||(h=b("Promise"))).resolve(a)}function a(a){return a.reduce(function(a,b,c){return a.then(function(a){return b(c).then(function(b){a.push(b);return a})})},n([]))}function e(a){return c("MAWDexie").Promise.all(a)}function f(a){return c("MAWDexie").Promise.allSettled(a)}function j(a){return c("MAWDexie").Promise.PSD[a]}function k(a,b){c("MAWDexie").Promise.PSD[a]=b}function l(a){c("MAWDexie").Promise.PSD[a]=void 0}var m=function(){function a(a,b,d,e){d===void 0&&(d=!0);e=new(c("MAWDexie"))(a,babelHelpers["extends"]({},e,{chromeTransactionDurability:"relaxed",modifyChunkSize:c("justknobx")._("3166")}));b(e);this.name=a;this.stores=e;d&&this.open()}var d=a.prototype;d.open=function(){this.stores.open()};d.close=function(){this.stores.close()};d.transact=function(a,c,d){var e=this;return i(this.stores.transaction(a,c.map(function(a){return e.stores[a]}),b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d());return a})))};return babelHelpers.createClass(a,[{key:"tables",get:function(){return this.stores.tables}}])}();function n(a){return c("MAWDexie").Promise.resolve(a)}g.DEXIE_MIN_KEY=d("MAWDexie").Dexie.minKey;g.DEXIE_MAX_KEY=d("MAWDexie").Dexie.maxKey;g.undexify=i;g.dexieSequentialAll=a;g.dexieAll=e;g.dexieAllSettled=f;g.getDexiePSDItem=j;g.setDexiePSDItem=k;g.clearDexiePSDItem=l;g.DexieTable=m;g.dexieResolve=n}),98);
__d("MAWDbSchema.dexie",["FBLogger","MAWDbMsg","MAWDbParticipant","MAWDbThread","MAWDbVersionList","MAWDexie","MAWDexieTable","MAWFolderTypes","MAWLocalizationType","MAWODSProxy","MAWTimeUtils","WAJids","WALogger","WAMsg","WAMsgType","WAOdsEnums","WAStanzaUtils","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a){var b=function(a){var b;b=(b=a.quote)==null?void 0:b.content;return a.quoteExternalId!=null&&(b==null?void 0:b.media)!=null};return a.messages.where("quoteExternalId").between(d("WAStanzaUtils").toStanzaId("0"),d("WAStanzaUtils").toStanzaId("["),!0,!0).filter(b).toArray()["catch"](function(){return a.messages.filter(b).toArray()}).then(function(b){var c=new Set(b.map(function(a){var b;a=(a=a.quote)==null?void 0:a.content;return a==null||(b=a.media)==null?void 0:b.plaintextHash}).filter(Boolean)),d=b.map(function(a){a=a.msgId;return a});return a.media.filter(function(a){a=a.plaintextHash;return c.has(a)}).toArray().then(function(b){var c=new Map(b.map(function(a){var b=a.mediaId;a=a.plaintextHash;return[a,b]}));return a.messages.where("msgId").anyOf(d).modify(function(a){var b;b=(b=a.quote)==null?void 0:b.content;a.quote.content.mediaId=c.get(b.media.plaintextHash);delete a.quote.content.media})})})};b=function(a){return a.groupInfo.toCollection().modify(function(a){typeof a.inviter==="number"&&delete a.inviter})};e=function(){return d("MAWDexieTable").dexieResolve()};f=function(a){return a.threads.filter(function(a){return d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(){return!1},user:function(){return a.oldestMsg!=null}})}).toArray().then(function(b){var c=[];b.forEach(function(a){c.push(a.oldestMsg),c.push(d("MAWDbMsg").toMsgId__UNSAFE_DO_NOT_USE(a.newestMsg))});return a.messages.where("msgId").anyOf(c.filter(Boolean)).toArray().then(function(c){var e=new Map(),f=[],g=[];c.forEach(function(a){e.set(a.msgId,a)});b.forEach(function(b){var c=e.get(b.oldestMsg),h=e.get(b.newestMsg);(c==null?void 0:c.type)==="Admin"&&(h==null?void 0:h.type)==="Admin"&&(c.msgId===h.msgId?g.push(b.chatId):f.push(b));return d("MAWDexieTable").dexieAll(f.map(function(b){return a.messages.where("thread").equals(b.chatId).toArray()})).then(function(b){b.forEach(function(a){if(a.length===0)return;var b=a[0].thread;a=a.filter(function(a){return a.type!=="Admin"});if(a.length>0)return;g.push(b)});return d("MAWDexieTable").dexieAll([a.threads.bulkDelete(g),a.messages.where("thread").anyOf(g)["delete"]()])})})})})};var j=function(a){return a.unrenderedMessages.toCollection().modify(function(a){if(a.type===d("WAMsgType").MSG_TYPE.DELETE_FOR_ME){var b=a.messageDeleteForMeTs;a.messageDeleteForMeTs=b}})},k=function(a){var b=0,e=0,f=c("MAWDexie").currentTransaction;if(f==null)throw c("FBLogger")("maw_db").mustfixThrow("transaction does not exist");f.on("complete",function(){b>0&&d("MAWODSProxy").odsBumpEntityKey({amount:b,entity:d("WAOdsEnums").Entity.MESSAGE_MISSING_THREAD_JID,key:"fail"}),e>0&&d("MAWODSProxy").odsBumpEntityKey({amount:e,entity:d("WAOdsEnums").Entity.MESSAGE_MISSING,key:"fail"})});return a.threads.toArray().then(function(c){var f=c.reduce(function(a,b){b!=null&&a.set(b.chatId,b);return a},new Map());return d("MAWDexieTable").dexieAll([a.messages.toCollection().modify(function(a){if(a!=null){var c=f.get(a.thread);c!=null?a.threadJid=c.jid:b+=1}else e+=1}),a.unrenderedMessages.toCollection().modify(function(a){if(a!=null){var c=f.get(a.thread);c!=null?a.threadJid=c.jid:b+=1}else e+=1})])})},l=function(a){return a.isDualSend.toCollection().modify(function(a){a.version==null&&(a.version=1)})},m=function(a){return a.messages.toCollection().modify(function(a){a.type===d("WAMsgType").MSG_TYPE.ADMIN&&a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION&&(a.altIndex=d("MAWDbMsg").craftE2eeAdminMsgAltIndex(a.thread))})},n=function(a){return a.messages.toCollection().modify(function(a){a.sortOrderMs=d("MAWDbMsg").getSortOrderWithFallback(a)})},o=function(a){return a.threads.toCollection().modify(function(a){a.folder==null&&(a.folder=d("MAWFolderTypes").FOLDER_ID.INBOX)})},p=function(a){return a.messages.toCollection().modify(function(a){a.sortOrderMs=d("MAWDbMsg").getSortOrderWithFallback(a)})},q=function(a){return a.personalSenderKeyStatuses.toCollection().modify(function(a){a.rotateSenderKey=!0,a.hasSenderKey=new Set()})},r=function(a){return a.messages.toCollection().modify(function(a){a.type===d("WAMsgType").MSG_TYPE.ADMIN&&a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE&&a.sortOrderMs!=null&&a.sortOrderMs>0&&(a.sortOrderMs=0)})},s=function(a){return a.messages.toCollection().modify(function(a){!(a.type===d("WAMsgType").MSG_TYPE.ADMIN&&(a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE||a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION))&&a.sortOrderMs!=null&&a.sortOrderMs<1661204086&&(a.sortOrderMs=d("MAWDbMsg").getCanonicalTsFromMsg(a)*1e3)})},t=function(a){return a.threads.filter(function(a){return a.isMigratedLocally===!0&&a.newestMsg!=null}).toArray().then(function(b){var c=b.map(function(a){return a.chatId}),e=new Map();return d("MAWDexieTable").dexieAll(b.map(function(b){return a.messages.where(["thread","sortOrderMs"]).between([b.chatId,0],[b.chatId,Number.MAX_VALUE]).last().then(function(a){a!=null&&e.set(a.thread,a.msgId)})})).then(function(){return a.threads.where("chatId").anyOf(c)})})},u=function(){return d("MAWDexieTable").dexieResolve()},v=function(a){return a.threads.toCollection().modify(function(a){a.lastReadMsgTs!=null&&a.lastReadMsgTs<d("WATimeUtils").MAX_INT&&(a.lastReadMsgTs=d("MAWTimeUtils").ensureValidMillisTime(a.lastReadMsgTs));if(a.newestMsgTs!=null&&a.newestMsgTs<d("WATimeUtils").MAX_INT){var b=d("MAWTimeUtils").ensureValidMillisTime(a.newestMsgTs);a.newestMsgTs=b;b!=null&&(a.threadOrder=d("MAWDbThread").craftThreadOrder(b,a.jid))}})},w=function(a){return a.messages.toCollection().modify(function(a){a.type===d("WAMsgType").MSG_TYPE.ADMIN&&a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE&&(a.altIndex=d("MAWDbMsg").craftCutoverAdminMsgAltIndex(a.thread))})},x=function(){return d("MAWDexieTable").dexieResolve()},y=function(){return d("MAWDexieTable").dexieResolve()},z=function(){return d("MAWDexieTable").dexieResolve()},A=function(a){return a.participants.toCollection().modify(function(a){var b;if(a==null||((b=a.userJid)==null?void 0:b.indexOf("@msgr@msgr"))===!1)return;a.id=a.id.replace("@msgr@msgr","@msgr");a.userJid=a.userJid.replace("@msgr@msgr","@msgr")}).then(c("emptyFunction"))},B=function(a){var b=a.threads.filter(function(a){return a.snippetMsg!=null&&a.snippetMsgTs==null});return b.toArray().then(function(c){var e=c.reduce(function(a,b){b!=null&&b.snippetMsg!=null&&a.set(b.jid,b.snippetMsg);return a},new Map());c=Array.from(e.values());return a.messages.where("msgId").anyOf(c).toArray().then(function(a){var c=a.reduce(function(a,b){b!=null&&b.serverTs!=null&&a.set(b.msgId,b.serverTs);return a},new Map());b.modify(function(a){var b=e.get(a.jid);if(b!=null){b=c.get(b);b!=null&&(a.snippetMsgTs=d("WATimeUtils").castUnixTimeToMillisTime(b))}})})})},C=function(a){return a.threads.toArray().then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return a.participants.where("threadId").equals(b.chatId).modify(function(a){a.threadJid=(a=a.threadJid)!=null?a:b.jid})}))})},D=C,E=function(a){var b=[];return a.groupInvites.toArray().then(function(c){var d=c.map(function(a){return a.invitedParticipantId});return a.participants.bulkGet(d).then(function(d){d.forEach(function(a,d){if(a==null){a=c[d];b.push(a)}});var e=d.filter(Boolean);return a.groupInvites.bulkPut(c.map(function(a){var c=e.find(function(b){return b.id===a.invitedParticipantId});if(c!=null){a.inviteeJid=c.userJid;a.threadJid=c.threadJid;return babelHelpers["extends"]({},a,{inviteeJid:c.userJid,threadJid:c.threadJid})}else{b.push(a);return a}}))})}).then(function(){return a.groupInvites.bulkDelete(b.map(function(a){return[a.invitedParticipantId,a.inviterJid]}))})},F=function(a){var b=new Map();return a.receipts.toArray().then(function(e){return d("MAWDexieTable").dexieAll(e.map(function(e){return a.messages.get({msgId:e.msgId}).then(function(f){if(f==null)return a.receipts["delete"](e.msgId).then(c("emptyFunction"));else{var g=d("WAMsg").craftWAMsgIdString({author:f.author,chat:f.threadJid,externalId:f.externalId});if(b.has(g)){var i;i=(i=b.get(g))!=null?i:1;b.set(g,i);d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Duplicate waMsgId found for receipt, number of duplicates: ",""])),i);return a.receipts["delete"](e.msgId).then(c("emptyFunction"))}else{b.set(g,1);return a.receipts.where("msgId").equals(f.msgId).modify(function(a){a.waMsgId=g}).then(c("emptyFunction"))}}})}))})},G=function(){return d("MAWDexieTable").dexieResolve()},H=function(a){return a.participants.toArray().then(function(b){var c=b.map(function(a){return babelHelpers["extends"]({},a,{id:d("MAWDbParticipant").craftParticipantId(a.threadJid,a.userJid)})});b=b.map(function(a){return a.id});return a.participants.bulkDelete(b).then(function(){a.participants.bulkPut(c)})})},I=function(a){return a.reactions.toCollection().modify(function(a){a.ts=a.ts})};a=new Map([[(i=d("MAWDbVersionList")).VERSION.V26,a],[i.VERSION.V27,b],[i.VERSION.V28,e],[i.VERSION.V29,f],[i.VERSION.V30,j],[i.VERSION.V31,k],[i.VERSION.V43,l],[i.VERSION.V44,m],[i.VERSION.V45,n],[i.VERSION.V46,o],[i.VERSION.V47,p],[i.VERSION.V53,q],[i.VERSION.V54,r],[i.VERSION.V55,s],[i.VERSION.V56,t],[i.VERSION.V57,u],[i.VERSION.V58,v],[i.VERSION.V60,w],[i.VERSION.V66,x],[i.VERSION.V68,y],[i.VERSION.V71,z],[i.VERSION.V72,A],[i.VERSION.V82,B],[i.VERSION.V85,C],[i.VERSION.V87,D],[i.VERSION.V90,E],[i.VERSION.V91,F],[i.VERSION.V101,G],[i.VERSION.V104,H],[i.VERSION.V116,I]]);g.dbUpgrades=a}),98);
__d("MAWDbSchemaReStoreDexieUtils",["FBLogger","MAWDbSchema","MAWDbSchema.dexie","sortBy"],(function(a,b,c,d,e,f,g){"use strict";var h=c("sortBy")(Array.from(new Set([].concat(Array.from(d("MAWDbSchema").dbSchema.keys()),Array.from(d("MAWDbSchema.dexie").dbUpgrades.keys())))).map(function(a){return{schema:d("MAWDbSchema").dbSchema.get(a),upgrade:d("MAWDbSchema.dexie").dbUpgrades.get(a),version:a}}),function(a){a=a.version;return a}),i=function(a,b){return Array.from(a.filter(function(a){return a.version<=b&&a.schema!=null}).reduce(function(a,b){(b=b.schema)==null||b.forEach(function(b){a.set(b.name,b)});return a},new Map()).values())},j=function(a,b){return i(a,b).reduce(function(a,b){var d=b.autoIncrement,e=b.dexieOnly_primaryKeyUnique,f=b.name,g=b.primaryKey,h=b.removed;f=f.replace(/^e2ee_/,"");if(h===!0){a[f]=null;return a}if(d&&e===!0)throw c("FBLogger")("messenger_web").mustfixThrow("Invalid schema, cannot have both autoincremnet and unique constraints "+JSON.stringify(b));h=d?"++":"";d=e===!0?"&":"";e=""+(g.length>1?"[":"")+g.join("+")+(g.length>1?"]":"");g=Object.values(b.indexes).map(function(a){var b=a.columns,c=!(a.unique===!1),d=b.length>1;a=a.multiEntry_DO_NOT_USE===!0;c=c&&!a?"&":"";a=a?"*":"";c=""+c+a;return""+c+(d?"[":"")+b.join("+")+(d?"]":"")}).join(",");a[f]=[""+h+d+e,g].filter(Boolean).join(",");return a},{})};a=function(a){return j(h,a)};g.MAW_DB_VERSION_CHANGES=h;g.getDexieSchemaForVersion=j;g.getCompleteDexieSchemaForVersion=a}),98);
__d("MAWDbVersion",["MAWCurrentUser","MAWDbSchemaReStoreDexieUtils","MAWDbVersionList","MAWGetDbVersion","MAWIndexedDbMetadata","MAWODSProxy","MWFBLogger","Promise","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r=d("MWFBLogger").MWLogger.tags(["db","getDexieDbVersion"]);e=d("MAWGetDbVersion").getArmadilloDbVersion();f=d("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(Math.min(d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES[d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.length-1].version,e>0?e:Infinity));function s(a,b){var c=b.schema,d=b.upgrade;b=b.version;c!=null&&d!=null?a.version(b).stores(c).upgrade(d):c!=null?a.version(b).stores(c):d!=null?a.version(b).upgrade(d):a.version(b);return b}function t(a){return new(q||(q=b("Promise")))(function(b){if(!indexedDB){b();return}var c=indexedDB.open(a);c.onupgradeneeded=function(c){c.target.transaction.abort();c=c.target.result;r.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose([""," onupgradeneeded - closing db"])),a);c==null||c.close();b()};c.onsuccess=function(c){c=c.target.result;var e=c==null?void 0:c.version;r.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose([""," version: ",""])),a,e!=null?e:"null");c==null||c.close();e!=null?(e%10>=1&&d("MAWODSProxy").odsBumpEntityKey({amount:1,entity:d("WAOdsEnums").Entity.MAW_DB_UNEXPECTED_VERSION,key:"fail_"+e%10}),b(d("MAWDbVersionList").toVersion(e/10))):b()};c.onerror=function(c){var d;r.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose([""," error ",""])),a,c==null||(d=c.target)==null||(d=d.error)==null?void 0:d.message);b()};c.onblocked=function(b){b=b.target.result;var c=b==null?void 0:b.version;r.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose([""," blocked, version: ",""])),a,c!=null?c:"null");b==null||b.close()}})}function a(){var a=d("MAWCurrentUser").getID();return t(d("MAWIndexedDbMetadata").dbName(a))}function u(a,b){if(a.upgrade!=null||b.upgrade!=null)return!0;a=Object.keys((a==null?void 0:a.schema)||{});b=Object.keys((b==null?void 0:b.schema)||{});a=[].concat(a,b);b=new Set(a);return b.size!==a.length}function v(a){return a.reduce(function(a,b,c){if(c===0)return[babelHelpers["extends"]({},b,{schema:d("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(b.version)})];c=a[a.length-1];b=babelHelpers["extends"]({},b,{schema:b.schema!=null?d("MAWDbSchemaReStoreDexieUtils").getDexieSchemaForVersion([b],b.version):null});if(u(c,b)){a.push(b);return a}a.splice(a.length-1,1,babelHelpers["extends"]({},c,b,{schema:babelHelpers["extends"]({},c==null?void 0:c.schema,b==null?void 0:b.schema)}));return a},[])}function c(a,b,c,e){var f=e!=null?e:d("MAWGetDbVersion").getArmadilloDbVersion==null?void 0:d("MAWGetDbVersion").getArmadilloDbVersion();r.DEBUG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["current db version: ",", target db version: ",""])),c,f);f==null&&r.WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["version is not set in QE"])));c!=null&&c>f&&(r.WARN(n||(n=babelHelpers.taggedTemplateLiteralLoose(["current db version is greater than target db version"]))),f=c);e=d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.filter(function(a){a=a.version;return c==null||a>c}).filter(function(a){a=a.version;return f==null||f>=a});var g=d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.filter(function(a){a=a.version;return f==null||f>=a});if(e.length===0||e.length===g.length){r.DEBUG(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Skipping db upgrade and just applying latest schema"])));b.addAnnotations({bool:{isUpgradeNeeded:!1}});g=d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES[d("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.length-1].version;g=Math.min(f!=null&&f>0?f:g,g);a.version(g).stores(d("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(g));return g}g=v(e);r.DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Applying "," updates between "," and ",""])),g.length,e[0].version,e[e.length-1].version);e=g.filter(function(a){return!!a.upgrade}).map(function(a){return a.version.toString()});var h=g.filter(function(a){return!!a.schema}).map(function(a){return a.version.toString()});e.length&&b.addAnnotations({string_array:{dataMigrationVersions:e}});h.length&&b.addAnnotations({string_array:{schemaUpgradeVersions:h}});b.addAnnotations({bool:{isUpgradeNeeded:!0}});var i=0;g.forEach(function(b){i=Math.max((b=s(a,b))!=null?b:0,i!=null?i:0)});return i}g.CURRENT_MAW_STORES=f;g.getDexieDbVersion=t;g.getDBVersion=a;g.updateDB=c}),98);
__d("MAWDexieError",[],(function(a,b,c,d,e,f){"use strict";a="ModifyError";b="BulkError";c="OpenFailedError";d="VersionChangeError";e="SchemaError";var g="UpgradeError",h="InvalidTableError",i="MissingAPIError",j="NoSuchDatabaseError",k="InvalidArgumentError",l="SubTransactionError",m="UnsupportedError",n="InternalError",o="DatabaseClosedError",p="PrematureCommitError",q="ForeignAwaitError",r="UnknownError",s="ConstraintError",t="DataError",u="TransactionInactiveError",v="ReadOnlyError",w="VersionError",x="NotFoundError",y="InvalidStateError",z="InvalidAccessError",A="AbortError",B="TimeoutError",C="QuotaExceededError",D="SyntaxError",E="DataCloneError";A={AbortError:A,BulkError:b,ConstraintError:s,DatabaseClosedError:o,DataCloneError:E,DataError:t,ForeignAwaitError:q,InternalError:n,InvalidAccessError:z,InvalidArgumentError:k,InvalidStateError:y,InvalidTableError:h,MissingAPIError:i,ModifyError:a,NoSuchDatabaseError:j,NotFoundError:x,OpenFailedError:c,PrematureCommitError:p,QuotaExceededError:C,ReadOnlyError:v,SchemaError:e,SubTransactionError:l,SyntaxError:D,TimeoutError:B,TransactionInactiveError:u,UnknownError:r,UnsupportedError:m,UpgradeError:g,VersionChangeError:d,VersionError:w};f.DEXIE_ERROR=A}),66);
__d("MAWIDbSetupQplEventListener",["MAWDexieError","MAWQplProxy","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null;function j(a){var b=new Set(Object.keys(d("MAWDexieError").DEXIE_ERROR));b.has(a.reason)&&h!=null&&(h.endFail(a.reason),d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25310776,"6155"),"database_setup_failed"),i!=null&&(i(),i=null))}b=function(b,c){h=b;i=c;a.addEventListener("unhandledrejection",j);return function(){return a.removeEventListener("unhandledrejection",j)}};g.trackDbSetupFailure=b}),98);
__d("MAWLowLevelApiTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a={EXISTING_GROUP_INVITE:"existing_group_invite",MISSING_GROUP:"missing_group"};c={EXPIRED_GROUP_INVITE:"expired_group_invite",MISSING_GROUP:"missing_group",MISSING_GROUP_INVITE:"missing_group_invite"};d=b("$InternalEnum")({Initializing:"initializing",Open:"open",Closed:"closed",Error:"error",Upgrading:"upgrading"});f.WRITE_GROUP_INVITE_ERROR=a;f.GET_GROUP_INVITE_ERROR=c;f.DatabaseState=d}),66);
__d("MAWDbFactory",["ClientConsistencyEventEmitter","Deferred","MAWCurrentUser","MAWDbVersion","MAWDexieTable","MAWGetDbVersion","MAWIDbSetupQplEventListener","MAWIndexedDBDeletion","MAWIndexedDbMetadata","MAWLowLevelApiTypes","MAWQplProxy","MAWReliabilityMonitor","MWFBLogger","Promise","asyncToGeneratorRuntime","gkx","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q=["backendInitPromise","middleware","onDbPopulate"],r;function a(a,e){var f=null,g=d("MWFBLogger").MWLogger.tags(["db",a,e]),s=new(c("Deferred"))(),t=!1,u=!1,v,w=!1,x=null,y=e!=="worker"?null:d("MAWReliabilityMonitor").MAWReliabilityMonitorSingleton.startMonitoring("DB_"+a+"_"+e,function(){return{extra:{isMakingDB:String(t),willBeSetup:String(u)},reason:String(x),state:function(){if(x==null)return d("MAWReliabilityMonitor").HealthReportState.UNKNOWN;switch(x){case d("MAWLowLevelApiTypes").DatabaseState.Initializing:case d("MAWLowLevelApiTypes").DatabaseState.Upgrading:return d("MAWReliabilityMonitor").HealthReportState.PENDING;case d("MAWLowLevelApiTypes").DatabaseState.Open:return d("MAWReliabilityMonitor").HealthReportState.OK;case d("MAWLowLevelApiTypes").DatabaseState.Closed:case d("MAWLowLevelApiTypes").DatabaseState.Error:return d("MAWReliabilityMonitor").HealthReportState.ERROR}}()}});function z(){s=new(c("Deferred"))(),v==null||v(),t=!1,u=!1}function A(){return u}function B(){return s.getPromise().then(function(){return w})}function C(a,b,c){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,r,A){var B=r.backendInitPromise,C=r.middleware,D=r.onDbPopulate;r=babelHelpers.objectWithoutPropertiesLoose(r,q);var E=d("MAWCurrentUser").getID();E=d("MAWIndexedDbMetadata").dbName(E);var F=c("qpl")._(25310776,"6155");function G(a){x=a,y==null||y.updateState()}if(f!=null){g.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["DB exists"])));d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_exsists");return}var H=d("MAWQplProxy").startQplUserFlow(c("qpl")._(1056836116,"905"),{string:{db:a,name:E}});u=!0;if(t){d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_make_in_progress");return s.getPromise()}g.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Starting DB Setup"])));t=!0;d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_make_started");v=d("MAWIDbSetupQplEventListener").trackDbSetupFailure(H,function(){G(d("MAWLowLevelApiTypes").DatabaseState.Error),s.reject("DB setup failed"),d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_setup_failed"),z()});G(d("MAWLowLevelApiTypes").DatabaseState.Initializing);var I=(yield d("MAWDbVersion").getDexieDbVersion(E));I==null&&(w=!0);H.addAnnotations({"int":{currentVersion:I}});var J=A!=null?A:d("MAWGetDbVersion").getArmadilloDbVersion();H.addAnnotations({"int":{targetVersion:J}});if(B&&(I||0)<J){H.addPoint("separate_read_waiting_on_worker_upgrade");g.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Waiting for worker to upgrade schema..."])));try{yield B}catch(a){throw g.catching(a).mustfixThrow("Worker startup promise rejected, schema upgrade failed.")}var K=(yield d("MAWDbVersion").getDexieDbVersion(E));if(K!==J)throw g.mustfixThrow("Main thread waiting on worker schema upgrade from %s to %s, upgrade failed with version %s",I,J,K);I=K}else e==="worker"&&(d("MAWQplProxy").sendQPLIntAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"dbVersion",I!=null?I:0),d("MAWQplProxy").sendQPLIntAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"useSentBytesCache",c("gkx")("33008")?1:0));var L=function(b){b=d("MAWDbVersion").updateDB(b,H,I,A);!B&&e==="worker"&&d("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(c("qpl")._(1056839232,"112"),"dbUpgradeNeeded",I!==b);g.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["latest pushed version: ",", current: ",", requested: ",""])),b,I,A!=null?A:"<latest>");e==="worker"&&(I!==b?d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_version_upgraded"):d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_version_upgrade_not_required"));return b};f=new(d("MAWDexieTable").DexieTable)(E,function(f){C.forEach(function(a){f.use(a(b))});var h=L(f);f.on("populate",function(b){if(!b){G(d("MAWLowLevelApiTypes").DatabaseState.Error);s.reject("Missing DB for populate event");H.endFail("on_populata-missing_txn");d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_on_populate_missing_txn");return}g.info("MAWDB populated. HasPopulateEvent: %s",Boolean(D));D==null||D(b)});f.on("blocked",function(){g.MUSTFIX(l||(l=babelHelpers.taggedTemplateLiteralLoose(["DB Open blocked"]))),G(d("MAWLowLevelApiTypes").DatabaseState.Error),s.reject("DB Open blocked"),H.endFail("db_blocked"),d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_blocked"),z()});f.on("ready",function(b){g.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["MAW DB setup complete"])));t=!1;if(b==null){G(d("MAWLowLevelApiTypes").DatabaseState.Error);g.MUSTFIX(n||(n=babelHelpers.taggedTemplateLiteralLoose(["DB is null"])));s.reject("DB is null");H.endFail("db_null");d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_null");z();return}G(d("MAWLowLevelApiTypes").DatabaseState.Open);v==null||v();s.resolve();H.endSuccess({"int":{dbVersion:h}});d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_ready")});f.on("close",function(){G(d("MAWLowLevelApiTypes").DatabaseState.Closed),g.WARN(o||(o=babelHelpers.taggedTemplateLiteralLoose(["DB forcibly closed"]))),d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_forcibly_closed")});f.on("versionchange",function(b){g.WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Versionchange detected: ("," -> "," (event version: ",", highestUsed: (","), name: ",""])),b==null?void 0:b.oldVersion,b==null?void 0:b.newVersion,String(b==null?void 0:b.version),h,b==null?void 0:b.name),G(d("MAWLowLevelApiTypes").DatabaseState.Upgrading),e!=="worker"&&c("ClientConsistencyEventEmitter").emit("softRefresh","mawdb_versionchange"),d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_versionchange")})},void 0,r);d("MAWQplProxy").sendQplPointThroughBridge(F,"database_"+a+"_make_requested");return s.getPromise()});return D.apply(this,arguments)}function E(a){if(f==null)throw g.mustfixThrow('IndexDB has not been initialized before executing "'+(a!=null?a:"unnamed")+'"');return f}function F(a){if(f!=null&&!t)return(r||(r=b("Promise"))).resolve(f);s=s||new(c("Deferred"))();return s.getPromise().then(function(){return E(a)})}function G(){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield F());a!=null&&(a.close(),f=null);z()});return H.apply(this,arguments)}function I(){f=null,z()}function J(a){c("promiseDone")(G());a=d("MAWIndexedDbMetadata").dbName(a!=null?a:d("MAWCurrentUser").getID());c("promiseDone")(d("MAWIndexedDBDeletion").deleteDB(a,"maw"));y==null||y.stopMonitoring()}return{closeDB:G,deleteDb:J,getDB:F,getDBExn:E,isNewDb:B,makeDB:C,reset_singleton_INTERNAL_ONLY:I,setupPromise:function(){return s.getPromise()},willSetupDB:A}}g.makeIDBFactory=a}),98);
__d("MAWIndexedDbUI",["ExecutionEnvironment","MAWDbFactory","MAWDbMutationMiddleware","MAWDbProtocolMsgIdMiddleware","MAWDexieTable","MAWIndexedDb","MAWTransactor","Promise","cr:3527","gkx","performance"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(){var a=d("MAWDbFactory").makeIDBFactory("ui_idb","main");return{closeDB:a.closeDB,deleteDb:a.deleteDb,getDB:a.getDB,makeDB:function(e,f,g){var h=[d("MAWDbMutationMiddleware").getMAWDbMutationMiddleware];c("gkx")("1760")&&h.push(d("MAWDbProtocolMsgIdMiddleware").MAWDbProtocolMsgIdMiddleware);b("cr:3527")!=null&&h.push(b("cr:3527"));e=a.makeDB(e,{autoOpen:c("gkx")("6817"),backendInitPromise:f.backendInitPromise,cache:"disabled",middleware:h,onDbPopulate:f.onDbPopulate},g);return e},reset_singleton_INTERNAL_ONLY:a.reset_singleton_INTERNAL_ONLY}}e=a();f=e.makeDB;var k=e.closeDB,l=e.getDB,m=e.deleteDb;e=e.reset_singleton_INTERNAL_ONLY;var n=(i||(i=c("ExecutionEnvironment"))).isInBrowser?l("MawDbInUISingleton_INTERNAL_ONLY").then(function(a){return{openReadonlyTransaction:function(b,e,f){return a.stores.transaction("r",e,function(){d("MAWDexieTable").setDexiePSDItem("transactorName",b);d("MAWDexieTable").setDexiePSDItem("transactionRequested",(j||(j=c("performance"))).now()+j.timeOrigin);return f(a.stores)})},openReadWriteTransaction:function(b,e,f){return a.stores.transaction("rw",e,function(){d("MAWDexieTable").setDexiePSDItem("transactorName",b);d("MAWDexieTable").setDexiePSDItem("transactionRequested",(j||(j=c("performance"))).now()+j.timeOrigin);return f(a.stores)})}}}):new(h||(h=b("Promise")))(function(){});g.makeMsgrTransactor=d("MAWTransactor").makeMsgrUITransactor_IMPORT_FROM_MAWIndexedDbUI_INSTEAD;g.afterTransaction=d("MAWIndexedDb").afterTransaction;g.makeMAWIndexedDBFactory=a;g.makeDB=f;g.closeDB=k;g.getDB=l;g.deleteDb=m;g.reset_singleton_INTERNAL_ONLY=e;g.MawDbInUISingleton=n}),98);
__d("MAWWorkerCacheServiceRegistry",["MAWSnippetsCacheService"],(function(a,b,c,d,e,f,g){"use strict";var h={snippets:d("MAWSnippetsCacheService").getMAWSnippetsCacheService()};function a(){return h}g.getWorkerRegistry=a}),98);
__d("MAWWorkerCacheServices",["FBLogger","MAWBridge","MAWCacheServiceDB","MAWCacheServiceQPL","MAWCacheServiceUtils","MAWLoggerUtils","MAWWorkerCacheServiceRegistry","Promise","WorkerScheduler","asyncToGeneratorRuntime","cr:2354"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(){function a(){this.$1=d("MAWCacheServiceUtils").getMAWCacheServiceBroadcastChannel();var a=d("MAWWorkerCacheServiceRegistry").getWorkerRegistry();this.registry=a;this.schedulerRegistry=Object.keys(a).reduce(function(a,b){return babelHelpers["extends"]({},a,(a={},a[b]=d("WorkerScheduler").makeScheduler(d("MAWCacheServiceUtils").getSchedulerName(b),d("MAWCacheServiceUtils").SCHEDULER_CONFIG),a))},{})}var e=a.prototype;e.$2=function(a,b,c,e){b={cache:b,instanceKey:e,namespace:a,source:c};this.$1==null?d("MAWBridge").getBridge().fireAndForget("event","broadcastChannelFallback",{event:{data:b},namespace:d("MAWCacheServiceUtils").MAW_CACHE_SERVICE_BROADCAST_CHANNEL}):this.$1.postMessage(b)};e.$3=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){var h=d("MAWCacheServiceUtils").findDuplicates(e,function(a){var b=a[0];a[1];return b});h.length>0&&(c("FBLogger")("MAWCacheService").mustfix("Found duplicate keys in cache: %s. Original keys: %s, Namespace: %s, Source: %s",h.map(function(a){var b=a[0];a[1];return b}).join(", "),e.map(function(a){var b=a[0];a[1];return b}).join(", "),a,f),g!=null&&c("MAWCacheServiceQPL").addAnnotationsQPL(g,{bool:{hasDuplicateKeys:!0},string_array:{duplicateKeys:c("MAWCacheServiceQPL").redactKeysForNonEmployee(h.map(function(a){var b=a[0];a[1];return b}))}}));if(e.length===0){g!=null&&(c("MAWCacheServiceQPL").addPointQPL(g,"nothing_to_update_in_cache",f),c("MAWCacheServiceQPL").endSuccessQPL(g));return}g!=null&&c("MAWCacheServiceQPL").addPointQPL(g,"updating_cache_in_persisted_start",f);h=this.registry[a];h.updateInMemoryCacheBulk(e);try{var i=d("MAWCacheServiceDB").convertCacheValueToDBRawValue(e);h=(yield d("MAWCacheServiceDB").getOrSetupMAWCacheDB());yield h.runInTransaction([a],"readwrite",function(b){var c=i.map(function(a){return{item:a,selector:[a.key]}});return b.stores[a].bulkUpsert("key",c)},"update_cache_"+a);f==="realtime-update"&&(b("cr:2354")==null||b("cr:2354").notifyCacheWrite(i.map(function(a){a=a.key;return a})));g!=null&&c("MAWCacheServiceQPL").addPointQPL(g,"updating_cache_in_persisted_end",f)}catch(a){g!=null&&(c("MAWCacheServiceQPL").addAnnotationsQPL(g,{string:{error:a.message}}),c("MAWCacheServiceQPL").addPointQPL(g,"updating_cache_in_persisted_failed",f)),c("FBLogger")("MAWCacheService").catching(a).mustfix("Failed to update persisted cache")}g!=null&&c("MAWCacheServiceQPL").addPointQPL(g,"broadcasting_to_ui_start",f);this.$2(a,e,f,g)});function e(b,c,d,e){return a.apply(this,arguments)}return e}();e.calculateDelta=function(a){var e=this,f=Object.values(this.registry).map(function(b){var f=b.shouldDropDelta(a);return f.then(function(f){if(f)return;f=e.schedulerRegistry[b.namespace];return f.runTask({fn:function(){return b.calculateDelta(a).then(function(a){var f=a.map(function(a){var b=a[0];a[1];return b}),g=d("MAWLoggerUtils").getInstanceKey();a.length!==0&&(c("MAWCacheServiceQPL").startQPL(g,b.namespace),c("MAWCacheServiceQPL").addAnnotationsQPL(g,{bool:{isRealtimeUpdate:!0},"int":{instanceKey:g},string_array:{realtimeUpdatedKeys:f}}));return e.$3(b.namespace,a,"realtime-update",g)})["catch"](function(a){c("FBLogger")("MAWCacheService").catching(a).warn("Failed to calculate delta for: %s",b.namespace)})},name:"maw_calculate_delta",priority:d("WorkerScheduler").REGULAR_PRIORITY})})});(h||(h=b("Promise"))).all([].concat(f))["catch"](function(a){c("FBLogger")("MAWCacheService").catching(a).mustfix("Failed to calculate delta for all services")})};e.computeCachePayloadFromScratch=function(a,b,e,f){var g=this;f!=null&&c("MAWCacheServiceQPL").registerInstanceKeyInWorker(f);c("MAWCacheServiceQPL").addPointQPL(f,"compute_from_scratch_start",e);c("MAWCacheServiceQPL").addAnnotationsQPL(f,{string_array:{keysReceivedInWorker:c("MAWCacheServiceQPL").redactKeysForNonEmployee(b)}});var h=this.registry[a],i=this.schedulerRegistry[h.namespace];if(h==null)throw c("FBLogger")("messenger_web").mustfixThrow("No service found for namespace: "+a);return i.runTask({fn:function(){return h.computeCachePayloadFromScratch(b).then(function(b){c("MAWCacheServiceQPL").addPointQPL(f,"compute_from_scratch_end",e);return g.$3(a,b,e,f)})["catch"](function(a){c("MAWCacheServiceQPL").endFailureQPL(f,"compute_from_scratch_failed",e),c("FBLogger")("MAWCacheService").catching(a).warn("Failed to compute cache payload from scratch")})},name:"maw_compute_cache_payload_from_scratch",priority:d("WorkerScheduler").REGULAR_PRIORITY})};return a}(),j=null;a=function(){j==null&&(j=new i());return j};g.getMAWWorkerCacheServices=a}),98);
__d("MAWDbMsgOrReaction",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.reactToExternalId!=null?b.forReaction(a):b.forMessage(a)}function b(a,b){return a==null?b.forNull():a.reactToExternalId!=null?b.forReaction(a):b.forMessage(a)}function c(a,b){return a.reactToExternalId!=null?b.forReaction(a):b.forMessage(a)}function d(a,b){return a==null?b.forNull():a.reactToExternalId!=null?b.forReaction(a):b.forMessage(a)}f.switchOnMsgOrReaction=a;f.switchOnMsgOrReactionNullish=b;f.switchOnMsgOrReactionMaybeUnstored=c;f.switchOnMsgOrReactionMaybeUnstoredNullish=d}),66);
__d("MAWGetBumpTimestampMs",["I64","MAWAckLevel","MAWDbMsgOrReaction","MAWExtractMsFromExternalId","MAWTimeUtils","WALongInt","WATimeUtils","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){b=b==null?null:d("MAWExtractMsFromExternalId").extractMsFromExternalId(b);return(h||(h=d("I64"))).add(d("MAWTimeUtils").millisTimeToTimestamp(a),h.of_int32(b!=null?b:0))}function j(a){var b=a.msg;a=a.throwIfNoServerTs;a=a?c("nullthrows")(b.serverTs):b.serverTs;return i(d("WATimeUtils").castUnixTimeToMillisTime(a!=null?a:b.ts),(h||(h=d("I64"))).of_string(b.externalId))}function k(a){return a.senderTimestampMs!=null?(h||(h=d("I64"))).of_string(d("WALongInt").longIntToDecimalString(a.senderTimestampMs)):i(d("WATimeUtils").castUnixTimeToMillisTime(a.ts),(h||(h=d("I64"))).of_string(a.externalId))}function a(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstoredNullish(a,{forMessage:function(a){return d("MAWAckLevel").isMsgAuthoritative(a.ack)&&a.sortOrderMs!=null?(h||(h=d("I64"))).of_float(a.sortOrderMs):j({msg:a,throwIfNoServerTs:!1})},forNull:function(){return(h||(h=d("I64"))).zero},forReaction:k})}g.calculateBumpTimestampMs=i;g.getBumpTimestampMs=a}),98);
__d("MAWSnippetsCacheServiceUtils",["I64","MAWDbMsgOrReaction","MAWGetBumpTimestampMs"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionNullish(a,{forMessage:function(a){return{msgAckLevel:a.ack,msgId:a.msgId,reactionId:void 0,timestamp:a.sortOrderMs!=null?a.sortOrderMs:(h||(h=d("I64"))).to_float(d("MAWGetBumpTimestampMs").getBumpTimestampMs(a))}},forNull:function(){return{msgAckLevel:void 0,msgId:void 0,reactionId:void 0,timestamp:Number.MIN_SAFE_INTEGER}},forReaction:function(a){return{msgAckLevel:void 0,msgId:void 0,reactionId:a.reactionId,timestamp:(h||(h=d("I64"))).to_float(d("MAWGetBumpTimestampMs").getBumpTimestampMs(a))}}})}g.getMsgOrReactionIdAndTimestamp=a}),98);
__d("MAWUpdateThreadListItemUtils",["MAWAckLevel","MAWDbMsg","MAWDbMsgOrReaction","MAWMsgType","MAWXMAUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstored(a,{forMessage:function(a){return a.altIndex===d("MAWDbMsg").SPAM_ALT_INDEX||a.altIndex===d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX},forReaction:function(){return!1}})}function b(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstored(a,{forMessage:function(a){return a.ack===d("MAWAckLevel").ACK.clock},forReaction:function(){return!1}})}function c(a){return a.msgId!=null&&a.type===d("MAWMsgType").MSG_TYPE.XMA&&((a=a.msgContent)==null?void 0:a.content)===""}function e(a){return a.type===d("MAWMsgType").MSG_TYPE.XMA&&d("MAWXMAUtils").isRtcXMA(a==null?void 0:a.xmaMessageType)}g.isSpamMessage=a;g.isOptimisticMessage=b;g.isXMAThreadSnippet=c;g.isRTCXMAMessage=e}),98);
__d("MAWSnippetsCacheCalculateDelta",["FBLogger","MAWDbMsgOrReaction","MAWGetThreadUpdateType","MAWSnippetsCacheServiceUtils","MAWUpdateThreadListItemUtils"],(function(a,b,c,d,e,f,g){"use strict";var h="[SnippetsCacheService][Worker]";function a(a){var b=new Set(a.map(function(a){var b;b=(b=a.decryptedValues)!=null?b:[];a=(a=a.deletedValues)!=null?a:[];return[].concat(b,a)}).flat().map(function(a){return d("MAWUpdateThreadListItemUtils").isOptimisticMessage(a)?null:a.msgId}).filter(Boolean));return a.reduce(function(a,c){var d=c.type==="delete"?c.deletedValues:c.decryptedValues;d=l(d);d=m(b,d);if(d.length===0)return a;d.forEach(function(b){var d=b.threadJid,e=a.get(d);b=k({type:c.type,value:b},e);a.set(d,b)});return a},new Map())}function b(a){return a.some(function(a){a.chatJid;a.lastComputedCacheValue;a=a.mutateReq;return!i(a)||j(a.value)})}function i(a){return a.type==="delete"||a.type==="deleteRange"||d("MAWUpdateThreadListItemUtils").isXMAThreadSnippet(a.value)||p(a.value)||q(a.value)?!1:!0}function j(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(a){return!1},forReaction:function(a){return a.reaction!=null&&d("MAWGetThreadUpdateType").canReactionAffectBump(a)}})}function k(a,b){if(b==null)return a;var c=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(a.value);c=c.timestamp;var e=a.value.externalId,f=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(b.value);f=f.timestamp;var g=b.value.externalId;if(c===f){if(a.type==="delete"||a.type==="deleteRange")return a;else if(b.type==="delete"||b.type==="deleteRange")return b;return e.localeCompare(g)>0?a:b}if(c==null)return b;return f==null?a:c>f?a:b}function l(a){return a==null||a.length===0?[]:a.filter(function(a){return n(a)})}function m(a,b){return b.reduce(function(b,c){var e=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(c);e=e.msgId;return e!=null&&d("MAWUpdateThreadListItemUtils").isOptimisticMessage(c)&&a.has(e)?b:[].concat(b,[c])},[])}function n(a){var b=o(a)&&!d("MAWUpdateThreadListItemUtils").isSpamMessage(a);b||r(a);return b}function o(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(b){return d("MAWGetThreadUpdateType").isThreadUpdateTypeEligibleForSnippet(a)},forReaction:function(b){return d("MAWGetThreadUpdateType").canReactionAffectBump(b)&&p(b)||d("MAWGetThreadUpdateType").isThreadUpdateTypeEligibleForSnippet(a)}})}function p(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(a){return!1},forReaction:function(a){return a.reaction==null}})}function q(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(a){return a.ephemeralMsgDisappeared===!0},forReaction:function(a){return!1}})}function r(a){a=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(a);var b=a.msgId;a=a.reactionId;c("FBLogger")("MAWCacheService").info(h+" msg or reaction is not eligible for snippet update, msgId: %s, reactionId: %s",b,a)}g.parseAndGetMostRecentSnippetUpdateMutateRequestForChatJids=a;g.isDbTransactionRequiredForSnippetUpdate=b;g.canCalculateSnippetUpdateFromDelta=i;g.isNeededToCheckMessageExistence=j}),98);
__d("MWThreadListConsts",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;a=56;b=900;c=10;g.threadlistItemHeight=a;g.minimumPixelsNeededForMaxDisplay=b;g.DEFAULT_MIN_LAST_ACTIVITY_TIMESTAMP=(h||d("I64")).one;g.SNIPPET_MAX_NEWEST_INCOMING_MESSAGES_COUNT=c}),98);
__d("MAWSnippetsCacheService",["FBLogger","MAWAckLevel","MAWCacheServiceBase","MAWDbMsgOrReaction","MAWDbMsgTxns","MAWDexieTable","MAWGetThreadUpdateType","MAWIndexedDb","MAWMessagesCompare","MAWSnippetsCacheCalculateDelta","MAWSnippetsCacheServiceUtils","MAWThreadNewestMsgOrReactionUtils","MAWThreadSnippetBuildTxns","MAWThreadSnippetUtils","MAWTransactionMode","MAWUpdateThreadListItemUtils","MAWVault","MWThreadListConsts","Promise","WAJids","asyncToGeneratorRuntime","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i=["messages","reactions"],j="[SnippetsCacheService][Worker]";a=function(a){function e(){return a.call(this,"snippets")||this}babelHelpers.inheritsLoose(e,a);var f=e.prototype;f.$MAWSnippetsCacheService$p_1=function(a){var c=this;a=a.filter(function(a){a=a[0];return i.includes(a)});a=d("MAWSnippetsCacheCalculateDelta").parseAndGetMostRecentSnippetUpdateMutateRequestForChatJids(a.map(function(a){a[0];a=a[1];return a}));return(h||(h=b("Promise"))).all(Array.from(a.entries()).map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a[0];a=a[1];var d=(yield c.getValueFromCache(b));return{chatJid:b,lastComputedCacheValue:d,mutateReq:a}});return function(b){return a.apply(this,arguments)}}()))};f.calculateDelta=function(a){var c=this;return this.$MAWSnippetsCacheService$p_1(a).then(function(a){if(a.length===0)return(h||(h=b("Promise"))).resolve([]);if(d("MAWSnippetsCacheCalculateDelta").isDbTransactionRequiredForSnippetUpdate(a))return d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"MAWSnippetsCacheService:calculateDelta",function(a){return function(b){return c.$MAWSnippetsCacheService$p_2(a,b)}})(a);else return c.$MAWSnippetsCacheService$p_3(a)})};f.computeCachePayloadFromScratch=function(a){var b=this;return d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"MAWSnippetsCacheService:computeCachePayloadFromScratch",function(a){return function(c){return d("MAWDexieTable").dexieAll(c.map(function(c){c=d("WAJids").unsafeCoerceToChatJid(c);return b.$MAWSnippetsCacheService$p_4(a,c,"from-scratch")})).then(function(a){return a.filter(Boolean)})}})(a)};f.$MAWSnippetsCacheService$p_5=function(a,b){if(b==null)return"no-value-calculated-from-scratch";if(d("MAWUpdateThreadListItemUtils").isOptimisticMessage(a.value))return null;a=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(a.value);var c=a.msgAckLevel,e=a.msgId,f=a.reactionId;a=a.timestamp;if(a==null)return"missing-timestamp";if(e!=null&&e===b.value.snippetMsgId)return null;if(f!=null&&f===b.value.snippetReactionId)return null;return e!=null&&c!==d("MAWAckLevel").ACK.received&&b.value.snippetMsgAckLevel===d("MAWAckLevel").ACK.clock?"optimistic-snippet-in-cache":a<b.timestamp?"older-than-last-snippet-value":null};f.$MAWSnippetsCacheService$p_6=function(a,b){var e;if(a.type!=="add")return!1;e=(e=c("qex")._("1213"))!=null?e:!1;return!e?!1:d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a.value,{forMessage:function(a){var c;if(a.sortOrderMs==null||!d("MAWThreadNewestMsgOrReactionUtils").filterForSnippetNewestIncomingMessages(d("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg(a),a.ephemeralMsgDisappeared===!0))return!1;var e=b==null||(c=b.value)==null?void 0:c.snippetNewestIncomingMsgs;if(e==null||e.length<d("MWThreadListConsts").SNIPPET_MAX_NEWEST_INCOMING_MESSAGES_COUNT)return!0;e=e[e.length-1];if(e==null||e.sortOrderMs==null)return!0;var f=d("MAWMessagesCompare").getSortComparisonFunctionForDirection("desc");return f({externalId:e.externalId,sortOrderMs:e.sortOrderMs},{externalId:a.externalId,sortOrderMs:a.sortOrderMs})>0},forReaction:function(a){return!1}})};f.$MAWSnippetsCacheService$p_7=function(a,b){var c={externalId:b.value.externalId,sortOrderMs:b.value.sortOrderMs};if(a==null||a.some(function(a){return a.externalId===c.externalId}))return[c];b=d("MAWMessagesCompare").getSortComparisonFunctionForDirection("desc");a=[].concat(a,[c]).sort(b).slice(0,d("MWThreadListConsts").SNIPPET_MAX_NEWEST_INCOMING_MESSAGES_COUNT);return a};f.shouldDropDelta=function(a){var c=this;return this.$MAWSnippetsCacheService$p_1(a).then(function(a){return a.length===0?(h||(h=b("Promise"))).resolve(!0):(h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.chatJid,d=a.lastComputedCacheValue;a=a.mutateReq;if(c.$MAWSnippetsCacheService$p_6(a,d))return!1;d=(yield c.$MAWSnippetsCacheService$p_5(a,d));if(d!=null){l({dropReason:d,key:b,msgOrReaction:a.value,operation:a.type});return!0}return!1});return function(b){return a.apply(this,arguments)}}())).then(function(a){if(a.every(function(a){return a===!0}))return!0;else return!1})})};f.$MAWSnippetsCacheService$p_4=function(a,b,c){var e=this;return d("MAWThreadSnippetUtils").getThreadSnippetFromScratch(a,b).then(function(a){a=e.$MAWSnippetsCacheService$p_8(b,a,c);return a==null?void 0:d("MAWDexieTable").dexieResolve([b,a])})};f.$MAWSnippetsCacheService$p_3=function(a){var b=this;return a.map(function(a){var c=b.$MAWSnippetsCacheService$p_9(a);return c==null?void 0:[a.chatJid,c]}).filter(Boolean)};f.$MAWSnippetsCacheService$p_2=function(a,b){var c=this;return d("MAWDexieTable").dexieAll(b.map(function(b){return!d("MAWSnippetsCacheCalculateDelta").canCalculateSnippetUpdateFromDelta(b.mutateReq)?c.$MAWSnippetsCacheService$p_4(a,b.chatJid,"realtime-from-scratch"):c.$MAWSnippetsCacheService$p_10(a,b.mutateReq.value).then(function(a){if(a)return void 0;a=c.$MAWSnippetsCacheService$p_9(b);return a==null?void 0:d("MAWDexieTable").dexieResolve([b.chatJid,a])})})).then(function(a){return a.filter(Boolean)})};f.$MAWSnippetsCacheService$p_9=function(a){var b;b=(b=c("qex")._("1213"))!=null?b:!1;if(b)return this.$MAWSnippetsCacheService$p_11(a);b=d("MAWThreadSnippetBuildTxns").buildThreadSnippetForMsgOrIncomingReaction(a.chatJid,a.mutateReq.value);b=this.$MAWSnippetsCacheService$p_8(a.chatJid,{snippet:b,snippetMsgOrReaction:a.mutateReq.value},"realtime-calculate-delta");return b};f.$MAWSnippetsCacheService$p_11=function(a){var b,c=a.chatJid,e=a.lastComputedCacheValue;a=a.mutateReq;var f=this.$MAWSnippetsCacheService$p_6(a,e),g=this.$MAWSnippetsCacheService$p_5(a,e)==null;f=f?this.$MAWSnippetsCacheService$p_7(e==null||(b=e.value)==null?void 0:b.snippetNewestIncomingMsgs,a):e==null?void 0:e.value.snippetNewestIncomingMsgs;if(!g&&e!=null)return babelHelpers["extends"]({},e,{value:babelHelpers["extends"]({},e.value,{snippetNewestIncomingMsgs:f})});g=d("MAWThreadSnippetBuildTxns").buildThreadSnippetForMsgOrIncomingReaction(c,a.value);e=this.$MAWSnippetsCacheService$p_8(c,{snippet:g,snippetMsgOrReaction:a.value,snippetNewestIncomingMsgsMetadata:f},"realtime-calculate-delta");return e};f.$MAWSnippetsCacheService$p_8=function(a,b,c){if(b==null){k({flow:c,key:a,threadSnippetResult:b});return void 0}var e=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(b.snippetMsgOrReaction),f=e.msgAckLevel,g=e.msgId,h=e.reactionId;e=e.timestamp;k({flow:c,key:a,msgAckLevel:f,msgId:g,reactionId:h,threadSnippetResult:b,timestamp:e});if(e==null)return void 0;c=babelHelpers["extends"]({},b.snippet.snippetParams,{strings:b.snippet.snippetParams.strings.map(function(a){return d("MAWVault").unvault(a)})});return{key:a,timestamp:e,value:{snippet:babelHelpers["extends"]({},b.snippet,{snippetParams:c}),snippetMsgAckLevel:f,snippetMsgId:g,snippetNewestIncomingMsgs:b.snippetNewestIncomingMsgsMetadata,snippetReactionId:h}}};f.$MAWSnippetsCacheService$p_10=function(a,b){if(!d("MAWSnippetsCacheCalculateDelta").isNeededToCheckMessageExistence(b))return d("MAWDexieTable").dexieResolve(!1);b=d("MAWDbMsgOrReaction").switchOnMsgOrReaction(b,{forMessage:function(a){return null},forReaction:function(a){return a.reactToMsgId}});return b==null?d("MAWDexieTable").dexieResolve(!0):d("MAWDbMsgTxns").getMsgsByMsgIds(a,[b]).then(function(a){return a.length===0})};return e}(c("MAWCacheServiceBase"));function k(a){var b=a.flow,d=a.key,e=a.msgAckLevel,f=a.msgId,g=a.reactionId,h=a.threadSnippetResult;a=a.timestamp;if(h==null){c("FBLogger")("MAWCacheService").warn(j+"["+b+"] Failed to calculate thread snippet, key: %s",d);return}if(a==null){c("FBLogger")("MAWCacheService").warn(j+"["+b+"] No timestamp found for the thread snippet, key: %s,\n      msgId: %s, reactionId: %s",d,f,g);return}c("FBLogger")("MAWCacheService").info(j+"["+b+"] Snippet successfully calculated, key: %s,\n    timestamp: %s, msgId: %s, reactionId: %s, ack level %s",d,a,f,g,e)}function l(a){var b=a.dropReason,e=a.key,f=a.msgOrReaction;a=a.operation;f=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(f);var g=f.msgAckLevel,h=f.msgId,i=f.reactionId;f=f.timestamp;c("FBLogger")("MAWCacheService").info(j+" Drop update for msg or reaction, reason: %s, key: %s, msgId: %s, reactionId: %s, timestamp: %s, ackLevel: %s, operation: %s",b,e,h,i,f,g,a)}var m=new a();e=function(){return m};g.getMAWSnippetsCacheService=e}),98);
__d("MAWDataSyncQueue",["Promise","WALogger","asyncToGeneratorRuntime","getErrorSafe","qex","throttle"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("qex")._("853")||1e3;a=c("qex")._("855")||1e3;e=function(){n=!1;return s({isUnloading:!0})};var l=[],m=[],n=!1,o=[],p=function(){var a,b=l.splice(0,l.length);(a=m).push.apply(a,b)},q=function(){return m.splice(0,k)},r=function(a){var c=q();if(c.length===0)return;return(j||(j=b("Promise"))).all(o.map(function(b,e){return b(c,a)["catch"](function(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Unhandled exception caught in middleware "," sync: ",""])),e,a)})})).then(function(){return r(a)})},s=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(n)return;n=!0;p();try{yield r(a)}catch(e){var b;a=c("getErrorSafe")(e);d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[MAWIndexedDbMiddleware] error handling queue batch: ",""])),(b=a==null?void 0:a.message)!=null?b:a.toString());throw e}finally{n=!1,l.length>0&&t()}});return function(b){return a.apply(this,arguments)}}(),t=c("throttle")(s,a);f=function(a,b){l.push({type:a,value:b}),t()};a=function(a){o.some(function(b){return b===a})||o.push(a)};var u=function(){o=[]},v=function(){l=[],m=[]},w=function(){return l};g.forceFlushDataSyncQueue=e;g.addSyncItem=f;g.registerDataSyncCallback=a;g.clearDataSyncCallbacks=u;g.clearDataSyncQueue_FOR_TESTING_ONLY=v;g.getDataSyncQueue_FOR_TESTING_ONLY=w}),98);
__d("MAWDataSyncMiddleware",["FBLogger","MAWDataSyncQueue"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set(["contacts","groupInfo","messages","participants","threads","reactions","xma","pendingStanzas"]);function i(a,b){var c=a.table(b);return!h.has(b)?c:babelHelpers["extends"]({},c,{mutate:function(a){return c.mutate(a).then(function(c){if(a.type==="delete"){a.keys.forEach(function(c){d("MAWDataSyncQueue").addSyncItem(a.type,{key:c,tableName:b})});return c}else c.results!=null?c.results.forEach(function(c){d("MAWDataSyncQueue").addSyncItem(a.type,{key:c,tableName:b,values:a.values})}):c.lastResult!=null&&d("MAWDataSyncQueue").addSyncItem(a.type,{key:c.lastResult,tableName:b,values:a.values});return c})}})}function a(){return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return i(a,b)}})}catch(b){c("FBLogger")("messenger_web").catching(b).mustfix("Error applying DataSync Middleware, messages made during this session will not be properly synced to registered consumers");return a}},name:"MAWDataSyncMiddleware",stack:"dbcore"}}g.getDataSyncMiddleware=a}),98);
__d("MAWIndexedDb",["EBGating","ExecutionEnvironment","I64","MAWBridge","MAWCacheServiceMiddleware","MAWDataSyncMiddleware","MAWDbFactory","MAWDbMutationMiddleware","MAWDbMutationValidator","MAWDbProtocolMsgIdMiddleware","MAWDbSchema","MAWDexie","MAWMiActOnActThreadReadyQueue","MAWTransactor","MWFBLogger","asyncToGeneratorRuntime","cr:10181","cr:10182","cr:17239","cr:20397","cr:3527","gkx","justknobx","promiseDone","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(e){e===void 0&&(e="idb");var f=d("MAWDbFactory").makeIDBFactory(e,"worker");function a(a){return f.setupPromise().then(function(){return f.getDBExn(a)})}return babelHelpers["extends"]({},f,{getSignalDB:a,makeDB:function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,g){var h=[d("MAWDbMutationMiddleware").getMAWDbMutationMiddleware];b("cr:20397")!=null&&h.push(b("cr:20397").getMAWLSDataSyncMiddleware);c("gkx")("1760")&&h.push(d("MAWDbProtocolMsgIdMiddleware").MAWDbProtocolMsgIdMiddleware);h.push(c("MAWCacheServiceMiddleware"));e.enableDataSyncMiddleware&&h.push(d("MAWDataSyncMiddleware").getDataSyncMiddleware);e.enableMutationValidator===!0&&h.push(d("MAWDbMutationValidator").getMutationValidatorMiddleware);b("cr:3527")!=null&&h.push(b("cr:3527"));c("justknobx")._("4087")&&b("cr:17239")!=null&&(yield b("cr:17239")(a));return f.makeDB(a,{autoOpen:!0,middleware:h,onDbPopulate:e.onDbPopulate},g)});function a(a,b,c){return e.apply(this,arguments)}return a}()})}var j=a(),k="idle",l=j.isNewDb,m=j.willSetupDB,n=function(a,b,c){return j.makeDB(a,b,c).then(function(){k="ready"})},o=j.closeDB,p=j.getDBExn,q=j.getSignalDB,r=j.getDB,s=function(a){return j.reset_singleton_INTERNAL_ONLY()},t=j.deleteDb;function e(){return k}function f(a){var b=k;k="migrating";return a["finally"](function(){k=b})}var u=new WeakMap(),v=new WeakMap(),w=d("MWFBLogger").MWLogger.tags(["db","afterTransaction"]);function x(a){var b=c("MAWDexie").currentTransaction;if(b==null)throw w.mustfixThrow("afterTransactionEffect called outside of dexie transaction");if(typeof a!=="function")return;var d=u.get(b)||[];d.push(a);u.set(b,d);d.length===1&&b.on("complete",function(){var a=u.get(b)||[];a.forEach(function(a){a()});u["delete"](b)})}function y(a){var e=c("MAWDexie").currentTransaction;if(e==null)throw w.mustfixThrow("afterTransaction called outside of dexie transaction","maw_db");var f=v.get(e);if(f!=null)f.push(a);else{var g=[a];v.set(e,g);e.on("complete",function(){v["delete"](e),c("gkx")("5675")&&(i||(i=c("ExecutionEnvironment"))).isInMainThread&&b("cr:10182")!==null&&b("cr:10181")!==null?b("cr:10182").handleEvents(b("cr:10181").LSDatabaseSingleton,g):d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:g})})}}var z=new Map([["DeleteReaction",c("qex")._("4298")],["UpsertReaction",c("qex")._("4298")],["EditMsgHistoryAdded",c("qex")._("4380")]]);function A(a,b){a=a.tag;return!b&&z.get(a)?!0:!1}function B(a,b){b===void 0&&(b=!1);if(A(a,b))return;if(a.tag==="ThreadUpdated")try{b=a.value.snippetContactIDs;b!=null&&b.some(function(a){return a==="Facebook User"})&&(w.mustfix('Something is still setting a contact id as "Facebook User"'),a.value=babelHelpers["extends"]({},a.value,{snippetContactIDs:b.map(function(a){return a==="Facebook User"?"0":a})}))}catch(a){}else if(a.tag==="VerifyThreadExists"&&c("gkx")("13646")&&!(d("EBGating").isEBSMv2Phase1Enabled()||c("gkx")("13647"))){b=a.value;if(b.clientThreadKey!=null){var e=(h||(h=d("I64"))).of_string(b==null?void 0:b.clientThreadKey);c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady(e,b.jid,"MAWIndexedDb:afterTransaction:withClientThreadKey","clientThreadKey"))}if(b.authoritativeThreadKey!=null){e=(h||(h=d("I64"))).of_string(b.authoritativeThreadKey);c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady(e,b.jid,"MAWIndexedDb:afterTransaction:withAuthoritativeThreadKey","authoritativeThreadKey"))}}y(a)}function C(a,b){var e=c("MAWDexie").currentTransaction;if(e==null)throw w.mustfixThrow("afterTransactionForThreadEvent called outside of dexie transaction","maw_db");e.on("complete",function(){d("MAWBridge").getBridge().fireAndForget("threadEvent",b,a)})}g.TABLES_TO_ENCRYPT=d("MAWDbSchema").TABLES_TO_ENCRYPT;g.makeMsgrTransactor=d("MAWTransactor").makeMsgrTransactor;g.makeMAWIndexedDBFactory=a;g.isNewDb=l;g.willSetupDB=m;g.makeDB=n;g.closeDB=o;g.getDBExn=p;g.getSignalDB=q;g.getDB=r;g.setDB_INTERNAL_USE_ONLY=s;g.deleteDb=t;g.getDbStatus=e;g.updateStatusDuringMigration=f;g.afterTransactionEffect=x;g.afterTransaction=B;g.afterTransactionThreadEvent=C}),98);
__d("MAWLLAMigrationUtils",["Random","gkx","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";b=c("justknobx")._("652");var h=Math.max(b,10);e=h*10;var i=new Map([["FTS",e]]);function j(a){if(c("gkx")("9340"))return 1;a=i.get(a);return a!=null?a:h}function a(a,b){b===void 0&&(b={});var e=j(a);return a==="debug"||a==="test"?[]:c("gkx")("23956")&&d("Random").coinflip(e)?[c("qpl")._(1056839327,"560"),babelHelpers["extends"]({"double":{sampleRate:1/e},string:{transactor:a}},b)]:[]}g.getTransactorQPLParam=a}),98);
__d("MAWTransactor",["FBLogger","MAWDexie","MAWDexieTable","MAWErrorObject","MAWIndexedDb","MAWIndexedDbUI","MAWLLAMigrationUtils","MAWQplProxy","MAWTransactionMode","WAExceededStorageQuota","WALogger","gkx","performance"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=["MWPTransactor"],l=c("FBLogger")("messenger_web");function m(a,b,e,f,g,i){f!=null&&c("MAWDexie").currentTransaction!=null&&f.endFail("invoked_in_nested_transaction",{string:{current_transaction_mode:c("MAWDexie").currentTransaction.mode},string_array:{current_transaction_store_names:c("MAWDexie").currentTransaction.storeNames}});c("MAWDexie").currentTransaction!=null&&d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["makeMsgrTransactor "," should not be called inside another transaction. The transaction will be forced to execute on top-level"])),g);return a.transact(b,e,i)}function n(a){a=d("MAWLLAMigrationUtils").getTransactorQPLParam(a);a=a.length===2?a:[null,void 0];var b=a[0];a=a[1];return b!=null?d("MAWQplProxy").startQplUserFlow(b,a,{sendThroughBridge:!1}):null}function a(a,b,c,e){return q(a,b,function(a){return d("MAWIndexedDb").getDB(a)},c,e)}function b(a,b,c){return q(a,b,d("MAWIndexedDbUI").getDB,c)}function e(a,b,c){return q(a,b,d("MAWIndexedDbUI").getDB,c)}var o=0,p=new Map();function q(a,b,e,f,g){var h=Object.keys(a),q=h.some(function(b){return a[b]===d("MAWTransactionMode").READWRITE})?d("MAWTransactionMode").READWRITE:d("MAWTransactionMode").READONLY;return function(){for(var a=arguments.length,t=new Array(a),u=0;u<a;u++)t[u]=arguments[u];var v=n(b),w=null,x=function(){return self.clearInterval(w)};if(v!=null){v.addAnnotations({string:{mode:q===d("MAWTransactionMode").READWRITE?"readwrite":"readonly"},string_array:{stores:h}});if(c("gkx")("1006")&&b==="bulkCreateThreadByJid"){var y=1e3,z=Date.now();w=self.setInterval(function(){v.addAnnotations({"int":{heartbeatLatestAliveSinceStartMs:Date.now()-z}})},y);self.setTimeout(x,d("MAWQplProxy").DEFAULT_WORKER_QPL_TIMEOUT_MS)}}var A=(j||(j=c("performance"))).now()+j.timeOrigin;return e(b).then(function(a){var e=Array.from(p.values());v==null||v.addPoint("lock_wait_start",{string_array:{maybeLockedOn:e}});var n=(j||(j=c("performance"))).now();g==null||g.onTxnRequestedCb==null||g.onTxnRequestedCb.apply(g,t);return m(a,q,h,v,b,function(){d("MAWDexieTable").setDexiePSDItem("transactionRequested",A);d("MAWDexieTable").setDexiePSDItem("transactorName",b);v==null||v.addPoint("dexie_transaction_start");o+=1;var m=o;p.set(m,b);var q=v!=null?a.stores[h[0]].get("").then(function(){v==null||v.addPoint("lock_wait_end"),v==null||v.addPoint("transaction_opened"),v==null||v.addPoint("transactor_execution_start")}):d("MAWDexieTable").dexieResolve();return q.then(function(){return f(a.stores).apply(void 0,t)}).then(function(a){if(c("gkx")("6795")&&(g==null?void 0:g.explicitlyCloseTxn)===!0){var f;(f=c("MAWDexie").currentTransaction)==null||(f=f.idbtrans)==null||f.commit==null||f.commit()}p["delete"](m);v==null||v.addPoint("transactor_execution_end");v==null||v.endSuccess();x();f=(j||(j=c("performance"))).now()-n;f>5e3&&(d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[Slow maw transaction] "," took ","ms to complete. Potentially waiting for locks on ",""])),b,f,e.join(", ")),l.mustfix("[Slow maw transaction] %s took long to complete. Potentially waiting for locks on $s",b,e.join(", ")));return a})["catch"](function(a){p["delete"](m);d("WAExceededStorageQuota").checkQuotaExceededError(a);var c=a.name==="AbortError"?a==null?void 0:a.inner:null;c=r(c);v==null||v.markError("transaction_error",null,a);if(a instanceof Error){var e=a,f=typeof (e==null?void 0:e.stack)==="string"?e.stack:typeof (e==null?void 0:e.stack);e=typeof (e==null?void 0:e.message)==="string"?e.message:typeof (e==null?void 0:e.message);v==null||v.addAnnotations({string:{errMessage:e,errStack:f,innerError:c}})}v==null||v.endFail("transaction_fail");x();e=d("MAWErrorObject").getErrorObject(a);throw s(e).mustfixThrow("[%s] Error performing %s transaction. Inner error: %s",k.join("|"),b!=null?b:"",c!=null?c:"unknown")})})})["catch"](function(a){d("WAExceededStorageQuota").checkQuotaExceededError(a);v==null||v.endFail("transaction_fail");x();a=d("MAWErrorObject").getErrorObject(a);throw s(a).mustfixThrow("[%s] Error performing %s transaction",k.join("|"),b!=null?b:"")})}}function r(a){if(typeof a==="string")return a;if(a instanceof Error)return a.name+": "+a.message;if(typeof a==="object")try{return JSON.stringify(a)}catch(a){}return null}function s(a){if(a)return l.catching(a);else return l}g.makeMsgrTransactor=a;g.makeMsgrUITransactor_IMPORT_FROM_MAWIndexedDbUI_INSTEAD=b;g.makeMsgrUIWritableTransactor=e}),98);
__d("MAWThreadUpdateType",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;c=2;d=3;e=Object.freeze({BUMP_THREAD:c,MARK_THREAD_AS_UNREAD:d,NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:a,SNIPPET_ONLY:b});f.THREAD_UPDATE_TYPE=e}),66);
__d("MAWGetThreadUpdateTypeForAdminMsg",["FBLogger","MAWAdminMsgTypesGrouped","MAWLocalizationType","MAWThreadUpdateType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=(a=a.msgContent)==null?void 0:a.adminType;if(a==null){c("FBLogger")("messenger_web").mustfix("nullAdminType");return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}if(h(a))return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD;if(i(a))return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;if(j(a))return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;if(k(a))return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE;c("FBLogger")("messenger_web").mustfix("unsupportedAdminMsgType");return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}function h(a){return d("MAWAdminMsgTypesGrouped").chatCustomizedByOtherUser.includes(a)||d("MAWAdminMsgTypesGrouped").callActionToNotifyAbout.includes(a)||d("MAWAdminMsgTypesGrouped").twoUsersConnected.includes(a)||d("MAWAdminMsgTypesGrouped").fallbackMsgFromOtherUser.includes(a)||d("MAWAdminMsgTypesGrouped").otherUserBumpsMessage.includes(a)||d("MAWAdminMsgTypesGrouped").otherNonAdminMsgToBeMarkedAsUnread.includes(a)||a===d("MAWLocalizationType").LOCALIZATION_TYPE.REACHABILITY_ERROR}function i(a){return d("MAWAdminMsgTypesGrouped").participantsAddedRemoved.includes(a)||d("MAWAdminMsgTypesGrouped").chatCustomizedByCurrentUser.includes(a)||d("MAWAdminMsgTypesGrouped").callActionNotToNotifyAbout.includes(a)||d("MAWAdminMsgTypesGrouped").fallbackMsgFromCurrentUser.includes(a)||d("MAWAdminMsgTypesGrouped").currentUserBumpsMessage.includes(a)||d("MAWAdminMsgTypesGrouped").otherNonAdminMsgToBeBumped.includes(a)||d("MAWAdminMsgTypesGrouped").limitSharingUpdate.includes(a)}function j(a){return a===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_ROLLBACK_ADMIN_MESSAGE||d("MAWAdminMsgTypesGrouped").ephemeralSettingChanges.includes(a)||d("MAWAdminMsgTypesGrouped").groupPermissionsChanged.includes(a)||d("MAWAdminMsgTypesGrouped").participantLeftGroup.includes(a)||d("MAWAdminMsgTypesGrouped").pinnedMessageUpdate.includes(a)}function k(a){return d("MAWAdminMsgTypesGrouped").cutoverAdminMsgs.includes(a)||d("MAWAdminMsgTypesGrouped").deviceChanges.includes(a)||d("MAWAdminMsgTypesGrouped").icdcAlerts.includes(a)||d("MAWAdminMsgTypesGrouped").otherNonAdminMsgToNotTriggerUpdate.includes(a)||a===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION||a===d("MAWLocalizationType").LOCALIZATION_TYPE.EMPTY_SNIPPET||a===d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG||a===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE}g.getThreadUpdateTypeForAdminMsg=a}),98);
__d("MAWGetThreadUpdateType",["FBLogger","MAWDbMsgOrReaction","MAWGetThreadUpdateTypeForAdminMsg","MAWThreadSnippetUtils","MAWThreadUpdateType","MAWUserJidWrapper","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b=a.reaction==null;return j(a,b)}function i(a){return k(a.reactToAuthor)&&!k(a.author)}function j(a,b){if(i(a)&&!b)if(a.senderTimestampMs==null)return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;else return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD;else return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}function k(a){return a===d("WAJids").AUTHOR_ME||a===d("MAWUserJidWrapper").getMyUserJid()}function l(a){var b=a.type,e=function(b){var c=b.me;b=b.other;return d("WAJids").isAuthorMe(a.author)?c:b};switch(b){case"Text":case"ReceiverFetch":case"Sticker":case"Unavailable":case"Video":case"Futureproof":case"DocumentFile":case"EphemeralScreenshotAction":case"Gif":case"Image":case"Ptt":case"RavenAction":case"Raven":case"GroupPollCreate":case"GroupPollUpdate":case"BumpExistingMessage":return e({me:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD,other:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD});case"XMA":return d("MAWThreadSnippetUtils").shouldIgnoreXMAMsgForSnippet(a)?d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:e({me:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD,other:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD});case"Revoked":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;case"DeleteForMe":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE;case"EditAction":return e({me:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY,other:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE});case"GroupInvite":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"Admin":if(a.type==="Admin")return d("MAWGetThreadUpdateTypeForAdminMsg").getThreadUpdateTypeForAdminMsg(a);throw c("FBLogger")("messenger_web").mustfixThrow("Non-admin msg passed in "+((e=a.type)!=null?e:"UNKNOWN"));case"SenderKeyDistribution":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE;case"AlertICDC":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"Ciphertext":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"EphemeralSettingAdmin":case"EphemeralSettingChangeFromCurrentDevice":case"EphemeralSyncResponse":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;default:b;throw c("FBLogger")("messenger_web").mustfixThrow("[MAWGetThreadUpdateType] Unexpected message type: "+((e=a.type)!=null?e:"UNKNOWN"))}}function m(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstoredNullish(a,{forMessage:function(a){return l(a)},forNull:function(){return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE},forReaction:function(a){return h(a)}})}function a(a){a=m(a);switch(a){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:return!1;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return!0;default:throw c("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate][snippet] Unhandled threadUpdateType: "+a)}}function b(a){a=m(a);switch(a){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:return!1;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return!0;default:throw c("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate][bump] Unhandled threadUpdateType: "+a)}}g.getThreadUpdateTypeForReaction=h;g.canReactionAffectBump=i;g.getReactionThreadUpdateType=j;g.getThreadUpdateTypeForMsg=l;g.getThreadUpdateTypeForMsgOrReaction=m;g.isThreadUpdateTypeEligibleForSnippet=a;g.isThreadUpdateTypeEligibleForBump=b}),98);
__d("MAWCacheServiceMiddleware",["FBLogger","MAWIndexedDb","MAWMpsGating","MAWWorkerCacheServices"],(function(a,b,c,d,e,f,g){"use strict";var h=["messages","reactions"],i=["messages","reactions"];function j(a,b,c){var d,e=c.trans,f=(d=(d=e._transactorMeta)==null?void 0:d.mawCacheServiceAccumulatedRequests)!=null?d:[];if(c.type==="delete"&&i.includes(b.name))return m(a,b.name,c).then(function(a){a=babelHelpers["extends"]({},c,{deletedValues:a});f.push([b.name,a]);e._transactorMeta=babelHelpers["extends"]({},e._transactorMeta,{mawCacheServiceAccumulatedRequests:f});return b.mutate(c)});d=babelHelpers["extends"]({},c,{decryptedValues:c.values?c.values:void 0});f.push([b.name,d]);e._transactorMeta=babelHelpers["extends"]({},e._transactorMeta,{mawCacheServiceAccumulatedRequests:f});return b.mutate(c)}function k(a){var b=a.trans;if(((a=b._transactorMeta)==null?void 0:a.mawCacheServiceAfterTransactionScheduled)===!0)return;d("MAWIndexedDb").afterTransactionEffect(function(){var a;a=(a=(a=b._transactorMeta)==null?void 0:a.mawCacheServiceAccumulatedRequests)!=null?a:[];if(a.length===0)return;d("MAWWorkerCacheServices").getMAWWorkerCacheServices().calculateDelta(a)});b._transactorMeta=babelHelpers["extends"]({},b._transactorMeta,{mawCacheServiceAfterTransactionScheduled:!0})}function l(a,b){var c=a.table(b);if(!h.includes(b))return c;return d("MAWMpsGating").isFullMpsEnabled()?c:babelHelpers["extends"]({},c,{mutate:function(b){k(b);return j(a,c,b)}})}function a(){return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return l(a,b)}})}catch(b){c("FBLogger")("MAWCacheService").catching(b).mustfix("Error applying MAW Cache Service Middleware");return a}},name:"MAWCacheServiceMiddleware",stack:"dbcore"}}function m(a,b,c){var d=c.keys;c=c.trans;return a.table(b).getMany({keys:d,trans:c}).then(function(a){return a.filter(Boolean)})}g["default"]=a}),98);
__d("MAWVaultDb",["FBLogger","MAWQplProxy","MAWVault","gkx","isObject","isPlainObject","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=1/1e3,i=new WeakMap();function j(a,b){return b[a]!=null}var k=c("gkx")("23909");function a(a,b,e){if(!c("isPlainObject")(a)||!k||!j(b,e)||a==null)return a;var f=i.get(a);if(f!=null)return f;f=Math.random()<h?d("MAWQplProxy").startQplUserFlow(c("qpl")._(25301509,"119")):null;try{e=e[b];e=l(a,e,d("MAWVault").vault);f==null||f.endSuccess();i.set(a,e);return e}catch(a){f==null||f.endFail("vault_fail");throw c("FBLogger")("messenger_web").mustfixThrow(a.message+" - Failed to vault an entity in the table: "+b)}}function b(a,b,e){if(!c("isPlainObject")(a)||!k||!j(b,e)||a==null)return a;var f=Math.random()<h?d("MAWQplProxy").startQplUserFlow(c("qpl")._(741087294,"2028")):null;try{a=l(a,e[b],d("MAWVault").unvault);f==null||f.endSuccess();return a}catch(a){f==null||f.endFail("unvault_fail");throw c("FBLogger")("messenger_web").mustfixThrow(a.message+" - Unvaulting failed for an entity in the table: "+b)}}function l(a,b,d){if(a==null)return a;b=Object.entries(b).filter(function(b){b=b[0];return a[b]!=null});return b.length===0?a:b.reduce(function(a,b){var e=b[0];b=b[1];typeof b!=="boolean"&&c("isObject")(b)?a[e]=l(a[e],b,d):b===!0&&(a[e]=d(a[e]));return a},babelHelpers["extends"]({},a))}g.vaultDbRow=a;g.unvaultDbRow=b;g.setInPath=l}),98);
__d("MAWVaultDefinitions",[],(function(a,b,c,d,e,f){"use strict";a={editMsgHistory:{msgContent:{content:!0}},messages:{msgContent:{content:!0},quote:{content:{msgContent:{content:!0}}}},unrenderedMessages:{msgContent:!0}};b={edit_message_history:{messageContent:!0},messages:{replyMessageText:!0,text:!0},threads:{snippet:!0}};f.ARMADILLO_IDB_VAULT_DEFINITIONS=a;f.PERSISTED_DB_VAULT_DEFINITIONS=b}),66);
__d("isEncryptionAtRestEnabled",["isInstamadillo","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){if(c("qex")._("507")===!0)return!0;else return c("isInstamadillo")()}g["default"]=a}),98);
__d("MAWDbMiddlewareMutations",["MAWDbObjEncryption","MAWVaultDb","MAWVaultDefinitions","gkx","isEncryptionAtRestEnabled"],(function(a,b,c,d,e,f,g){"use strict";var h=c("gkx")("23909");function a(a,b,e){if(!h&&!(c("isEncryptionAtRestEnabled")()||c("gkx")("23910")))return a;a=babelHelpers["extends"]({},a);a=d("MAWVaultDb").unvaultDbRow(a,b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS);a=d("MAWDbObjEncryption").encryptDbObj(a,b,e);return a}function b(a,b){return!h?a:d("MAWVaultDb").unvaultDbRow(babelHelpers["extends"]({},a),b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS)}function e(a,b,c){a=d("MAWDbObjEncryption").decryptDbObj(babelHelpers["extends"]({},a),b,c);return!h?a:d("MAWVaultDb").vaultDbRow(a,b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS)}function f(a,b){if(a==null)return void 0;return!h?a:d("MAWVaultDb").vaultDbRow(a,b,d("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS)}g.mutateValue=a;g.mutateVaultedValue=b;g.getValue=e;g.getVaultedValue=f}),98);
__d("MAWDbMutationValidator",["FBLogger","MAWIndexedDb","MAWMessageHasNonNullServerTsOnReceivedAckValidator","MAWMessageHasUniqueExternalIdValidator","MAWODSProxy","MAWParticipantMatchOneOnOneThreadValidator","MAWReactionHasUniqueProtocolMsgIdValidator","Promise","Random","WAOdsEnums","gkx","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i=[d("MAWMessageHasUniqueExternalIdValidator").MAWMessageHasUniqueExternalIdValidator,d("MAWParticipantMatchOneOnOneThreadValidator").MAWParticipantMatchOneOnOneThreadValidator,d("MAWReactionHasUniqueProtocolMsgIdValidator").MAWReactionHasUniqueProtocolMsgIdValidator,d("MAWMessageHasNonNullServerTsOnReceivedAckValidator").MAWMessageHasNonNullServerTsOnReceivedAckValidator],j=c("justknobx")._("2610"),k=c("gkx")("5906"),l=function(a){return d("Random").coinflip(a!=null?a:j)||k};function m(a,e){var f=a.table(e),g=i.filter(function(a){return a.table===e});return g.length===0?f:babelHelpers["extends"]({},f,{mutate:function(a){return d("MAWIndexedDb").getDbStatus()!=="ready"?f.mutate(a):f.mutate(a).then(function(e){var f=g.filter(function(b){var c=b.sampleRate;b=b.type;return b.includes(a.type)&&l(c)});d("MAWIndexedDb").afterTransactionEffect(function(){var g=f.flatMap(function(a){var b=a.description,c=a.isValid;return((a=e.results)!=null?a:[]).map(function(a){return c(a).then(function(a){return babelHelpers["extends"]({validatorName:b},a)})})});c("promiseDone")((h||(h=b("Promise"))).all(g).then(function(b){b.forEach(function(b){switch(b.result){case"valid":d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MUTATION_VALIDATOR,key:b.validatorName+"."+a.type+".valid"});break;case"invalid":d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MUTATION_VALIDATOR,key:b.validatorName+"."+a.type+".invalid"});c("FBLogger")("maw_mutation_validator").mustfix("Validator %s failed for %s mutation, with description: %s",b.validatorName,a.type,b.description);break;case"skipped":break}})}))});return e})}})}function a(){return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return m(a,b)}})}catch(b){c("FBLogger")("messenger_web").catching(b).mustfix("Error applying Mutation Validator Middleware");return a}},name:"MAWMutationValidatorMiddleware",stack:"dbcore"}}g.getMutationValidatorMiddleware=a}),98);
__d("MAWDbProtocolMsgIdMiddleware",["FBLogger","MAWDBMigrationUtils","MAWJidUtils","MAWODSProxy","Random","WAOdsEnums","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h=c("justknobx")._("3300");function i(a){return babelHelpers["extends"]({},a,{get:function(b){return a.get(b).then(function(a){l(a,"get");return a})},getMany:function(b){return a.getMany(b).then(function(a){return a==null?void 0:a.map(function(a){l(a,"getMany");return a})})},mutate:function(b){b.type==="add"?b.values.map(function(a){return j(a)}):b.type==="put"&&c("gkx")("11791")&&c("justknobx")._("3947")&&b.values.map(function(a){a.protocolMsgId==null&&(d("MAWDBMigrationUtils").mawDbMigrationVersion.version>=d("MAWDBMigrationUtils").MAWDB_DEDUPE_MSGS_MIGRATION_VERSION?(d("Random").coinflip(h)&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_after_migration_complete.migration_version_"+d("MAWDBMigrationUtils").mawDbMigrationVersion.version}),j(a)):a.rowId<d("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.cursorValue?(d("Random").coinflip(h)&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_below_migration_cursor.migration_version_"+d("MAWDBMigrationUtils").mawDbMigrationVersion.version}),j(a)):d("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.isRunning&&a.rowId<d("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.cursorValue+d("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.batchSize&&(d("Random").coinflip(h)&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_in_current_migration_batch.migration_version_"+d("MAWDBMigrationUtils").mawDbMigrationVersion.version}),j(a)))});return a.mutate(b)},query:function(b){return a.query(b).then(function(a){var b;a==null||(b=a.result)==null||b.map(function(a){l(a,"query")});return a})}})}function j(a){a.protocolMsgId=d("MAWJidUtils").toProtocolMsgIdStringForMAWStorage(a)}function k(a){return(a==null?void 0:a.rowId)==null&&(a==null?void 0:a.externalId)==null}function l(a,b){try{var e=c("justknobx")._("3947");if(k(a)){b!=="get"&&d("Random").coinflip(h)&&c("FBLogger")("messenger_web").warn("Corrupted message row returned from DB, msg is null:%s, queryType: %s",a==null,b);return}(a==null?void 0:a.protocolMsgId)==null&&d("Random").coinflip(h)&&(d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.migration_version_"+d("MAWDBMigrationUtils").mawDbMigrationVersion.version+".append_protocol_msg_id_for_put_operation_jk_"+String(e)}),d("MAWDBMigrationUtils").mawDbMigrationVersion.version>=d("MAWDBMigrationUtils").MAWDB_DEDUPE_MSGS_MIGRATION_VERSION&&c("FBLogger")("maw_db_migration").warn("Message with null protocolMsgId after the msg dedupe migration. type: %s, rowId: %s, externalId: %s",a==null?void 0:a.type,a==null?void 0:a.rowId,a==null?void 0:a.externalId));a!=null&&a.protocolMsgId!=null&&a.protocolMsgId!==d("MAWJidUtils").toProtocolMsgIdStringForMAWStorage(a)&&d("Random").coinflip(h)&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"inconsistent_protocol_msg_id."+(a==null?void 0:a.type)+".migration_version_"+d("MAWDBMigrationUtils").mawDbMigrationVersion.version+".append_protocol_msg_id_for_put_operation_jk_"+String(e)})}catch(a){c("FBLogger")("messenger_web").catching(a).mustfix("Error while checking protocol msg id")}}function a(){return{create:function(a){try{return babelHelpers["extends"]({},a,{table:function(b){return b!=="messages"?a.table(b):i(a.table(b))}})}catch(b){c("FBLogger")("messenger_web").catching(b).mustfix("Error applying Protocol MsgId Middleware");return a}},name:"MAWDbProtocolMsgIdMiddleware",stack:"dbcore"}}g.appendProtocolMsgId=j;g.isCorruptedMsgRow=k;g.MAWDbProtocolMsgIdMiddleware=a}),98);
__d("MAWDbReaction",["FBLogger","I64","MAWAckLevel","MAWGetBumpTimestampMs","MAWUserJidWrapper","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){var b=d("MAWUserJidWrapper").getMyUserJid();if(a.reactToAuthor!=="@me"&&a.reactToAuthor!==b||a.reaction==null)return null;b=a.author==="@me"||a.author==="@system"?null:a.author;return b==null?null:babelHelpers["extends"]({},a,{author:b,reaction:a.reaction,reactToAuthor:"@me"})}function a(a){a=i(a);if(a==null)throw c("FBLogger")("messenger_web").mustfixThrow("Cannot cast reaction to incomingDbReaction");return a}function b(a,b,c){var e=d("MAWUserJidWrapper").getMyUserJid();return a.find(function(a){return a.threadJid===b&&d("WAJids").authorToUserId(a.author,e)===d("WAJids").authorToUserId(c,e)})}function e(a){return a}function f(a,b,c,e,f,g,h,i,j,k,l,m,n){m===void 0&&(m=d("MAWAckLevel").ACK.clock);m={ack:m,author:k,externalId:b,groupingKey:g,reaction:f,reactionId:c,reactToAuthor:h,reactToExternalId:e,reactToMsgId:i,senderTimestampMs:n,threadJid:a,ts:j};return l!=null?babelHelpers["extends"]({},m,{rowId:l}):m}function j(a){a=d("MAWGetBumpTimestampMs").getBumpTimestampMs(a);return d("WATimeUtils").castToMillisTime((h||(h=d("I64"))).to_float(a))}g.maybeCastToIncomingDbReaction=i;g.castToIncomingDbReaction=a;g.findMatchingReaction=b;g.reactionIdToMsgId=e;g.formatReactionForDb=f;g.getReactionTimeMs=j}),98);
__d("MAWThreadNewestMsgOrReactionUtils",["FBLogger","MAWDbMsg","MAWDbMsgTxns","MAWDbReaction","MAWDbReactionsTxns","MAWDexieTable","MAWGetThreadUpdateType","MAWODSProxy","MAWThreadUpdateType","WALogger","WAMsg","WAOdsEnums","WATimeUtils","first","last"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return l(a,b,i)}function i(a,b){switch(a){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return b!==!0;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:return!1;default:throw c("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate] Unhandled threadUpdateType to create filter function : "+a)}}function b(a,b){return l(a,b,j)}function e(a){var b=a.db,c=a.jid;a=a.limit;return d("MAWDbMsgTxns").fetchMessagesFromDbWithSortOrderMs(b,c,null,!0,a,function(a){return k(d("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg(a),a.ephemeralMsgDisappeared===!0)},"before")}function j(a,b){switch(a){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return b!==!0;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:return!1;default:throw c("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate] Unhandled threadUpdateType to create filter function : %s",a)}}function k(a,b){switch(a){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return b!==!0;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:return!1;default:throw c("FBLogger")("messenger_web").mustfixThrow("[MAWCacheService] Unhandled threadUpdateType to create filter function : %s",a)}}function l(a,b,c){var e=function(e){return e==null?d("MAWDexieTable").dexieResolve(null):n(a,b,c,e)};return m(a,b,c).then(function(a){return e(a).then(function(c){if(a==null&&c==null){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[CentralizedThreadUpdate] No Reaction or Message in "," is eligible for snippet"])),b);return null}if(c==null)return a;if(a==null)return c;var e=d("WATimeUtils").castToMillisTime(d("MAWDbMsg").getSortOrderWithFallback(a)),f=d("MAWDbReaction").getReactionTimeMs(c);return e>=f?a:c})})}function m(a,b,e){return d("MAWDbMsgTxns").fetchMessagesFromDbWithSortOrderMs(a,b,null,!0,1,function(a){return e(d("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg(a),a.ephemeralMsgDisappeared===!0)},"before").then(c("first"))}function n(a,b,e,f){var g=d("MAWDbMsg").getSortOrderWithFallback(f),h=function(c,f){return d("MAWDbReactionsTxns").fetchReactionsFromDbWithTimestamp(a,b,d("WATimeUtils").castToMillisTime(g),f,f==null,c,function(a){return e(d("MAWGetThreadUpdateType").getThreadUpdateTypeForReaction(a),!1)&&d("MAWDbReaction").getReactionTimeMs(a)>g})},i=[1,10],j=100,k=new Set(),l=function(b,e){var f;return h((f=i[b])!=null?f:j,e).then(function(e){var f=e.filter(function(a){return!k.has(q(a))});if(f.length===0){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_THREAD_GET_NEWEST_REACTION_BATCH_NUM,key:"new."+b});return null}return o(a,f).then(function(a){var f=a.newestReaction;a=a.nullMsgIds;if(f!=null){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_THREAD_GET_NEWEST_REACTION_BATCH_NUM,key:"new."+b});return f}a.forEach(function(a){return k.add(a)});return l(b+1,c("last")(e))})})};return l(0,null)}function o(a,b){return d("MAWDbMsgTxns").getUniqueMsgsByProtocolMsgIds(a,b.map(p)).then(function(a){var c=new Set(a.map(r)),d=new Set(),e=null;b.forEach(function(a){var b=q(a);c.has(b)?e=s(e,a):d.add(b)});return{newestReaction:e,nullMsgIds:d}})}function p(a){return{author:a.reactToAuthor,chat:a.threadJid,externalId:a.reactToExternalId}}function q(a){return d("WAMsg").craftWAMsgIdString(p(a))}function r(a){return d("WAMsg").craftWAMsgIdString({author:a.author,chat:a.threadJid,externalId:a.externalId})}function s(a,b){if(a==null)return b;return b==null?a:d("MAWDbReaction").getReactionTimeMs(a)>d("MAWDbReaction").getReactionTimeMs(b)?a:b}g.getNewestMsgOrReactionForBump=a;g.filterForBump=i;g.getNewestMsgOrReactionForSnippet=b;g.getNewestIncomingMsgsForSnippet=e;g.filterForSnippet=j;g.filterForSnippetNewestIncomingMessages=k;g.getNewestReactionToNonNullMsg=o}),98);
__d("MAWLocalizationUtils",["MAWAckLevel","MAWLocalizationType","MAWMsgType","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set([(f=d("MAWLocalizationType")).LOCALIZATION_TYPE.CURRENT_USER_CREATED_POLL,f.LOCALIZATION_TYPE.PARTICIPANT_CREATED_POLL,f.LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_OPTION,f.LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_OPTION,f.LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_OPTIONS,f.LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_OPTIONS,f.LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_VOTE,f.LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_VOTE,f.LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_POLL_VOTE,f.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_POLL_VOTE,f.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.CURRENT_USER_MIXED_POLL_UPDATE,f.LOCALIZATION_TYPE.PARTICIPANT_MIXED_POLL_UPDATE,f.LOCALIZATION_TYPE.CURRENT_USER_CHANGED_POLL_VOTE,f.LOCALIZATION_TYPE.PARTICIPANT_CHANGED_POLL_VOTE,f.LOCALIZATION_TYPE.CURRENT_USER_CHANGED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.PARTICIPANT_CHANGED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.POLL_UNSENT_UPDATE]);function a(a,b,c,e,f,g){return{ack:d("MAWAckLevel").ACK.sent,altIndex:f!=null?f:void 0,author:d("WAJids").AUTHOR_SYSTEM,externalId:c,msgContent:a,sortOrderMs:g,threadJid:b,ts:e!=null?e:d("WATimeUtils").unixTime(),type:d("MAWMsgType").MSG_TYPE.ADMIN}}function b(a){if(h.has(a))return!0;switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SELF_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_GOT_PROMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_GOT_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_PROMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SELF_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_PHOTO:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UNPINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PHOTO:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNPINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_LIMIT_SHARING_DISABLED:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_LIMIT_SHARING_ENABLED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_DISABLED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_ENABLED:return!0}return!1}function c(a){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:return!0}return!1}function e(a){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_MORE_THAN_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:return!0}return!1}g.POLL_ADMIN_MSG_TYPES=h;g.buildUnstoredDbAdminMsg=a;g.isAdminMsgNormalized=b;g.isDeviceChangeAdminMsg=c;g.isParticipantChangeAdminMsg=e}),98);
__d("MAWThreadSnippetForAdminOrEphemeralMsg",["FBLogger","MAWAdminMsgNormalized","MAWLocalizationType","MAWLocalizationUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e;e=(e=a.msgContent)==null?void 0:e.adminType;a=(a=a.msgContent)==null?void 0:a.adminMsgContent;if(e==null||a==null){c("FBLogger")("GroupPollsE2EE").mustfix("MAWThreadSnippetForAdminOrEphemeralMsg: snippetType or adminMsgContent is null");return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:b,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET}}a=d("MAWLocalizationUtils").isAdminMsgNormalized(e)?d("MAWAdminMsgNormalized").deconstructContactIdsFromAdminContent(e,a):{contactIds:[],contents:a};var f=a.contactIds;a=a.contents;return{snippetParams:{contactIDs:[].concat(f.map(function(a){return a==="Facebook User"?"0":a})),strings:[].concat(a)},snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForBumpExistingMessageMsg",["MAWLocalizationType","WAGlobals","WAJids","WALogger","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(a,b,c){return{snippetParams:{contactIDs:c!=null?c:[],strings:[]},snippetSenderContactId:a,snippetType:b}}var m=function(a){return l(a,d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)};function a(a,b){var c;if(d("WAJids").isAuthorSystem(a.author)){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Bumped message can not have AUTHOR_SYSTEM"])));return m(b)}c=(c=a.quote)==null?void 0:c.content.type;if(c===d("WAMsgType").UNAVAILABLE){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Bump message has unavailable content type"])));return m(b)}c=(c=a.quote)==null?void 0:c.content.author;if(c==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Bump message has no quoted author"])));return m(b)}if(d("WAJids").isAuthorMe(a.author)||a.author===d("WAGlobals").getMyUserJid())return d("WAJids").isAuthorMe(c)||c===d("WAGlobals").getMyUserJid()?l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_OWN_MESSAGE):l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE,[d("WAJids").userIdFromJid(c)]);if(b==null){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Bump message sender is null"])));return m(b)}if(d("WAJids").isAuthorMe(c)||c===d("WAGlobals").getMyUserJid())return l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE,[b]);return c===a.author?l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_OWN_MESSAGE,[b]):l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE,[b,d("WAJids").userIdFromJid(c)])}g["default"]=a}),98);
__d("MAWThreadSnippetForCiphertextMsg",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:a,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.USER_SEND_ENCRYPTED_MESSAGE_FALLBACK}}g["default"]=a}),98);
__d("MAWThreadSnippetForDocumentFileMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Document file message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForFallbackMessageMsg",["MAWLocalizationType","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){return{snippetParams:{contactIDs:c!=null?c:[],strings:[]},snippetSenderContactId:a,snippetType:b}}function a(a,b){var c=a.author;a=a.msgContent.subtype;if(d("WAJids").isAuthorMe(c))switch(a){case"liveLocationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LIVE_LOCATION_FALLBACK);case"locationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LOCATION_FALLBACK);case"contactShareMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_CONTACT_SHARE_FALLBACK);case"storyMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STORY_MENTION_FALLBACK);case"postMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POST_MENTION_FALLBACK);case"pollCreationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POLL_CREATION_FALLBACK);case"bumpMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE);case"stickerReceiverFetchMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK);case"messengerMemory":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK);default:return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)}else switch(a){case"liveLocationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LIVE_LOCATION_FALLBACK);case"locationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LOCATION_FALLBACK);case"contactShareMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_CONTACT_SHARE_FALLBACK);case"storyMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STORY_MENTION_FALLBACK);case"postMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POST_MENTION_FALLBACK);case"pollCreationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POLL_CREATION_FALLBACK);case"bumpMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE);case"metaAiMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.META_AI_SEND_MESSAGE_FALLBACK);case"stickerReceiverFetchMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK);case"messengerMemory":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK);default:return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)}}g["default"]=a}),98);
__d("MAWThreadSnippetForGifMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_GIF:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Animated message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_GIF,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForImageMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_IMAGE:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Image message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForPttMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_AUDIO:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Ptt message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_AUDIO,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForRavenMsg",["MAWLocalizationType","MAWMsg","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=a.ravenMediaType===d("MAWMsg").MAWRavenMsgMediaType.IMAGE?d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_IMAGE:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_VIDEO:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Animated message can not have AUTHOR_SYSTEM"]))):(e=a.ravenMediaType===d("MAWMsg").MAWRavenMsgMediaType.IMAGE?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForMsgUtils",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){var e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;b={contactIDs:[],mentionJIDs:b!=null?b:[],strings:[]};d("WAJids").isAuthorMe(a)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER:d("WAJids").isAuthorSystem(a)||c==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Sticker message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER,b.contactIDs.push(c));return{snippetParams:b,snippetSenderContactId:c,snippetType:e}}g.getMAWThreadSnippetForStickerMsg=a}),98);
__d("MAWThreadSnippetForReceiverFetchMsg",["MAWThreadSnippetForMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWThreadSnippetForMsgUtils").getMAWThreadSnippetForStickerMsg(a.author,(a=a.msgContent)==null?void 0:a.mentionedJids,b)}g["default"]=a}),98);
__d("MAWThreadSnippetForRevokedMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UNSENT_MESSAGE:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Revoked message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNSENT_MESSAGE,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForStickerMsg",["MAWThreadSnippetForMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWThreadSnippetForMsgUtils").getMAWThreadSnippetForStickerMsg(a.author,(a=a.msgContent)==null?void 0:a.mentionedJids,b)}g["default"]=a}),98);
__d("MAWThreadSnippetForTextMsg",["MAWLocalizationType","MAWVault","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){var e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,f={contactIDs:[],mentionJIDs:a.msgContent.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_TEXT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Text message can not have AUTHOR_SYSTEM"]))):(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT_IN_GROUP:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT,f.contactIDs.push(b));if(a.specialTextSize===1||a.specialTextSize===2||a.specialTextSize===3){c=d("MAWVault").unvault(a.msgContent.content);f.strings.push(c==="\ud83d\udc4d"?"(Y)":a.msgContent.content)}else f.strings.push(a.msgContent.content);return{snippetParams:f,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForVideoMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_VIDEO:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Video message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForXMAMsg",["MAWLocalizationType","WAArmadilloXMA.pb","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};a.xmaMessageType==null&&d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["XMA message does not have xmaMessageType"])));switch(a.xmaMessageType){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PROFILE_DIRECTORY_ITEM:if(d("WAJids").isAuthorMe(a.author)){var f;if(a.msgContent!=null&&((f=a.msgContent)==null?void 0:f.content)!=null){f=a.msgContent.content;e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT;f!=null&&c.strings.push(f)}else e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT}else if(d("WAJids").isAuthorSystem(a.author)||b==null)d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"])));else{e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT;c.contactIDs.push(b);f=(f=a.msgContent)==null?void 0:f.content;f!=null&&c.strings.push(f)}break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_POST_MENTION:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POST_MENTION:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POST_MENTION;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_MEMORIES_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_MEMORIES_SHARE:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_MEMORIES_SHARE;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STORY_MENTION:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STORY_MENTION;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LOCATION:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LOCATION;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_AI_CONTACT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_CONTACT_SHARE:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_CONTACT_SHARE;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_REEL:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_REEL;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_POST:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_POST;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_POST:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_POST;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(r||(r=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY_HIGHLIGHT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY_HIGHLIGHT;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION:if(d("WAJids").isAuthorMe(a.author)){e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MENTIONED_STORY_IG;f=a.threadJid;var g;f!=null&&(g=d("WAJids").interpretAsUserJid(f));if(g!=null){f=d("WAJids").userIdFromJid(g);c.contactIDs.push(f)}else d("WALogger").ERROR(t||(t=babelHelpers.taggedTemplateLiteralLoose(["XMA story mentions must have a target Jid"])))}else d("WAJids").isAuthorSystem(a.author)?d("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_RECEIVED_STORY_MENTION_IG;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:if(d("WAJids").isAuthorMe(a.author)){e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_AUDIO_CALLED;f=H(a);f!=null?c.contactIDs.push(f):d("WALogger").ERROR(v||(v=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(w||(w=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_AUDIO_CALLED,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:if(d("WAJids").isAuthorMe(a.author)&&b!=null){e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_VIDEO_CALLED;f=H(a);f!=null?c.contactIDs.push(f):d("WALogger").ERROR(x||(x=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(y||(y=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_VIDEO_CALLED,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:if(d("WAJids").isAuthorMe(a.author)){e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_AUDIO_CALL;f=H(a);f!=null?c.contactIDs.push(f):d("WALogger").ERROR(z||(z=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(A||(A=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_AUDIO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:if(d("WAJids").isAuthorMe(a.author)){e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_VIDEO_CALL;f=H(a);f!=null?c.contactIDs.push(f):d("WALogger").ERROR(B||(B=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(C||(C=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_VIDEO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_AUDIO_CALL:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(D||(D=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_AUDIO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_VIDEO_CALL:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(E||(E=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_VIDEO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_EVENT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(F||(F=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_EVENT,c.contactIDs.push(b));break;default:d("WALogger").ERROR(G||(G=babelHelpers.taggedTemplateLiteralLoose(["Encountered unexpected XMAMessageType when building a thread snippet: ",""])),a.xmaMessageType)}return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}function H(a){a=a.threadJid!=null?d("WAJids").interpretAsUserJid(a.threadJid):null;return a!=null?d("WAJids").userIdFromJid(a):null}g["default"]=a}),98);
__d("MAWThreadSnippet",["FBLogger","MAWLocalizationType","MAWMsgType","MAWThreadSnippetForAdminOrEphemeralMsg","MAWThreadSnippetForBumpExistingMessageMsg","MAWThreadSnippetForCiphertextMsg","MAWThreadSnippetForDocumentFileMsg","MAWThreadSnippetForFallbackMessageMsg","MAWThreadSnippetForGifMsg","MAWThreadSnippetForImageMsg","MAWThreadSnippetForPttMsg","MAWThreadSnippetForRavenMsg","MAWThreadSnippetForReceiverFetchMsg","MAWThreadSnippetForRevokedMsg","MAWThreadSnippetForStickerMsg","MAWThreadSnippetForTextMsg","MAWThreadSnippetForVideoMsg","MAWThreadSnippetForXMAMsg","MAWUserJidWrapper","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return/^\d+$/.test(a)}function i(a){if(d("WAJids").isAuthorSystem(a))return;a=d("WAJids").isAuthorMe(a)?d("WAJids").userIdFromJid(d("MAWUserJidWrapper").getMyUserJid()):d("WAJids").userIdFromJid(a);if(!h(a)){c("FBLogger")("messenger_web").mustfix("[MAWThreadSnippetBuildTxns] Snippet sender contact id is invalid");return}return a}function a(a){var b=a.chatJid;a=a.dbMsg;b=d("WAJids").switchOnMsgrChatJidType(b,{group:function(a){return!0},user:function(a){return!1}});var e=i(a.author);switch(a.type){case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return c("MAWThreadSnippetForCiphertextMsg")(e);case d("MAWMsgType").MSG_TYPE.TEXT:return c("MAWThreadSnippetForTextMsg")(a,e,b);case d("MAWMsgType").MSG_TYPE.IMAGE:return c("MAWThreadSnippetForImageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.VIDEO:return c("MAWThreadSnippetForVideoMsg")(a,e);case d("MAWMsgType").MSG_TYPE.PTT:return c("MAWThreadSnippetForPttMsg")(a,e);case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return c("MAWThreadSnippetForAdminOrEphemeralMsg")(a,e);case d("MAWMsgType").MSG_TYPE.GIF:return c("MAWThreadSnippetForGifMsg")(a,e);case d("MAWMsgType").MSG_TYPE.STICKER:return c("MAWThreadSnippetForStickerMsg")(a,e);case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return c("MAWThreadSnippetForDocumentFileMsg")(a,e);case d("MAWMsgType").MSG_TYPE.REVOKED:return c("MAWThreadSnippetForRevokedMsg")(a,e);case d("MAWMsgType").MSG_TYPE.XMA:return c("MAWThreadSnippetForXMAMsg")(a,e);case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return c("MAWThreadSnippetForBumpExistingMessageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return c("MAWThreadSnippetForFallbackMessageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return c("MAWThreadSnippetForReceiverFetchMsg")(a,e);case d("MAWMsgType").MSG_TYPE.RAVEN:return c("MAWThreadSnippetForRavenMsg")(a,e);default:return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:e,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET}}}function b(a,b){a=d("WAJids").switchOnMsgrChatJidType(a,{group:function(a){return!0},user:function(a){return!1}});return j(b,a)}function j(a,b){var e=i(a.author);switch(a.type){case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return c("MAWThreadSnippetForCiphertextMsg")(e);case d("MAWMsgType").MSG_TYPE.TEXT:return c("MAWThreadSnippetForTextMsg")(a,e,b);case d("MAWMsgType").MSG_TYPE.IMAGE:return c("MAWThreadSnippetForImageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.VIDEO:return c("MAWThreadSnippetForVideoMsg")(a,e);case d("MAWMsgType").MSG_TYPE.PTT:return c("MAWThreadSnippetForPttMsg")(a,e);case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return c("MAWThreadSnippetForAdminOrEphemeralMsg")(a,e);case d("MAWMsgType").MSG_TYPE.GIF:return c("MAWThreadSnippetForGifMsg")(a,e);case d("MAWMsgType").MSG_TYPE.STICKER:return c("MAWThreadSnippetForStickerMsg")(a,e);case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return c("MAWThreadSnippetForDocumentFileMsg")(a,e);case d("MAWMsgType").MSG_TYPE.REVOKED:return c("MAWThreadSnippetForRevokedMsg")(a,e);case d("MAWMsgType").MSG_TYPE.XMA:return c("MAWThreadSnippetForXMAMsg")(a,e);case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return c("MAWThreadSnippetForBumpExistingMessageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return c("MAWThreadSnippetForFallbackMessageMsg")(a,e);case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return c("MAWThreadSnippetForReceiverFetchMsg")(a,e);case d("MAWMsgType").MSG_TYPE.RAVEN:return c("MAWThreadSnippetForRavenMsg")(a,e);default:return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:e,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET}}}g.getSnippetContactId=i;g.buildThreadSnippetV2=a;g.buildThreadSnippet=b}),98);
__d("WAProtocolMsgId",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.externalId===b.externalId&&a.author===b.author&&a.chat===b.chat}f.equals=a}),66);
__d("MAWThreadSnippetBuildTxns",["FBLogger","MAWDbMsg","MAWDbMsgOrReaction","MAWDbReaction","MAWDexieTable","MAWJidUtils","MAWLocalizationType","MAWThreadSnippet","MAWThreadSnippetUtils","MAWUserJidWrapper","WAJids","WAProtocolMsgId","WATimeUtils","emptyFunction","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){return d("WAJids").switchOnMsgrChatJidType(c,{group:function(c){return i(a,b,!0)},user:function(c){return i(a,b,!1)}})}function a(a,b){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstored(b,{forMessage:function(b){return d("MAWThreadSnippet").buildThreadSnippet(a,b)},forReaction:function(a){a=d("MAWDbReaction").castToIncomingDbReaction(a);return h(a.author,a.reaction,a.threadJid)}})}function i(a,b,e){var f;d("WAJids").isAuthorMe(a)?(c("FBLogger")("messenger_web").warn("[MAWThreadSnippetBuildTxns] Reaction snippet author should not be @me"),f=d("WAJids").userIdFromJid(d("MAWUserJidWrapper").getMyUserJid())):f=d("WAJids").userIdFromJid(a);a={contactIDs:[],strings:[]};e=e?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE_IN_GROUP:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE;a.contactIDs.push(f);a.strings.push(b);return{snippetParams:a,snippetSenderContactId:f,snippetType:e}}function b(a,b,e,f){var g=e.newestReaction,h=e.reactionsToClear;if(g!=null&&d("WATimeUtils").castUnixTimeToMillisTime(g.ts)>((e=b.snippetMsgTs)!=null?e:0))return d("MAWDexieTable").dexieResolve({newestReaction:g,thread:j(b,g,f)});e=c("justknobx")._("2763")?h!=null&&h.length>0:h!=null;return e&&b.snippetMsg!=null?a.reactions.get({reactionId:b.snippetMsg}).then(function(c){var e=!1;if(c==null)e=!0;else{var f=d("MAWJidUtils").maybeToProtocolMsgId(c.author,c.threadJid,c.reactToExternalId);f!=null&&(e=h.some(function(a){a=d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.reactToExternalId);return a!=null&&d("WAProtocolMsgId").equals(a,f)}))}return e?k(a,b).then(function(a){return{newestReaction:null,thread:a}}):d("MAWDexieTable").dexieResolve({newestReaction:null,thread:b})}):d("MAWDexieTable").dexieResolve({newestReaction:null,thread:b})}function j(a,b,c){return babelHelpers["extends"]({},a,{snippetMsg:b.reactionId,snippetMsgTs:d("WATimeUtils").castUnixTimeToMillisTime(b.ts)})}function k(a,b){return d("MAWThreadSnippetUtils").recalculateSnippetFromScratch_EXPENSIVE(a,b).then(function(a){if(a==null){c("FBLogger")("messenger_web").mustfix("[Occamadillo] ThreadUpdated handler called for clear snippet when centralized thread bump is enabled");return babelHelpers["extends"]({},b,{snippetMsg:void 0,snippetMsgTs:void 0})}var e=d("WATimeUtils").castUnixTimeToMillisTime(d("MAWDbMsg").getCanonicalTsFromMsg(a));return babelHelpers["extends"]({},b,{snippetMsg:a.msgId,snippetMsgTs:e})})}function e(a,b){return k(a,b).then(function(b){return a.threads.put(b).then(c("emptyFunction"))})}g.buildReactionThreadSnippet=h;g.buildThreadSnippetForMsgOrIncomingReaction=a;g.getReactionSnippetParams=i;g.getThreadChangesetForReactionChanges=b;g.getThreadChangesetForNewReaction=j;g.refreshThreadSnippet=e}),98);
__d("MAWEphemeralMsgUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){return function(b){return!a.has(b.msgId)&&b.ephemeralMsgDisappeared!==!0}}f.filterNonExpiredMsg=a}),66);
__d("MAWThreadSnippetUtils",["MAWDbReaction","MAWDexieTable","MAWEphemeralMsgUtils","MAWJidUtils","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWThreadNewestMsgOrReactionUtils","MAWThreadSnippet","MAWThreadSnippetBuildTxns","MAWXMAUtils","MWThreadListConsts","qex"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b;if(j(a))return!0;b=((b=a.msgContent)==null?void 0:b.adminType)!=null?d("MAWLocalizationUtils").isDeviceChangeAdminMsg(a.msgContent.adminType):!1;if(a.type!==d("MAWMsgType").MSG_TYPE.ADMIN)return!1;a=a.msgContent.adminType;return a===d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG?!0:b}function a(a,b,c){return a.messages.where("[threadJid+sortOrderMs]").between([b.jid,Number.MIN_SAFE_INTEGER],[b.jid,Number.MAX_SAFE_INTEGER],!1,!1).filter(function(a){return(c==null||d("MAWEphemeralMsgUtils").filterNonExpiredMsg(c)(a))&&!h(a)}).reverse().first()}var i={snippetParams:{contactIDs:[],mentionJIDs:[],strings:[]},snippetSenderContactId:null,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.EMPTY_SNIPPET};function b(a,b){return d("MAWThreadNewestMsgOrReactionUtils").getNewestMsgOrReactionForSnippet(a,b).then(function(c){return c==null?{snippet:i}:l(a,b).then(function(a){var d=k(b,c);return d==null?d:babelHelpers["extends"]({},d,{snippetNewestIncomingMsgsMetadata:a})})})}function j(a){return d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType)||d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType)}function k(a,b){if(b.reactionId!=null){var c=d("MAWDbReaction").maybeCastToIncomingDbReaction(b);return c==null?{snippet:i}:{snippet:d("MAWThreadSnippetBuildTxns").buildReactionThreadSnippet(c.author,c.reaction,a),snippetMsgOrReaction:b}}switch(b.type){case d("MAWMsgType").MSG_TYPE.XMA:c=d("MAWJidUtils").toProtocolMsgId(b);return c==null?{snippet:i}:{snippet:d("MAWThreadSnippet").buildThreadSnippetV2({chatJid:b.threadJid,dbMsg:b}),snippetMsgOrReaction:b};default:return{snippet:d("MAWThreadSnippet").buildThreadSnippetV2({chatJid:b.threadJid,dbMsg:b}),snippetMsgOrReaction:b}}}function l(a,b){var e;e=(e=c("qex")._("1213"))!=null?e:!1;return!e?d("MAWDexieTable").dexieResolve(void 0):d("MAWThreadNewestMsgOrReactionUtils").getNewestIncomingMsgsForSnippet({db:a,jid:b,limit:d("MWThreadListConsts").SNIPPET_MAX_NEWEST_INCOMING_MESSAGES_COUNT}).then(function(a){return a.length===0?void 0:a.map(function(a){return{externalId:a.externalId,sortOrderMs:a.sortOrderMs}})})}g.isDbMsgDisabledForThreadSnippet=h;g.recalculateSnippetFromScratch_EXPENSIVE=a;g.EMPTY_SNIPPET_DATA=i;g.getThreadSnippetFromScratch=b;g.shouldIgnoreXMAMsgForSnippet=j}),98);
__d("MAWDbAppMeta",[],(function(a,b,c,d,e,f){"use strict";a={allowSecurityAlert:"allowSecurityAlert",allowSecurityAlertForSelf:"allowSecurityAlertForSelf",dbMigrationVersion:"dbMigrationVersion",deviceJid:"deviceJid",hasMigratedFromDexie:"hasMigratedFromDexie",hmacKey:"hmacKey",hotlikeSticker:"hotlikeSticker",isBackfilledForOccamadillo:"isBackfilledForOccamadillo",msgTypeVersion:"msgTypeVersion",restoreMigrationAttempts:"restoreMigrationAttempts",restoreToDexieMigrationComplete:"restoreToDexieMigrationComplete"};f.AppMetaKeysEnum=a}),66);
__d("MAWDBMigrationUtils",["MAWDbAppMeta","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a={batchSize:0,cursorValue:0,isRunning:!1};var h={version:0};b=d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READONLY},"getMigrationVersion",function(a){return function(){return a.appMeta.get(d("MAWDbAppMeta").AppMetaKeysEnum.dbMigrationVersion).then(function(a){a=(a=a==null?void 0:a.value.dbMigrationVersion)!=null?a:0;h.version=a;return a})}});c=6;g.mawDbDedupeMsgsMigrationStatus=a;g.mawDbMigrationVersion=h;g.getMigrationVersion=b;g.MAWDB_DEDUPE_MSGS_MIGRATION_VERSION=c}),98);
__d("MAWLoadReplyMediaTxns",["MAWBridgeReceiverFetchInfo","MAWDbMedia","MAWDbMsg","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWMediaUtils","MAWMsgType","MAWUserJidWrapper","MAWXMAUtils","MWPBumpEntityKey","WAAssertUnreachable","WAJids","WALogger","WAMsgType","WAResultOrError","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n;function o(a,b,e){if(c("gkx")("2419")&&e!=null){e=d("MAWMediaUtils").genHMACPlaintextHash(e);return a.media.where("hashedPlaintextHash").equals(e).first()}else return a.media.get(b)}var p=new Set([(e=d("MAWDbMedia")).MEDIA_TYPE.IMAGE,e.MEDIA_TYPE.GIF,e.MEDIA_TYPE.PTT,e.MEDIA_TYPE.STICKER,e.MEDIA_TYPE.VIDEO,e.MEDIA_TYPE.DOCUMENT_FILE]);function q(a){var b;switch(a.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:case d("MAWDbMedia").MEDIA_TYPE.GIF:case d("MAWDbMedia").MEDIA_TYPE.STICKER:b=a.validatedImageInfo;break;case d("MAWDbMedia").MEDIA_TYPE.VIDEO:b=a.validatedVideoInfo;break}a=b||{};var c=a.height,e=a.jpegThumbnailHeight,f=a.jpegThumbnailWidth;a=a.width;return{replyMediaPreviewHeight:e!=null?e:c,replyMediaPreviewWidth:f!=null?f:a}}function r(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return!0;case d("MAWMsgType").MSG_TYPE.XMA:if(c("gkx")("9921"))return!0;else return d("MAWXMAUtils").isXMAShare_DO_NOT_USE(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType);case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("WAMsgType").NOTE_REPLY:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RAVEN:return!1;default:return c("WAAssertUnreachable")(a.type)}}function s(a,b,c){if(b==null)return d("MAWDexieTable").dexieResolve();a=o(a,b,c).then(function(a){if(a==null)return d("WAResultOrError").makeError("reply_media_not_found");if(!p.has(a.mediaType))return d("WAResultOrError").makeError("reply_media_type_unknown");var c=q(a),e=c.replyMediaPreviewHeight;c=c.replyMediaPreviewWidth;b!=null&&a.plaintextHash==null&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("maw.reply_attachment_media_missing_plaintext_hash","load_reply_media_txns_for_reply_type_'unknown'}");return d("WAResultOrError").makeResult({replyMediaId:b,replyMediaPreviewHeight:e,replyMediaPreviewWidth:c,replyPlaintextHash:a.plaintextHash})});return a.then(function(a){if(a.success!==!0){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Unable to fetch reply media with id ",": ",""])),b,a.error);return}return a.value})}function t(a,b){var c=b.defaultPreviewMediaId;if(c==null)return d("MAWDexieTable").dexieResolve({replyXMAId:b.xmaId});a=o(a,c).then(function(a){if(a==null)return d("WAResultOrError").makeError("reply_xma_media_not_found - "+b.targetType);if(!p.has(a.mediaType))return d("WAResultOrError").makeError("reply_xma_media_type_unknown");var c=q(a),e=c.replyMediaPreviewHeight;c=c.replyMediaPreviewWidth;return d("WAResultOrError").makeResult({replyMediaPreviewHeight:e,replyMediaPreviewWidth:c,replyPlaintextHash:a.plaintextHash,replyXMAId:b.xmaId})});return a.then(function(a){if(a.success!==!0){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Unable to fetch reply media XMA with id ",": ",""])),b.xmaId,a.error);return}return a.value})}function a(a,b,e){var f,g;e===void 0&&(e=!1);f=((f=b.quote)==null?void 0:f.content)||{};var h=f.author,i=f.externalId,j=f.mediaId,k=f.msgId,l=f.plaintextHash,m=f.type;f=f.xmaMessageType;if(((g=b.quote)==null?void 0:g.content)==null||!r((g=b.quote)==null?void 0:g.content))return d("MAWDexieTable").dexieResolve();g=b.threadJid;b=h===d("MAWUserJidWrapper").getMyUserJid();b=b?d("WAJids").AUTHOR_ME:h;if(c("gkx")("9921")?m===d("MAWMsgType").MSG_TYPE.XMA:d("MAWXMAUtils").isXMAShare_DO_NOT_USE(f))return u(a,d("MAWJidUtils").maybeToProtocolMsgId(b,g,i));return m===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH?w(a,k):s(a,j,e?null:l)}function u(a,b){return b==null?d("MAWDexieTable").dexieResolve():d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,b).then(function(b){if(b==null||d("MAWXMAUtils").isXMAExpired(b.isTombstoned,b.targetExpiringAtSec))return;return t(a,b)})}function b(a,b){var e=b.author,f=b.externalId,g=b.mediaId,h=b.plaintextHash,i=b.threadJid,j=b.type,k=b.xmaMessageType;k=c("gkx")("9921")?j===d("MAWMsgType").MSG_TYPE.XMA:d("MAWXMAUtils").isXMAShare_DO_NOT_USE(k);j=j===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH;if(!d("MAWDbMsg").isMediaMsg(b)&&!k&&!j)return d("MAWDexieTable").dexieResolve();if(k)return u(a,d("MAWJidUtils").maybeToProtocolMsgId(e,i,f));return j?v(a,b.receiverFetchId):s(a,g,h)}function v(a,b,c){if(b==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Missing receiverFetchId for getReplyMediaForReceiverFetchWithReceiverFetchId"])));return d("MAWDexieTable").dexieResolve()}return a.receiverFetchInfo.get({receiverFetchId:b}).then(function(a){if(a==null){d("WALogger").WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Missing receiverFetchInfo for getReplyMediaForReceiverFetchWithReceiverFetchId"])));return}try{var b=d("MAWDbMedia").convertNumberToMediaId(parseInt(a.receiverFetchId,10));c!=null&&d("MAWIndexedDb").afterTransaction({tag:"NewReceiverFetchInfo",value:d("MAWBridgeReceiverFetchInfo").createBridgeReceiverFetchInfoPayloadFromDbInfo(c.threadJid,c.msgId,c.sortOrderMs,c.ts,a)});return{replyMediaId:b,replyMediaPreviewHeight:a.previewHeight,replyMediaPreviewWidth:a.previewWidth}}catch(a){d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Unable to convert receiver fetch id to media id: ",""])),a);return}})}function w(a,b){if(b==null){d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Missing msgId for getReplyMediaForReceiverFetch"])));return d("MAWDexieTable").dexieResolve()}return a.messages.get({msgId:b}).then(function(b){if(b==null||b.type!==d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH||b.receiverFetchId==null){d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Invalid msg for getReplyMediaForReceiverFetch with type: ",""])),b==null?void 0:b.type);return}return v(a,b.receiverFetchId,b)})}g.getMedia=o;g.MSG_MEDIA_TYPE=p;g.getImageAttributes=q;g.isMediaReplyContent=r;g.getReplyMediaForMsgQuote=a;g.getReplyMediaForMsg=b}),98);
__d("MAWDbChunkTxns",["MAWDexieTable","MAWMediaUtils","MAWODSProxy","MWFBLogger","WAErrorMessage","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=d("MWFBLogger").MWLogger.tags(["maw_db","txn","MAWDbChunkTxns"]);b=function(a,b,c,e,f){f===void 0&&(f=0);var g=d("MAWMediaUtils").genHMACPlaintextHash(b);return m(a,b,g,c,e,f)};var m=function(a,b,c,e,f,g){g===void 0&&(g=0);return a.chunk.where("hashedPlaintextHash").equals(c).first().then(function(n){if(n){g>0&&l.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Chunk found after retry for hashedPlaintextHash: ",""])),c);return n}else{var o={blobData:e,hashedPlaintextHash:c,mimetype:f,plaintextHash:b};return a.chunk.add(o).then(function(a){return babelHelpers["extends"]({},o,{chunkId:a})})["catch"](function(h){var n=d("WAErrorMessage").maybeGetMessageFromError(h);if(g>0){l.WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk for hashedPlaintextHash: ",". Error: ",""])),c,n);l.MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk after retry. Error: ",""])),n);throw h}else{l.WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk. Possible duplicate? Will attempt a retry. For hashedPlaintextHash: ",". Error: ",""])),c,n);d("MAWODSProxy").odsBumpEntityKey({amount:1,entity:d("WAOdsEnums").Entity.MAW_MEDIA_DB_DUPLICATE_CHUNK,key:"retry"});return m(a,b,c,e,f,g+1)}})}})},n=function(a,b){return a.chunk.where("hashedPlaintextHash").equals(b)},o=function(a,b){return n(a,b).count().then(function(a){return a>0})};c=function(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){return o(a,b).then(function(a){return[b,a]})})).then(function(a){return new Map(a)})};e=function(a,b){return n(a,b).first()};f=function(a,b){return a.chunk.where("hashedPlaintextHash").anyOf(b).toArray().then(function(a){return new Map(a.map(function(a){return[a.hashedPlaintextHash,a]}))})};function a(a,b){return a.chunk.bulkGet(b)}var p=function(a,b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return a.chunk.get({hashedPlaintextHash:b})};g.getOrCreateMediaChunkWithPlaintextHash=b;g.getOrCreateMediaChunkWithHashedPlaintextHash=m;g.hasMediaChunk=o;g.hasMediaChunks=c;g.maybeGetChunkFromHash=e;g.maybeBulkGetChunksFromHash=f;g.bulkGetChunks=a;g.maybeGetChunkByPlaintextHash=p}),98);
__d("MAWDbMediaTxns",["MAWDbMsg","MAWDexieTable","MAWMediaUtils","MAWMsgType","MAWODSProxy","WAHashUtils","WALogger","WAOdsEnums","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function a(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.media.get({mediaId:b})}function b(a,b){return b.length===0?d("MAWDexieTable").dexieResolve(new Map()):a.media.bulkGet(b).then(function(a){return new Map(a.filter(Boolean).map(function(a){return[a.mediaId,a]}))})}function l(a,b){return a.media.where("hashedPlaintextHash").equals(b).first()}function e(a,b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return l(a,b)}function f(a,b){b=b.map(function(a){return d("MAWMediaUtils").genHMACPlaintextHash(a)});return m(a,b)}function m(a,b){return a.media.where("hashedPlaintextHash").anyOf(b).toArray()}function n(a,b){return b==null?d("MAWDexieTable").dexieResolve():o(a,b).then(function(c){c=c==null?void 0:c.mediaId;return c!=null?a.media.get({mediaId:c}):a.media.get({objectId:b})})}function o(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.mediaBackup.get({objectId:b})}function p(a,b){if(b==null)return d("MAWDexieTable").dexieResolve();a=a.mediaBackup.where("msgId").equals(b).toArray();return a}function q(a,b){b=b.filter(d("MAWDbMsg").isMediaMsg);if(b.length===0)return d("MAWDexieTable").dexieResolve([]);d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[getMsgMediaPairFromMsgs] msgs: ",""])),b.map(function(a){return""+a.msgId}));var e=b.reduce(function(a,b){if(b.mediaId==null){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["mediaId is null for media msg with msgId: "," and msg type ",""])),b.msgId,b.type);return a}return a.set(b.mediaId,b)},new Map());b=Array.from(e.keys());return t(a,b).then(function(a){var b=[];a.forEach(function(a){if(a==null)throw c("err")("Error missing media");var f=e.get(a.mediaId);if(f==null)throw c("err")("Error missing media");var g=d("MAWMediaUtils").genHMACPlaintextHash(a.plaintextHash);g!==a.hashedPlaintextHash&&(d("WALogger").WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[getMsgMediaPairFromMsgs] encountered mismatched hashedPlaintextHash for media. PlaintextHash: ",""])),d("WAHashUtils").sanitisePlaintextHash(a.plaintextHash)),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MEDIA_MISMATCH_HASHED_PLAINTEXT_HASH,key:"mismatch."+f.type}));b.push([f,a])});return b})}function r(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.filter(d("MAWDbMsg").isMediaMsg).map(function(a){var b=a.mediaId;if(b==null){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["mediaId is null for media msg with msgId: ",""])),a.msgId);throw c("err")("mediaId is missing")}else return b});return t(a,b).then(function(a){var b=[];a.forEach(function(a){a!=null&&b.push(a)});return b})}function s(a,b){if(b.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME||d("MAWDbMsg").isMediaMsg(b)){var c=b.mediaId;return c==null?b.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME?d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult()):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing")):a.media.get(c).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}else return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult())}function t(a,b){return a.media.bulkGet(b)}function u(a,b){var c=b.previewMediaIds!=null?t(a,b.previewMediaIds):d("MAWDexieTable").dexieResolve(),e=b.headerMediaId!=null?a.media.get(b.headerMediaId):d("MAWDexieTable").dexieResolve(),f=b.faviconMediaId!=null?a.media.get(b.faviconMediaId):d("MAWDexieTable").dexieResolve();a=b.defaultPreviewMediaId!=null?a.media.get(b.defaultPreviewMediaId):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([c,e,f,a]).then(function(a){var c=a[0],e=a[1],f=a[2];a=a[3];if(b.headerMediaId!=null&&e==null)return d("WAResultOrError").makeError("missing");if(b.faviconMediaId!=null&&f==null)return d("WAResultOrError").makeError("missing");if(c==null)return d("WAResultOrError").makeError("missing");var g=[];for(c of c)if(c==null)return d("WAResultOrError").makeError("missing");else g.push(c);return d("WAResultOrError").makeResult({defaultPreview:a,favicon:f,header:e,previews:g})})}function v(a,b,c){b=babelHelpers["extends"]({},b,c);return a.media.put(b)}g.maybeGetMediaFromMediaId=a;g.maybeBulkGetMediaFromMediaId=b;g.maybeGetMediaFromHashedPlaintextHash=l;g.maybeGetMediaFromPlaintextHash=e;g.maybeBulkGetMediaFromPlaintextHash=f;g.maybeBulkGetMediaFromHashedPlaintextHash=m;g.maybeGetMediaFromObjectId=n;g.maybeGetMediaBackupRowFromObjectId=o;g.maybeGetMediaBackupRowFromMsgId=p;g.getMsgMediaPairFromMsgs=q;g.getMediaFromMsgs=r;g.getAndCheckMediaFromMsg=s;g.bulkGetMedias=t;g.getMediaForXMA=u;g.updateMedia=v}),98);
__d("WAMsgMap",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){var b=this;this.$1=new Map();a==null||a.forEach(function(a){var c=a[0];a=a[1];b.set(c,a)})}var b=a.prototype;b.clear=function(){this.$1.clear()};b["delete"]=function(a){var b;(b=this.$1.get(a.externalId))==null||(b=b.get(a.author))==null||b["delete"](a.chat)};b.get=function(a){var b;return(b=this.$1.get(a.externalId))==null||(b=b.get(a.author))==null?void 0:b.get(a.chat)};b.has=function(a){var b;return(b=(b=this.$1.get(a.externalId))==null||(b=b.get(a.author))==null?void 0:b.has(a.chat))!=null?b:!1};b.set=function(a,b){var c,d;c=(c=this.$1.get(a.externalId))!=null?c:new Map();this.$1.has(a.externalId)||this.$1.set(a.externalId,c);d=(d=c.get(a.author))!=null?d:new Map();c.has(a.author)||c.set(a.author,d);d.set(a.chat,b);return this};b.keys=function(){var a=[],b=this.$1;for(var c of b.keys()){var d;d=(d=b.get(c))!=null?d:new Map();for(var e of d.keys()){var f;f=(f=d.get(e))!=null?f:new Map();for(f of f.keys())a.push({externalId:c,author:e,chat:f})}}return a};b.entries=function(){var a=[],b=this.$1;for(var c of b.keys()){var d;d=(d=b.get(c))!=null?d:new Map();for(var e of d.keys()){var f;f=(f=d.get(e))!=null?f:new Map();for(var g of f.keys()){var h=f.get(g);h!=null&&a.push([{externalId:c,author:e,chat:g},h])}}}return a};b.values=function(){return this.entries().map(function(a){return a[1]})};return a}();f.MsgMap=a}),66);
__d("MAWDbMsgUtil",["WAJids","WALogger","WAMsgMap"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){return a.reduce(function(a,b){var c=b.threadJid;if(c==null){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Missing jid prevents adding message to array map"])));return a}if(b.author==="@system"){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Invalid author when converting msg array to map"])));return a}a.set({author:b.author,chat:c,externalId:b.externalId},b);return a},new(d("WAMsgMap").MsgMap)())}function b(a){return d("WAJids").isAuthorSystem(a.author)||a.threadJid==null?null:{author:a.author,chat:a.threadJid,externalId:a.externalId}}g.convertMsgArrayToMap=a;g.getProtocolMsgIdFromDbMsg=b}),98);
__d("MAWDbUnrenderedMsgTxns",["MAWAckLevel","MAWDbMsg","MAWDbMsgUtil","MAWDexieTable","WAJids","WALogger","WAMsgMap","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b){var c=b.author,e=b.chat,f=b.externalId;return a.threads.get({jid:e}).then(function(b){return b==null?d("WAResultOrError").makeError("missing_thread_unrendered_msg"):k(a,f,e,c).then(function(a){return a==null?d("WAResultOrError").makeError("missing_unrendered_msg"):d("WAResultOrError").makeResult(a)})})}function b(a,b){var c=b.map(function(a){a=a.externalId;return a});return a.unrenderedMessages.where("externalId").anyOf(c).toArray().then(function(a){var c=d("MAWDbMsgUtil").convertMsgArrayToMap(a),e=new(d("WAMsgMap").MsgMap)();b.forEach(function(a){var b=c.get(a);b!=null&&e.set(a,b)});return e})}function k(a,b,c,d){return a.unrenderedMessages.where("externalId").equals(b).filter(function(a){return a.author===d&&a.threadJid===c}).first()}function l(a,b){return a+"_"+b}function c(a,b){var c=b.map(function(a){a=a.externalId;return a}),e=Array.from(new Set(b.map(function(a){return a.chat})));return d("MAWDexieTable").dexieAll([a.threads.where("jid").anyOf(e).toArray(),a.unrenderedMessages.where("externalId").anyOf(c).toArray()]).then(function(a){var c=a[0];a=a[1];if(a.length===0||c.length===0)return[];var d=new Map();b.forEach(function(a){var b=a.author,c=a.chat;a=a.externalId;var e=d.get(a)||new Set();e.add(l(b,c));d.set(a,e)});return a.filter(function(a){var b=a.author,c=a.externalId;a=a.threadJid;c=d.get(c);return c!=null&&a!=null&&c.has(l(b,a))})})}function e(a,b,c){return m(a,[{ack:c,msgId:b}]).then(function(a){a=a[0];if(a==null){d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["updateSystemAckForUnrenderedMsg on non existing message"])));return null}return a})}function m(a,b){var c=b.map(function(a){return a.msgId}),e=new Map();b.forEach(function(a){return e.set(a.msgId,{ack:a.ack})});return a.unrenderedMessages.where("msgId").anyOf(c).toArray().then(function(b){if(b.length===0)return b;var c=[],f=[];b.forEach(function(a){var b;if(a.author!==d("WAJids").AUTHOR_ME){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on incoming message"])));c.push(a);return}if(a.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on sent message"])));c.push(a);return}b=(b=e.get(a.msgId))==null?void 0:b.ack;if(b==null)return null;a=babelHelpers["extends"]({},a,{ack:b});b===d("MAWAckLevel").ACK.sent&&delete a.resendCount;f.push(a)});return a.unrenderedMessages.bulkPut(f).then(function(){return[].concat(f,c)})})}function f(a,b){b=b.map(function(b){return a.unrenderedMessages.get({msgId:b})});return d("MAWDexieTable").dexieAll(b)}function n(a,b){return a.unrenderedMessages.where("msgId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").msgIdsInChatUpperBound(b.chatId)).last().then(function(a){a=a==null?0:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.msgId);return a+1})}g.maybeGetUnrenderedMsgByProtocolMsgId=a;g.getUnrenderedMsgMapByProtocolMsgId=b;g.maybeGetUnrenderedMsgByExternalId=k;g.getUnrenderedMsgsByProtocolMsgId=c;g.updateSystemAckForUnrenderedMsg=e;g.bulkUpdateSystemAckForUnrenderedMsgs=m;g.getUnrenderedMsgsByMsgIds=f;g.getNextUnrenderedMsgIdNumberForThread=n}),98);
__d("MAWMessageSortOrderUtils",["I64","MAWDbMsg","MAWExtractMsFromExternalId","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l;function a(a){var b=a.revokedExternalId!=null?a.revokedExternalId:a.externalId;b==null&&d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["generateAuthoritativeMessageSortOrder called without ID"])));b=(l||(l=d("I64"))).of_string_opt(b);if(a.serverTs==null){var c;if(a.sortOrderMs!=null)return a.sortOrderMs;b==null&&d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] ExternalId is not present"])));var e=b==null?null:d("MAWExtractMsFromExternalId").extractMsFromExternalId(b);return Math.floor((c=a.originalTs)!=null?c:d("MAWDbMsg").getCanonicalTsFromMsg(a))*1e3+(e!=null?e:0)}if(b!=null){c=d("MAWExtractMsFromExternalId").extractMsFromExternalId(b);if(c!=null){e=a.originalTs!=null?a.originalTs:a.serverTs;return Number(e)*1e3+c}else d("WALogger").WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] Timestamp bits in externalId not valid"])))}else d("WALogger").WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] externalId is not a valid int64"])));return d("MAWDbMsg").getSortOrderWithFallback(a)}g.generateAuthoritativeMessageSortOrder=a}),98);
__d("WAArrayGroupBy",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=new Map();for(var d=0;d<a.length;d++){var e=b(a[d]),f=c.get(e);f==null?c.set(e,[a[d]]):f.push(a[d])}return Array.from(c.entries())}f.groupBy=a}),66);
__d("MAWDbMsgTxns",["EncryptedBackupsUtils","FBLogger","MAWAckLevel","MAWBridgeMsg","MAWDbMsg","MAWDbMsgUtil","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWMessageSortOrderUtils","MAWMsgType","MAWODSProxy","MAWTransactionMode","MAWTransactor","Random","WAArrayGroupBy","WAJids","WALogger","WAMsg","WAMsgMap","WAOdsEnums","WAResultOrError","WATimeUtils","emptyFunction","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q;function a(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.messages.get({msgId:b})}function b(a,b){return a.messages.where("threadJid").equals(b).count().then(function(a){return a===0})}function e(a,b,c){return a.messages.where("threadJid").equals(b).filter(c).first().then(function(a){return a!=null})}function r(a,b,c,d){return a.messages.where(["threadJid","sortOrderMs"]).between([b,Number.MIN_SAFE_INTEGER],[b,Number.MAX_SAFE_INTEGER],c,d)}function s(a,b){return r(a,b,!1,!1).last()}function f(a,b){return s(a,b).then(function(a){return a==null?void 0:a.msgId})}function t(a,b){return s(a,b).then(function(a){return(a==null?void 0:a.sortOrderMs)==null?null:d("WATimeUtils").castToMillisTime(a.sortOrderMs)})}function u(a,b,c){return r(a,b,!1,!1).reverse().limit(c).toArray()}function v(a,b){return r(a,b,!1,!1).first()}function w(a,b){return v(a,b).then(function(a){return a==null?void 0:a.msgId})}function x(a,b){return a.messages.where("externalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).toArray().then(z)}function y(a,b){var c=new Set(b.map(function(a){var b=a.author,c=a.chat;a=a.externalId;return d("WAMsg").craftWAMsgIdString({author:b,chat:c,externalId:a})}));return a.messages.where("externalId").anyOf(b.map(function(a){a=a.externalId;return a})).filter(function(a){var b=a.author,e=a.externalId;a=a.threadJid;return c.has(d("WAMsg").craftWAMsgIdString({author:b,chat:a,externalId:e}))}).toArray().then(function(a){return d("WAArrayGroupBy").groupBy(a,function(a){return d("WAMsg").craftWAMsgIdString({author:a.author,chat:a.threadJid,externalId:a.externalId})}).map(function(a){a[0];a=a[1];return z(a)}).filter(Boolean)})}function z(a){if(a.length>1){var b=a.map(function(a){var b;return a.type+":"+((b=a.serverTs)!=null?b:0).toString()+":"+((b=a.ts)!=null?b:0).toString()});b=new Set(b).size===1;!b?d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByProtocolMsgId] Can't have "," messages with the same protocolMsgId!"])),a.length):d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByProtocolMsgId] Suspected multiple instances of same message!"])));(c("gkx")("5039")||d("Random").coinflip(c("justknobx")._("3594")))&&A(a)}return a[0]}function A(a){var b=a.length;if(b<=1)return;var e=b-1,f=a[e],g={editCount:0,mediaId:0,revokedStatus:0,serverTs:0,sortOrderMs:0,ts:0,type:0};a.slice(0,e).forEach(function(a){var b=[];if((a==null?void 0:a.editCount)!==(f==null?void 0:f.editCount)){var e;g.editCount++;b.push("editCount, reference: "+((e=f==null?void 0:f.editCount)!=null?e:"")+", duplicate: "+((e=a==null?void 0:a.editCount)!=null?e:"")+". ")}(a==null?void 0:a.mediaId)!==(f==null?void 0:f.mediaId)&&(g.mediaId++,b.push("mediaId, reference: "+((f==null?void 0:f.mediaId)!=null?String(f.mediaId):"")+", duplicate: "+((a==null?void 0:a.mediaId)!=null?String(a.mediaId):"")+". "));a.sortOrderMs!==f.sortOrderMs&&(g.sortOrderMs++,b.push("sortOrderMs, reference: "+String(f.sortOrderMs)+", duplicate: "+String(a.sortOrderMs)+". "));a.serverTs!==f.serverTs&&(g.serverTs++,b.push("serverTs, reference: "+String(f.serverTs)+", duplicate: "+String(a.serverTs)+". "));a.ts!==f.ts&&(g.ts++,b.push("ts, reference: "+String(f.ts)+", duplicate: "+String(a.ts)+". "));if(a.type!==f.type){(a.type===d("MAWMsgType").MSG_TYPE.REVOKED||f.type===d("MAWMsgType").MSG_TYPE.REVOKED)&&(g.revokedStatus++,c("FBLogger")("MAWDuplicateMessageComparison").info("Revoked duplicate msg conflict, duplicate message, %s, has type: %s, externalId: %s, revokedExternalId: %s, sortOrderMs: %s, serverTs: %s, ts: %s, rowId: %s, reference msg, %s, has type: %s, externalId: %s, revokedExternalId: %s, sortOrderMs: %s, serverTs: %s, ts: %s, rowId: %s",a.msgId,a.type,a.externalId,a.revokedExternalId,a.sortOrderMs,a.serverTs,a.ts,a.rowId,f.msgId,f.type,f.externalId,f.revokedExternalId,a.sortOrderMs,a.serverTs,a.ts,a.rowId));g.type++;b.push("type, reference: "+((e=f.type)!=null?e:"")+", duplicate: "+((e=a.type)!=null?e:"")+". ")}e=b.join("");e.length>0?c("FBLogger")("MAWDuplicateMessageComparison").info("Duplicate msg, %s, has conflicting field values to reference msg, %s: %s",a.msgId,f.msgId,e):c("FBLogger")("MAWDuplicateMessageComparison").info("Duplicate msg, %s, has no conflicting field values to reference msg, %s",a.msgId,f.msgId)});d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"sets_of_duplicate_msgs"});Object.keys(g).forEach(function(a){var b=g[a];b>0&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"sets_of_duplicate_msgs_with_"+a+"_field_differences"})});d("MAWODSProxy").odsBumpEntityKey({amount:b-1,entity:d("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"number_of_duplicate_msgs"});Object.keys(g).forEach(function(a){var b=g[a];b>0&&d("MAWODSProxy").odsBumpEntityKey({amount:b,entity:d("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"number_of_duplicate_msgs_with_"+a+"_field_differences"})})}function B(a,b,c,d){d={author:d,chat:c,externalId:b};return x(a,d)}function C(a,b){return a.messages.where("msgId").equals(b).toArray()}function D(a,b){return G(a,b).then(function(a){return a.success?a:a})}function E(a,b){var c=b.map(function(a){a=a.externalId;return a});return a.messages.where("externalId").anyOf(c).toArray().then(function(a){var c=d("MAWDbMsgUtil").convertMsgArrayToMap(a),e=new(d("WAMsgMap").MsgMap)();b.forEach(function(a){var b=c.get(a);b!=null&&e.set(a,b)});return e})}function F(a,b){return a.messages.where("msgId").equals(b).first().then(function(a){return a==null?void 0:a.sortOrderMs})}function G(a,b){var c=b.author,e=b.chat,f=b.externalId;return a.threads.get({jid:e}).then(function(b){return b==null?d("WAResultOrError").makeError("missing_thread_msg"):B(a,f,b.jid,c).then(function(a){return a==null?d("WAResultOrError").makeError("missing_msg"):d("WAResultOrError").makeResult(a)})})}function H(a,b){var c=b.author,d=b.chat,e=b.externalId;return a.threads.get({jid:d}).then(function(b){if(b==null)return;return a.messages.where("revokedExternalId").equals(e).filter(function(a){return a.author===c&&a.threadJid===b.jid&&a.type==="Revoked"}).first()})}function I(a,b,c,e){var f=a.messages.where("revokedExternalId").equals(b).filter(function(a){return a.author===e&&a.threadJid===c&&a.type===d("MAWMsgType").MSG_TYPE.REVOKED}).first();a=d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByExternalId(a,b,c,e).then(function(a){if((a==null?void 0:a.type)===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)return a});return d("MAWDexieTable").dexieAll([f,a]).then(function(a){var b=a[0];a=a[1];return b!=null||a!=null})}function J(a,b){var c=new Array(b.length),e=new Set();b.forEach(function(a){c.push(a.externalId),e.add(d("EncryptedBackupsUtils").convertWAMsgIdToStringId(a))});return a.messages.where("externalId").anyOf(c).filter(function(a){return e.has(d("EncryptedBackupsUtils").convertWAMsgIdToStringId({author:a.author,chat:a.threadJid,externalId:a.externalId}))}).toArray()}function K(a,b,c,e,f,g){return L(a,[{ack:c,applicationErrorCode:g,msgId:b,reportingMeta:f,serverTs:e}]).then(function(a){a=a.find(function(a){return a.msgId===b});if(a==null){d("WALogger").LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["updateSystemAck on non existing message"])));return null}return a})}function L(a,b){var e=b.map(function(a){return a.msgId});return d("MAWDbXMATxns").getXMAMsgIdsFromAssociatedMsgIds(a,e).then(function(f){var g=new Map();b.forEach(function(a){g.set(a.msgId,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,reportingMeta:a.reportingMeta,serverTs:a.serverTs});var b=f.get(a.msgId);b!=null&&g.set(b,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,reportingMeta:a.reportingMeta,serverTs:a.serverTs})});var h=Array.from(new Set(e.concat(Array.from(f.values()))));return a.messages.where("msgId").anyOf(h).toArray().then(function(b){if(b.length===0)return b;var e=[],f=[];b.forEach(function(a){var b,h;if(a.author!==d("WAJids").AUTHOR_ME||a.ack>d("MAWAckLevel").ACK.clock){e.push(a);return}b=(b=g.get(a.msgId))==null?void 0:b.ack;h=(h=g.get(a.msgId))==null?void 0:h.serverTs;if(b==null)return null;var i=babelHelpers["extends"]({},a,{ack:b});M(i,h);h=(h=g.get(a.msgId))==null?void 0:h.reportingMeta;h!=null&&(i.reportingMeta=h);h=c("gkx")("7471");if(h){a=(h=g.get(a.msgId))==null?void 0:h.applicationErrorCode;a!=null&&(i.applicationErrorCode=a)}b===d("MAWAckLevel").ACK.sent&&delete i.resendCount;f.push(i)});e.length>0&&d("WALogger").LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck: not updating ",""])),e.map(function(a){return a.msgId}).toString());return a.messages.bulkPut(f).then(function(){return d("MAWDexieTable").dexieAll(f.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)}))}).then(function(a){f.forEach(function(b,c){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b,void 0,a[c],void 0)})});return[].concat(f,e)})})})}function M(a,b){if(b==null)return;a.serverTs=b;var e=a.sortOrderMs;if(a.type===d("MAWMsgType").MSG_TYPE.REVOKED&&c("justknobx")._("3841"))return;a.sortOrderMs=d("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder(a);d("WALogger").LOG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Message was acked by server (serverTs = ","), override sortOrderMs: "," -> ",""])),b,e,a.sortOrderMs)}function N(a,b,e,f){return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success||f==null)return;var g=b.value;b=[a.messages.where(["threadJid","sortOrderMs"]).above([g.jid,f]).first(),a.messages.where(["threadJid","sortOrderMs"]).below([g.jid,f]).last()];return d("MAWDexieTable").dexieAll(b).then(function(b){var f=b[0];b=b[1];return d("MAWDbThreadTxns").updateThread(a,babelHelpers["extends"]({},g,{newestMsgTs:(b==null?void 0:b.ts)==null?g.newestMsgTs:d("WATimeUtils").castUnixTimeToMillisTime(b.ts),oldestMsg:g.oldestMsg===e?f==null?void 0:f.msgId:g.oldestMsg})).then(c("emptyFunction"))})})}function O(a){return a.messages.where("altIndex").equals(d("MAWDbMsg").FUTUREPROOF_ALT_INDEX).toArray().then(function(a){var b=[];a.forEach(function(a){if(a.type!==d("MAWMsgType").MSG_TYPE.FUTUREPROOF){d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["getFutureproofMsg gets a message "," with unsupported type ",""])),a.msgId,a.type);return}b.push(a)});return b})}function P(a){return a.toString()}function Q(a,b,e,f){var g=b.mediaId;if(g===e){d("WALogger").LOG(n||(n=babelHelpers.taggedTemplateLiteralLoose(["updateMediaId on message "," that already has this mediaId ",""])),b.msgId,e);return d("MAWDexieTable").dexieResolve()}g=g!=null?a.media.get(g):d("MAWDexieTable").dexieResolve();return g.then(function(g){g&&d("WALogger").ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Replacing mediaId for message with pre-existing media. type=",""])),b.type);g=f!=null?f:void 0;g=babelHelpers["extends"]({},b,{mediaId:e,plaintextHash:g});return a.messages.put(g).then(c("emptyFunction"))})}function R(a,b){var e=Array.from(b.keys());return a.messages.where("msgId").anyOf(e).toArray().then(function(e){var f=[];e.map(function(a){var e=b.get(a.msgId),g=a.mediaId;if(g!=null&&g!==e){if(e!=null)throw c("FBLogger")("messenger_web").mustfixThrow("mediaId "+P(g)+" in message "+a.msgId+" is different with the "+P(e)+" in bulkUpdateMediaId");d("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["updateMediaId on message "," that already has this mediaId ",""])),a.msgId,e);return}g=babelHelpers["extends"]({},a,{mediaId:e,plaintextHash:a.plaintextHash});f.push(g)});return a.messages.bulkPut(f).then(c("emptyFunction"))})}function S(a,b){return T(a,[b]).then(c("emptyFunction"))}function T(a,b){return a.messages.where("msgId").anyOf(b).toArray().then(function(b){var c=b.map(function(a){return babelHelpers["extends"]({},a,{isExpiredXmaMsg:!0})});return a.messages.bulkPut(c).then(function(){return c})})}function U(a,b,c,e){if(e!=null&&e<=0)return d("MAWDexieTable").dexieResolve([]);a=a.messages.where("altIndex").equals(d("MAWDbMsg").craftToBeReadAltIndex(b)).filter(function(a){return d("MAWDbMsg").getSortOrderWithFallback(a)<=c});e!=null&&(a=a.limit(e));return a.toArray()}function V(a,b,c){return U(a,b,c).then(function(b){var c=b.map(function(a){return babelHelpers["extends"]({altIndex:null},a)});return a.messages.bulkPut(c).then(function(){return c})})}function W(a,b){return a.messages["delete"](b)}function X(a,b){return a.messages.bulkDelete(b)}function Y(a,b,c){var e=b.map(function(a){return a.rowId});b=c!=null?b.map(function(a){a=d("MAWJidUtils").toProtocolMsgId(a);if(!a)return;return babelHelpers["extends"]({},a,{reason:c})}).filter(Boolean):[];return d("MAWDexieTable").dexieAll([a.deletedMessages.bulkAdd(b),a.messages.bulkDelete(e)]).then(function(a){a[0];a=a[1];d("WALogger").LOG(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Successfull deleted "," messages"])),a)})}function Z(a,b){return a.messages.where("msgId").anyOf(b).toArray()}function aa(a){return a.messages.where("altIndex").anyOf([d("MAWDbMsg").SPAM_ALT_INDEX,d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX]).toArray()}function ba(a,b,c,e,f,g,h,i){h===void 0&&(h="before");i===void 0&&(i=null);c=c==null?null:d("MAWDbMsg").getSortOrderWithFallback(c);if(h==="before")return a.messages.where(["threadJid","sortOrderMs"]).between([b,i!=null?i:Number.MIN_SAFE_INTEGER],[b,c!=null?c:Number.MAX_SAFE_INTEGER],!0,e).reverse().filter(g).limit(f).toArray();else return a.messages.where(["threadJid","sortOrderMs"]).between([b,c!=null?c:Number.MIN_SAFE_INTEGER],[b,i!=null?i:Number.MAX_SAFE_INTEGER],e,!0).filter(g).limit(f).toArray().then(function(a){return a.sort(function(a,b){return b.ts-a.ts})})}function ca(a,b,c,d){var e=c.msgId;if(d==null){var f;return{oldestMsg:(f=a==null?void 0:a.msgId)!=null?f:e}}f=[a,b,c].filter(Boolean);return{oldestMsg:f.reduce(function(a,b){return $(a,e,d)<$(b,e,d)?a:b}).msgId}}function $(a,b,c){return a.msgId===b?c:d("MAWDbMsg").getSortOrderWithFallback(a)}function da(a,b){return a.messages.where("msgId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").msgIdsInChatUpperBound(b.chatId)).last().then(function(a){a=a==null?0:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.msgId);return a+1})}function ea(a){return d("MAWTransactor").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY},"checkMessagesExistenceByProtocolMsgIds",function(b){return function(){return d("MAWDexieTable").dexieAll(a.map(function(a){return b.messages.get({protocolMsgId:a.chat+"."+a.externalId})}))}})()}function fa(a,b){return a.messages.where("externalId").anyOf(b).toArray()}g.maybeGetMsg=a;g.getIsThreadEmpty=b;g.doesThreadHaveMsgsMatchCriteria=e;g.getThreadMessagesBySortOrder=r;g.getThreadNewestMessageBySortOrder=s;g.getThreadNewestMessageId=f;g.getThreadNewestMessageMs=t;g.getThreadNewestNumMessagesBySortOrder=u;g.getThreadOldestMessageBySortOrder=v;g.getThreadOldestMessageId=w;g.maybeGetMsgByProtocolMsgId=x;g.getUniqueMsgsByProtocolMsgIds=y;g.maybeGetMsgByExternalId=B;g.maybeGetMsgListByMsgId_I_KNOW_WHAT_I_AM_DOING=C;g.maybeGetMsgResultByProtocolMsgId=D;g.getMsgMapByProtocolMsgId=E;g.getSortOrderFromMsgId=F;g.maybeGetRevokedMsgByProtocolMsgId=H;g.checkIfMsgIsDeletedForMeOrRevoked=I;g.getMsgsByProtocolMsgId=J;g.updateSystemAck=K;g.bulkUpdateSystemAck=L;g.maybeUpdateThreadMsgsForDeleteForMe=N;g.getFutureProofMsgs=O;g.updateMediaId=Q;g.bulkUpdateMediaId=R;g.updateDbMsgXMAExpiration=S;g.bulkUpdateDbMsgXMAExpired=T;g.getMsgsNeedingRetroactiveReadReceiptsUpTo=U;g.clearRetroactiveReadReceiptStatusFromMsgsUpTo=V;g.deleteDbMsg=W;g.bulkDeleteDbMsg=X;g.deleteMessages=Y;g.getMsgsByMsgIds=Z;g.getSpamMsgs=aa;g.fetchMessagesFromDbWithSortOrderMs=ba;g.calculateOldestMsg=ca;g.getNextMsgIdNumberForThread=da;g.checkMessagesExistenceByProtocolMsgIds=ea;g.UNSAFE_getMultipleMsgsByExternalId=fa}),98);
__d("MAWDbReactionsTxns",["FBLogger","MAWAuthor","MAWBridgeTypesCreators","MAWDbMsg","MAWDexieTable","MAWIndexedDb","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=function(a){return a};function a(a,b){return a.reactions.put(k(b))}function b(a,b){return a.reactions["delete"](b.rowId).then(function(){var a=b.author,c=b.reactionId,e=b.reactToMsgId,f=b.threadJid;if(e==null)return;d("MAWIndexedDb").afterTransaction({tag:"DeleteReaction",value:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:a,chatJid:f,reactToMsgId:e})});d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted reaction with id : ","."])),c)})}function e(a,b){var c=d("MAWAuthor").getAuthorUserJid(b.author);return a.reactions.where("reactToExternalId").equals(b.externalId).filter(function(a){return(a.reactToAuthor===c||a.reactToAuthor===b.author)&&a.threadJid===b.chat}).toArray()}function l(a,b){var d=b.reduce(function(a,b){a.set(b.msgId,b);return a},new Map());return a.reactions.where("reactToMsgId").anyOf(b.map(function(a){return a.msgId})).toArray().then(function(a){var b=a.filter(function(a){var b=a.reactToExternalId;a=a.reactToMsgId;return a!=null&&b===((b=d.get(a))==null?void 0:b.externalId)});b.length<a.length&&c("FBLogger")("messenger_web").mustfix("Reactions query by reactToMsgId returns reactions with mismatching externalId");return b})}function f(a,b){return a.reactions.where("reactToMsgId").equals(b.msgId).toArray().then(function(a){var d=a.filter(function(a){a=a.reactToExternalId;return a===b.externalId});d.length<a.length&&c("FBLogger")("messenger_web").mustfix("Reactions query by reactToMsgId returns reactions with mismatching externalId");return d})}function m(a,b){return l(a,[b])}function n(a,b){var c=b.author,d=b.chat;b=b.externalId;return a.reactions.where("externalId").equals(b).filter(function(a){return a.author===c&&a.threadJid===d}).first()}function o(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.author;b=b.externalId;var e=d("MAWAuthor").getAuthorUserJid(c);return a.reactions.where("reactToExternalId").equals(b).filter(function(a){return d("MAWAuthor").getAuthorUserJid(a.reactToAuthor)===e}).toArray()})).then(function(b){b=b.flat();b.forEach(function(a){var b=a.author,c=a.reactToMsgId;a=a.threadJid;if(c==null)return;d("MAWIndexedDb").afterTransaction({tag:"DeleteReaction",value:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:b,chatJid:a,reactToMsgId:c})})});if(b.length===0)return;d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," reactions rows."])),b.length);return a.reactions.bulkDelete(b.map(function(a){return a.rowId}))})}function p(a,b){return a.reactions.where("reactToMsgId").anyOf(b.map(function(a){return a.msgId}))["delete"]().then(function(a){d("WALogger").LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Deleted "," reactions"])),a)})}function q(a,b){return a.reactions.where("reactionId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").msgIdsInChatUpperBound(b.chatId)).last().then(function(a){a=a==null?0:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.reactionId);return a+1})}function r(a,b,c,e,f,g,h){e=(e=e==null?void 0:e.ts)!=null?e:d("WATimeUtils").unixTime();return a.reactions.where(["threadJid","ts"]).between([b,(a=d("WATimeUtils").castMillisTimeToUnixTime(c))!=null?a:d("WATimeUtils").castToUnixTime(0)],[b,e],!0,f).reverse().filter(h).limit(g).toArray()}g.coerceToReaction=k;g.putReaction=a;g.deleteReaction=b;g.getReactionForEcho=e;g.getReactionsFromMessages=l;g.getReactionsForMessage=f;g.getReactionsFromMessage=m;g.maybeGetReactionByProtocolMsgId=n;g.deleteReactionsByUniqueMsgIdentifiers=o;g.deleteAllReactionsForMessages=p;g.getNextReactionIdNumberForThread=q;g.fetchReactionsFromDbWithTimestamp=r}),98);
__d("MaybeCreateOrUpdateThreadResultCache",[],(function(a,b,c,d,e,f){"use strict";var g=new Map();function a(a){g["delete"](a)}f.cache__I_KNOW_WHAT_I_AM_DOING=g;f.deleteCachedThreadResult=a}),66);
__d("MAWDbThreadTxns",["MAWAuthoritativeThreadsCache","MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDexieTable","MAWFolderTypes","MAWIndexedDb","MaybeCreateOrUpdateThreadResultCache","WAArrayZip","WALogger","WAResultOrError","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b){return a.threads.get({deduplicationKey:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function k(a,b){return a.threads.get({jid:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function l(a,b){return a.threads.where("jid").anyOf(b).toArray()}function b(a,b){return a.threads.where("jid").startsWith(b+"@").first().then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function m(a){d("MaybeCreateOrUpdateThreadResultCache").deleteCachedThreadResult(a),d("MAWAuthoritativeThreadsCache").AuthoritativeThreadsCache["delete"](a)}function e(a,b){return a.threads.where("jid").equals(b)["delete"]().then(function(){return m(b)})}function f(a,b){return a.participants.where("userJid").equals(b).toArray().then(function(b){b=b.map(function(a){return a.threadJid});return l(a,b)})}function n(a,b){return a.participants.where("userJid").anyOf(b).toArray().then(function(b){var c=new Map(),d=new Set();b.forEach(function(a){var b,e=a.userJid;b=(b=c.get(e))!=null?b:[];b.push(a.threadJid);c.set(e,b);d.add(a.threadJid)});return l(a,Array.from(d)).then(function(a){var b=a.reduce(function(a,b){a.set(b.jid,b);return a},new Map());return new Map(Array.from(c.entries()).map(function(a){var c=a[0];a=a[1];return[c,a.map(function(a){return b.get(a)}).filter(Boolean)]}))})})}function o(a,b,c){return(b==null?void 0:b.lastReadMsgReceiptSent)==null?d("MAWDexieTable").dexieResolve(!1):d("MAWDbMsgTxns").getSortOrderFromMsgId(a,b.lastReadMsgReceiptSent).then(function(a){return c.sortOrderMs==null||a==null?!1:c.sortOrderMs<=a})}function p(a,b){return a.threads.get({jid:b.threadJid}).then(function(c){return o(a,c,b)})}function q(a,b){return a.threads.where("jid").anyOf(b.map(function(a){return a.threadJid})).toArray().then(function(c){return d("MAWDexieTable").dexieAll(d("WAArrayZip").zip(b,c).map(function(b){var c=b[0];b=b[1];return o(a,b,c)}))})}function r(a,b,c){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var e=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{archived:!0,cannotReplyReason:c?"viewer_not_subscribed":a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.ARCHIVED})});return a.threads.bulkPut(e).then(function(){e.forEach(function(a){c&&d("WALogger").LOG(["[Occamadillo] Leaving a group thread\n          "+a.jid.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]),d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.ARCHIVED,threadJid:a.jid})})})})})}function s(a,b){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var c=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{cannotReplyReason:null})});return a.threads.bulkPut(c).then(function(){c.forEach(function(a){a={cannotReplyReason:null,threadJid:a.jid};d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread(a)})})})})}function t(a,b){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var c=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{archived:!1,cannotReplyReason:a.cannotReplyReason==="viewer_not_subscribed"?a.cannotReplyReason:null,folder:d("MAWFolderTypes").FOLDER_ID.INBOX})});return a.threads.bulkPut(c).then(function(){c.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.INBOX,threadJid:a.jid})})})})})}function u(a,b){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var c=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{cannotReplyReason:"viewer_not_subscribed"})});return a.threads.bulkPut(c).then(function(){c.forEach(function(a){var b={cannotReplyReason:"viewer_not_subscribed",threadJid:a.jid};d("WALogger").LOG(["[Occamadillo] User is unsubscribed from thread\n          "+a.jid.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]);d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread(b)})})})})}function v(a,b){return k(a,b).then(function(b){if(!b.success){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsMigratedLocally failed to get the thread"])));return}b=b.value;if(b.isMigratedLocally===!0){d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsMigratedLocally failed because thread is already migrated"])));return}b=babelHelpers["extends"]({},b,{isMigratedLocally:!0});return a.threads.put(b).then(c("emptyFunction"))})}function w(a,b){if(b.isMigratedLocally===!1){d("WALogger").WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["markCutoverThreadAsNotMigratedLocally failed because thread is already unmigrated"])));return d("MAWDexieTable").dexieResolve(b)}var c=babelHelpers["extends"]({},b,{isMigratedLocally:!1});return a.threads.put(c).then(function(){return c})}function x(a,b){return a.threads.put(b).then(c("emptyFunction"))}function y(a,b,c,e,f){return x(a,babelHelpers["extends"]({},b,{newestMsgTs:(f==null?void 0:f.ts)==null?b.newestMsgTs:d("WATimeUtils").castUnixTimeToMillisTime(f.ts),oldestMsg:e==null?void 0:e.msgId}))}g.getThreadByDeduplicationKey=a;g.getThread=k;g.getThreads=l;g.getThreadPrimaryId=b;g.deleteThread=e;g.getAllThreadsForUser=f;g.getAllThreadsForUsers=n;g.needsRetroactiveReadReceiptInThread=p;g.bulkNeedsRetroactiveReadReceiptInThread=q;g.archiveThreads=r;g.subscribeToThreads=s;g.unarchiveThreads=t;g.unsubscribeFromThreads=u;g.markCutoverThreadAsMigratedLocally=v;g.markCutoverThreadAsNotMigratedLocally=w;g.updateThread=x;g.updateThreadMsgsForUndefinedOldestOrNewestMsgs=y}),98);
__d("MAWDbXMATxns",["MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWJidUtils","MAWXMAUtils","WAResultOrError","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.xma.bulkGet(b)}function b(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.get({xmaId:b})}function h(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.where("associatedMessageId").equals(b).first()}function i(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.where("externalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).first()}function e(a,b){return i(a,b).then(function(b){return b==null?d("WAResultOrError").makeError("missing"):d("MAWDexieTable").dexieAll([d("MAWDbMediaTxns").getMediaForXMA(a,b),d("MAWDbMsgTxns").maybeGetMsg(a,b.associatedMessageId)]).then(function(a){var c=a[0];a=a[1];if(!c.success)return d("WAResultOrError").makeError("missing");c=c.value;var e=c.defaultPreview,f=c.favicon,g=c.header;c=c.previews;return d("WAResultOrError").makeResult({associatedMessage:a,defaultPreview:e,favicon:f,header:g,previews:c,xma:b})})})}function f(a,b){return h(a,b).then(function(b){if(b==null)return;return d("MAWDbMsgTxns").maybeGetMsg(a,b.msgId)})}function j(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.filter(d("MAWDbMsg").isXMAMsg).map(function(a){return d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.externalId)}).filter(Boolean);b=b.map(function(b){return i(a,b)});return d("MAWDexieTable").dexieAll(b).then(function(a){return a.filter(Boolean)})}function k(a,b){return a.xma.where("associatedMessageId").anyOf(b).toArray().then(function(a){a=a.filter(function(a){return a.msgId!=null&&c("gkx")("9841")?a.targetType!=null:d("MAWXMAUtils").isXMAShare_DO_NOT_USE(a.targetType)});return a.reduce(function(a,b){return b.associatedMessageId!=null&&b.msgId!=null?a.set(b.associatedMessageId,b.msgId):a},new Map())})}function l(a,b){return a.xma.where("associatedMessageId").equals(b).first()}function m(a,b){return a.xma.where("associatedMessageId").equals(b).first().then(function(b){if(b==null)return;b=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.externalId);if(b==null)return;return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b)})}function n(a,b){return l(a,b).then(function(b){return b==null?d("WAResultOrError").makeResult():d("MAWDexieTable").dexieAll([d("MAWDbMediaTxns").getMediaForXMA(a,b),d("MAWDbMsgTxns").maybeGetMsg(a,b.associatedMessageId)]).then(function(a){var c=a[0];a=a[1];if(!c.success)return d("WAResultOrError").makeError("missing");c=c.value;var e=c.defaultPreview,f=c.favicon,g=c.header;c=c.previews;return d("WAResultOrError").makeResult({associatedMessage:a,defaultPreview:e,favicon:f,header:g,previews:c,xma:b})})})}function o(a,b,c){return d("MAWDbThreadTxns").getThread(a,c).then(function(c){if(!c.success)return;c=c.value;if(b==null)return d("MAWDexieTable").dexieResolve();c={author:b.author,chat:c.jid,externalId:b.externalId};return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c)})}function p(a,b){return i(a,b).then(function(b){if(b==null)return d("MAWDexieTable").dexieResolve();if(d("MAWXMAUtils").isXMAStoryReply(b.targetType))return;return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.defaultPreviewMediaId).then(function(c){return c==null?{hasMedia:!1,xma:b}:d("MAWDexieTable").dexieAll([c,d("MAWDbChunkTxns").hasMediaChunk(a,c.hashedPlaintextHash)]).then(function(a){var c=a[0];a=a[1];return{hasMedia:a,previewMedia:c,xma:b}})})})}function q(a,b){return a.xma.where("externalId").anyOf(b).toArray()}g.bulkGetXMAs=a;g.maybeGetXMAFromXMAId=b;g.maybeGetXMAFromAssociatedMsgId=h;g.maybeGetXMAFromProtocolMsgId=i;g.maybeGetXMAPayloadFromProtocolMsgId=e;g.getDbXMAMsgFromAssociatedMsgId=f;g.getXMAFromMsgs=j;g.getXMAMsgIdsFromAssociatedMsgIds=k;g.maybeGetDbXMAMsgByAssociatedMsgId=m;g.maybeGetXMAPayloadFromAssociatedMsgId=n;g.maybeGetAssociatedXMAMsg=o;g.maybeGetXMAAndDefaultPreviewMediaFromProtocolMsg=p;g.getMultipleXMAByExternalId=q}),98);
__d("MAWMessageHasNonNullServerTsOnReceivedAckValidator",["MAWAckLevel","MAWTransactionMode","MAWTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWTransactor").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY},"isMessageHasNonNullServerTsOnReceivedAckValidator",function(a){return function(b){return a.messages.get(b).then(function(a){return a==null||a.ack<d("MAWAckLevel").ACK.sent?{key:b,result:"skipped"}:a.serverTs!=null?{key:b,result:"valid"}:{description:"Message with "+a.ack+" ack has empty serverTs.",key:b,result:"invalid"}})}});b={description:"MAWMessageHasNonNullServerTsOnReceivedAckValidator",isValid:a,table:"messages",type:["add","put"]};g.MAWMessageHasNonNullServerTsOnReceivedAckValidator=b}),98);
__d("MAWMessageHasUniqueExternalIdValidator",["MAWDexieTable","MAWTransactionMode","MAWTransactor","WAStanzaUtils","justknobx"],(function(a,b,c,d,e,f,g){"use strict";a=c("justknobx")._("3288");b=d("MAWTransactor").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY},"isMessageWithUniqueExternalIdValidator",function(a){return function(b){return a.messages.get(b).then(function(c){var e=c==null?void 0:c.externalId;return c==null||e==null?d("MAWDexieTable").dexieResolve({key:b,result:"skipped"}):a.messages.where("externalId").equals(d("WAStanzaUtils").toStanzaId(e)).filter(function(a){return a.author===c.author&&a.threadJid===c.threadJid}).toArray().then(function(a){if(a.length===1)return{key:b,result:"valid"};else{a=h(b,c,a);return{description:a,key:b,result:"invalid"}}})})}});function h(a,b,c){var d,e=c.every(function(a){return a.serverTs===b.serverTs});c=c.filter(function(b){return b.rowId!==a});d="Message has duplicate externalId."+("New message type: "+((d=b.type)!=null?d:"")+". ")+("Existing message types: "+c.map(function(a){return a.type}).join(", ")+". ")+("Messages have same serverTS: "+e.toString()+". ")+("Message has null protocolMsgId: "+(b.protocolMsgId==null).toString()+". ");return d}e={description:"MAWMessageHasUniqueExternalIdValidator",isValid:b,sampleRate:a,table:"messages",type:["add","put"]};g.MAWMessageHasUniqueExternalIdValidator=e}),98);
__d("MAWParticipantMatchOneOnOneThreadValidator",["MAWIndexedDb","MAWTransactionMode","MAWUserJidWrapper","WAJids","justknobx"],(function(a,b,c,d,e,f,g){"use strict";a=c("justknobx")._("3121");b=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY},"isParticipantMatchingOneOnOneThreadValidator",function(a){return function(b){return a.participants.get(b).then(function(a){return a==null?{key:b,result:"skipped"}:d("WAJids").switchOnMsgrChatJidType(a.threadJid,{group:function(){return{key:b,result:"skipped"}},user:function(c){return a.userJid!==c&&a.userJid!==d("MAWUserJidWrapper").getMyUserJid()?{description:"Participants added to 1:1 thread is neither self or the other user",key:b,result:"invalid"}:{key:b,result:"valid"}}})})}});e={description:"MAWParticipantMatchOneOnOneThreadValidator",isValid:b,sampleRate:a,table:"participants",type:["add","put"]};g.MAWParticipantMatchOneOnOneThreadValidator=e}),98);
__d("MAWReactionHasUniqueProtocolMsgIdValidator",["MAWDexieTable","MAWTransactionMode","MAWTransactor","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWTransactor").makeMsgrTransactor({reactions:d("MAWTransactionMode").READONLY},"isReactionWithUniqueProtocolMsgIdValidator",function(a){return function(b){return a.reactions.get(b).then(function(c){var e=c==null?void 0:c.externalId;return e==null?d("MAWDexieTable").dexieResolve({key:b,result:"skipped"}):a.reactions.where("externalId").equals(d("WAStanzaUtils").toStanzaId(e)).filter(function(a){return a.author===(c==null?void 0:c.author)&&a.threadJid===(c==null?void 0:c.threadJid)}).toArray().then(function(a){if(a.length===1)return{key:b,result:"valid"};else return{description:"Reaction has duplicate protocolMsgId",key:b,result:"invalid"}})})}});b={description:"MAWReactionHasUniqueProtocolMsgIdValidator",isValid:a,table:"reactions",type:["add","put"]};g.MAWReactionHasUniqueProtocolMsgIdValidator=b}),98);
__d("MAWDbMutationMiddleware",["FBLogger","MAWDbMiddlewareMutations"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{create:function(b){return babelHelpers["extends"]({},b,{table:function(e){var f=b.table(e);try{return babelHelpers["extends"]({},f,{get:function(b){return f.get(b).then(function(b){return b==null?void 0:d("MAWDbMiddlewareMutations").getValue(b,e,a)})},getMany:function(b){return f.getMany(b).then(function(b){return b.map(function(b){return b==null?void 0:d("MAWDbMiddlewareMutations").getValue(b,e,a)})})},mutate:function(b){var c=null;switch(b.type){case"add":case"put":c=b.values.map(function(b){return d("MAWDbMiddlewareMutations").mutateValue(b,e,a)});break;case"delete":break;case"deleteRange":break}if(b.type==="delete"||b.type==="deleteRange"||c==null)return f.mutate(b);b.values=c;return f.mutate(b).then(function(a){return a})},openCursor:function(b){return f.openCursor(b).then(function(b){return b==null||b.value==null?b:h(b,e,a)})},query:function(b){return f.query(b).then(function(b){if(b.result.length===0||typeof b.result[0]!=="object")return b;var c=b.result.map(function(b){return d("MAWDbMiddlewareMutations").getValue(b,e,a)});b.result=c;return b})}})}catch(a){c("FBLogger")("messenger_web").catching(a).mustfix("Error applying MAWDbMiddleware");return f}}})},name:"MAWDbMutationMiddleware",stack:"dbcore"}}function b(){return{create:function(a){return babelHelpers["extends"]({},a,{table:function(b){var e=a.table(b);try{return babelHelpers["extends"]({},e,{get:function(a){return e.get(a).then(function(a){return d("MAWDbMiddlewareMutations").getVaultedValue(a,b)})},getMany:function(a){return e.getMany(a).then(function(a){return a.map(function(a){return d("MAWDbMiddlewareMutations").getVaultedValue(a,b)})})},mutate:function(a){if(a.type==="delete"||a.type==="deleteRange")return e.mutate(a);a.values=a.values.map(function(a){return d("MAWDbMiddlewareMutations").mutateVaultedValue(a,b)});return e.mutate(a)},openCursor:function(a){return e.openCursor(a).then(function(a){return a==null||a.value==null?a:i(a,b)})},query:function(a){return e.query(a).then(function(a){return a.result.length===0||typeof a.result[0]!=="object"?a:babelHelpers["extends"]({},a,{result:a.result.map(function(a){return d("MAWDbMiddlewareMutations").getVaultedValue(a,b)})})})}})}catch(a){c("FBLogger")("messenger_web").catching(a).mustfix("Error applying MAWDbMiddleware");return e}}})},name:"getMAWVaultMiddleware",stack:"dbcore"}}function h(a,b,c){var e;return Object.create(a,{"continue":{get:function(){return a["continue"]}},continuePrimaryKey:{get:function(){return a.continuePrimaryKey}},key:{get:function(){return a.key}},primaryKey:{get:function(){return a.primaryKey}},start:{value:function(f){return a.start(function(){e=d("MAWDbMiddlewareMutations").getValue(a.value,b,c);try{a.value=e}catch(a){}f()})}},value:{get:function(){return e}}})}function i(a,b){var c;return Object.create(a,{"continue":{get:function(){return a["continue"]}},continuePrimaryKey:{get:function(){return a.continuePrimaryKey}},key:{get:function(){return a.key}},primaryKey:{get:function(){return a.primaryKey}},start:{value:function(e){return a.start(function(){c=d("MAWDbMiddlewareMutations").getVaultedValue(a.value,b);try{a.value=c}catch(a){}e()})}},value:{get:function(){return c}}})}g.getMAWDbMutationMiddleware=a;g.getMAWVaultMiddleware=b}),98);
__d("MAWDbEncryptObjContent",["MAWKeychainNaClCrypto"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWKeychainNaClCrypto").encryptTweetNaClArrayBuffer(a,b,c)}g.encryptContent=a}),98);
__d("MAWXMACTAUtil",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=a.actionUrl,c=a.buttonType,d=a.ctaType,e=a.nativeUrl;a=a.title;return{actionUrl:b,buttonType:c,ctaType:d,nativeUrl:e,title:a}}function b(a){var b=a.actionUrl,c=a.buttonType,d=a.ctaType,e=a.nativeUrl;a=a.title;return{actionUrl:b,buttonType:c,ctaType:d,nativeUrl:e,title:a}}f.toMAWCTAEncode=a;f.fromMAWCTAEncode=b}),66);
__d("WAServerSync.pb",["$InternalEnum","WAProtoConst"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({SET:0,REMOVE:1});c={};e={};f={};b={};var h={},i={},j={},k={},l={},m={},n={};c.name="SyncdVersion";c.internalSpec={version:[1,(d=d("WAProtoConst")).TYPES.UINT64]};e.name="ExitCode";e.internalSpec={code:[1,d.TYPES.UINT64],text:[2,d.TYPES.STRING]};f.name="SyncdIndex";f.internalSpec={blob:[1,d.TYPES.BYTES]};b.name="SyncdValue";b.internalSpec={blob:[1,d.TYPES.BYTES]};h.name="KeyId";h.internalSpec={id:[1,d.TYPES.BYTES]};i.name="SyncdRecord";i.internalSpec={index:[1,d.TYPES.MESSAGE,f],value:[2,d.TYPES.MESSAGE,b],keyId:[3,d.TYPES.MESSAGE,h]};j.name="ExternalBlobReference";j.internalSpec={mediaKey:[1,d.TYPES.BYTES],directPath:[2,d.TYPES.STRING],handle:[3,d.TYPES.STRING],fileSizeBytes:[4,d.TYPES.UINT64],fileSha256:[5,d.TYPES.BYTES],fileEncSha256:[6,d.TYPES.BYTES]};k.name="SyncdSnapshot";k.internalSpec={version:[1,d.TYPES.MESSAGE,c],records:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i],mac:[3,d.TYPES.BYTES],keyId:[4,d.TYPES.MESSAGE,h]};l.name="SyncdMutations";l.internalSpec={mutations:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,m]};m.name="SyncdMutation";m.internalSpec={operation:[1,d.TYPES.ENUM,a],record:[2,d.TYPES.MESSAGE,i]};n.name="SyncdPatch";n.internalSpec={version:[1,d.TYPES.MESSAGE,c],mutations:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,m],externalMutations:[3,d.TYPES.MESSAGE,j],snapshotMac:[4,d.TYPES.BYTES],patchMac:[5,d.TYPES.BYTES],keyId:[6,d.TYPES.MESSAGE,h],exitCode:[7,d.TYPES.MESSAGE,e],deviceIndex:[8,d.TYPES.UINT32],clientDebugData:[9,d.TYPES.BYTES]};g.SyncdMutation$SyncdOperation=a;g.SyncdVersionSpec=c;g.ExitCodeSpec=e;g.SyncdIndexSpec=f;g.SyncdValueSpec=b;g.KeyIdSpec=h;g.SyncdRecordSpec=i;g.ExternalBlobReferenceSpec=j;g.SyncdSnapshotSpec=k;g.SyncdMutationsSpec=l;g.SyncdMutationSpec=m;g.SyncdPatchSpec=n}),98);
__d("MAWDbObjDecode",["FBLogger","MAWArmadilloAppDataTableSchema.pb","MAWArmadilloAppMetaTableSchema.pb","MAWArmadilloCollectionVersionsTableSchema.pb","MAWArmadilloDeletedMessagesTableSchema.pb","MAWArmadilloDeviceChangeAlertsTableSchema.pb","MAWArmadilloDyiBatchTableSchema.pb","MAWArmadilloEBMsgRangesTableSchema.pb","MAWArmadilloEditMsgHistoryTableSchema.pb","MAWArmadilloGroupInfoTableSchema.pb","MAWArmadilloGroupInvitesTableSchema.pb","MAWArmadilloMediaTablesSchema.pb","MAWArmadilloMessagesTableSchema.pb","MAWArmadilloMissingKeysTableSchema.pb","MAWArmadilloParticipantsTableSchema.pb","MAWArmadilloPendingMutationsTableSchema.pb","MAWArmadilloPersonalSenderKeyStatusTableSchema.pb","MAWArmadilloPollTableSchema.pb","MAWArmadilloReactionsTableSchema.pb","MAWArmadilloReceiptTablesSchema.pb","MAWArmadilloReceiverFetchInfoTableSchema.pb","MAWArmadilloSyncActionsTableSchema.pb","MAWArmadilloSyncKeysTableSchema.pb","MAWArmadilloTasksTableSchema.pb","MAWArmadilloThreadsTableSchema.pb","MAWArmadilloUnrenderedMessagesTableSchema.pb","MAWArmadilloXMATableSchema.pb","MAWMsgType","MAWODSProxy","MAWXMACTAUtil","WAOdsEnums","WAServerSync.pb","decodeProtobuf"],(function(a,b,c,d,e,f,g){var h={appData:function(a){return A(a)},appMeta:function(a){return B(a)},chunk:function(a){return C(a)},collectionVersions:function(a){return L(a)},deletedMessages:function(a){return n(a)},deviceChangeAlerts:function(a){return i(a)},dualSendMedia:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},dyiBatch:function(a){return G(a)},ebMessageRestoreTasks:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ebMsgRanges:function(a){return H(a)},ebRestoreQueue:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ebUploadQueue:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},editMsgHistory:function(a){return O(a)},encryptionMetaV3:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ephemeralSettings:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},existingUsers:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsBackloggedMessages:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsEncryptionMeta:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsIndexV3:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsPurgeBacklog:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsPurgeThreadBacklog:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},groupInfo:function(a){return q(a)},groupInvites:function(a){return x(a)},historySyncQRCodeData:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},historySyncQRCodeSecretKey:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},igMessageAuxiliaryInfo:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},isDualSend:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},media:function(a){return E(a)},mediaBackup:function(a){return D(a)},mediaKeys:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},messages:function(a){return m(a)},missingKeys:function(a){return J(a)},participants:function(a){return w(a)},pendingMessageStanzaQueue:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},pendingMutations:function(a){return K(a)},pendingReceipts:function(a){return u(a)},pendingStanzas:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},personalSenderKeyStatuses:function(a){return z(a)},poll:function(a){return Q(a)},reactions:function(a){return F(a)},receipts:function(a){return t(a)},receiverFetchInfo:function(a){return P(a)},sentBytesCache:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},staleQueue:function(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},syncActions:function(a){return I(a)},syncKeys:function(a){return M(a)},tasks:function(a){return y(a)},threads:function(a){return v(a)},unrenderedMessages:function(a){return o(a)},xma:function(a){return N(a)}};function a(a,b){if(Object.prototype.hasOwnProperty.call(h,b))b=h[b](a);else throw c("FBLogger")("messenger_web").mustfixThrow("not a valid table name");return b}function i(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloDeviceChangeAlertsTableSchema.pb").DeviceChangeAlertsTableSchemaProtoSpec,a);return{action:a.action,deviceJid:a.deviceJid,identity:a.identity,isArchived:a.isArchived,latitude:a.latitude,location:a.location,loggedOut:a.loggedOut,longitude:a.longitude,model:a.model,platform:a.platform,ts:a.ts}}function j(a){a=a.quote;var b;if(a!=null){if(a.content==null)throw c("FBLogger")("messenger_web").mustfixThrow("QuotedMsgContent missing upon decoding");var d=a.content,e=d.author,f=d.expirationTs,g=d.externalId,h=d.mediaId,i=d.msgContent,j=d.msgId,k=d.plaintextHash,l=d.sourceId,m=d.specialTextSize,n=d.ts,o=d.type;d=d.xmaMessageType;b={content:babelHelpers["extends"]({},a.content,{author:e,expirationTs:f,externalId:g,mediaId:h,msgContent:i,msgId:j,plaintextHash:k,sourceId:l,specialTextSize:m,ts:n,type:o,xmaMessageType:d}),remoteJid:a.remoteJid}}return b}function k(a){if(a==null)return a;else return new Uint8Array(a)}function l(a){if(a==null||a.length===0)return new Set();else return new Set(a)}function m(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMessagesTableSchema.pb").MessagesTableSchemaProtoSpec,a);var b=a.msgContent;if(a.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF){if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("MsgContent missing upon decoding futureproof message");b.subtype=b.subtype}var e=j(a),f=p(a.reportingMeta);return babelHelpers["extends"]({},a,{msgContent:b,quote:e,reportingMeta:f})}function n(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloDeletedMessagesTableSchema.pb").DeletedMessagesTableSchemaProtoSpec,a);return babelHelpers["extends"]({},a)}function o(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloUnrenderedMessagesTableSchema.pb").UnrenderedMessagesTableSchemaProtoSpec,a);var b=j(a),c=p(a.reportingMeta);return babelHelpers["extends"]({},a,{quote:b,reportingMeta:c})}function p(a){if(a==null)return;return{frankingKey:a.frankingKey!=null?new Uint8Array(a.frankingKey):a.frankingKey,frankingTag:a.frankingTag!=null?new Uint8Array(a.frankingTag):a.frankingTag,frankingVersion:a.frankingVersion,reportingContent:a.reportingContent,reportingTag:a.reportingTag!=null?new Uint8Array(a.reportingTag):a.reportingTag}}function q(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloGroupInfoTableSchema.pb").GroupInfoSchemaProtoSpec,a);return{creationTs:a.creationTs,creator:a.creator,inviter:a.inviter,memberAddMode:a.memberAddMode,msgExpiration:a.msgExpiration,name:a.name,nameOwner:a.nameOwner,nameTs:a.nameTs,participantVersion:a.participantVersion}}function r(a){if(a.length===0)return null;else return new Map(a.map(function(a){var b=a.deviceJid;if(b==null||a.serializedPubKey==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected deviceJid or serializedPubKey are missing ");var d=new Uint8Array(a.serializedPubKey);a=k(a.baseKey);a={baseKey:a,pubKey:d};return[b,a]}))}function s(a){if(a==null)return null;else return new Map(a.map(function(a){if(a.deviceJid==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected deviceJID is missing ");return[a.deviceJid,(a=a.count)!=null?a:0]}))}function t(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").ReceiptsTableSchemaProtoSpec,a);var b=a.recipientDevices;b=l(b);return{permittedIdentitiesPerDevice:r(a.permittedIdentitiesPerDevice),recipientDevices:b,retryCountsPerDevice:s(a.retryCountsPerDevice)}}function u(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").PendingReceiptsTableSchemaProtoSpec,a)}function v(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloThreadsTableSchema.pb").ThreadsTableSchemaProtoSpec,a);return{archived:a.archived,cannotReplyReason:a.cannotReplyReason,didInsertDualThreadCutoverAdminMsg:a.didInsertDualThreadCutoverAdminMsg,folder:a.folder,isMigratedLocally:a.isMigratedLocally,lastReadMsg:a.lastReadMsg,lastReadMsgReceiptSent:a.lastReadMsgReceiptSent,muteCallsExpireTimeMs:a.muteCallsExpireTimeMs,muteExpireTimeMs:a.muteExpireTimeMs,newestMsg:a.newestMsg,newestMsgTs:a.newestMsgTs,oldestMsg:a.oldestMsg,optimisticThreadKey:a.optimisticThreadKey,snippetMsg:a.snippetMsg,snippetMsgTs:a.snippetMsgTs}}function w(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloParticipantsTableSchema.pb").ParticipantsTableSchemaProtoSpec,a)}function x(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloGroupInvitesTableSchema.pb").GroupInvitesTableSchemaProtoSpec,a)}function y(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloTasksTableSchema.pb").TasksTableSchemaProtoSpec,a)}function z(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb").PersonalSenderKeyStatusTableSchemaProtoSpec,a);var b=a.hasSenderKey;b=l(b);return{hasSenderKey:b,rotateSenderKey:a.rotateSenderKey,senderKeyId:a.senderKeyId,senderKeyTs:a.senderKeyTs}}function A(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloAppDataTableSchema.pb").AppDataTableSchemaProtoSpec,a);return{ack:a.ack,contents:a.contents,permittedIdentitiesPerDevice:r(a.permittedIdentitiesPerDevice),recipientDevices:new Set(a.recipientDevices),sendPartial:a.sendPartial,ts:a.ts}}function B(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloAppMetaTableSchema.pb").AppMetaTableSchemaProtoSpec,a)}function C(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").ChunkTableSchemaProtoSpec,a)}function D(a){return d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaBackupSchemaProtoSpec,a)}function E(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaTableSchemaProtoSpec,a);var b,e=a.mediaEntries;e==null?b=new Map():b=new Map(e.map(function(a){if(a.msgId==null||a.mediaEntryData==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected msgId or mediaEntryData are missing ");return[a.msgId,new Uint8Array(a.mediaEntryData)]}));return{accessibilitySummaryText:a.accessibilitySummaryText,mediaEntries:b,mediaType:a.mediaType,plaintextHash:a.plaintextHash,size:a.size,ts:a.ts,validatedAudioInfo:a.validatedAudioInfo,validatedDocumentFileInfo:a.validatedDocumentFileInfo,validatedImageInfo:a.validatedImageInfo,validatedResult:a.validatedResult,validatedVideoInfo:a.validatedVideoInfo}}function F(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReactionsTableSchema.pb").ReactionsTableSchemaProtoSpec,a);a.ts!=null&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MIGRATE_REACTION_TS_AS_INDEX,key:"reaction_ts_encrypted"});return babelHelpers["extends"]({ack:a.ack,author:a.author,groupingKey:a.groupingKey,reaction:a.reaction,reactToAuthor:a.reactToAuthor,senderTimestampMs:a.senderTimestampMs},a.ts!=null?{ts:a.ts}:{})}function G(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloDyiBatchTableSchema.pb").DyiBatchTableSchemaProtoSpec,a);return{isThread:a.isThread,numMessages:a.numMessages,numMessagesRestored:a.numMessagesRestored,numThreadsRestored:a.numThreadsRestored,oldestTs:a.oldestTs,qplFlowDescriptor:a.qplFlowDescriptor,qplInstanceKeyE2E:a.qplInstanceKeyE2E,qplInstanceKeyForThread:a.qplInstanceKeyForThread,threadId:a.threadId}}function H(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloEBMsgRangesTableSchema.pb").EBMsgRangesTableSchemaProtoSpec,a);return{creationTime:a.creationTime,maxMsgExternalId:a.maxMsgExternalId,maxMsgSortOrderMs:a.maxMsgSortOrderMs,minMsgExternalId:a.minMsgExternalId,minMsgSortOrderMs:a.minMsgSortOrderMs}}function I(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSyncActionsTableSchema.pb").SyncActionsTableSchemaProtoSpec,a);return{binarySyncData:a.binarySyncData,keyId:a.keyId,timestamp:a.timestamp,valueMac:a.valueMac,version:a.version}}function J(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloMissingKeysTableSchema.pb").MissingKeysTableSchemaProtoSpec,a);var b;a.deviceResponses==null?b=new Map():b=new Map(a.deviceResponses.map(function(a){if(a.deviceId==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected deviceId is missing");else return[a.deviceId,a.deviceResponse]}));return{deviceResponses:b,keyId:a.keyId,timestamp:a.timestamp}}function K(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloPendingMutationsTableSchema.pb").PendingMutationsTableSchemaProtoSpec,a);var b;switch(a.operation){case d("MAWArmadilloPendingMutationsTableSchema.pb").SYNCD_MUTATION_SYNCD_OPERATION.SET:b=d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET;break;case d("MAWArmadilloPendingMutationsTableSchema.pb").SYNCD_MUTATION_SYNCD_OPERATION.REMOVE:b=d("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE;break;default:throw c("FBLogger")("messenger_web").mustfixThrow("operation missing when decoding PendingMutation")}return{binarySyncAction:a.binarySyncAction,operation:b,timestamp:a.timestamp,version:a.version}}function L(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloCollectionVersionsTableSchema.pb").CollectionVersionsTableSchemaProtoSpec,a);return{finiteFailureStartTime:a.finiteFailureStartTime,isCollectionInMacMismatchFatal:a.isCollectionInMacMismatchFatal,isCollectionLthashInconsistent:a.isCollectionLthashInconsistent,ltHash:a.ltHash,state:a.state,version:a.version}}function M(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloSyncKeysTableSchema.pb").SyncKeysTableSchemaProtoSpec,a);return{fingerprint:a.fingerprint,keyData:a.keyData,timestamp:a.timestamp}}function N(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloXMATableSchema.pb").XMATableSchemaProtoSpec,a);return{author:a.author,ctas:a.ctas.map(function(a){return d("MAWXMACTAUtil").fromMAWCTAEncode(a)}),defaultCTA:a.defaultCTA==null?a.defaultCTA:d("MAWXMACTAUtil").fromMAWCTAEncode(a.defaultCTA),defaultPreviewMediaPlaintextHash:a.defaultPreviewMediaPlaintextHash,faviconPlaintextHash:a.faviconPlaintextHash,headerMediaPlaintextHash:a.headerMediaPlaintextHash,headerTitle:a.headerTitle,isTombstoned:a.isTombstoned,maxSubtitleNumOfLines:a.maxSubtitleNumOfLines,maxTitleNumOfLines:a.maxTitleNumOfLines,msgId:a.msgId,overlayDescription:a.overlayDescription,overlayIconGlyph:a.overlayIconGlyph,overlayTitle:a.overlayTitle,previewMediaIds:a.previewMediaIds,subtitleText:a.subtitleText,targetId:a.targetId,targetType:a.targetType,targetUsername:a.targetUsername,threadJid:a.threadJid,titleText:a.titleText,xmaLayoutType:a.xmaLayoutType}}function O(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloEditMsgHistoryTableSchema.pb").EditMsgHistoryTableSchemaProtoSpec,a);return{author:a.author,editExternalId:a.editExternalId,editTs:a.editTs,msgContent:a.msgContent,sendStatus:a.sendStatus,specialTextSize:a.specialTextSize}}function P(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloReceiverFetchInfoTableSchema.pb").ReceiverFetchInfoTableSchemaProtoSpec,a);return{accessibilitySummaryText:a.accessibilitySummaryText,mimetype:a.mimetype,previewHeight:a.previewHeight,previewUrl:a.previewUrl,previewUrlExpirationTimestampMs:a.previewUrlExpirationTimestampMs,previewWidth:a.previewWidth,type:a.type}}function Q(a){a=d("decodeProtobuf").decodeProtobuf(d("MAWArmadilloPollTableSchema.pb").PollTableSchemaProtoSpec,a);var b=new Map(a.pollOptions.map(function(a){var b=a.pollOptionHash;if(b==null||a.pollOption==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected pollOptionHash or pollOption is missing");return[b,{optionText:a.pollOption.optionText,voteAuthors:new Set(a.pollOption.voteAuthors)}]}).filter(Boolean)),e=new Map(a.latestSenderTimestampsMs.map(function(a){if(a.author==null||a.latestSenderTimestampMs==null)throw c("FBLogger")("messenger_web").mustfixThrow("Expected author or latestSenderTimestampMs are missing");return[a.author,a.latestSenderTimestampMs]}));return{encKey:a.encKey,latestSenderTimestampsMs:e,pollAuthor:a.pollAuthor,pollOptions:b,pollParticipantCount:a.pollParticipantCount,pollState:a.pollState,selectableOptionsCount:a.selectableOptionsCount,title:a.title}}g.decodeDbObj=a}),98);
__d("WASyncdKeyTypes",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}function c(a){return a}function d(a){return a}f.toSyncKeyId=a;f.fromSyncKeyId=b;f.toSyncKeyData=c;f.fromSyncKeyData=d}),66);
__d("MAWDbObjEncode",["FBLogger","MAWArmadilloAppDataTableSchema.pb","MAWArmadilloAppMetaTableSchema.pb","MAWArmadilloDeletedMessagesTableSchema.pb","MAWArmadilloDeviceChangeAlertsTableSchema.pb","MAWArmadilloDyiBatchTableSchema.pb","MAWArmadilloEBMsgRangesTableSchema.pb","MAWArmadilloEditMsgHistoryTableSchema.pb","MAWArmadilloGroupInfoTableSchema.pb","MAWArmadilloGroupInvitesTableSchema.pb","MAWArmadilloMediaTablesSchema.pb","MAWArmadilloMessagesTableSchema.pb","MAWArmadilloParticipantsTableSchema.pb","MAWArmadilloPersonalSenderKeyStatusTableSchema.pb","MAWArmadilloPollTableSchema.pb","MAWArmadilloReactionsTableSchema.pb","MAWArmadilloReceiptTablesSchema.pb","MAWArmadilloReceiverFetchInfoTableSchema.pb","MAWArmadilloTasksTableSchema.pb","MAWArmadilloThreadsTableSchema.pb","MAWArmadilloUnrenderedMessagesTableSchema.pb","MAWArmadilloXMATableSchema.pb","MAWMsgType","MAWXMACTAUtil","WASyncdKeyTypes","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h=["ack","altIndex","collapsibleId","externalId","messageDeleteTs","messageExpirationTs","msgId","pollStanzaId","protocolMsgId","quoteExpirationTs","quoteExternalId","revokedExternalId","rowId","serverTs","sortOrderMs","threadJid","unsendMsgContentDeleteTs"],i=["author","chat","externalId","rowId"],j={appData:w,appMeta:x,chunk:y,deletedMessages:k,deviceChangeAlerts:a,dualSendMedia:b,dyiBatch:C,ebMessageRestoreTasks:b,ebMsgRanges:D,ebRestoreQueue:b,ebUploadQueue:b,editMsgHistory:F,encryptionMetaV3:b,ephemeralSettings:b,existingUsers:b,ftsBackloggedMessages:b,ftsEncryptionMeta:b,ftsIndexV3:b,ftsPurgeBacklog:b,ftsPurgeThreadBacklog:b,groupInfo:m,groupInvites:t,historySyncQRCodeData:b,historySyncQRCodeSecretKey:b,igMessageAuxiliaryInfo:b,isDualSend:b,media:A,mediaBackup:z,mediaKeys:b,messages:f,participants:s,pendingMessageStanzaQueue:b,pendingReceipts:q,pendingStanzas:b,personalSenderKeyStatuses:v,poll:H,reactions:B,receipts:p,receiverFetchInfo:G,sentBytesCache:b,staleQueue:b,tasks:u,threads:r,unrenderedMessages:l,xma:E};function a(a){a={action:a.action,deviceJid:a.deviceJid,identity:a.identity,isArchived:a.isArchived,latitude:a.latitude,location:a.location,loggedOut:a.loggedOut,longitude:a.longitude,model:a.model,platform:a.platform,ts:a.ts};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloDeviceChangeAlertsTableSchema.pb").DeviceChangeAlertsTableSchemaProtoSpec,a).readByteArrayView()}}function b(a){throw c("FBLogger")("messenger_web").mustfixThrow("unexpected table for encryption")}function e(a,b){if(Object.prototype.hasOwnProperty.call(j,b))b=j[b](a);else throw c("FBLogger")("messenger_web").mustfixThrow("not a valid table name");return b}function f(a){a.ack;a.altIndex;a.collapsibleId;a.externalId;a.messageDeleteTs;a.messageExpirationTs;a.msgId;a.pollStanzaId;a.protocolMsgId;a.quoteExpirationTs;a.quoteExternalId;a.revokedExternalId;a.rowId;a.serverTs;a.sortOrderMs;a.threadJid;a.unsendMsgContentDeleteTs;a=babelHelpers.objectWithoutPropertiesLoose(a,h);a=a;var b;if(a.quote==null)b=a.quote;else{var c;c={author:a.quote.content.author,expirationTs:a.quote.content.expirationTs,externalId:(c=a.quote)==null?void 0:c.content.externalId,mediaId:a.quote.content.mediaId,msgContent:a.quote.content.msgContent,msgId:a.quote.content.msgId,plaintextHash:a.quote.content.plaintextHash,sourceId:a.quote.content.sourceId,specialTextSize:a.quote.content.specialTextSize,ts:a.quote.content.ts,type:a.quote.content.type,xmaMessageType:a.quote.content.xmaMessageType};c={content:c,remoteJid:a.quote.remoteJid};b=c}c=a.msgContent;a.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF&&(c={protobuf:a.msgContent.protobuf,subtype:a.msgContent.subtype});var e=a.ravenEphemeralType,f=a.ravenEphemeralMediaState;e=e!=null?e:null;f=f!=null?f:null;c={applicationErrorCode:a.applicationErrorCode,author:a.author,editCount:a.editCount,ephemeralCounterStarted:a.ephemeralCounterStarted,ephemeralMsgDisappeared:a.ephemeralMsgDisappeared,ephemeralSetting:a.ephemeralSetting,forwardingScore:a.forwardingScore,groupId:a.groupId,groupIndex:a.groupIndex,groupSize:a.groupSize,hdType:a.hdType,isCollapsed:a.isCollapsed,isExpiredXmaMsg:a.isExpiredXmaMsg,isForwarded:a.isForwarded,mediaId:a.mediaId,msgContent:c,originalTs:a.originalTs,quote:b,ravenEphemeralMediaState:f,ravenEphemeralType:e,receiverFetchId:a.receiverFetchId,reportingMeta:a.reportingMeta,resendCount:a.resendCount,source:a.source,specialTextSize:a.specialTextSize,ts:a.ts,type:a.type,xmaMessageType:a.xmaMessageType};return{encodedFields:c,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMessagesTableSchema.pb").MessagesTableSchemaProtoSpec,c).readByteArrayView()}}function k(a){a.author;a.chat;a.externalId;a.rowId;a=babelHelpers.objectWithoutPropertiesLoose(a,i);a={reason:String(a.reason)};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloDeletedMessagesTableSchema.pb").DeletedMessagesTableSchemaProtoSpec,a).readByteArrayView()}}function l(a){var b;if(a.quote==null)b=a.quote;else{var c;c={author:a.quote.content.author,expirationTs:a.quote.content.expirationTs,externalId:(c=a.quote)==null?void 0:c.content.externalId,mediaId:a.quote.content.mediaId,msgContent:a.quote.content.msgContent,msgId:a.quote.content.msgId,plaintextHash:a.quote.content.plaintextHash,sourceId:a.quote.content.sourceId,ts:a.quote.content.ts,type:a.quote.content.type,xmaMessageType:a.quote.content.xmaMessageType};c={content:c,remoteJid:a.quote.remoteJid};b=c}c={ack:a.ack,author:a.author,ephemeralSetting:a.ephemeralSetting,groupName:a.groupName,invitedParticipantUserJid:a.invitedParticipantUserJid,mediaId:a.mediaId,msgContent:a.msgContent,quote:b,reportingMeta:a.reportingMeta,resendCount:a.resendCount,ts:a.ts,type:a.type,xmaMessageType:a.xmaMessageType};return{encodedFields:c,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloUnrenderedMessagesTableSchema.pb").UnrenderedMessagesTableSchemaProtoSpec,c).readByteArrayView()}}function m(a){a={creationTs:a.creationTs,creator:a.creator,inviter:a.inviter,memberAddMode:a.memberAddMode,msgExpiration:a.msgExpiration,name:a.name,nameOwner:a.nameOwner,nameTs:a.nameTs,participantVersion:a.participantVersion};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloGroupInfoTableSchema.pb").GroupInfoSchemaProtoSpec,a).readByteArrayView()}}function n(a){if(a==null)return a;else return Array.from(a,function(a){var b=a[0];a=a[1];return{baseKey:a.baseKey,deviceJid:b,serializedPubKey:a.pubKey}})}function o(a){if(a==null)return null;else return Array.from(a,function(a){var b=a[0];a=a[1];return{count:a,deviceJid:b}})}function p(a){var b=Array.from(a.recipientDevices);b={permittedIdentitiesPerDevice:n(a.permittedIdentitiesPerDevice),recipientDevices:b,retryCountsPerDevice:o(a.retryCountsPerDevice)};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").ReceiptsTableSchemaProtoSpec,b).readByteArrayView()}}function q(a){a={author:a.author,deliveryReceipts:a.deliveryReceipts,externalId:a.externalId,readReceipts:a.readReceipts,thread:a.thread};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReceiptTablesSchema.pb").PendingReceiptsTableSchemaProtoSpec,a).readByteArrayView()}}function r(a){a={archived:a.archived,cannotReplyReason:a.cannotReplyReason,didInsertDualThreadCutoverAdminMsg:a.didInsertDualThreadCutoverAdminMsg,folder:a.folder,isMigratedLocally:a.isMigratedLocally,lastReadMsg:a.lastReadMsg,lastReadMsgReceiptSent:a.lastReadMsgReceiptSent,newestMsgTs:a.newestMsgTs,oldestMsg:a.oldestMsg,optimisticThreadKey:a.optimisticThreadKey,snippetMsg:a.snippetMsg,snippetMsgTs:a.snippetMsgTs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloThreadsTableSchema.pb").ThreadsTableSchemaProtoSpec,a).readByteArrayView()}}function s(a){a={addressable:a.addressable,deliveredWatermarkTs:a.deliveredWatermarkTs,lastReadActionTs:a.lastReadActionTs,lastReadWatermarkTs:a.lastReadWatermarkTs,type:a.type};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloParticipantsTableSchema.pb").ParticipantsTableSchemaProtoSpec,a).readByteArrayView()}}function t(a){a={caption:a.caption,inviteCode:a.inviteCode,inviteExpirationTs:a.inviteExpirationTs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloGroupInvitesTableSchema.pb").GroupInvitesTableSchemaProtoSpec,a).readByteArrayView()}}function u(a){a={scheduledTime:a.scheduledTime};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloTasksTableSchema.pb").TasksTableSchemaProtoSpec,a).readByteArrayView()}}function v(a){var b=Array.from(a.hasSenderKey);b={hasSenderKey:b,rotateSenderKey:a.rotateSenderKey,senderKeyId:a.senderKeyId,senderKeyTs:a.senderKeyTs};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb").PersonalSenderKeyStatusTableSchemaProtoSpec,b).readByteArrayView()}}function w(a){var b;switch(a.contents.type){case"meta_sync":var e=[];for(var f of a.contents.actions)f.chatAction?e.push({chatAction:f.chatAction}):f.messageAction&&e.push({messageAction:f.messageAction});b={actions:e,type:"meta_sync"};break;case"backups_secrets":b={encryptedBackupsSecrets:a.contents.encryptedBackupsSecrets,type:"backups_secrets"};break;case"sync_key_share":b={syncKeyShare:{keys:a.contents.syncKeyShare.keys,orphanKeys:(f=a.contents.syncKeyShare)==null||(f=f.orphanKeys)==null?void 0:f.map(d("WASyncdKeyTypes").fromSyncKeyId)},type:"sync_key_share"};break;case"sync_key_request":b={syncKeyRequest:{keyIds:a.contents.syncKeyRequest.keyIds.map(d("WASyncdKeyTypes").fromSyncKeyId)},type:"sync_key_request"};break;default:a.contents.type;throw c("FBLogger")("messenger_web").mustfixThrow("Unknown appdata type: "+a.contents.type)}e={ack:a.ack,contents:b,permittedIdentitiesPerDevice:n(a.permittedIdentitiesPerDevice),recipientDevices:Array.from(a.recipientDevices),sendPartial:a.sendPartial,ts:a.ts};return{encodedFields:e,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloAppDataTableSchema.pb").AppDataTableSchemaProtoSpec,e).readByteArrayView()}}function x(a){a={value:a.value};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloAppMetaTableSchema.pb").AppMetaTableSchemaProtoSpec,a).readByteArrayView()}}function y(a){a={blobData:a.blobData,mimetype:a.mimetype,plaintextHash:a.plaintextHash};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").ChunkTableSchemaProtoSpec,a).readByteArrayView()}}function z(a){a={fbid:a.fbid};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaBackupSchemaProtoSpec,a).readByteArrayView()}}function A(a){var b=Array.from(a.mediaEntries,function(a){var b=a[0];a=a[1];return{mediaEntryData:a,msgId:b}});b={accessibilitySummaryText:a.accessibilitySummaryText,mediaEntries:b,mediaType:a.mediaType,plaintextHash:a.plaintextHash,size:a.size,ts:a.ts,validatedAudioInfo:a.validatedAudioInfo,validatedDocumentFileInfo:a.validatedDocumentFileInfo,validatedImageInfo:a.validatedImageInfo,validatedResult:a.validatedResult,validatedVideoInfo:a.validatedVideoInfo};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloMediaTablesSchema.pb").MediaTableSchemaProtoSpec,b).readByteArrayView()}}function B(a){a={ack:a.ack,author:a.author,groupingKey:a.groupingKey,reaction:a.reaction,reactToAuthor:a.reactToAuthor,senderTimestampMs:a.senderTimestampMs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReactionsTableSchema.pb").ReactionsTableSchemaProtoSpec,a).readByteArrayView()}}function C(a){a={isThread:a.isThread,numMessages:a.numMessages,numMessagesRestored:a.numMessagesRestored,numThreadsRestored:a.numThreadsRestored,oldestTs:a.oldestTs,qplFlowDescriptor:a.qplFlowDescriptor,qplInstanceKeyE2E:a.qplInstanceKeyE2E,qplInstanceKeyForThread:a.qplInstanceKeyForThread,threadId:a.threadId};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloDyiBatchTableSchema.pb").DyiBatchTableSchemaProtoSpec,a).readByteArrayView()}}function D(a){a={creationTime:a.creationTime,maxMsgExternalId:a.maxMsgExternalId,maxMsgSortOrderMs:a.maxMsgSortOrderMs,minMsgExternalId:a.minMsgExternalId,minMsgSortOrderMs:a.minMsgSortOrderMs};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloEBMsgRangesTableSchema.pb").EBMsgRangesTableSchemaProtoSpec,a).readByteArrayView()}}function E(a){var b=a.ctas==null?[]:a.ctas.map(function(a){return d("MAWXMACTAUtil").toMAWCTAEncode(a)});b={author:a.author,ctas:b,defaultCTA:a.defaultCTA==null?a.defaultCTA:d("MAWXMACTAUtil").toMAWCTAEncode(a.defaultCTA),defaultPreviewMediaPlaintextHash:a.defaultPreviewMediaPlaintextHash,faviconPlaintextHash:a.faviconPlaintextHash,headerMediaPlaintextHash:a.headerMediaPlaintextHash,headerTitle:a.headerTitle,isTombstoned:a.isTombstoned,maxSubtitleNumOfLines:a.maxSubtitleNumOfLines,maxTitleNumOfLines:a.maxTitleNumOfLines,msgId:a.msgId,overlayDescription:a.overlayDescription,overlayIconGlyph:a.overlayIconGlyph,overlayTitle:a.overlayTitle,previewMediaIds:a.previewMediaIds,subtitleText:a.subtitleText,targetId:a.targetId,targetType:a.targetType,targetUsername:a.targetUsername,threadJid:a.threadJid,titleText:a.titleText,xmaLayoutType:a.xmaLayoutType};return{encodedFields:b,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloXMATableSchema.pb").XMATableSchemaProtoSpec,b).readByteArrayView()}}function F(a){a={author:a.author,editExternalId:a.editExternalId,editTs:a.editTs,msgContent:a.msgContent,sendStatus:a.sendStatus,specialTextSize:a.specialTextSize};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloEditMsgHistoryTableSchema.pb").EditMsgHistoryTableSchemaProtoSpec,a).readByteArrayView()}}function G(a){a={accessibilitySummaryText:a.accessibilitySummaryText,mimetype:a.mimetype,previewHeight:a.previewHeight,previewUrl:a.previewUrl,previewUrlExpirationTimestampMs:a.previewUrlExpirationTimestampMs,previewWidth:a.previewWidth,type:a.type};return{encodedFields:a,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloReceiverFetchInfoTableSchema.pb").ReceiverFetchInfoTableSchemaProtoSpec,a).readByteArrayView()}}function H(a){var b=Array.from(a.pollOptions,function(a){var b=a[0];a=a[1];return{pollOption:{optionText:a.optionText,voteAuthors:Array.from(a.voteAuthors)},pollOptionHash:b}}),c=Array.from(a.latestSenderTimestampsMs,function(a){var b=a[0];a=a[1];return{author:b,latestSenderTimestampMs:a}});c={encKey:a.encKey,latestSenderTimestampsMs:c,pollAuthor:a.pollAuthor,pollOptions:b,pollParticipantCount:a.pollParticipantCount,pollState:a.pollState,selectableOptionsCount:a.selectableOptionsCount,title:a.title};return{encodedFields:c,proto:d("encodeProtobuf").encodeProtobuf(d("MAWArmadilloPollTableSchema.pb").PollTableSchemaProtoSpec,c).readByteArrayView()}}g.encodeDbObj=e;g.encodeDbPollForEncryption=H}),98);
__d("MAWDbObjEncryption",["ExecutionEnvironment","FBLogger","MAWBridge","MAWCryptoConsts","MAWDbEncryptObjContent","MAWDbObjDecode","MAWDbObjEncode","MAWDexieTable","MAWIndexedDb","MAWKeychainCrypto","MAWKeychainNaClCrypto","MAWKeychainUtil","MAWQplProxy","MAWUnrecoverableDbErrors","MWEARKeychainV3","MWEARKeychainV3Errors","ODS","WABase64","WATimeUtils","getErrorSafe","gkx","isEncryptionAtRestEnabled","justknobx","pageID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j="_encryptedContent",k=new Set(["threads","messages","participants"]);function a(a,b,e){if(!(c("isEncryptionAtRestEnabled")()||c("gkx")("23910")===!0)||!d("MAWIndexedDb").TABLES_TO_ENCRYPT.includes(b))return a;var f=d("MAWQplProxy").startQplUserFlow(c("qpl")._(25300256,"115"),{bool:{isWorker:(i||(i=c("ExecutionEnvironment"))).isInWorker,useMawEar:d("MWEARKeychainV3").isKeychainSettled("maw_ear")},string:{pageID:c("pageID"),tableName:b}});try{var g=babelHelpers["extends"]({},a);e=e(d("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear");var h=e.keys;h=h[0];var l=e.version;e=e.randomisedVersion;d("MWEARKeychainV3").isKeychainSettled("maw_ear")===!1&&c("FBLogger")("messenger_web").mustfix("[EAR] Encrypting %s data with global ear. Transactor: %s",b,d("MAWDexieTable").getDexiePSDItem("transactorName"));f.addAnnotations({"int":{keyVersion:l,randomisedVersion:e}});var m=d("MAWKeychainUtil").makeAAD(l,d("MAWCryptoConsts").CIPHER_ID),n=d("MAWDbObjEncode").encodeDbObj(a,b),o=n.encodedFields;n=n.proto;Object.keys(o).forEach(function(b){Object.prototype.hasOwnProperty.call(a,b)&&delete g[b]});o=d("MAWDbEncryptObjContent").encryptContent(h,n,m);g[j]=o;k.has(b)&&(g.updatedAt_S456130=Date.now(),g.randomisedVersion_S456130=e,g.encryptedWith_S456130=d("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear",g.keyVersion_S456130=l);f==null||f.endSuccess();return g}catch(a){f==null||f.endFail("ear_encrypt_fail");throw c("FBLogger")("messenger_web").catching(a).mustfixThrow("[%s] %s - Encrypted dexie was unable to encrypt an entity for table %s",a.name,a.message,b)}}function b(a,b,e){if(!d("MAWIndexedDb").TABLES_TO_ENCRYPT.includes(b)||!Object.prototype.hasOwnProperty.call(a,j))return a;var f=(i||(i=c("ExecutionEnvironment"))).isInMainThread&&c("justknobx")._("3378")?null:d("MAWQplProxy").startQplUserFlow(c("qpl")._(25313004,"118"));f==null||f.addAnnotations({bool:{isWorker:(i||(i=c("ExecutionEnvironment"))).isInWorker,useMawEar:d("MWEARKeychainV3").isKeychainSettled("maw_ear")},string:{pageID:c("pageID"),tableName:b}});var g;try{var n=a[j],o=babelHelpers["extends"]({},a);(h||(h=d("ODS"))).bumpEntityKey(3185,"maw_db_ear_decryption","encrypted_content_type."+b+"."+(n instanceof ArrayBuffer?"ArrayBuffer":"string"));n=n instanceof ArrayBuffer?n:d("WABase64").decodeB64(n);var p=d("MAWKeychainCrypto").getKeyVersionFromCipherDataString(n),q=p.aadLengthInBytes;p=p.keyVersion;e=e(d("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear",p);g=e;var r=e.dbEntry,s=e.keys;e=e.randomisedVersion;f==null||f.addAnnotations({"int":{contentVersion:a==null?void 0:a.keyVersion_S456130,keyVersion:p,randomisedVersion:e},string:{encryptedWith:a==null?void 0:a.encryptedWith_S456130,randomisedVersionEncryption:a==null?void 0:a.randomisedVersion_S456130}});var t={},u,v;for(e of s)try{u=d("MAWKeychainNaClCrypto").decryptArrayBuffer(e,n,p,r.formatVersion,q);break}catch(a){v=a}if(u==null)throw c("getErrorSafe")(v);var w=d("MAWDbObjDecode").decodeDbObj(u,b);Object.keys(w).forEach(function(a){t[a]=w[a]});delete o[j];s=babelHelpers["extends"]({},o,t);f==null||f.endSuccess();return s}catch(h){if(k.has(b)){f==null||f.addAnnotations({"int":{updatedAt:(q=a==null?void 0:a.updatedAt_S456130)!=null?q:-1}})}f==null||f.markError("ear_decrypt_exception",null,h);f==null||f.endFail("ear_decrypt_fail");c("justknobx")._("3208")&&(i||(i=c("ExecutionEnvironment"))).isInWorker&&(h instanceof d("MAWKeychainNaClCrypto").EARDecryptionError||h instanceof d("MWEARKeychainV3Errors").EARKeychainNotFoundError)&&d("MAWBridge").getBridge().fireAndForget("event","unrecoverableDbError",{error:new(d("MAWUnrecoverableDbErrors").EarRuntimeError)()});throw c("FBLogger")("messenger_web").catching(h).mustfixThrow("[%s] %s - (v2) Encrypted dexie was unable to decrypt an entity for table %s. UpdatedAt: %s. KeyStatus: %s. Signature matches: %s. Key source: %s. Using MAW EAR: %s. Worker: %s. Encrypted With: %s. PageID: %s. Source: %s",h.name,h.message,b,l(a==null?void 0:a.updatedAt_S456130),m(a,g),(a==null?void 0:a.randomisedVersion_S456130)!=null&&((r=g)==null?void 0:r.randomisedVersion)!=null?a.randomisedVersion_S456130===g.randomisedVersion:null,(e=(n=g)==null?void 0:n.dbEntry.source)!=null?e:"-1",d("MWEARKeychainV3").isKeychainSettled("maw_ear"),(i||(i=c("ExecutionEnvironment"))).isInWorker,a==null?void 0:a.encryptedWith_S456130,c("pageID"),d("MAWDexieTable").getDexiePSDItem("transactorName"))}}function l(a){if(a==null)return"unknown";a=Date.now()-a;a=Math.floor(a/(1e3*60*60*24));if(a<1)return"0-1 days";else if(a<7)return"1-7 days";else if(a<14)return"7-14 days";else if(a<30)return"14-30 days";else return"30+ days"}function m(a,b){if((a==null?void 0:a.updatedAt_S456130)==null||b==null)return null;a=d("WATimeUtils").castToUnixTime(a.updatedAt_S456130/1e3);b=b.dbEntry.expiration-d("MAWCryptoConsts").ENC_KEY_TTL;if(a===b)return"same";else if(a>b)return"key_older";else return"key_newer"}g.ENCRYPTED_COLUMN_NAME=j;g.encryptDbObj=a;g.decryptDbObj=b}),98);
__d("MAWDbMsgTypeVersionTxns",["MAWDbAppMeta","MAWDexieTable","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return a.appMeta.get({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion}).then(function(a){return a==null?void 0:a.value.msgTypeVersion})}function b(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion,value:{msgTypeVersion:b}})}function e(a,b){return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion,value:{msgTypeVersion:b}})}function f(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.hmacKey,value:{hmacKey:b}})}function i(a){return a.appMeta.get({key:d("MAWDbAppMeta").AppMetaKeysEnum.hmacKey}).then(function(a){return a==null?void 0:a.value.hmacKey})}function j(a,b){return a.appMeta.get({key:b})}function k(a,b){return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert,value:{allowSecurityAlert:b}}).then(c("emptyFunction"))}function l(a,b){return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf,value:{allowSecurityAlertForSelf:b}}).then(c("emptyFunction"))}function m(a){return j(a,d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert).then(function(a){return(a=a==null?void 0:a.value.allowSecurityAlert)!=null?a:!1})}function n(a){return j(a,d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf).then(function(a){return(a=a==null?void 0:a.value.allowSecurityAlertForSelf)!=null?a:!0})}function o(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.hotlikeSticker,value:{hotlikeSticker:b}})}function p(a){return d("MAWDexieTable").dexieAll([n(a),m(a)]).then(function(a){var b=a[0];a=a[1];return{allowSecurityAlertForContact:a,allowSecurityAlertForSelf:b}})}g.MSG_TYPE_VERSION=(h=d("MAWDbAppMeta")).AppMetaKeysEnum.msgTypeVersion;g.ALLOW_SECURITY_ALERT_FOR_CONTACT=h.AppMetaKeysEnum.allowSecurityAlert;g.ALLOW_SECURITY_ALERT_FOR_SELF=h.AppMetaKeysEnum.allowSecurityAlertForSelf;g.HOT_LIKE=h.AppMetaKeysEnum.hotlikeSticker;g.getMsgTypeVersion=a;g.addMsgTypeVersion=b;g.updateMsgTypeVersion=e;g.addHMACKey=f;g.getHMACKey=i;g.getAppMetaValue=j;g.updateSecurityAlertValueForContact=k;g.updateSecurityAlertValueForSelf=l;g.getSecuritySettingForContact=m;g.getSecuritySettingForSelf=n;g.addHotLike=o;g.maybeBulkGetSecuritySetting=p}),98);
__d("MAWHMACKey",["MAWCryptoConsts","MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWKeychainUtil","MAWSubtleCrypto","MAWTransactionMode","WABase64","tweetnacl-auth"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=d("MAWKeychainUtil").getBufferWithRandomValuesFromLength(d("MAWCryptoConsts").HKDF_SEED_LENGTH_IN_BYTES);return i(a).then(function(a){return d("MAWSubtleCrypto").MAWSubtleCrypto.exportKey("raw",a)})}function a(a,b){a=new TextEncoder().encode(a);b=new Uint8Array(b);a=c("tweetnacl-auth")(a,b);return d("WABase64").encodeB64UrlSafe(a)}function b(){return h().then(function(a){return d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READWRITE},"generateAndInsertHMACKey",function(b){return function(){return d("MAWDbMsgTypeVersionTxns").getHMACKey(b).then(function(c){return c!=null?c:d("MAWDbMsgTypeVersionTxns").addHMACKey(b,a).then(function(){return a})})}})()})}function i(a){return d("MAWSubtleCrypto").MAWSubtleCrypto.importKey("raw",a,{hash:"SHA-256",name:"HMAC"},!0,["sign"])}g.genHMACKey=h;g.hmacTweetNaCl=a;g.generateAndInsertHMACKey=b}),98);
__d("MAWMediaUtils",["FBLogger","MAWDbMedia","MAWDexieTable","MAWHMACKey","MAWImageUtils","MAWMsgType","WABlobToArrayBuffer","WAGlobals","WAHashUtils","WAMsgType","WATimeUtils","asyncToGeneratorRuntime","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b===void 0&&(b="media");switch(a){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return b==="xma-media"?"xma-image":"image";case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return"video";case d("MAWDbMedia").MEDIA_TYPE.PTT:return"ptt";case d("MAWDbMedia").MEDIA_TYPE.GIF:return"gif";case d("MAWDbMedia").MEDIA_TYPE.STICKER:return"sticker";case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return"document";default:throw c("FBLogger")("messenger_web").mustfixThrow("get a wrong media file with type "+a)}}function h(a){try{return d("WABlobToArrayBuffer").blobToArrayBuffer(a).then(i)}catch(a){throw c("FBLogger")("messenger_web").mustfixThrow("Got "+a+" when convert the blob to Uint8Array")}}function i(a){return self.crypto.subtle.digest("SHA-256",a).then(function(a){return new Uint8Array(a)})}function e(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield h(a));a=d("WAHashUtils").toPlaintextHash(a);var b=k(a);return[a,b]});return j.apply(this,arguments)}function k(a){var b=d("WAGlobals").getHMACKey();return d("WAHashUtils").toHashedPlaintextHash(d("MAWHMACKey").hmacTweetNaCl(a,b))}function f(a){if(a==null)return null;var b="preview-"+d("WATimeUtils").unixTime().toString()+".jpeg";return l(a,b,"image/jpeg")}function l(a,b,c){return new File([new Blob([new Uint8Array(a)],{type:c})],b,{type:c})}function m(a,b,c){var e=function(){return c!=null?d("MAWDexieTable").dexieResolve(c.filter(function(a){return a.type!==d("WAMsgType").REVOKED&&b.msgIds.includes(a.msgId)})):a.messages.where("msgId").anyOf(b.msgIds).filter(function(a){return a.type!==d("WAMsgType").REVOKED}).toArray()};return e().then(function(a){return o(b,a)})}function n(a){return a.reduce(function(a,b){var c=b.hdType;c!=null&&(a[b.msgId]=c);return a},{})}function o(a,b){b=b.filter(function(b){return b.type!==d("WAMsgType").REVOKED&&a.msgIds.includes(b.msgId)});var e=b.map(function(a){return a.msgId});e=babelHelpers["extends"]({},a,{msgIds:e});var f=b.reduce(function(a,b){a[b.msgId]=d("WATimeUtils").castToMillisTime(b.sortOrderMs!=null?b.sortOrderMs:b.ts*1e3);return a},{});e=babelHelpers["extends"]({},e,{messagesSortOrderMs:f});if(b.every(function(a){return a.type===d("WAMsgType").STICKER})&&c("justknobx")._("2932")){f=d("MAWImageUtils").boundHeightWidth(e.previewHeight,e.previewWidth,d("MAWImageUtils").STICKER_THUMBNAIL_MAX_SIZE);var g=f.height;f=f.width;e=babelHelpers["extends"]({},e,{mediaType:d("MAWDbMedia").MEDIA_TYPE.STICKER,previewHeight:g,previewHeightLarge:g,previewWidth:f,previewWidthLarge:f})}g=new Set(b.map(function(a){return a.type}));g.forEach(function(b){if(b===d("MAWMsgType").MSG_TYPE.RAVEN)return;a.mediaType!==p(b)&&c("FBLogger")("messenger_web").mustfix("Message and media type mismatch: message with type %s is associated with media with type %s",b,a.mediaType)});return e}function p(a){switch(a){case d("MAWMsgType").MSG_TYPE.IMAGE:return d("MAWDbMedia").MEDIA_TYPE.IMAGE;case d("MAWMsgType").MSG_TYPE.VIDEO:return d("MAWDbMedia").MEDIA_TYPE.VIDEO;case d("MAWMsgType").MSG_TYPE.PTT:return d("MAWDbMedia").MEDIA_TYPE.PTT;case d("MAWMsgType").MSG_TYPE.GIF:return d("MAWDbMedia").MEDIA_TYPE.GIF;case d("MAWMsgType").MSG_TYPE.STICKER:return d("MAWDbMedia").MEDIA_TYPE.STICKER;case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE}}g.getServerMediaTypeFromMediaType=a;g.hashBlob=h;g.hashArrayBuffer=i;g.genBlobHashes=e;g.genHMACPlaintextHash=k;g.convertJpegThumbnailArrayBufferToFile=f;g.getBridgeMediaAnnotatedForDisplay=m;g.createHdTypesForBridgeMedia=n;g.annotateBridgeMediaForDisplay=o;g.getMediaTypeFromMsgType=p}),98);
__d("MAWDexieCastToPromise",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a){return(g||(g=b("Promise"))).resolve(a)}function c(a){return a}f.dexieCastToPromise_I_KNOW_WHAT_I_AM_DOING=a;f.promiseCastToDexiePromise_I_KNOW_WHAT_I_AM_DOING=c}),66);
__d("MAWEBCombinedSwitch",["MAWEBEnabledStateManager","MAWEBLSInWorkerSwitch","MAWEBSwitch"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("MAWEBEnabledStateManager").MAWEBEnabledStateManager)();function i(){h.set(c("MAWEBSwitch").isEnabled()&&c("MAWEBLSInWorkerSwitch").isEnabled())}c("MAWEBSwitch").onSet(function(){i()});c("MAWEBLSInWorkerSwitch").onSet(function(){i()});i();g.MAWEBCombinedSwitch=h}),98);
__d("MAWJobsIndexedDb",["FBLogger","MAWCurrentUser","MAWErrorObject","MAWIndexedDbMetadata","MAWQplProxy","MAWTransactionMode","Promise","WAExceededStorageQuota","WALogger","WAWorkerGlobalScope","emptyFunction","promiseDone","qex","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=null,k=null,l="jobs";function m(){return c("qex")._("940")}function n(){if(j==null)throw c("FBLogger")("messenger_web").mustfixThrow("JobDB IndexDB should've been initialized");return j}function o(){if(k==null)throw c("FBLogger")("messenger_web").mustfixThrow("JobDB IndexDB should've been initialized");return k.then(function(){return n()})}function a(){return j!=null}var p=[function(a){a=a.target.result;a=a.createObjectStore(l,{autoIncrement:!0,keyPath:"jobId"});a.createIndex("uniqKey","uniqKey")},c("emptyFunction"),c("emptyFunction")];function e(a){k=null;j=null;return q(a).then(function(){return j.version})}function q(a){if(k!=null)return k;if(j!=null)return(i||(i=b("Promise"))).resolve();var e=d("MAWCurrentUser").getID(),f=d("MAWIndexedDbMetadata").jobsDbName(e),g=(e=a!=null?a:m())!=null?e:p.length,l=c("qpl")._(25310776,"6155");k=new(i||(i=b("Promise")))(function(a,b){var c=indexedDB.open(f,g);c.onupgradeneeded=function(a){for(var b=0;b<p.length;b++){var c=p[b],d=b+1;r(a,d)&&c(a)}};c.onsuccess=function(b){var c=b.target.result;c.onversionchange=function(){var a;d("MAWQplProxy").sendQplPointThroughBridge(l,"database_jobs_db_versionchange");d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[JobsDb initialization] upgradeneeded is triggered in another worker. This should not happen."])));c.close();(a=d("WAWorkerGlobalScope").workerGlobalScope.location)==null||a.reload==null||a.reload()};j=c;d("MAWQplProxy").sendQplPointThroughBridge(l,"database_jobs_db_ready");a()};c.onerror=function(){d("MAWQplProxy").sendQplPointThroughBridge(l,"database_jobs_db_failed"),b(c.error)}});return k}function r(a,b){var c=a.newVersion;a=a.oldVersion;return a<b&&c>=b}function s(a){return a===d("MAWTransactionMode").READWRITE?"readwrite":"readonly"}function f(a,b,e,f){var g=s(b);return function(b){return function(){for(var h=arguments.length,i=new Array(h),l=0;l<h;l++)i[l]=arguments[l];var m=f!=null?d("MAWQplProxy").startQplUserFlow(f):null,n=function(f){return o().then(function(c){var e=function(b){b=c.transaction(a,b!=null?s(b):g,{durability:"relaxed"});d("WAExceededStorageQuota").listenToQuotaExceededError(b);return b.objectStore(a)};return b.apply(void 0,[e].concat(i))}).then(function(a){m==null||m.endSuccess();return a})["catch"](function(b){m==null||m.endFail("job_transaction_fail");b=d("MAWErrorObject").getErrorObject(b);if((b==null?void 0:b.name)==="InvalidStateError"&&f===1){k=null;j=null;c("promiseDone")(q());return n(f-1)}if(b instanceof Error)throw c("FBLogger")("maw_db").catching(b).mustfixThrow("%s:%s - Error performing transaction in jobDB transactor v2",e,a);throw c("FBLogger")("maw_db").mustfixThrow("%s:%s - Error performing transaction in jobDB transactor v2",e,a)})};return n(1)}}}g.getJobsDbVersion=m;g.getJobDB=n;g.isJobDBInitted=a;g.dbMigrations=p;g.makeJobsDbIgnoringPreviousCreations=e;g.makeJobsDb=q;g.makeJobsTransactor=f}),98);
__d("MAWLegacyDownloadManager",[],(function(a,b,c,d,e,f){"use strict";var g=1e4;a=function(){function a(){this.$1=[],this.$2=new Map()}var b=a.prototype;b.setToDownloadManager=function(a,b){this.$3(),this.$2.set(a,b),this.$1.push(a)};b.getFromDownloadManager=function(a){return this.$2.get(a)};b.removeFromMediaDownloadManager=function(a){this.$2["delete"](a);var b=this.$1.filter(function(b){return b!==a});this.setDownloadManagerQueue(b)};b.setDownloadManagerQueue=function(a){this.$1=a};b.$3=function(){if(this.$1.length>=g){var a=this.$1.shift();this.$2["delete"](a)}};return a}();f.LegacyDownloadManager=a}),66);
__d("MAWLegacyMediaDownloadManager",["MAWLegacyDownloadManager"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("MAWLegacyDownloadManager").LegacyDownloadManager)(),i=new(d("MAWLegacyDownloadManager").LegacyDownloadManager)();function a(a,b){h.setToDownloadManager(a,b)}function b(a){return h.getFromDownloadManager(a)}function c(a){h.removeFromMediaDownloadManager(a)}function e(a,b){i.setToDownloadManager(a,b)}function f(a){return i.getFromDownloadManager(a)}function j(a){i.removeFromMediaDownloadManager(a)}g.setToMediaDownloadManager=a;g.getFromMediaDownloadManager=b;g.removeFromMediaDownloadManager=c;g.setToMediaPlaintextDownloadManager=e;g.getFromMediaPlaintextDownloadManager=f;g.removeFromMediaPlaintextDownloadManager=j}),98);
__d("MAWMediaAfterTxns",["MAWBridgeTypesCreators","MAWDbMedia","MAWDexieCastToPromise","MAWDexieTable","MAWIndexedDb","MAWMediaUtils","MAWRavenUtils","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g,j){if(c("gkx")("9695"))return h(a,b,e,f,g,j);i(a,b,e,f,g,j);return d("MAWDexieTable").dexieResolve()}function h(a,b,c,e,f,g){return e.messages.where("msgId").anyOf(b.msgIds).toArray().then(function(h){var i=a.threadJid,k=d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(h,i);h=d("MAWMediaUtils").createHdTypesForBridgeMedia(h);i=a.ravenEphemeralType!=null&&a.ravenEphemeralMediaState!=null?d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:i,filteredMsgIds:k,hasMediaForUI:c,hdTypes:h,media:b,ravenSettings:d("MAWRavenUtils").deriveRavenSettings(a.ravenEphemeralType,a.ravenEphemeralMediaState),sortOrderMs:a.sortOrderMs,transportKey:g}):d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:i,filteredMsgIds:k,hasMediaForUI:c,hdTypes:h,media:b,sortOrderMs:a.sortOrderMs,transportKey:g});return j(e,babelHelpers["extends"]({},i,{skipShouldUpdateHasMore:f}))})}function i(a,b,e,f,g,h){c("promiseDone")(d("MAWDexieCastToPromise").dexieCastToPromise_I_KNOW_WHAT_I_AM_DOING(f.messages.where("msgId").anyOf(b.msgIds).toArray().then(function(c){var i=a.threadJid,j=d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(c,i);c=d("MAWMediaUtils").createHdTypesForBridgeMedia(c);i=a.ravenEphemeralType!=null&&a.ravenEphemeralMediaState!=null?d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:i,filteredMsgIds:j,hasMediaForUI:e,hdTypes:c,media:b,ravenSettings:d("MAWRavenUtils").deriveRavenSettings(a.ravenEphemeralType,a.ravenEphemeralMediaState),sortOrderMs:a.sortOrderMs,transportKey:h}):d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:i,filteredMsgIds:j,hasMediaForUI:e,hdTypes:c,media:b,sortOrderMs:a.sortOrderMs,transportKey:h});l(f,babelHelpers["extends"]({},i,{skipShouldUpdateHasMore:g}))})))}function j(a,b,e){if(c("gkx")("9695"))return k(a,b,e);l(a,b,e);return d("MAWDexieTable").dexieResolve()}function k(a,b,c){if(!m(b)){d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:b});return d("MAWDexieTable").dexieResolve()}return d("MAWMediaUtils").getBridgeMediaAnnotatedForDisplay(a,b,c).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:a})})}function l(a,b,e){if(!m(b))return d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:b});c("promiseDone")(d("MAWDexieCastToPromise").dexieCastToPromise_I_KNOW_WHAT_I_AM_DOING(d("MAWMediaUtils").getBridgeMediaAnnotatedForDisplay(a,b,e).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:a})})))}function m(a){if(a.ephemeralMediaState!=null||a.ephemeralMediaViewMode!=null)return!1;switch(a.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:case d("MAWDbMedia").MEDIA_TYPE.VIDEO:case d("MAWDbMedia").MEDIA_TYPE.GIF:case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return!0;default:return!1}}g.handleNewMediaAfterTxn=a;g.handleNewMediaAfterTxnWithBridgeMedia=j}),98);
__d("MAWMediaDownloadStatusForUI",["MAWBridge","MAWLoggerUtils","MAWMediaDownloadStatus","MWFBLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("MWFBLogger").MWMediaLogger.tags([d("MAWLoggerUtils").Tag.MediaDownload,d("MAWLoggerUtils").Tag.MessageReceive]);function a(a){var b=a.details,c=a.hash,d=a.status,e=a.type;a=a.validationResult;j({details:b,hash:c,status:d,type:e,validationResult:a})}function j(a){var b=a.details,c=a.hash,e=a.status,f=a.type;a=a.validationResult;d("MAWBridge").getBridge().fireAndForget("event","updateMediaStatus",{details:b,key:c,status:e,type:f,validationResult:a})}function b(a){switch(a){case"disconnected":case"backoff":case"body-network-error":case"no-host":case"download-throttled":case"max-attempts-exceeded":case"runtime-error":case"access-expired":case"http-fetch-exception":case"http-fetch-aborted":case"unspecified-http-error":case"server-timeout":return c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE;case"request-error":case"media-not-found":case"media-entry-invalid":case"media-entry-invalid-direct-path":case"media-entry-invalid-file-enc-sha256":case"media-entry-invalid-file-sha256":case"media-entry-invalid-media-key":case"media-entry-invalid-server-media-type":case"decryption-error":case"enc-hash-mismatch":case"hash-mismatch":case"ciphertext-hash-mismatch":case"signature-expired":return c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE;default:a;i.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["getStatusTypeFromWAAPIDownloadMediaError: Unknown error type ",""])),String(a));return c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE}}g.sendMediaDownloadStatusToUI=a;g.getStatusFromWAAPIDownloadMediaError=b}),98);
__d("WAAPI",["cr:21048"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:21048")}),98);
__d("WACryptoEd25519",["WACryptoPrimitives","err"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function i(a){var b=h;h=[];try{return a()}finally{(h!=null?h:[]).forEach(function(a){return void a.fill(0)}),h=b}}function j(a,b){if(h==null)throw c("err")("allocate called outside of active scope");return new a(b)}function a(a,b,c){d("WACryptoPrimitives").lowlevel.crypto_hash(a,b,c)}function b(a,b){for(var c=0;c<64;++c)b[c]=a[c],a[c]=0;l(a,b);b.fill(0)}function e(a,b){var c=[k(),k(),k(),k()];d("WACryptoPrimitives").lowlevel.scalarbase(c,b);R(a,c)}function k(a){var b=j(Float64Array,16);if(a){if(a.length>16)throw c("err")("Incorrect initialiser array provided to the fieldElement");for(var d=0;d<a.length;d++)b[d]=a[d]}return b}function l(a,b){d("WACryptoPrimitives").lowlevel.modL(a,b)}var m=function(){return k([0])},n=function(){return k([1])},o=function(){return k([2])},p=function(){return k([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139])};function q(){return[k(),k(),k(),k()]}function r(){return[k(),k(),k(),k()]}function s(){return[k(),k(),k()]}function t(a,b){var c=0;b=b;while(b>0){var d=b%65536;a[c]=d;b=(b-d)/65536;c++}}function u(a,b){return T(a,b)?0:1}function v(a){var b=d("WACryptoPrimitives").lowlevel.pack25519,c=j(Uint8Array,32);b(c,a);return c[0]&1}function w(a,b){var c=d("WACryptoPrimitives").lowlevel.S,e=d("WACryptoPrimitives").lowlevel.M,f=o(),g=k();c(g,b);e(a,f,g)}function x(a,b){var c=d("WACryptoPrimitives").lowlevel.S,e=d("WACryptoPrimitives").lowlevel.M,f=d("WACryptoPrimitives").lowlevel.A,g=m(),h=n(),i=k(),j=k(),l=k(),o=k();t(g,486662);c(i,b);e(j,g,b);f(l,i,j);f(o,l,h);e(a,b,o)}function y(a,b,c){c===1&&a.set(b)}var z=new Uint8Array([176,160,14,74,39,27,238,196,120,228,47,173,6,24,67,47,167,215,251,61,153,0,77,43,11,223,193,79,128,36,131,43]);function A(a,b){var c,e=(c=d("WACryptoPrimitives")).lowlevel.unpack25519,f=c.lowlevel.pow2523,g=c.lowlevel.M;c=c.lowlevel.S;var h=k();e(h,z);e=k();f(e,b);f=k();g(f,b,e);e=k();c(e,f);c=k();g(c,f,h);y(f,c,1^u(e,b));a.set(f)}function B(a,b){var c=d("WACryptoPrimitives").lowlevel.Z,e=d("WACryptoPrimitives").lowlevel.A,f=d("WACryptoPrimitives").lowlevel.M,g=n(),h=k(),i=k(),j=k();c(h,b,g);e(i,b,g);S(j,i);f(a,h,j)}function C(a,b){var c=d("WACryptoPrimitives").lowlevel.Z,e=m();c(a,e,b)}function D(a,b){var c=d("WACryptoPrimitives").lowlevel.M;c(a[0],b[0],b[3]);c(a[1],b[1],b[2]);c(a[2],b[2],b[3])}function E(a,b){var c=d("WACryptoPrimitives").lowlevel.M;c(a[0],b[0],b[3]);c(a[1],b[1],b[2]);c(a[2],b[2],b[3]);c(a[3],b[0],b[1])}function F(a,b){var c=d("WACryptoPrimitives").lowlevel.S,e=d("WACryptoPrimitives").lowlevel.A,f=d("WACryptoPrimitives").lowlevel.Z;c(a[0],b[0]);c(a[2],b[1]);w(a[3],b[2]);e(a[1],b[0],b[1]);b=k();c(b,a[1]);e(a[1],a[2],a[0]);f(a[2],a[2],a[0]);f(a[0],b,a[1]);f(a[3],a[3],a[2])}var G=new Uint8Array([6,126,69,255,170,4,110,204,130,26,125,75,209,211,161,197,126,79,252,3,220,8,123,210,187,6,160,96,244,237,38,15]);function H(a,b,c){var e=d("WACryptoPrimitives").lowlevel.unpack25519,f=d("WACryptoPrimitives").lowlevel.M,g=k();e(g,G);e=k();B(e,b);var h=k();x(h,b);var i=k();A(i,h);h=k();f(h,b,g);b=k();S(b,i);g=k();f(g,h,b);i=k();C(i,g);y(g,i,v(g)^c);a[0].set(g);a[1].set(e);a[2].set(n());f(a[3],a[0],a[1])}function I(a,b){a[0].set(b[0]),a[1].set(b[1]),a[2].set(b[2])}function J(a,b){var c=s();I(c,b);F(a,c)}function K(a,b){var c=r(),d=s();J(c,b);D(d,c);F(c,d);D(d,c);F(c,d);E(a,c)}function L(a){var b,c=(b=d("WACryptoPrimitives")).lowlevel.S,e=b.lowlevel.M,f=b.lowlevel.pow2523;b=b.lowlevel.pack25519;var g=k(),h=k(),i=k(),j=k(),l=k();f(g,a);c(h,g);c(i,h);e(j,i,a);e(l,j,a);f=new Uint8Array(32);b(f,l);return 1&f[31]}function M(a,b){C(a[0],b[0]),a[1].set(b[1]),a[2].set(b[2]),C(a[3],b[3])}function f(a,b){var c=q();b=U(c,b);if(b!==0)return-1;M(a,c);return 0}function N(a,b){var c=d("WACryptoPrimitives").lowlevel.M,e=d("WACryptoPrimitives").lowlevel.A;b=b;var f=n(),g=m();t(g,486662);var h=k();w(h,b);b=k();e(b,h,f);h=k();S(h,b);f=k();c(f,h,g);b=k();C(b,f);c=k();x(c,b);h=L(c);f=k([0]);y(f,g,h);c=k();e(c,b,f);g=k();C(g,c);y(c,g,h);a.set(c)}function O(a){var b=d("WACryptoPrimitives").lowlevel.unpack25519;a=d("WACryptoPrimitives").hash(a);var c=(a[31]&128)>>7;a[31]&=127;var e=k();b(e,a);b=k();P(b,e);a=q();H(a,b,c);e=q();K(e,a);return e}function P(a,b){return i(function(){return N(a,b)})}function Q(a){return i(function(){return O(a)})}function R(a,b){var c=k(),e=k(),f=k(),g=d("WACryptoPrimitives").lowlevel.M,h=d("WACryptoPrimitives").lowlevel.pack25519;S(f,b[2]);g(c,b[0],f);g(e,b[1],f);h(a,e);g=new Uint8Array(32);h(g,c);a[31]^=(g[0]&1)<<7}function S(a,b){var c=k();c.set(b);var e=d("WACryptoPrimitives").lowlevel.M,f=d("WACryptoPrimitives").lowlevel.S;for(var g=253;g>=0;--g)f(c,c),g!==2&&g!==4&&e(c,c,b);a.set(c)}function T(a,b){var c=d("WACryptoPrimitives").lowlevel.pack25519,e=d("WACryptoPrimitives").lowlevel.crypto_verify_32,f=new Uint8Array(32),g=new Uint8Array(32);c(f,a);c(g,b);return e(f,0,g,0)}function U(a,b){var c,e=(c=d("WACryptoPrimitives")).lowlevel.set25519,f=c.lowlevel.S,g=c.lowlevel.M,h=c.lowlevel.Z,i=c.lowlevel.A,j=c.lowlevel.D,l=c.lowlevel.unpack25519;c=c.lowlevel.pow2523;var o=k(),q=k(),r=k(),s=k(),t=k(),u=k(),v=k();e(a[2],n());l(a[1],b);f(r,a[1]);g(s,r,j);h(r,r,a[2]);i(s,a[2],s);f(t,s);f(u,t);g(v,u,t);g(o,v,r);g(o,o,s);c(o,o);g(o,o,r);g(o,o,s);g(o,o,s);g(a[0],o,s);f(q,a[0]);g(q,q,s);T(q,r)&&g(a[0],a[0],p());f(q,a[0]);g(q,q,s);if(T(q,r))return-1;V(a[0])===b[31]>>7&&h(a[0],m(),a[0]);g(a[3],a[0],a[1]);return 0}function V(a){var b=d("WACryptoPrimitives").lowlevel.pack25519,c=new Uint8Array(32);b(c,a);return c[0]&1}g.runInAllocationScope=i;g.allocate=j;g.hashSha512=a;g.reduce=b;g.scalarmultBase=e;g.fieldElement=k;g.modL=l;g.p3Element=q;g.unpack=f;g.elligator=P;g.hashToPoint=Q;g.pack=R;g.inv25519=S;g.unpackneg=U}),98);
__d("WADbDeviceRegistration",["gkx"],(function(a,b,c,d,e,f,g){"use strict";a=25;b=6;d=b;e="https://reg-e2ee.facebook.com";f=c("gkx")("13108")?"https://reg-e2ee.messenger.com":e;c="https://v.whatsapp.net";var h="https://reg-e2ee.instagram.com",i="/v2/fb_icdc_fetch",j="/v2/fb_register_v2",k="Device has already been registered to WA servers",l="Device registration finished successfully",m="Device registration retries failed "+b+" times. No longer attempting registration.",n="Device registration response was null",o="Current user id is zero",p="CryptoAuthToken is empty",q="CryptoAuthToken is expired",r={failed:"failed",finished:"finished"};g.MAX_USERS_FOR_NOTIFY_DEVICE_CHANGE=a;g.MAX_DEVICE_REGISTRATION_RETRIES=b;g.MAX_ROTATE_CRYPTO_AUTH_TOKEN_RETRIES=d;g.REG_FB_DOMAIN=e;g.REG_MSGR_DOMAIN=f;g.REG_WA_DOMAIN=c;g.REG_IGD_DOMAIN=h;g.ICDC_ENDPOINT=i;g.REGISTRATION_ENDPOINT=j;g.DEVICE_ALREADY_REGISTERED=k;g.DEVICE_SUCCESSFULLY_REGISTERED=l;g.FAILED_REGISTRATION_RETRIES=m;g.NULL_RESPONSE_FROM_SERVER=n;g.DEVICE_REGISTER_ERROR_ZERO_AS_USER_ID=o;g.DEVICE_REGISTER_ERROR_EMPTY_CAT_TOKEN=p;g.DEVICE_REGISTER_ERROR_EXPIRED_CAT_TOKEN=q;g.RegistrationStatesEnum=r}),98);
__d("WAGetPlatformFromStanzaId",["WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){try{var b=(1<<5)-1;b=BigInt(b<<17);var c=BigInt(0),e=BigInt(1<<17);b=BigInt(a)&b;if(b===c)return"web";return b===e?"mobile":"unknown"}catch(b){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to parse stanza id "," for platform: ",""])),a,b);return"error"}}g.getPlatformFromStanzaId=a}),98);
__d("WAIsMediaExpiredError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){switch(a){case"signature-expired":return!0;case"hash-mismatch":case"ciphertext-hash-mismatch":case"enc-hash-mismatch":case"decryption-error":case"max-attempts-exceeded":case"request-error":case"download-throttled":case"media-not-found":case"media-entry-invalid":case"media-entry-invalid-direct-path":case"media-entry-invalid-file-enc-sha256":case"media-entry-invalid-file-sha256":case"media-entry-invalid-media-key":case"media-entry-invalid-server-media-type":case"no-host":case"backoff":case"body-network-error":case"disconnected":case"runtime-error":case"access-expired":case"http-fetch-exception":case"http-fetch-aborted":case"unspecified-http-error":case"server-timeout":case"missing-expected-hmacs":case"hmac-chiphertext-array-mismatch":return!1;default:a;return!0}};f.isMediaExpiredError=a}),66);
__d("WALoggerTag",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["CryptoManager","MediaPreview","PrekeyGenerateAndUpload","SignedPrekey","SignedPrekeyRotation","OneTimePrekey"]);c=a;f["default"]=c}),66);
__d("WAPREList",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({APP_STATE_SYNC_DAILY:"app_state_sync_daily",CREATE_GROUP:"create_group",DECRYPT_MESSAGE_FINAL:"decrypt_message_final",DELETE_THREAD:"delete_thread",DOWNLOAD_AND_DECRYPT:"download_and_decrypt",EBDB_INIT:"ebdb_init",FRANKING_VALIDATION:"franking_validation",GET_DEVICES:"get_devices",ICDC_ERROR:"icdc_error",MEDIA_DOWNLOAD:"media_download",MEDIA_UPLOAD:"media_upload",MEDIA_VALIDATE:"media_validate",MESSAGE_DECRYPTION:"message_decryption",MESSAGE_ENCRYPTION:"message_encryption",OFFLINE_QUEUE:"offline_queue",OFFLINE_RETRY:"offline_retry",ONE_QUEUE:"one_queue",QUERY_GROUP:"query_group",QUERY_GROUPS:"query_groups",RECEIVE_MESSAGE:"receive_message",REMOVE_PARTICIPANTS:"remove_participants",SEND_MESSAGE:"send_message",STANZA_QUEUE_MESSAGE_CONSUMER:"stanza_queue_message_consumer",SYNCD:"syncd",SYNCD_BOOTSTRAP_APP_STATE_DOWNLOAD:"syncd_bootstrap_app_state_download",SYNCD_BOOTSTRAP_DATA_APPLIED:"syncd_bootstrap_data_applied",SYNCD_CRITICAL_BOOTSTRAP_STAGE:"syncd_critical_bootstrap_stage",SYNCD_CRITICAL_EVENT:"syncd_critical_event",SYNCD_DECRYPT_MUTATIONS:"syncd_decrypt_mutations",SYNCD_FATAL_ERROR:"syncd_fatal_error",SYNCD_KEY_ROTATION:"syncd_key_rotation",WA_DISCONNECT:"wa_disconnect",WA_FAIL_STANZA_QUEUE_ITEM:"stanza_queue_item_failure",WA_JOB_MANAGER:"wa_job_manager",WA_JOBS_ORCHESTRATOR:"wa_jobs_orchestrator",WA_NO_SIGNED_PRE_KEY:"wa_no_signed_pre_key"});f.PRE_METRIC=a}),66);
__d("WAPREMetrics",["WALogger","WAPREList"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;c=6e4;e=18e4;f=10*60*1e3;var k=0;function a(){var c=[];function e(a){c.push(a)}function b(){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Removing all listeners from PRE_METRICS"]))),c.length=0}function a(a){c.length===0&&d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[PRE] There are no subscribers to PRE events "," ",""])),a.name,a.stage),c.forEach(function(b){b(a)})}return{subscribe:e,notify:a,clear:b}}a=a();var l=a.notify,m=a.clear;a=a.subscribe;var n;"FinalizationRegistry"in self&&"WeakRef"in self&&(n=new FinalizationRegistry(function(a){var b=a.event;a=a.eventFlow;if(a.isActive())try{d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[PRE][","] EventFlow still active during garbage collection"])),b)}catch(a){}}));var o=new Set([d("WAPREList").PRE_METRIC.SEND_MESSAGE,d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD]);function b(a,b,c,d){c==null&&k++;var e=c!=null?c:k,f="open";c==null?l({name:a,stage:"START",instanceKey:e,annotations:b,timeoutInMs:d}):l({name:a,stage:"RESUME",instanceKey:e,annotations:b});var g;function h(){if(g!=null){var a=g.deref();if(a!=null){var b;(b=n)==null||b.unregister(a)}}}d={addPoint:function(c,b){l({name:a,stage:"POINT",reason:c,instanceKey:e,annotations:b})},addAnnotations:function(b){l({name:a,stage:"ANNOTATE",instanceKey:e,annotations:b})},endSuccess:function(b){l({name:a,stage:"SUCCESS",instanceKey:e,annotations:b}),f="closed",h()},endCancel:function(b){l({name:a,stage:"CANCEL",instanceKey:e,annotations:b}),h()},endFail:function(c,b){l({name:a,stage:"FAIL",reason:c,instanceKey:e,annotations:b}),f="closed",h()},getFlowDetails:function(){return{name:a,instanceKey:e}},isActive:function(){return f==="open"}};n&&!o.has(a)&&c==null&&(n.register(d,{event:a,eventFlow:{endCancel:d.endCancel,isActive:d.isActive}}),g=new WeakRef(d));return d}g.QPL_DEFAULT_TIMEOUT_IN_MS=c;g.QPL_RECEIVE_MESSAGE_TIMEOUT_IN_MS=e;g.QPL_MEDIA_DOWNLOAD_TIMEOUT_IN_MS=f;g.clear=m;g.subscribe=a;g.startMetric=b}),98);
__d("WAPromiseQueue",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;a=function(){function a(a){a===void 0&&(a=-1),this.$1=(g||(g=b("Promise"))).resolve(),this.$3=0,this.$2=a}var c=a.prototype;c.wait=function(){return this.$1};c.enqueueHandlers=function(a,b,c){var d=this;this.$3++;b=this.$1.then(function(){return a}).then(b,c);c=b.then();this.$1=h(b,this.$2)["finally"](function(){d.$3--});return c};c.enqueue=function(a){var b=this;this.$3++;a=this.$1.then(a);var c=a.then();this.$1=h(a,this.$2)["finally"](function(){b.$3--});return c};c.size=function(){return this.$3};return a}();c=function(){function a(a){a===void 0&&(a=-1),this.$1=new Map(),this.$2=a}var c=a.prototype;c.waitIfPending=function(a){return this.$1.get(a)};c.wait=function(a){return this.$1.get(a)||(g||(g=b("Promise"))).resolve()};c.enqueueHandlers=function(a,b,c,d){c=this.wait(a).then(function(){return b}).then(c,d);return this.$3(a,c)};c.enqueue=function(a,b){b=this.wait(a).then(b);return this.$3(a,b)};c.$3=function(a,b){var c=this,d=b.then(),e,f=function(){c.$1.get(a)===e&&c.$1["delete"](a)};e=h(b,this.$2).then(f,f);this.$1.set(a,e);return d};return a}();function h(a,c){if(c>=0)return new(g||(g=b("Promise")))(function(b){var d=function(){return void b()};a.then(d,d);setTimeout(d,c)});else return a.then(i,i)}function i(){}f.PromiseQueue=a;f.PromiseQueueMap=c}),66);
__d("WASignalSignatures",["Promise","WACryptoDependencies","WACryptoEd25519","WACryptoPrimitives","WAHex","WALogger","WALongInt","WASignalKeys","WASignalLocalStorageProtocol.pb","WASignalOther","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b,c){return d("WACryptoEd25519").runInAllocationScope(function(){var e,f=b.length,g=a.privateKey,h=new Uint8Array(32);(e=d("WACryptoEd25519")).scalarmultBase(h,g);var i=h[31]&128,j=new Uint8Array(f+128);j[0]=254;j.fill(255,1,32);j.set(g,32);j.set(b,64);j.set(c,f+64);var k=e.allocate(Uint8Array,64);e.hashSha512(k,j,f+128);j.set(h,32);h=e.allocate(Float64Array,64);e.reduce(k,h);e.scalarmultBase(j,k);var l=e.allocate(Uint8Array,64);e.hashSha512(l,j,f+64);e.reduce(l,h);for(f=0;f<32;++f)h[f]=k[f];for(f=0;f<32;++f)for(k=0;k<32;++k)h[f+k]+=l[f]*g[k];e.modL(j.subarray(32,64),h);return{pubKeyNegative:i!==0,signedMsg:j}})}function a(a,c){return(i||(i=b("Promise"))).resolve().then(function(){var b=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(b);return k(a,c,b)})}function e(a,b,c){var e=c[63];return e&96?!1:d("WACryptoEd25519").runInAllocationScope(function(){var f,g,h=(f=d("WACryptoPrimitives")).lowlevel.A,i=f.lowlevel.M,j=f.lowlevel.Z,k=f.lowlevel.pack25519,l=f.lowlevel.unpack25519,m=(g=d("WACryptoEd25519")).allocate(Uint8Array,64);m.set(c);m[63]=e&127;var n=g.fieldElement(),o=g.fieldElement(),p=g.fieldElement(),q=g.fieldElement(),r=g.fieldElement(),s=g.allocate(Uint8Array,32),t=g.fieldElement();t[0]=1;l(n,a.subarray(1));j(o,n,t);h(p,n,t);g.inv25519(q,p);i(r,o,q);k(s,r);s[31]=s[31]&127|e&128;return f.signDetachedVerify(b,m,s)})}function k(a,b,c){a=j(a,b,c);b=d("WASignalOther").sliceBytes(a.signedMsg,0,64);b[63]=b[63]&127|(a.pubKeyNegative?128:0);return b}function l(a,b,e){var f=d("WASignalKeys").makeKeyPair(),g=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(g);e=k(e,d("WASignalKeys").serializePubKey(f),g);if(!Number.isSafeInteger(b))throw c("err")("Expected timestamp to be a safe integer, given "+String(b));return{id:d("WASignalKeys").castToPreKeyId(a),ts:b,keyPair:f,signature:e}}function f(a,b){var c=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(c);return k(a,b,c)}function m(a){var b=a.id,c=a.keyPair;return d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").SignedPreKeyRecordStructureSpec,{id:b,publicKey:d("WASignalKeys").serializePubKey(c),privateKey:c.privateKey,signature:a.signature,timestamp:a.ts})}function n(a){try{a=d("decodeProtobuf").decodeProtobuf(d("WASignalLocalStorageProtocol.pb").SignedPreKeyRecordStructureSpec,a);var b=a.id,c=a.publicKey,e=a.privateKey,f=a.signature;a=a.timestamp;return b==null||c==null||e==null||f==null||a==null?null:{id:d("WASignalKeys").castToSignedPreKeyId(b),ts:d("WALongInt").numberOrThrowIfTooLarge(a),keyPair:d("WASignalKeys").makeKeyPairFromSerialized(d("WASignalOther").toBytes(e,32),d("WASignalKeys").castToSerializedPubKey(new Uint8Array(c))),signature:d("WASignalOther").toBytes(f,64)}}catch(a){d("WALogger").DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["deserializeSignedPreKey error ",""])),a);return null}}function o(a){return new Uint8Array(d("WAHex").parseHex(a))}function p(a){if(a.length===33)return d("WASignalKeys").castToSerializedPubKey(a);else if(a.length===32)return d("WASignalKeys").serializeIdentity(a);else throw c("err")("verifyCertificate publicKey incorrect length")}function q(a,c,d){return(i||(i=b("Promise"))).resolve().then(function(){var b=l(a,c,d),e=m(b);return{plainObject:b,record:e}})}g.signMsg=a;g.verifyMsgSignalVariant=e;g.makeSignature=k;g.makeSignedPreKey=l;g.signSenderKeyMessage=f;g.serializeSignedPreKeyForPrivateStorage=m;g.deserializeSignedPreKey=n;g.convertPublicKeyHexToUint8Array=o;g.convertPublicKeyToSerializedPubKey=p;g.generateSignedPreKey=q}),98);
__d("WASmaxInPreKeysIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","item-not-found");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",404);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorItemNotFoundMixin=a}),98);
__d("WASmaxInPreKeysRequestErrorsFetchDigest",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorItemNotFoundMixin","WASmaxInPreKeysIQErrorNotAcceptableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:b.value});var c=d("WASmaxInPreKeysIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:c.value});var e=d("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return e.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorNotAcceptable","IQErrorItemNotFound","IQErrorFallbackClient"],[b,c,e])}g.parseRequestErrorsFetchDigest=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrorsFetchDigest","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrorsFetchDigest").parseRequestErrorsFetchDigest(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrorsFetchDigest:b.value}))}g.parseFetchDigestResponseRequestError=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseFetchDigestResponseServerError=a}),98);
__d("WASmaxInPreKeysKeysHashMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"hash");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,20,20);return!a.success?a:d("WAResultOrError").makeResult({hashElementValue:a.value})}g.parseKeysHashMixin=a}),98);
__d("WASmaxInPreKeysPreKeyIDListMixin",["WAResultOrError","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"id");if(!b.success)return b;b=d("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(a);return!b.success?b:b}function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"list");if(!a.success)return a;a=d("WASmaxParseUtils").mapChildrenWithTag(a.value,"id",0,2e4,h);return!a.success?a:d("WAResultOrError").makeResult({listId:a.value})}g.parsePreKeyIDListListId=h;g.parsePreKeyIDListMixin=a}),98);
__d("WASmaxInPreKeysIdentityDigestBundleMixin",["WAResultOrError","WASmaxInPreKeysIdentityKeyMixin","WASmaxInPreKeysKeyTypeMixin","WASmaxInPreKeysKeysHashMixin","WASmaxInPreKeysPreKeyIDListMixin","WASmaxInPreKeysRegistrationIDMixin","WASmaxInPreKeysSignedPreKeyMixin"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysRegistrationIDMixin").parseRegistrationIDMixin(a);if(!b.success)return b;var c=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(a);if(!c.success)return c;var e=d("WASmaxInPreKeysPreKeyIDListMixin").parsePreKeyIDListMixin(a);if(!e.success)return e;var f=d("WASmaxInPreKeysSignedPreKeyMixin").parseSignedPreKeyMixin(a);if(!f.success)return f;var g=d("WASmaxInPreKeysKeyTypeMixin").parseKeyTypeMixin(a);a=d("WASmaxInPreKeysKeysHashMixin").parseKeysHashMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,c.value,e.value,f.value,{keyTypeMixin:g.success?g.value:null},a.value))}g.parseIdentityDigestBundleMixin=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseSuccess",["WAResultOrError","WASmaxInPreKeysIQResultResponseMixin","WASmaxInPreKeysIdentityDigestBundleMixin","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"digest");if(!c.success)return c;var e=d("WASmaxParseReference").optionalAttrStringFromReference(b,["digest","identity_type"]);if(!e.success)return e;e=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,c.value,"identity_type",e.value);if(!e.success)return e;c=d("WASmaxInPreKeysIdentityDigestBundleMixin").parseIdentityDigestBundleMixin(c.value);if(!c.success)return c;a=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({hasDigestIdentityType:e.value!=null,digestIdentityDigestBundleMixin:c.value},a.value))}g.parseFetchDigestResponseSuccess=a}),98);
__d("WASmaxOutPreKeysFetchDigestRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin"],(function(a,b,c,d,e,f,g){function a(){var a=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"get"},d("WASmaxJsx").smax("digest",null)));return a}g.makeFetchDigestRequest=a}),98);
__d("WASmaxPreKeysFetchDigestRPC",["WAComms","WASmaxInPreKeysFetchDigestResponseRequestError","WASmaxInPreKeysFetchDigestResponseServerError","WASmaxInPreKeysFetchDigestResponseSuccess","WASmaxOutPreKeysFetchDigestRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WASmaxOutPreKeysFetchDigestRequest").makeFetchDigestRequest();a=(yield d("WAComms").sendSmaxStanza(b,a));var c=d("WASmaxInPreKeysFetchDigestResponseSuccess").parseFetchDigestResponseSuccess(a,b);if(c.success)return{name:"FetchDigestResponseSuccess",value:c.value};var e=d("WASmaxInPreKeysFetchDigestResponseRequestError").parseFetchDigestResponseRequestError(a,b);if(e.success)return{name:"FetchDigestResponseRequestError",value:e.value};a=d("WASmaxInPreKeysFetchDigestResponseServerError").parseFetchDigestResponseServerError(a,b);if(a.success)return{name:"FetchDigestResponseServerError",value:a.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("FetchDigest",{Success:c,RequestError:e,ServerError:a}))});return h.apply(this,arguments)}g.sendFetchDigestRPC=a}),98);
__d("WARequestPreKeyDigestProtocol",["WABinary","WAConvertRegistrationIdMixin","WAConvertSignedPreKeyMixin","WACryptoDependencies","WACryptoUtils","WAParsableXmlNode","WAResultOrError","WASignalKeys","WASmaxPreKeysFetchDigestRPC","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=d("WATagsLogger").TAGS(["requestPreKeyDigestProtocol"]);function a(a){return d("WASmaxPreKeysFetchDigestRPC").sendFetchDigestRPC({withoutRetry:!1}).then(function(b){switch(b.name){case"FetchDigestResponseServerError":var c=b.value.errorServerErrors.name;j.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),b.name,c);return d("WAResultOrError").makeError({type:"server-error",payload:c});case"FetchDigestResponseRequestError":c=b.value.errorRequestErrorsFetchDigest.name;j.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),b.name,c);return d("WAResultOrError").makeError({type:"request-error",payload:c});default:b.name;c=k(b.value.digestIdentityDigestBundleMixin);return l(c,a).then(function(a){return a==="ok"?d("WAResultOrError").makeResult():d("WAResultOrError").makeError({type:"compare-error",payload:a})})}})}function k(a){var b=d("WAConvertRegistrationIdMixin").registrationIdMixin(a),c=d("WAConvertSignedPreKeyMixin").convertSignedPreKeyMixin(a),e=a.listId.map(function(a){return d("WASignalKeys").castToPreKeyId(d("WAParsableXmlNode").convertBytesToUint(a.elementValue,3))});a=a.hashElementValue;return{regId:b,skeyId:c.id,preKeyIds:e,hash:a}}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a.regId!==b.regInfo.regId)return"RegIdMismatch";if(a.skeyId!==b.signedPreKey.id)return"SignedPreKeyIdMismatch";var c=new Map();b.preKeys.forEach(function(a){return c.set(a.id,a)});var e=a.preKeyIds.some(function(a){return!c.has(a)});if(e)return"UnknownPreKey";e=a.preKeyIds.map(function(a){return c.get(a)}).filter(Boolean);b=(yield n(b,e));return!d("WACryptoUtils").uint8ArraysEqual(b,a.hash)?"HashMismatch":"ok"});return m.apply(this,arguments)}function n(a,b){var c=new(d("WABinary").Binary)();c.writeByteArray(a.regInfo.staticKeyPair.publicKey);c.writeByteArray(a.signedPreKey.keyPair.publicKey);c.writeByteArray(a.signedPreKey.signature);b.forEach(function(a){c.writeByteArray(a.keyPair.publicKey)});return d("WACryptoDependencies").getCrypto().subtle.digest("SHA-1",c.readByteArrayView()).then(function(a){return new Uint8Array(a)})}g.requestPreKeyDigestProtocol=a}),98);
__d("WARequestPreKeyDigest",["WABridge","WAGenerateAndUploadPreKeys","WAGetKeysForUpload","WAGlobals","WALogger","WAOdsEnums","WARequestPreKeyDigestProtocol","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield a(function(a){a=a.cryptoManager;return d("WAGetKeysForUpload").getKeysForUpload(a)}));a=(yield d("WARequestPreKeyDigestProtocol").requestPreKeyDigestProtocol(a.value));if(a.success===!1){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_DIGEST,key:"fail"});if(a.error.type==="compare-error"){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["PreKey digest comparison failed: ",""])),a.error.payload);d("WAGenerateAndUploadPreKeys").generateAndUploadPreKeys(null,{reason:"prekey digest comparison failed"})["catch"](function(a){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Error while generating and uploading prekeys: ",""])),a)});return}throw c("err")("Error while requesting key digest: "+a.error.type+" "+a.error.payload)}a.success;d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_DIGEST,key:"success"})});return k.apply(this,arguments)}function a(a){return j(function(a){return d("WAGlobals").getWaOneQueue().enqueue(a,{operationType:"request_prekey_digest",flush:!1})})}g.requestPreKeyDigestFn=j;g.requestPreKeyDigest=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrors").parseRequestErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrors:b.value}))}g.parseRotateSignedResponseRequestError=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseRotateSignedResponseServerError=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseSuccess",["WASmaxInPreKeysIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseRotateSignedResponseSuccess=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseValidationError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysIdentityKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;var e=d("WASmaxParseUtils").attrString(c.value,"text");if(!e.success)return e;var f=d("WASmaxParseUtils").attrIntRange(c.value,"code",400,499);if(!f.success)return f;c=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(c.value);if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorText:e.value,errorCode:f.value,errorIdentityKeyMixin:c.value},a.value))}g.parseRotateSignedResponseValidationError=a}),98);
__d("WASmaxOutPreKeysRotateSignedRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WASmaxOutPreKeysSignedPreKeyMixin"],(function(a,b,c,d,e,f,g){function a(a){a=a.signedPreKeyMixinArgs;a=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"set"},d("WASmaxOutPreKeysSignedPreKeyMixin").mergeSignedPreKeyMixin(d("WASmaxJsx").smax("rotate",null),a)));return a}g.makeRotateSignedRequest=a}),98);
__d("WASmaxPreKeysRotateSignedRPC",["WAComms","WASmaxInPreKeysRotateSignedResponseRequestError","WASmaxInPreKeysRotateSignedResponseServerError","WASmaxInPreKeysRotateSignedResponseSuccess","WASmaxInPreKeysRotateSignedResponseValidationError","WASmaxOutPreKeysRotateSignedRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutPreKeysRotateSignedRequest").makeRotateSignedRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInPreKeysRotateSignedResponseSuccess").parseRotateSignedResponseSuccess(b,a);if(c.success)return{name:"RotateSignedResponseSuccess",value:c.value};var e=d("WASmaxInPreKeysRotateSignedResponseValidationError").parseRotateSignedResponseValidationError(b,a);if(e.success)return{name:"RotateSignedResponseValidationError",value:e.value};var f=d("WASmaxInPreKeysRotateSignedResponseRequestError").parseRotateSignedResponseRequestError(b,a);if(f.success)return{name:"RotateSignedResponseRequestError",value:f.value};b=d("WASmaxInPreKeysRotateSignedResponseServerError").parseRotateSignedResponseServerError(b,a);if(b.success)return{name:"RotateSignedResponseServerError",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("RotateSigned",{Success:c,ValidationError:e,RequestError:f,ServerError:b}))});return h.apply(this,arguments)}g.sendRotateSignedRPC=a}),98);
__d("WARotateSignedPreKeyProtocol",["WACryptoManager","WAErrorMessage","WAGlobals","WAHandleFailureUtils","WAMakeSignedPreKeyMixin","WAResultOrError","WASmaxPreKeysRotateSignedRPC","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n=d("WATagsLogger").TAGS(["rotateSignedPreKeyProtocol"]);function a(){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){n.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["start generating skey..."])));try{var a=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return d("WACryptoManager").generateSignedPreKey(a)},{operationType:"generate_signed_prekey",flush:!0,afterInit:!0}));n.LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["generated skey. Start rotating skey..."])));a=(yield d("WASmaxPreKeysRotateSignedRPC").sendRotateSignedRPC({signedPreKeyMixinArgs:d("WAMakeSignedPreKeyMixin").makeSignedPreKeyMixin(a)}));switch(a.name){case"RotateSignedResponseValidationError":var b=a.value,c=b.errorCode,e=b.errorText;b=b.errorIdentityKeyMixin;n.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["ValidationError: "," ",""])),c,e);return d("WAResultOrError").makeError({type:"validation-error",identity:b.elementValue});case"RotateSignedResponseRequestError":c=a.value.errorRequestErrors.value.code;e=a.value.errorRequestErrors.name;n.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["RequestError: "," ",""])),c,e);return d("WAResultOrError").makeError({type:"request-error"});case"RotateSignedResponseServerError":b=a.value.errorServerErrors.value.code;c=a.value.errorServerErrors.name;n.ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["ServerError: "," ",""])),b,c);return d("WAResultOrError").makeError({type:"server-error"});default:a.name;n.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["successfully rotated new skey"])));return d("WAResultOrError").makeResult()}}catch(a){e=d("WAErrorMessage").maybeGetMessageFromError(a);if(e.includes("No lastSignedPrekeyId and registration")){yield d("WAHandleFailureUtils").reregisterPhone();return d("WAResultOrError").makeError({type:"no-prekey-reregistered"})}throw a}});return o.apply(this,arguments)}g.rotateSignedPreKeyProtocol=a}),98);
__d("WARotateSignedPreKey",["Promise","WAGenerateAndUploadPreKeys","WALoggerTag","WARotateSignedPreKeyProtocol","WATagsLogger","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=d("WATagsLogger").TAGS([c("WALoggerTag").SignedPrekeyRotation,c("WALoggerTag").SignedPrekey]);function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WARotateSignedPreKeyProtocol").rotateSignedPreKeyProtocol());if(a.success||a.error.type==="no-prekey-reregistered")return;if(a.error.type==="validation-error"){l.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Signed prekey failed server validation. need to upload all keys."])));d("WAGenerateAndUploadPreKeys").generateAndUploadPreKeys(null,{reason:"signed prekey failed server validation"})["catch"](function(a){l.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Error while generating and uploading prekeys: ",""])),a)});return(k||(k=b("Promise"))).resolve()}l.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["rotateSignedPreKey failed."])));throw c("err")("rotateSignedPreKey RPC failed: "+a.error.type)});return m.apply(this,arguments)}g.rotateSignedPreKey=a}),98);
__d("WAStartMediaDownloadQplFlow",["WAGetPlatformFromStanzaId","WAGetStorageQplAnnotations","WAJids","WAMediaUtils","WAPREList","WAPREMetrics"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.downloadEntry,c=a.msgType,e=a.triggerUIView,f=a.protocolMsgId,g=a.isPreview;a=a.xmaMediaType;var h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD,{bool:{isTransformStreamSupported:d("WAMediaUtils").isTransformStreamSupported()},string:{chat_type:f==null?null:d("WAJids").switchOnMsgrChatJidType(f.chat,{group:function(){return"group"},user:function(){return"user"}}),downloadEntry:g===!0?b+"-preview":b,e2eePlatform:f==null?null:d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(f.externalId),msgType:c,trigger_ui_view:e,xmaMediaType:a!=null?a:void 0}},void 0,d("WAPREMetrics").QPL_MEDIA_DOWNLOAD_TIMEOUT_IN_MS);void d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){h.addAnnotations(a)});return babelHelpers["extends"]({},h,{downloadEntry:b,triggerUIView:e})}g.startMediaDownloadQplFlow=a}),98);