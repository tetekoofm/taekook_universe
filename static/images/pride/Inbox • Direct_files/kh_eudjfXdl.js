;/*FB_PKG_DELIM*/

__d("LSOnMessageStatusChange.nop",["Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c,d,e,f,g,i){return(h||(h=b("Promise"))).resolve()}a.__nop_name__="LSOnMessageStatusChange";g["default"]=a}),98);
__d("LSReplaceOptimsiticMessage",["LSOnMessageStatusChange.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return c.sequence([function(d){return c.nativeOperation(b("LSOnMessageStatusChange.nop"),void 0,a[0],a[1],c.i64.cast([0,60]),void 0)},function(b){return c.forEach(c.filter(c.db.table(12).fetch([[[a[0]]],"optimistic"]),function(b){return b.offlineThreadingId===a[0]&&c.i64.eq(b.authorityLevel,c.i64.cast([0,20]))}),function(b){var d=b.update;b.item;return d({messageId:a[1],authorityLevel:c.i64.cast([0,60]),sendStatus:c.i64.cast([0,2]),sendStatusV2:c.i64.cast([0,2])})})}])},function(a){return c.resolve(d)}])}a.__sproc_name__="LSMailboxReplaceOptimsiticMessageStoredProcedure";a.__tables__=["messages"];e.exports=a}),null);
__d("LSUpdateMessagesOptimisticContext",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.filter(b.db.table(31).fetch([[[a[0]]]]),function(c){return b.i64.eq(c.taskId,a[0])&&c.textHasLinks!==void 0}),function(a){var b=a.update;a.item;return b({textHasLinks:void 0})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpdateMessagesOptimisticContextStoredProcedure";a.__tables__=["messages_optimistic_context"];e.exports=a}),null);
__d("LSWriteCTAIdToThreadsTable",["LSGetFirstAvailableAttachmentCTAID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return a[1]===void 0?c.forEach(c.filter(c.db.table(9).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&(c.i64.neq(b.lastMessageCtaId,void 0)||b.lastMessageCtaType!==void 0)}),function(b){var c=b.update;b.item;return c({lastMessageCtaId:void 0,lastMessageCtaType:void 0,lastMessageCtaTimestampMs:a[2]})}):c.i64.neq(a[2],void 0)?c.sequence([function(b){return c.db.table(9).fetch([[[a[0]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[0]=c.i64.cast([0,0]):(b=a.item,d[0]=b.lastActivityTimestampMs)})},function(e){return c.i64.ge(a[2],d[0])?c.sequence([function(a){return c.storedProcedure(b("LSGetFirstAvailableAttachmentCTAID")).then(function(a){return a=a,d[2]=a[0],a})},function(b){return c.forEach(c.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({lastMessageCtaId:d[2],lastMessageCtaType:a[1],lastMessageCtaTimestampMs:a[2]})})}]):c.resolve(0)}]):c.resolve()},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxWriteCTAIdToThreadsTableStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);