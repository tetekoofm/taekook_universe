<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Santa's Delivery Dash</title>
<style>
  body {
    margin: 0;
    background: #000;
    font-family: sans-serif;
    overflow: hidden;
  }

  #scoreBoard {
    text-align: center;
    font-size: 24px;
    color: #fff;
    margin-top: 10px;
  }

  #gameArea {
    position: relative;
    width: 1200px;
    height: 1200px;
    margin: 20px auto;
    background: #000;
    border: 2px solid #fff;
    overflow: hidden;
  }

  canvas {
    position: absolute;
    top: 0;
    left: 0;
    pointer-events: none;
  }
</style>
</head>
<body>

<div id="scoreBoard">Score: 0</div>
<div id="gameArea"></div>

<script>
const gameArea = document.getElementById('gameArea');
const gameWidth = gameArea.offsetWidth;
const gameHeight = gameArea.offsetHeight;

let score = 0;
let speed = 2;
let santaX = (gameWidth - 100)/2;

// Image sources
const santaImgSrc = "{{ url_for('static', filename='images/games/christmas/santa.png') }}";
const giftImages = [
    "{{ url_for('static', filename='images/games/christmas/tata.png') }}",
    "{{ url_for('static', filename='images/games/christmas/cooky.png') }}",
    "{{ url_for('static', filename='images/games/christmas/green_gift.png') }}",
    "{{ url_for('static', filename='images/games/christmas/purple_gift.png') }}"
];
const obstacleImages = [
    "{{ url_for('static', filename='images/games/christmas/snowflake.png') }}",
    "{{ url_for('static', filename='images/games/christmas/snowman.png') }}"
];
const powerupImage = "{{ url_for('static', filename='images/games/christmas/star.png') }}";

// Create Santa canvas
const santaCanvas = document.createElement('canvas');
santaCanvas.width = 100;
santaCanvas.height = 100;
santaCanvas.style.bottom = '10px';
santaCanvas.style.left = santaX + 'px';
santaCanvas.style.position = 'absolute';
const santaCtx = santaCanvas.getContext('2d');
gameArea.appendChild(santaCanvas);

const santaImg = new Image();
santaImg.src = santaImgSrc;
santaImg.onload = () => {
    santaCtx.clearRect(0,0,100,100);
    santaCtx.drawImage(santaImg, 0,0,100,100);
};

// Falling objects array
let objects = [];

// Function to create a falling object
function createObject(type) {
    const obj = {};
    obj.type = type;
    obj.x = Math.random() * (gameWidth - 70);
    obj.y = -70;
    obj.width = 70;
    obj.height = 70;
    obj.canvas = document.createElement('canvas');
    obj.canvas.width = obj.width;
    obj.canvas.height = obj.height;
    obj.canvas.style.position = 'absolute';
    obj.canvas.style.left = obj.x + 'px';
    obj.canvas.style.top = obj.y + 'px';
    const ctx = obj.canvas.getContext('2d');

    const img = new Image();
    if(type === 'gift') img.src = giftImages[Math.floor(Math.random() * giftImages.length)];
    else if(type === 'obstacle') img.src = obstacleImages[Math.floor(Math.random() * obstacleImages.length)];
    else if(type === 'powerup') img.src = powerupImage;

    img.onload = () => {
        ctx.clearRect(0,0,obj.width,obj.height);
        ctx.drawImage(img,0,0,obj.width,obj.height);
    }

    gameArea.appendChild(obj.canvas);
    objects.push(obj);
}

// Move falling objects and check collisions
function moveObjects() {
    objects.forEach((obj, index) => {
        obj.y += speed;
        obj.canvas.style.top = obj.y + 'px';

        // Collision detection
        const santaRect = {x: santaX, y: gameHeight-110, width: 100, height:100};
        const objRect = {x: obj.x, y: obj.y, width: obj.width, height: obj.height};

        if (!(santaRect.x + santaRect.width < objRect.x ||
              santaRect.x > objRect.x + objRect.width ||
              santaRect.y + santaRect.height < objRect.y ||
              santaRect.y > objRect.y + objRect.height)) {
            
            if(obj.type === 'gift') score += 10;
            else if(obj.type === 'powerup') speed = 5;
            else if(obj.type === 'obstacle') score = Math.max(0, score-20);

            gameArea.removeChild(obj.canvas);
            objects.splice(index,1);
        } else if(obj.y > gameHeight) {
            gameArea.removeChild(obj.canvas);
            objects.splice(index,1);
        }
    });
    document.getElementById('scoreBoard').textContent = "Score: " + score;
}

// Game loop
function gameLoop() {
    if(Math.random() < 0.02) createObject('gift');
    if(Math.random() < 0.01) createObject('obstacle');
    if(Math.random() < 0.005) createObject('powerup');

    moveObjects();
    requestAnimationFrame(gameLoop);
}

// Santa movement
document.addEventListener('keydown', e => {
    if(e.key === 'ArrowLeft') santaX -= 20;
    if(e.key === 'ArrowRight') santaX += 20;
    santaX = Math.max(0, Math.min(gameWidth - 100, santaX));
    santaCanvas.style.left = santaX + 'px';
});

gameLoop();
</script>

</body>
</html>
