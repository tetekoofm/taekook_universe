<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memories Timeline</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Navigation Menu -->
    <nav class="navbar">
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/projects">Upcoming</a></li>
            <li><a href="/memories">Memories</a></li>
            <li><a href="/milestones">Milestones</a></li>
            <li><a href="/radio">Radios</a></li>
            <li><a href="/vibe">Vibe</a></li>
            <li><a href="/fanbases">Fanbases</a></li>
            <li><a href="/fanprojects">Projects</a></li>
            <li><a href="/store">Store</a></li>
        </ul>
    </nav>

    <!-- Main Content Section -->
    <div class="intro">
        <h1 class="heading">Memories</h1>
        <p class="caption">Few memories through their timeline!</p>
    </div>


    <div class="timeline-container">
        <!-- Years Container -->
        <div class="years-container">
            {% for year in timeline_data.keys() | sort %}
            <div class="year-box" data-year="{{ year }}" role="button" aria-expanded="false">
                {{ year }}
                <div class="year-vertical-line"></div> <!-- Vertical line from the year -->
            </div>
            {% endfor %}
        </div>

        <!-- Months and Events for Each Year -->
        {% for year, months in timeline_data.items() %}
        <div class="months-container" data-year="{{ year }}" style="display: none;">
            <div class="horizontal-tree-line"></div> <!-- Horizontal line connecting months -->
            <div class="months-box">
                {% for month_num, events in months.items() %}
                <div class="month-box-container">
                    <!-- Month Box -->
                    <div class="month-box" data-month="{{ month_num }}">
                        <div class="month-vertical-branch"></div> <!-- Short branch above month -->
                        <div class="month-name">{{ calendar.month_abbr[month_num] }} '{{ formatted_years[year] }}'</div>
                    </div>
        
                    <!-- Event list positioned below the month -->
                    <div class="event-list" data-month="{{ month_num }}">
                        {% if events %}
                        {% for event in events %}
                        <div class="event-item" onclick="showEventDetails('{{ event.title }}', '{{ event.date }}', '{{ event.description }}')">
                            <span class="event-bullet">&#8226;</span> {{ event.title }}
                        </div>
                        {% endfor %}
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        {% endfor %}
    </div>

    <!-- Event Modal -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="eventTitle"></h2>
            <p id="eventDate"></p>
            <p id="eventDescription"></p>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const yearBoxes = document.querySelectorAll(".year-box");

            yearBoxes.forEach(box => {
                box.addEventListener("click", () => {
                    const year = box.dataset.year;

                    // Hide all months and reset line visibility
                    document.querySelectorAll(".months-container").forEach(container => {
                        const isActive = container.dataset.year === year;
                        container.style.display = isActive ? "flex" : "none";

                        const horizontalLine = container.querySelector(".horizontal-tree-line");
                        if (horizontalLine) {
                            horizontalLine.style.display = isActive ? "block" : "none";
                        }

                        // Reset year-box lines
                        const yearBox = document.querySelector(`[data-year="${container.dataset.year}"]`);
                        if (yearBox) {
                            const yearLine = yearBox.querySelector(".year-vertical-line");
                            yearLine.style.display = isActive ? "block" : "none";
                        }
                    });

                    // Display vertical branches for the active month's box
                    document.querySelectorAll(".month-box-container").forEach(monthBox => {
                        const branch = monthBox.querySelector(".month-vertical-branch");
                        branch.style.display = branch.closest(".months-container").dataset.year === year ? "block" : "none";
                    });

                    // Set active state for the year clicked
                    yearBoxes.forEach(yb => yb.classList.remove("active"));
                    box.classList.add("active");
                });
            });
        });

        function showEventDetails(title = "No Title", date = "Unknown Date", description = "No Description") {
            document.getElementById("eventTitle").textContent = title;
            document.getElementById("eventDate").textContent = date;
            document.getElementById("eventDescription").textContent = description;
            document.getElementById("eventModal").style.display = "block";
        }

        function closeModal() {
            document.getElementById("eventModal").style.display = "none";
        }
    </script>
    <!-- Footer -->
    <footer>
        <p>Thank you for visiting Purple Dreams: Taekook Edition. Stay tuned for updates!</p>
    </footer>
</body>
</html>
